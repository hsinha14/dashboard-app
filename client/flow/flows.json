[
    {
        "id": "ec253f80.0c828",
        "type": "tab",
        "label": "Job Dashbaord"
    },
    {
        "id": "ca23f017.a3529",
        "type": "tab",
        "label": "Alert DashBoard"
    },
    {
        "id": "556c4c4b.054284",
        "type": "tab",
        "label": "JobStatus Dashboard"
    },
    {
        "id": "87759769.25c5a8",
        "type": "tab",
        "label": "Home Page"
    },
    {
        "id": "61f45e89.e9959",
        "type": "tab",
        "label": "Flow 2"
    },
    {
        "id": "73c2b0f6.41dab",
        "type": "tab",
        "label": "Flow 1"
    },
    {
        "id": "bc71bbb2.5d89a8",
        "type": "tab",
        "label": "Flow 3"
    },
    {
        "id": "17f54f18.339b21",
        "type": "tab",
        "label": "Flow 6"
    },
    {
        "id": "1cee00b4.e18b0f",
        "type": "subflow",
        "name": "Subflow 1",
        "info": "",
        "in": [
            {
                "x": 29,
                "y": 126,
                "wires": [
                    {
                        "id": "d2eb1061.780cf"
                    },
                    {
                        "id": "96a71c02.73d"
                    },
                    {
                        "id": "e7d02c0.1ae84d8"
                    },
                    {
                        "id": "f1576920.15cac8"
                    },
                    {
                        "id": "cc71cf0f.fda8f"
                    }
                ]
            }
        ],
        "out": [
            {
                "x": 712.9999923706055,
                "y": 88,
                "wires": [
                    {
                        "id": "53396eb8.267f",
                        "port": 0
                    }
                ]
            },
            {
                "x": 690.9999847412109,
                "y": 298,
                "wires": [
                    {
                        "id": "7f83fb05.4e5444",
                        "port": 0
                    }
                ]
            }
        ]
    },
    {
        "id": "f359e7a3.637498",
        "type": "mongodb",
        "z": "ec253f80.0c828",
        "hostname": "mongo",
        "port": "27017",
        "db": "node-red",
        "name": "Mongo"
    },
    {
        "id": "2903ae4c.f1dc52",
        "type": "mongodb",
        "z": "73c2b0f6.41dab",
        "hostname": "127.0.0.1",
        "port": "27017",
        "db": "wsr-data",
        "name": "wsrData"
    },
    {
        "id": "c60cb185.3a934",
        "type": "mongodb",
        "z": "61f45e89.e9959",
        "hostname": "127.0.0.1",
        "port": "27017",
        "db": "wsr-data",
        "name": ""
    },
    {
        "id": "3c8699.baeac968",
        "type": "google-credentials",
        "z": "73c2b0f6.41dab",
        "displayName": "Harshita Sinha"
    },
    {
        "id": "fc8ab9ea.abc4b8",
        "type": "http in",
        "z": "ec253f80.0c828",
        "name": "Request",
        "url": "/dashboard/controlm-jobs",
        "method": "get",
        "swaggerDoc": "",
        "x": 108,
        "y": 40,
        "wires": [
            [
                "14dae9c3.2fa3f6"
            ]
        ]
    },
    {
        "id": "6490c6c8.71e308",
        "type": "http response",
        "z": "ec253f80.0c828",
        "name": "Reponse",
        "x": 731,
        "y": 49,
        "wires": []
    },
    {
        "id": "1befc500.4f886b",
        "type": "template",
        "z": "ec253f80.0c828",
        "name": "HTML",
        "field": "payload",
        "fieldType": "msg",
        "format": "handlebars",
        "syntax": "mustache",
        "template": "<!DOCTYPE html>\n<html>\n<head>\n<title>Batch Job DashBoard</title>\n</head>\n<body>\n\n<h1>Batch Job DashBoard</h1>\n<table style=\"width:100%\">\n    <th>JOB_NAME</th>\n    <th>SERVER_NAME</th>\n    <th>START_TIME</th>\n    <th>END_TIME</th>\n    <th>STATUS</th>\n    <th>DESCRIPTION</th>\n    <th>JOB_GROUP</th>\n{{#payload}}\n  <tr>\n    <td>{{JOB_NAME}}</td>\n    <td>{{SERVER_NAME}}</td> \n    <td>{{START_TIME}}</td>\n\t<td>{{END_TIME}}</td>\n\t<td>{{STATUS}}</td>\n\t{{#LOOKUP}}\n\t<td>{{DESCRIPTION}}</td>\n\t<td>{{JOB_GROUP}}</td>\n\t{{/LOOKUP}}\n  </tr>\n  {{/payload}}\n</table>\n\n</body>\n</html>\n\n",
        "x": 500,
        "y": 106,
        "wires": [
            [
                "6490c6c8.71e308"
            ]
        ]
    },
    {
        "id": "14dae9c3.2fa3f6",
        "type": "function",
        "z": "ec253f80.0c828",
        "name": "Set Fetch Properties",
        "func": "var job_type=msg.payload.type;\nif(typeof job_type== \"undefined\"){\n    job_type=/.*.*/;\n}\nmsg.payload=[\n    {\n      $lookup:\n     {\n       from: \"controlm-job-lookup\",\n       localField: \"JOB_NAME\",\n       foreignField: \"JOB_NAME\",\n       as: \"LOOKUP\"\n     }\n   },\n   { $match: {\"LOOKUP.JOB_GROUP\" : job_type  } },\n   { $sort: { START_TIME: -1 }},\n    { $limit : 50 }\n];\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 271,
        "y": 148,
        "wires": [
            [
                "1befc500.4f886b"
            ]
        ]
    },
    {
        "id": "6851e03d.5994e",
        "type": "http in",
        "z": "ec253f80.0c828",
        "name": "Request",
        "url": "/dashboard/alerts",
        "method": "get",
        "swaggerDoc": "",
        "x": 101,
        "y": 186,
        "wires": [
            [
                "33f2dced.9b3cc4"
            ]
        ]
    },
    {
        "id": "ceb78fc1.48a67",
        "type": "http response",
        "z": "ec253f80.0c828",
        "name": "Reponse",
        "x": 724,
        "y": 195,
        "wires": []
    },
    {
        "id": "cf795a56.57ff58",
        "type": "template",
        "z": "ec253f80.0c828",
        "name": "HTML",
        "field": "payload",
        "fieldType": "msg",
        "format": "handlebars",
        "syntax": "mustache",
        "template": "<!DOCTYPE html>\n<html>\n<head>\n<title>Alert DashBoard</title>\n</head>\n<body>\n\n<h1>Alert DashBoard</h1>\n<table style=\"width:100% ;border: 1px solid black;\">\n{{#payload}}\n  <tr>\n    <td style=\"border: 1px solid black;\">{{Asset}}</td>\n    <td style=\"border: 1px solid black;\">{{Severity}}</td> \n    <td style=\"border: 1px solid black;\">{{Mode}}</td>\n\t<td style=\"border: 1px solid black;\">{{Message}}</td>\n\t<td style=\"border: 1px solid black;\">{{AlertDate}}</td>\n\t<td style=\"border: 1px solid black;\">{{AlertKey}}</td>\n  </tr>\n  {{/payload}}\n</table>\n\n</body>\n</html>\n\n",
        "x": 493,
        "y": 252,
        "wires": [
            [
                "ceb78fc1.48a67"
            ]
        ]
    },
    {
        "id": "33f2dced.9b3cc4",
        "type": "function",
        "z": "ec253f80.0c828",
        "name": "Set Fetch Properties",
        "func": "msg.limit= 0;\nmsg.skip= 0;\nmsg.sort={ AlertDate: -1 };\nmsg.payload={Severity:\"major\"};\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 264,
        "y": 294,
        "wires": [
            [
                "cf795a56.57ff58"
            ]
        ]
    },
    {
        "id": "3b54eb7c.48ff44",
        "type": "http request",
        "z": "ca23f017.a3529",
        "name": "getJobGroup",
        "method": "GET",
        "ret": "txt",
        "url": "http://app:81/dashboard/job/lookup",
        "tls": "",
        "x": 425,
        "y": 153.23297119140625,
        "wires": [
            [
                "184e27aa.a32df8"
            ]
        ]
    },
    {
        "id": "cef66459.faad18",
        "type": "http in",
        "z": "ca23f017.a3529",
        "name": "AlertDashboard",
        "url": "/AlertDashboard",
        "method": "get",
        "swaggerDoc": "",
        "x": 85,
        "y": 50.28977966308594,
        "wires": [
            [
                "f4f5efb.32ecc1",
                "3b54eb7c.48ff44"
            ]
        ]
    },
    {
        "id": "f4f5efb.32ecc1",
        "type": "http request",
        "z": "ca23f017.a3529",
        "name": "alertsJson",
        "method": "GET",
        "ret": "obj",
        "url": "http://app:81/dashboard/alerts/api?severity=major",
        "tls": "",
        "x": 420.9516906738281,
        "y": 58,
        "wires": [
            [
                "26d30c49.d69674"
            ]
        ]
    },
    {
        "id": "916e95a0.068558",
        "type": "template",
        "z": "ca23f017.a3529",
        "name": "mainPage",
        "field": "payload",
        "fieldType": "msg",
        "format": "html",
        "syntax": "mustache",
        "template": "<!DOCTYPE html> \n<html>\n<head>\n    <!--<meta http-equiv=\"refresh\" content=\"10\"> -->\n\t<meta name=\"viewport\" content=\"width=device-width, initial-scale=1\">\n    <link rel=\"stylesheet\" href=\"http://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css\">\n    <link rel=\"stylesheet\" href=\"/assets/main.css\">\n    <link rel=\"stylesheet\" href=\"//code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css\">\n    <script src=\"https://code.jquery.com/jquery-1.12.4.js\"></script>\n    <script src=\"https://code.jquery.com/ui/1.12.1/jquery-ui.js\"></script>\n    <link rel=\"stylesheet\" href=\"/assets/main.css\">\n    <script>\n  $( function() {\n    $( \"#start-date\" ).datepicker();\n    $(\"#end-date\").datepicker();\n  } );\n  \n  \n  function formsubmit(){\n    $(\"#startDate\").val($( \"#start-date\" ).val());\n    $(\"#endDate\").val($( \"#end-date\" ).val());\n\n\n  }\n\n  </script>\n    </head>\n    <body class=\"alert-homepage\">\n        <div class=\"container-fluid\">\n            <div class=\"row dashboard-title\">\n                <h1>Alerts Dashboard</h1>\n            </div>\n            <div class=\"row data-col\">\n                <div class=\"col-sm-6\">\n                    <a href=\"/showhourlydata\" id=\"hourlyBox\" target=\"_blank\">\n                    <div class=\"{{hourlyStatus}} status-box\">\n                        <h2>Hourly Status</h2>\n                        <p>Status : {{hourlyStatus}}</p>\n                        <p>Number of alerts: {{hourlyFailed}} ({{hourlyUniqueCount}})</p>\n                    </div>\n                    </a>\n                </div>\n                <div class=\"col-sm-6\">\n                    <a href=\"/showdailystatus\" id=\"dailyBox\" target=\"_blank\">\n                        <div class=\"{{dailyStatus}} status-box\">\n                            <h2>Daily Status</h2>\n                            <p>Status : {{dailyStatus}}</p>\n                            <p>Number of alerts: {{dailyFailed}}  ({{dailyUniqueCount}})</p>\n                        </div>\n                    </a>\n                </div>\n            </div>\n            \n            <div class=\"row date-picker\">\n                <form action=\"/dateSelect\" target=\"_blank\">\n                <p><label>Start Date: <br/><input type=\"text\" id=\"start-date\" name=\"startDate\"></label>\n                <label>End Date: <br/><input type=\"text\" id=\"end-date\" name=\"endDate\"></label>\n                <label>Severity: <br/><select class=\"select-type\" name=\"severity\">\n                    <option value=\"all\">All</option>\n                    <option value=\"major\">Major</option>\n                    <option value=\"minor\">Minor</option>\n                </select>\n                </label>\n                \n                </p>\n                <!--<input type=\"hidden\" id=\"startDate\" name=\"startDate\" value=\"\">\n                <input type=\"hidden\" id=\"endDate\" name=\"endDate\" value=\"\">\n                <input type=\"submit\" id=\"getData\" value=\"Alert Trend\" onClick=\"formsubmit()\">-->\n                <input type=\"submit\" id=\"getData\" value=\"Alert Trend\" >\n                </form>\n            </div>\n           <!-- <p><a href=\"/selectDate\" id=\"dateButton\" target=\"_blank\">Alert Trend</a></p>-->\n        </div>\n\n    </body>\n   \n</html>\n",
        "x": 1053.9546508789062,
        "y": 38,
        "wires": [
            [
                "b8c05c36.22c0b"
            ]
        ]
    },
    {
        "id": "89e1b22a.b5d7c",
        "type": "http response",
        "z": "ca23f017.a3529",
        "name": "httpResponse",
        "x": 1676.963134765625,
        "y": 146.3267059326172,
        "wires": []
    },
    {
        "id": "11818230.e7f19e",
        "type": "function",
        "z": "ca23f017.a3529",
        "name": "function",
        "func": "var hourlyFailed=0,\n    dailyFailed=0,\n    hourlyData=[],\n    dailyData=[];\n\nif (!context.data){\n   context.data = {\n       alerts: {}\n   };\n} \nif(msg.identifier === \"jobAlerts\"){\n    context.data.alerts.jobalerts = msg.payload;\n} else {\n    context.data.alerts.lookup = msg.payload;\n}\n\nif(context.data.alerts.jobalerts && context.data.alerts.lookup){\n     msg.payload = context.data;\n     context.data = null;\n     //for homepage alertdashboard\n     \n    for (var i=0;i<msg.payload.alerts.jobalerts.length;i++){\n        var currentTime=new Date().getTime(),\n            alertDate=new Date(msg.payload.alerts.jobalerts[i].AlertDate).getTime();\n        if((currentTime-3600000) <= alertDate && alertDate<=currentTime){\n            hourlyData.push(msg.payload.alerts.jobalerts[i]);\n            hourlyFailed=hourlyFailed+1;\n        }\n        if((currentTime-86400000) <= alertDate && alertDate<=currentTime){\n            dailyData.push(msg.payload.alerts.jobalerts[i]);\n            dailyFailed=dailyFailed+1;\n        }\n        if(hourlyFailed===0){\n            msg.hourlyStatus=\"Green\";\n        } else msg.hourlyStatus=\"Red\";\n        if(dailyFailed===0){\n            msg.dailyStatus=\"Green\";\n        } else msg.dailyStatus=\"Red\";\n        msg.dailyFailed=dailyFailed;\n        msg.hourlyFailed=hourlyFailed;\n    }\n    msg.dailydata=dailyData;\n    msg.hourlydata=hourlyData;\n    msg.payload.alerts.lookup=JSON.parse(msg.payload.alerts.lookup);\n\n  /**removing dupliacte entries from lookup***/\n  Array.prototype.remove = function(from, to) {\n  var rest = this.slice((to || from) + 1 || this.length);\n  this.length = from < 0 ? this.length + from : from;\n  return this.push.apply(this, rest);\n};\nfor (var i=0;i<msg.payload.alerts.lookup.length;i++) {\n    for(var j=i+1;j<msg.payload.alerts.lookup.length;j++){\n        if(i!=j && (msg.payload.alerts.lookup[i].JOB_NAME == msg.payload.alerts.lookup[j].JOB_NAME)){\n           //delete  msg.payload.alerts.lookup[j];\n           msg.payload.alerts.lookup.remove(j);\n        }\n    }\n}\n \n  /****/\n  \n//for hourlydata array\nvar finalArr=new Array([]),\n    hourlyAlertArray= [];\nfor (var i=0;i<msg.payload.alerts.lookup.length;i++) {\n    var k=0;\n    finalArr[i] = [];\n    var temp1=[];\n    for (var j=0;j<msg.hourlydata.length;j++) {\n        if (msg.hourlydata[j].AlertKey===msg.payload.alerts.lookup[i].JOB_NAME) {\n            msg.hourlydata[j][\"JobGroup\"]=msg.payload.alerts.lookup[i].JOB_GROUP;\n            finalArr[i][k]=msg.hourlydata[j];\n            //msg.hourlydata.splice(j, 1);\n            k++;\n        } else {\n            msg.hourlydata[j][\"JobGroup\"]=\"iLA\";\n            temp1.push(msg.hourlydata[j]);\n        }\n    }\n    msg.hourlydata = temp1;\n    if (finalArr[i].length !== 0) {\n        hourlyAlertArray.push(finalArr[i]);\n    }\n}\n\nvar x = {},y=temp1;\nvar i = y.length;\n//var newArr=[];\nwhile(i--) {\n    var sHash = y[i].AlertKey.toString();\n    if (typeof(x[sHash]) == \"undefined\") \n        x[sHash] = [];\n    x[sHash].push(y[i]);\n}\nvar hourlyNoGroup=[];\nfor(var key in x) {\n    hourlyNoGroup.push(x[key]);\n}\nhourlyAlertArray =hourlyAlertArray.concat(hourlyNoGroup);\nmsg.hourlyAlertData=hourlyAlertArray;\n\n\n//for dailydata array\nvar finalArr1=new Array([]),\n    dailyAlertArray= [];\nfor (var i=0;i<msg.payload.alerts.lookup.length;i++) {\n    var k=0;\n    finalArr1[i] = [];\n    var temp=[];\n    for (var j=0;j<msg.dailydata.length;j++) {\n        if (msg.dailydata[j].AlertKey===msg.payload.alerts.lookup[i].JOB_NAME) {\n            msg.dailydata[j][\"JobGroup\"]=msg.payload.alerts.lookup[i].JOB_GROUP;\n            finalArr1[i][k]=msg.dailydata[j];\n            //delete temp[j];\n            k++;\n        } else {\n            msg.dailydata[j][\"JobGroup\"]=\"iLA\";\n            temp.push(msg.dailydata[j]);\n        }\n    }\n    msg.dailydata = temp;\n    if (finalArr1[i].length !== 0) {\n        dailyAlertArray.push(finalArr1[i]);\n    }\n\n}\n/*var temp=msg.dailydata,\nnewtemp=msg.dailydata;\nfor (var i=0;i<temp;i++) {\n    for (var j=0;j<tempVar;j++) {\n        if(temp[i].AlertKey===tempVar[j]) {\n            newtemp.splice(i,1);\n        }\n    }\n}*/\n\nvar x = {},y=temp;\nvar i = y.length;\n//var newArr=[];\nwhile(i--) {\n    var sHash = y[i].AlertKey.toString();\n    if (typeof(x[sHash]) == \"undefined\") \n        x[sHash] = [];\n    x[sHash].push(y[i]);\n}\nvar dailyNoGroup=[];\nfor(var key in x) {\n    dailyNoGroup.push(x[key]);\n}\ndailyAlertArray =dailyAlertArray.concat(dailyNoGroup);\nmsg.dailyAlertData=dailyAlertArray;\nmsg.dailyUniqueCount=dailyAlertArray.length;\nmsg.hourlyUniqueCount=hourlyAlertArray.length;\n\nif (msg.req.url===\"/alertDashboard\"){\n    return [msg,null,null]\n} else if(msg.req.url===\"/showdailystatus\") {\n    return [null,msg,null]\n} else if(msg.req.url===\"/showhourlydata\") {\n    return [null,null,msg]\n} \n}\n\n",
        "outputs": "3",
        "noerr": 0,
        "x": 786.9573974609375,
        "y": 54.83807373046875,
        "wires": [
            [
                "916e95a0.068558"
            ],
            [
                "1575cdf1.3564f2"
            ],
            [
                "1a623971.3f7dd7"
            ]
        ]
    },
    {
        "id": "350c68fe.633658",
        "type": "http in",
        "z": "ca23f017.a3529",
        "name": "showdailystatus",
        "url": "/showdailystatus",
        "method": "get",
        "swaggerDoc": "",
        "x": 85,
        "y": 111.23297119140625,
        "wires": [
            [
                "f4f5efb.32ecc1",
                "3b54eb7c.48ff44"
            ]
        ]
    },
    {
        "id": "5ea1e5a9.4c940c",
        "type": "template",
        "z": "ca23f017.a3529",
        "name": "daily-status",
        "field": "payload",
        "fieldType": "msg",
        "format": "html",
        "syntax": "mustache",
        "template": "<!DOCTYPE html> \n<html>\n    <head>\n\t<meta name=\"viewport\" content=\"width=device-width, initial-scale=1\">\n    <link rel=\"stylesheet\" href=\"http://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css\">\n    <link rel=\"stylesheet\" href=\"/assets/main.css\">\n    </head>\n<body>\n    <div class=\"container-fluid\">\n        <div class=\"row dashboard-title\">\n            <h1>Alerts Dashboard</h1>\n        </div>\n        {{#dailyAlert.length}}\n        <div class=\"\">\n            <table class=\"table table-bordered alert-table\">\n                <tr>\n                    <th>AlertKey</th>\n                    <th>Group</th>\n                    <th>Count</th>\n                    <th>Last Occurence</th>\n                    <th class=\"message-head\">Message</th>\n                </tr>\n        {{#dailyAlert}}\n        <tr>\n            <td>{{AlertKey}}</td>\n            <td>{{JobGroup}}</td>\n            <td>{{Count}}</td>\n            <td>{{AlertDate}}</td>\n            <td class=\"message-head\"><span class=\"hasTooltip\">{{Message}}<p>{{Message}}</p></span></td>\n            \n        </tr>\n    {{/dailyAlert}}\n    </table>\n    </div>\n    {{/dailyAlert.length}}\n    {{^dailyAlert.length}}\n        <h2>No Alerts to show!</h2>\n    {{/dailyAlert.length}}\n    </div>\n</body>\n</html>",
        "x": 1225,
        "y": 110.23297119140625,
        "wires": [
            [
                "b8c05c36.22c0b"
            ]
        ]
    },
    {
        "id": "ae87e0c5.6dca8",
        "type": "template",
        "z": "ca23f017.a3529",
        "name": "hourly-status",
        "field": "payload",
        "fieldType": "msg",
        "format": "handlebars",
        "syntax": "mustache",
        "template": "<!DOCTYPE html> \n<html>\n    <head>\n\t<meta name=\"viewport\" content=\"width=device-width, initial-scale=1\">\n    <link rel=\"stylesheet\" href=\"http://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css\">\n    <link rel=\"stylesheet\" href=\"/assets/main.css\">\n\n    </head>\n<body>\n    <div class=\"row dashboard-title\">\n        <h1>Alerts Dashboard</h1>\n    </div>\n    {{#hourlyAlert.length}}\n        <div class=\"\">\n            <table class=\"table table-bordered alert-table\">\n                <tr>\n                    <th>AlertKey</th>\n                    <th>Group</th>\n                    <th>Count</th>\n                    <th>Last Occurence</th>\n                    <th class=\"message-head\">Message</th>\n                </tr>\n        {{#hourlyAlert}}\n        <tr>\n            <td>{{AlertKey}}</td>\n            <td>{{JobGroup}}</td>\n            <td>{{Count}}</td>\n            <td>{{AlertDate}}</td>\n            <td class=\"message-head\"><span class=\"hasTooltip\">{{Message}}<p>{{Message}}</p></span></td>\n        </tr>\n    {{/hourlyAlert}}\n    </table>\n    </div>\n    {{/hourlyAlert.length}}\n    {{^hourlyAlert.length}}\n        <h2>No Alerts to show!</h2>\n    {{/hourlyAlert.length}}\n</body>\n</html>",
        "x": 1041,
        "y": 225.23297119140625,
        "wires": [
            [
                "b8c05c36.22c0b"
            ]
        ]
    },
    {
        "id": "1f4e6792.c67d98",
        "type": "http in",
        "z": "ca23f017.a3529",
        "name": "showhourlystatus",
        "url": "/showhourlydata",
        "method": "get",
        "swaggerDoc": "",
        "x": 85,
        "y": 193.23297119140625,
        "wires": [
            [
                "f4f5efb.32ecc1",
                "3b54eb7c.48ff44"
            ]
        ]
    },
    {
        "id": "184e27aa.a32df8",
        "type": "function",
        "z": "ca23f017.a3529",
        "name": "",
        "func": "//msg.identifyGroup=msg.payload;\nmsg.identifier=\"jobLookup\";\nreturn msg;",
        "outputs": "1",
        "noerr": 0,
        "x": 775,
        "y": 157.23297119140625,
        "wires": [
            [
                "11818230.e7f19e"
            ]
        ]
    },
    {
        "id": "26d30c49.d69674",
        "type": "function",
        "z": "ca23f017.a3529",
        "name": "",
        "func": "msg.identifier=\"jobAlerts\";\nreturn msg;",
        "outputs": "1",
        "noerr": 0,
        "x": 592,
        "y": 57.23297119140625,
        "wires": [
            [
                "11818230.e7f19e"
            ]
        ]
    },
    {
        "id": "1575cdf1.3564f2",
        "type": "function",
        "z": "ca23f017.a3529",
        "name": "",
        "func": "var dailyAlert=[];\nfor (var i=0;i<msg.dailyAlertData.length;i++){\n    msg.dailyAlertData[i][0][\"Count\"]=msg.dailyAlertData[i].length;\n    dailyAlert.push(msg.dailyAlertData[i][0]);\n\n}\n\ndailyAlert.sort(function(a, b){\n    return b.Count-a.Count\n});\nmsg.dailyAlert=dailyAlert;\nreturn msg",
        "outputs": 1,
        "noerr": 0,
        "x": 1049.5056762695312,
        "y": 81.47158813476562,
        "wires": [
            [
                "5ea1e5a9.4c940c"
            ]
        ]
    },
    {
        "id": "1a623971.3f7dd7",
        "type": "function",
        "z": "ca23f017.a3529",
        "name": "",
        "func": "var hourlyAlert=[];\nfor (var i=0;i<msg.hourlyAlertData.length;i++){\n    msg.hourlyAlertData[i][0][\"Count\"]=msg.hourlyAlertData[i].length;\n    hourlyAlert.push(msg.hourlyAlertData[i][0]);\n\n}\nhourlyAlert.sort(function(a, b){\n    return b.Count-a.Count\n});\nmsg.hourlyAlert=hourlyAlert;\nreturn msg",
        "outputs": 1,
        "noerr": 0,
        "x": 625.5084838867188,
        "y": 196.47158813476562,
        "wires": [
            [
                "ae87e0c5.6dca8"
            ]
        ]
    },
    {
        "id": "32dff273.7ad12e",
        "type": "template",
        "z": "ca23f017.a3529",
        "name": "dateRangeData",
        "field": "payload",
        "fieldType": "msg",
        "format": "html",
        "syntax": "mustache",
        "template": "<!DOCTYPE html> \n<html>\n    <head>\n\t<meta name=\"viewport\" content=\"width=device-width, initial-scale=1\">\n    <link rel=\"stylesheet\" href=\"http://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css\">\n    <link rel=\"stylesheet\" href=\"/assets/main.css\">\n    </head>\n<body>\n    <div class=\"container-fluid\">\n        <div class=\"row dashboard-title\">\n            <h1>Alerts Dashboard</h1>\n        </div>\n        {{#dailyAlert.length}}\n        <div class=\"\">\n            <table class=\"table table-bordered alert-table\">\n                <tr>\n                    <th>AlertKey</th>\n                    <th>Group</th>\n                    <th>Count</th>\n                    <th>Last Occurence</th>\n                    <th>Severity</th>\n                    <th class=\"message-head\">Message</th>\n                </tr>\n        {{#dailyAlert}}\n        <tr>\n            <td>{{AlertKey}}</td>\n            <td>{{JobGroup}}</td>\n            <td>{{Count}}</td>\n            <td>{{AlertDate}}</td>\n            <td>{{Severity}}</td>\n            <td class=\"message-head\"><span class=\"hasTooltip\">{{Message}}<p>{{Message}}</p></span></td>\n            \n        </tr>\n    {{/dailyAlert}}\n    </table>\n    </div>\n    {{/dailyAlert.length}}\n    {{^dailyAlert.length}}\n        <h2>No Alerts to show!</h2>\n    {{/dailyAlert.length}}\n    </div>\n</body>\n</html>",
        "x": 1366,
        "y": 315.23297119140625,
        "wires": [
            [
                "b8c05c36.22c0b"
            ]
        ]
    },
    {
        "id": "c220697.0bea598",
        "type": "http in",
        "z": "ca23f017.a3529",
        "name": "getUrl",
        "url": "/dateSelect",
        "method": "get",
        "swaggerDoc": "",
        "x": 55,
        "y": 383.23297119140625,
        "wires": [
            [
                "e5258d1b.b8683",
                "cbe12a8b.9fc2a8"
            ]
        ]
    },
    {
        "id": "8132200d.0dabc",
        "type": "http request",
        "z": "ca23f017.a3529",
        "name": "alertsJson",
        "method": "GET",
        "ret": "obj",
        "url": "",
        "tls": "",
        "x": 466,
        "y": 384,
        "wires": [
            [
                "fe27e12e.5a87a"
            ]
        ]
    },
    {
        "id": "e5258d1b.b8683",
        "type": "function",
        "z": "ca23f017.a3529",
        "name": "",
        "func": "var msgurl=msg.req.url,\nfinalUrl=msgurl.substring(msgurl.indexOf(\"?\") + 0);\nmsg.url=\"http://app:81/dashboard/alerts/api\"+finalUrl;\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 254,
        "y": 385,
        "wires": [
            [
                "8132200d.0dabc"
            ]
        ]
    },
    {
        "id": "fe27e12e.5a87a",
        "type": "function",
        "z": "ca23f017.a3529",
        "name": "",
        "func": "msg.identifier=\"jobAlerts\";\nreturn msg;",
        "outputs": "1",
        "noerr": 0,
        "x": 686,
        "y": 384,
        "wires": [
            [
                "668202a.9e1a1fc"
            ]
        ]
    },
    {
        "id": "668202a.9e1a1fc",
        "type": "function",
        "z": "ca23f017.a3529",
        "name": "",
        "func": "if (!context.data){\n   context.data = {\n       alerts: {}\n   };\n} \nif(msg.identifier === \"jobAlerts\"){\n    context.data.alerts.jobalerts = msg.payload;\n} else {\n    context.data.alerts.lookup = msg.payload;\n}\n\nif(context.data.alerts.jobalerts && context.data.alerts.lookup){\n     msg.payload = context.data;\n     context.data = null;\n     //for homepage alertdashboard\n    msg.dateData=msg.payload.alerts.jobalerts;\n    msg.payload.alerts.lookup=JSON.parse(msg.payload.alerts.lookup);\n\n  /**removing dupliacte entries from lookup***/\n  Array.prototype.remove = function(from, to) {\n  var rest = this.slice((to || from) + 1 || this.length);\n  this.length = from < 0 ? this.length + from : from;\n  return this.push.apply(this, rest);\n};\nfor (var i=0;i<msg.payload.alerts.lookup.length;i++) {\n    for(var j=i+1;j<msg.payload.alerts.lookup.length;j++){\n        if(i!=j && (msg.payload.alerts.lookup[i].JOB_NAME == msg.payload.alerts.lookup[j].JOB_NAME)){\n           //delete  msg.payload.alerts.lookup[j];\n           msg.payload.alerts.lookup.remove(j);\n        }\n    }\n}\n//for datedata array\nvar finalArr1=new Array([]),\n    datedataArray= [];\n    for (var i=0;i<msg.payload.alerts.lookup.length;i++) {\n        var k=0;\n        finalArr1[i] = [];\n        var temp=[];\n        for (var j=0;j<msg.dateData.length;j++) {\n            if (msg.dateData[j].AlertKey===msg.payload.alerts.lookup[i].JOB_NAME) {\n                msg.dateData[j][\"JobGroup\"]=msg.payload.alerts.lookup[i].JOB_GROUP;\n                finalArr1[i][k]=msg.dateData[j];\n                //delete temp[j];\n                k++;\n            } else {\n                msg.dateData[j][\"JobGroup\"]=\"iLA\";\n                temp.push(msg.dateData[j]);\n            }\n        }\n        msg.dateData = temp;\n        if (finalArr1[i].length !== 0) {\n            datedataArray.push(finalArr1[i]);\n        }\n\n    }\n\nvar x = {},y=temp;\nvar i = y.length;\n//var newArr=[];\nwhile(i--) {\n    var sHash = y[i].AlertKey.toString();\n    if (typeof(x[sHash]) == \"undefined\") \n        x[sHash] = [];\n    x[sHash].push(y[i]);\n}\nvar dateNoGroup=[];\nfor(var key in x) {\n    dateNoGroup.push(x[key]);\n}\ndatedataArray =datedataArray.concat(dateNoGroup);\nmsg.datedataArray=datedataArray;\n\n\nreturn msg;\n}\n\n",
        "outputs": 1,
        "noerr": 0,
        "x": 937,
        "y": 372,
        "wires": [
            [
                "ef077013.1452e"
            ]
        ]
    },
    {
        "id": "ef077013.1452e",
        "type": "function",
        "z": "ca23f017.a3529",
        "name": "",
        "func": "var dateAlert=[];\nfor (var i=0;i<msg.datedataArray.length;i++){\n    msg.datedataArray[i][0][\"Count\"]=msg.datedataArray[i].length;\n    dateAlert.push(msg.datedataArray[i][0]);\n\n}\nvar majorAlert=[],minorAlert=[];\nfor (var i=0;i<dateAlert.length;i++) {\n    if(dateAlert[i][\"Severity\"]===\"major\") {\n        majorAlert.push(dateAlert[i]);\n    } else if(dateAlert[i][\"Severity\"]===\"minor\") {\n        minorAlert.push(dateAlert[i]);\n\n    }\n}\nmajorAlert.sort(function(a, b){\n    return b.Count-a.Count\n});\nminorAlert.sort(function(a, b){\n    return b.Count-a.Count\n});\ndateAlert.sort(function(a, b){\n    return b.Count-a.Count\n});\nmsg.dailyAlert=majorAlert.concat(minorAlert);\nreturn msg",
        "outputs": 1,
        "noerr": 0,
        "x": 1132,
        "y": 330,
        "wires": [
            [
                "32dff273.7ad12e"
            ]
        ]
    },
    {
        "id": "cbe12a8b.9fc2a8",
        "type": "http request",
        "z": "ca23f017.a3529",
        "name": "getJobGroup",
        "method": "GET",
        "ret": "txt",
        "url": "http://app:81/dashboard/job/lookup",
        "tls": "",
        "x": 327,
        "y": 282,
        "wires": [
            [
                "c3ba2477.854438"
            ]
        ]
    },
    {
        "id": "c3ba2477.854438",
        "type": "function",
        "z": "ca23f017.a3529",
        "name": "",
        "func": "//msg.identifyGroup=msg.payload;\nmsg.identifier=\"jobLookup\";\nreturn msg;",
        "outputs": "1",
        "noerr": 0,
        "x": 677,
        "y": 286,
        "wires": [
            [
                "668202a.9e1a1fc"
            ]
        ]
    },
    {
        "id": "b8c05c36.22c0b",
        "type": "function",
        "z": "ca23f017.a3529",
        "name": "No Cache",
        "func": "msg.headers={\n    \"Cache-Control\":\"no-cache, no-store, must-revalidate\",\n    \"Pragma\":\"no-cache\",\n    \"Expires\":\"0\"\n}\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 1473,
        "y": 102,
        "wires": [
            [
                "89e1b22a.b5d7c"
            ]
        ]
    },
    {
        "id": "daca49b.eb182b8",
        "type": "http in",
        "z": "556c4c4b.054284",
        "name": "testApp",
        "url": "/test-app",
        "method": "get",
        "swaggerDoc": "",
        "x": 58.00000762939453,
        "y": 162.9999828338623,
        "wires": [
            [
                "9641751a.7cfde8",
                "9403701b.37fd3"
            ]
        ]
    },
    {
        "id": "ec93a79a.ecb238",
        "type": "http response",
        "z": "556c4c4b.054284",
        "name": "",
        "x": 1074.500020980835,
        "y": 227.44443225860596,
        "wires": []
    },
    {
        "id": "b6fdd481.3e26f8",
        "type": "template",
        "z": "556c4c4b.054284",
        "name": "MainPage",
        "field": "payload",
        "fieldType": "msg",
        "format": "handlebars",
        "syntax": "mustache",
        "template": "<!DOCTYPE html> \n<html>\n<head>\n\t<meta name=\"viewport\" content=\"width=device-width, initial-scale=1\">\n    <meta http-equiv=\"refresh\" content=\"1000000\">\n    <link rel=\"stylesheet\" href=\"http://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css\">\n    <link rel=\"stylesheet\" href=\"/assets/main.css\">\n\n    \n    </head>\n    <body class=\"alert-homepage\">\n            <div class=\"container-fluid\">\n                <div class=\"row dashboard-title\">\n                    <h1>Jobs Status Dashboard</h1>\n                </div>\n                <div class=\"row\">\n                    <div class=\"col-sm-6\">\n                        <a href=\"/showjobdata\" id=\"hourlyBox\" target=\"_blank\">\n\n                            <div class=\"status-box {{jobsStatus}}\">\n                                <p>Nightly Jobs Status</p>\n                                <p>Jobs Executed: {{jobsExecuted}}/{{totalLookupJobs}} </p>\n                                <p>Percentage Completion {{percentCompletion}}%</p>\n                                <div class=\"progress\">\n                                  <div class=\"progress-bar\" role=\"progressbar\" aria-valuenow={{jobsExecuted}}\n                                  aria-valuemin=\"0\" aria-valuemax={{totalLookupJobs}} style=\"width:{{percentCompletion}}%\">\n                                    <span class=\"sr-only\">70% Complete</span>\n                                  </div>\n                                </div>\n                            </div>\n                        </a>\n                    </div>\n                    <div class=\"col-sm-6\">\n                        \n                    </div>\n                </div>\n            </div>\n\n    </body>\n   \n</html>\n",
        "x": 741.6666793823242,
        "y": 117.99999809265137,
        "wires": [
            [
                "7b76d29e.afbc9c"
            ]
        ]
    },
    {
        "id": "45090b43.d31494",
        "type": "http in",
        "z": "556c4c4b.054284",
        "name": "showjobdata",
        "url": "/showjobdata",
        "method": "get",
        "swaggerDoc": "",
        "x": 75,
        "y": 328.55556869506836,
        "wires": [
            [
                "9641751a.7cfde8",
                "9403701b.37fd3"
            ]
        ]
    },
    {
        "id": "e3647657.857f38",
        "type": "template",
        "z": "556c4c4b.054284",
        "name": "JobsTable",
        "field": "payload",
        "fieldType": "msg",
        "format": "handlebars",
        "syntax": "mustache",
        "template": "<!DOCTYPE html> \n<html>\n    <head>\n\t<meta name=\"viewport\" content=\"width=device-width, initial-scale=1\">\n    <link rel=\"stylesheet\" href=\"http://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css\">\n    <link rel=\"stylesheet\" href=\"/assets/main.css\">\n    </head>\n<body>\n    <div class=\"container-fluid\">\n        <div class=\"row dashboard-title\">\n            <h1>Jobs Dashboard</h1>\n        </div>\n        {{#dailyAlert.length}}\n        <div class=\"\">\n            <table class=\"table table-bordered alert-table\">\n                <tr>\n                    <th>job_name</th>\n                    <th>server_name</th>\n                    <th>start_time</th>\n                    <th>end_time</th>\n                    <th>status</th>\n                    <th>description</th>\n                    <th>job_group</th>\n                   <!-- <th class=\"message-head\">Message</th>-->\n                </tr>\n        {{#dailyAlert}}\n        <tr>\n            <td>{{JOB_NAME}}</td>\n            <td>{{SERVER_NAME}}</td>\n            <td>{{START_TIME}}</td>\n            <td>{{END_TIME}}</td>\n        \t<td>{{STATUS}}</td>\n        \t{{#LOOKUP}}\n        \t<td>{{DESCRIPTION}}</td>\n        \t<td>{{JOB_GROUP}}</td>\n        \t{{/LOOKUP}}\n            <!--<td class=\"message-head\"><span class=\"hasTooltip\">{{Message}}<p>{{Message}}</p></span></td>-->\n            \n        </tr>\n    {{/dailyAlert}}\n    </table>\n    </div>\n    {{/dailyAlert.length}}\n    {{^dailyAlert.length}}\n        <h2>No Alerts to show!</h2>\n    {{/dailyAlert.length}}\n    </div>\n</body>\n</html>",
        "x": 739.111083984375,
        "y": 363.11111068725586,
        "wires": [
            [
                "7b76d29e.afbc9c"
            ]
        ]
    },
    {
        "id": "4f614925.ceb618",
        "type": "function",
        "z": "556c4c4b.054284",
        "name": "",
        "func": "var dailyAlert=[];\nfor (var i=0;i<msg.jobsData.length;i++){\n    //msg.jobsData[i][0][\"Count\"]=msg.jobsData[i].length;\n    dailyAlert.push(msg.jobsData[i][0]);\n\n}\n/*dailyAlert.sort(function(a, b){\n    return b.Count-a.Count\n});*/\nmsg.dailyAlert=dailyAlert;\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 620.3333740234375,
        "y": 282.33337020874023,
        "wires": [
            [
                "e3647657.857f38"
            ]
        ]
    },
    {
        "id": "7b76d29e.afbc9c",
        "type": "function",
        "z": "556c4c4b.054284",
        "name": "No Cache",
        "func": "msg.headers={\n    \"Cache-Control\":\"no-cache, no-store, must-revalidate\",\n    \"Pragma\":\"no-cache\",\n    \"Expires\":\"0\"\n}\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 883.3333892822266,
        "y": 213.1110782623291,
        "wires": [
            [
                "ec93a79a.ecb238"
            ]
        ]
    },
    {
        "id": "9641751a.7cfde8",
        "type": "http request",
        "z": "556c4c4b.054284",
        "name": "JobStatus",
        "method": "GET",
        "ret": "obj",
        "url": "http://app:81/dashboard/job/api?type=NIGHTLY",
        "tls": "",
        "x": 205.6666717529297,
        "y": 58,
        "wires": [
            [
                "9ff7ed3d.467c2"
            ]
        ]
    },
    {
        "id": "9403701b.37fd3",
        "type": "http request",
        "z": "556c4c4b.054284",
        "name": "nightlyLookup",
        "method": "GET",
        "ret": "obj",
        "url": "http://app:81/dashboard/job/lookup?type=NIGHTLY",
        "tls": "",
        "x": 272.44447326660156,
        "y": 233.11111068725586,
        "wires": [
            [
                "9799d2e7.a7a8f"
            ]
        ]
    },
    {
        "id": "9ff7ed3d.467c2",
        "type": "function",
        "z": "556c4c4b.054284",
        "name": "addJobStatusIdentifier",
        "func": "msg.identifier = 'nightlyStatus';\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 421.94439697265625,
        "y": 107.33332824707031,
        "wires": [
            [
                "f1139c57.2eb46"
            ]
        ]
    },
    {
        "id": "f1139c57.2eb46",
        "type": "function",
        "z": "556c4c4b.054284",
        "name": "payloadHandler",
        "func": "if (!context.data){\n   context.data = {\n       nightly: {}\n   };\n} \nif(msg.identifier === \"nightlyStatus\"){\n    context.data.nightly.status = msg.payload;\n} else {\n    context.data.nightly.lookups = msg.payload;\n}\nif(context.data.nightly.status && context.data.nightly.lookups){\n     msg.payload = context.data;\n     context.data = null;\n\nvar finalArr=new Array([]),\nfinalArray= [];\nfor (var i=0;i<msg.payload.nightly.lookups.length;i++){\n    var k=0;\n    finalArr[i] = [];\n    for (var j=0;j<msg.payload.nightly.status.length;j++){\n        if(msg.payload.nightly.lookups[i].JOB_NAME===msg.payload.nightly.status[j].LOOKUP[0].JOB_NAME){\n            finalArr[i][k]=msg.payload.nightly.status[j];\n            k++;\n        }\n    }\n    if(finalArr[i].length !== 0){\n        finalArray.push(finalArr[i]);\n    }\n}\nfor (var i=0;i<finalArray.length;i++){\n    if(finalArray[i][0].STATUS===\"FAILURE\"){\n        msg.jobsStatus=\"failed\";\n    } else msg.jobsStatus=\"success\";\n}\nmsg.jobsData=finalArray;\nmsg.jobsExecuted=finalArray.length;\nmsg.totalLookupJobs=msg.payload.nightly.lookups.length;\nmsg.percentCompletion=Math.round((msg.jobsExecuted/msg.totalLookupJobs)*100);\n\nif (msg.req.url===\"/showjobdata\"){\n    return [null,msg]\n} else {\n    return [msg,null]\n} \n}",
        "outputs": "2",
        "noerr": 0,
        "x": 569.0555648803711,
        "y": 207.11110305786133,
        "wires": [
            [
                "b6fdd481.3e26f8"
            ],
            [
                "4f614925.ceb618"
            ]
        ]
    },
    {
        "id": "9799d2e7.a7a8f",
        "type": "function",
        "z": "556c4c4b.054284",
        "name": "addlookupIdentifier",
        "func": "msg.identifier = 'nightlyLookups';\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 413.6111145019531,
        "y": 298.222225189209,
        "wires": [
            [
                "f1139c57.2eb46"
            ]
        ]
    },
    {
        "id": "ae5ac3cd.49572",
        "type": "http in",
        "z": "87759769.25c5a8",
        "name": "Home Page",
        "url": "/",
        "method": "get",
        "swaggerDoc": "",
        "x": 169.5,
        "y": 118,
        "wires": [
            [
                "bfdc990c.587b78"
            ]
        ]
    },
    {
        "id": "bfdc990c.587b78",
        "type": "template",
        "z": "87759769.25c5a8",
        "name": "Home Page Template",
        "field": "payload",
        "fieldType": "msg",
        "format": "handlebars",
        "syntax": "mustache",
        "template": "Under Construction",
        "x": 380.5,
        "y": 126,
        "wires": [
            [
                "e675c94f.d7d098"
            ]
        ]
    },
    {
        "id": "e675c94f.d7d098",
        "type": "http response",
        "z": "87759769.25c5a8",
        "name": "",
        "x": 575.5,
        "y": 126,
        "wires": []
    },
    {
        "id": "90528b40.71bf48",
        "type": "inject",
        "z": "61f45e89.e9959",
        "name": "",
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "repeat": "",
        "crontab": "",
        "once": false,
        "x": 81,
        "y": 137,
        "wires": [
            [
                "4c8c7e4a.825a5"
            ]
        ]
    },
    {
        "id": "af49edbc.2d76b",
        "type": "csv",
        "z": "61f45e89.e9959",
        "name": "CSV content",
        "sep": ",",
        "hdrin": true,
        "hdrout": "",
        "multi": "one",
        "ret": "\\n",
        "temp": "Priority*,Impact*,Summary*,Incident ID*+,Status*,Status_Reason_Hidden,Vendor Ticket Number,Assignee+,Reported Date+,Responded Date+,Last Resolved Date,Closed Date,First Name+,Last Name+,Resolution Categorization Tier 1,Resolution Categorization Tier 2",
        "x": 405.99998474121094,
        "y": 147,
        "wires": [
            [
                "bcb873c1.4728d"
            ]
        ]
    },
    {
        "id": "bcb873c1.4728d",
        "type": "function",
        "z": "61f45e89.e9959",
        "name": "",
        "func": "\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 661,
        "y": 157,
        "wires": [
            [
                "adc8ebc6.0bd908"
            ]
        ]
    },
    {
        "id": "adc8ebc6.0bd908",
        "type": "mongodb out",
        "z": "61f45e89.e9959",
        "mongodb": "c60cb185.3a934",
        "name": "all-incidentsData",
        "collection": "all-incidentsData",
        "payonly": true,
        "upsert": false,
        "multi": false,
        "operation": "store",
        "x": 813,
        "y": 217,
        "wires": []
    },
    {
        "id": "d817dbb1.da6128",
        "type": "http in",
        "z": "61f45e89.e9959",
        "name": "",
        "url": "/getjson",
        "method": "get",
        "swaggerDoc": "",
        "x": 78,
        "y": 362,
        "wires": [
            [
                "9f22e7a0.dfeec8"
            ]
        ]
    },
    {
        "id": "2836f605.f49c7a",
        "type": "mongodb in",
        "z": "61f45e89.e9959",
        "mongodb": "c60cb185.3a934",
        "name": "",
        "collection": "all-incidentsData",
        "operation": "find",
        "x": 387,
        "y": 403,
        "wires": [
            [
                "25217875.7f4aa8"
            ]
        ]
    },
    {
        "id": "25217875.7f4aa8",
        "type": "json",
        "z": "61f45e89.e9959",
        "name": "",
        "x": 585,
        "y": 353,
        "wires": [
            [
                "9c725998.321448"
            ]
        ]
    },
    {
        "id": "f15f569b.599a58",
        "type": "http response",
        "z": "61f45e89.e9959",
        "name": "",
        "x": 840,
        "y": 428,
        "wires": []
    },
    {
        "id": "9c725998.321448",
        "type": "function",
        "z": "61f45e89.e9959",
        "name": "",
        "func": "return msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 719,
        "y": 412,
        "wires": [
            [
                "f15f569b.599a58"
            ]
        ]
    },
    {
        "id": "9f22e7a0.dfeec8",
        "type": "function",
        "z": "61f45e89.e9959",
        "name": "",
        "func": "msg.skip=0;\nmsg.limit=0;\nmsg.payload={};\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 144,
        "y": 447,
        "wires": [
            [
                "2836f605.f49c7a"
            ]
        ]
    },
    {
        "id": "4c8c7e4a.825a5",
        "type": "file in",
        "z": "61f45e89.e9959",
        "name": "",
        "filename": "D:/csv-files/incidentsToUse.csv",
        "format": "utf8",
        "x": 238.99998474121094,
        "y": 193,
        "wires": [
            [
                "af49edbc.2d76b"
            ]
        ]
    },
    {
        "id": "a03109c0.920e28",
        "type": "inject",
        "z": "61f45e89.e9959",
        "name": "",
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "repeat": "",
        "crontab": "",
        "once": false,
        "x": 96,
        "y": 261,
        "wires": [
            [
                "767d6075.fb70e"
            ]
        ]
    },
    {
        "id": "5d4950a.34ac2b",
        "type": "csv",
        "z": "61f45e89.e9959",
        "name": "CSV content",
        "sep": ",",
        "hdrin": true,
        "hdrout": "",
        "multi": "one",
        "ret": "\\n",
        "temp": "Problem ID*+,Priority*,Impact*,Status*,Summary*,Notes,Assignee+,Target Date,Known Error Created,Submit Date,Submitter*,Vendor Ticket Number,Workaround,Resolution,Last Modified Date,Closed_Date",
        "x": 430,
        "y": 253,
        "wires": [
            [
                "a5220d76.ca133"
            ]
        ]
    },
    {
        "id": "a5220d76.ca133",
        "type": "function",
        "z": "61f45e89.e9959",
        "name": "",
        "func": "\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 576,
        "y": 287,
        "wires": [
            [
                "5a693377.c0db9c"
            ]
        ]
    },
    {
        "id": "5a693377.c0db9c",
        "type": "mongodb out",
        "z": "61f45e89.e9959",
        "mongodb": "c60cb185.3a934",
        "name": "problemRecord",
        "collection": "problem-record",
        "payonly": true,
        "upsert": true,
        "multi": true,
        "operation": "store",
        "x": 740,
        "y": 278,
        "wires": []
    },
    {
        "id": "767d6075.fb70e",
        "type": "file in",
        "z": "61f45e89.e9959",
        "name": "",
        "filename": "D:/csv-files/Problem_Records.csv",
        "format": "utf8",
        "x": 238,
        "y": 313,
        "wires": [
            [
                "5d4950a.34ac2b"
            ]
        ]
    },
    {
        "id": "e37dec89.e29c",
        "type": "http in",
        "z": "61f45e89.e9959",
        "name": "",
        "url": "/getpr",
        "method": "get",
        "swaggerDoc": "",
        "x": 65,
        "y": 492,
        "wires": [
            [
                "7886356b.5cdaec"
            ]
        ]
    },
    {
        "id": "396c1d62.fa9472",
        "type": "mongodb in",
        "z": "61f45e89.e9959",
        "mongodb": "c60cb185.3a934",
        "name": "",
        "collection": "problem-record",
        "operation": "find",
        "x": 386,
        "y": 510,
        "wires": [
            [
                "f99c3d41.cd8f5"
            ]
        ]
    },
    {
        "id": "f99c3d41.cd8f5",
        "type": "json",
        "z": "61f45e89.e9959",
        "name": "",
        "x": 531,
        "y": 584,
        "wires": [
            [
                "3b4abb3b.241914"
            ]
        ]
    },
    {
        "id": "9af069b7.cb3328",
        "type": "http response",
        "z": "61f45e89.e9959",
        "name": "",
        "x": 837,
        "y": 558,
        "wires": []
    },
    {
        "id": "3b4abb3b.241914",
        "type": "function",
        "z": "61f45e89.e9959",
        "name": "",
        "func": "return msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 666,
        "y": 530,
        "wires": [
            [
                "9af069b7.cb3328"
            ]
        ]
    },
    {
        "id": "7886356b.5cdaec",
        "type": "function",
        "z": "61f45e89.e9959",
        "name": "",
        "func": "msg.skip=0;\nmsg.limit=0;\nmsg.payload={};\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 141,
        "y": 577,
        "wires": [
            [
                "396c1d62.fa9472"
            ]
        ]
    },
    {
        "id": "6271414c.05e82",
        "type": "http in",
        "z": "73c2b0f6.41dab",
        "name": "",
        "url": "/wsr",
        "method": "get",
        "swaggerDoc": "",
        "x": 65,
        "y": 103,
        "wires": [
            [
                "6bd2d57e.2b6dcc",
                "d2c752de.33b6e",
                "ef656852.ef2638",
                "b74868ad.b90be8",
                "14195f90.4adf4"
            ]
        ]
    },
    {
        "id": "31f9e20a.f1497e",
        "type": "http response",
        "z": "73c2b0f6.41dab",
        "name": "",
        "x": 1029.4998779296875,
        "y": 211.5,
        "wires": []
    },
    {
        "id": "6bd2d57e.2b6dcc",
        "type": "http request",
        "z": "73c2b0f6.41dab",
        "name": "",
        "method": "GET",
        "ret": "txt",
        "url": "http://127.0.0.1:80/getjson",
        "tls": "",
        "x": 252.99998474121094,
        "y": 134,
        "wires": [
            [
                "90a005dd.2dc158"
            ]
        ]
    },
    {
        "id": "90a005dd.2dc158",
        "type": "function",
        "z": "73c2b0f6.41dab",
        "name": "",
        "func": "msg.identifier = 'all-incidents';\n//console.log(msg.identifier);\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 417.99998474121094,
        "y": 117,
        "wires": [
            [
                "ce75b255.31529"
            ]
        ]
    },
    {
        "id": "d2c752de.33b6e",
        "type": "http request",
        "z": "73c2b0f6.41dab",
        "name": "",
        "method": "GET",
        "ret": "txt",
        "url": "http://127.0.0.1:80/getpr",
        "tls": "",
        "x": 258.75,
        "y": 223.49999523162842,
        "wires": [
            [
                "79cffcd0.139944"
            ]
        ]
    },
    {
        "id": "79cffcd0.139944",
        "type": "function",
        "z": "73c2b0f6.41dab",
        "name": "",
        "func": "msg.identifier=\"problem-record\";\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 366.99998474121094,
        "y": 168,
        "wires": [
            [
                "ce75b255.31529"
            ]
        ]
    },
    {
        "id": "ce75b255.31529",
        "type": "function",
        "z": "73c2b0f6.41dab",
        "name": "",
        "func": "if (!context.data){\n   context.data = {\n       csvdata: {}\n   };\n} \nif(msg.identifier === \"all-incidents\"){\n    context.data.csvdata.allIncident = msg.payload;\n} else if(msg.identifier === \"aecom\") {\n    context.data.csvdata.aecomData = msg.payload;\n} else if (msg.identifier === \"calendar-event\") {\n    context.data.csvdata.calendarEvent=msg.payload;\n} else if (msg.identifier===\"summary-event\") {\n    context.data.csvdata.summaryData = msg.payload;\n \n}\nelse {\n    context.data.csvdata.probRecords = msg.payload;\n}\nif(context.data.csvdata.allIncident && context.data.csvdata.probRecords && context.data.csvdata.aecomData && context.data.csvdata.calendarEvent && context.data.csvdata.summaryData){\n    console.log(\"all-data\");\n     msg.payload = context.data;\n     context.data = null;\n     msg.incidentData=JSON.parse(msg.payload.csvdata.allIncident);\n     msg.probRecords=JSON.parse(msg.payload.csvdata.probRecords);\n    msg.aecomData=JSON.parse(msg.payload.csvdata.aecomData);\n    msg.calendarEvents=msg.payload.csvdata.calendarEvent;\nmsg.summaryData=JSON.parse(msg.payload.csvdata.summaryData);\n//console.log(msg.summaryData);\nif (msg.req.url===\"/wsr\"){\n    return [msg,null];\n} else {\n    return [null,msg];\n} \n //   return msg;\n}",
        "outputs": "2",
        "noerr": 0,
        "x": 500.2499237060547,
        "y": 204,
        "wires": [
            [
                "8f656c28.a4d46"
            ],
            [
                "900c297a.032e28"
            ]
        ]
    },
    {
        "id": "8f656c28.a4d46",
        "type": "function",
        "z": "73c2b0f6.41dab",
        "name": "",
        "func": "var tableDatas={};\nvar incidentDataJson=[\n    [\"Weekly Report (MM/DD/YYYY)\"],\n    //[\"Overall\",\"Green\",\"Green\",\"Green\",\"Green\",\"Green\",\"Green\"],\n    [\"Incidents\"],\n    [\"Problem Records\"]\n];\nvar slaViewData= [\n  [\"Sev1\",\"4hours\",,,0],\n  [\"Sev2\",\"8hours\",,,0],\n  [\"Sev3/4\",\"NA\",,\"NA\",\"NA\"]\n];\nvar incidentSummary = {};\nvar dateArray=[],currentWeekSummary=[],lastWeekSummary=[],finalWeekArray=[];\n\nfunction getfulldate(today) { //returns date in mm/dd/yyyy format\n  var currentDate=today.getDate(),\n    currentMonth=today.getMonth()+1;\n  var x=(currentMonth<10)?('0'+currentMonth):currentMonth;\n  var y=(currentDate<10)?('0'+currentDate):currentDate;\n  return (x+'/'+y+'/'+today.getFullYear());\n}\nfunction getLastSunday(d) { //returns last sunday date takes input as mm/dd/yyyy\n    var t = new Date(d);\n    t.setDate(t.getDate() - t.getDay());\n    return t;\n}\nfunction getDateStamp(dateStamp) {\n  var monthName=[\"Jan\", \"Feb\", \"Mar\", \"Apr\", \"May\", \"June\",\"July\", \"Aug\", \"Sept\", \"Oct\", \"Nov\", \"Dec\"];\n  var newDate= new Date(dateStamp);\n  return newDate.getDate()+\"-\"+monthName[newDate.getMonth()]+\"-\"+newDate.getFullYear();\n}\n\nvar lastSundaydate=getLastSunday(getfulldate(new Date()));\ntableDatas[\"date\"]=getDateStamp(lastSundaydate);\nvar lastSunday=getfulldate(lastSundaydate);\nvar i=2;\ndateArray[i-1]=lastSunday;\nincidentDataJson[0][i-1]=getDateStamp(new Date(lastSunday));\ndo{\n  var newlastSundaydate=new Date(lastSundaydate.setDate(lastSundaydate.getDate() - 7));\n  var newlastSunday=getfulldate(newlastSundaydate);\n  dateArray[i]=newlastSunday;\n  incidentDataJson[0][i]=getDateStamp(new Date(newlastSunday));\n  //incidentDataJson[0][i]=newlastSunday;\n  lastSundaydate=newlastSundaydate;\n  lastSunday=newlastSunday;\n  i++;\n} while(i<7);\n\n\n/***incident Count ***/\nvar firstEl=true,criticalCount=0,highCount=0,lowCount=0,totalIncidentCount=0,activeIncident=0;\n\nfor (var i=1;i<incidentDataJson[0].length;i++) {\nvar dateTo=dateArray[i];\n  //var dateTo=incidentDataJson[0][i];\n    var to=new Date(dateTo);\n    var newto=new Date(dateTo);\n    var dateFrom=new Date(newto.setDate(newto.getDate() - 6));\n    var incidentCount=0;\n  for (var j=0;j<msg.incidentData.length;j++) {\n    var getDate=msg.incidentData[j][\"Reported Date+\"];\n    //console.log(getDate);\n      var daterange=getDate.substring(0, getDate.indexOf(' '));\n      var check=new Date(daterange);\n      if(firstEl && (msg.incidentData[j][\"Priority*\"]===\"Medium\" || msg.incidentData[j][\"Priority*\"]===\"Critical\" || msg.incidentData[j][\"Priority*\"]===\"High\")) {\n        totalIncidentCount++;\n          if(msg.incidentData[j][\"Status*\"]===\"Assigned\" || msg.incidentData[j][\"Status*\"]===\"Pending\") {\n        activeIncident++;\n      }\n    }\n    if(check >= dateFrom && check <= to ) {\n          incidentCount++;\n          if(msg.incidentData[j][\"Priority*\"]===\"Critical\" && firstEl) {\n            criticalCount++;\n          }\n          if(msg.incidentData[j][\"Priority*\"]===\"High\" && firstEl) {\n            highCount++;\n          }\n          if((msg.incidentData[j][\"Priority*\"]===\"Medium\" || msg.incidentData[j][\"Priority*\"]===\"Low\") && firstEl) {\n            lowCount++;\n          }\n\n\n      }\n  }\n  firstEl=false;\n  incidentDataJson[1][i]=incidentCount;\n}\n\n\n/***problem Count ***/\nvar problemArrayDraft=[],problemArrayReview=[];\n  for (var i=1;i<incidentDataJson[0].length;i++) {\n    var dateTo=dateArray[i];\n  //var dateTo=incidentDataJson[0][i];\n        var to=new Date(dateTo);\n        var newto=new Date(dateTo);\n        var dateFrom=new Date(newto.setDate(newto.getDate() - 6));\n        var problemCount=0;\n    for (var j=0;j<msg.probRecords.length;j++) {\n      var getDate=msg.probRecords[j][\"Submit Date\"];\n        var daterange=getDate.substring(0, getDate.indexOf(' '));\n        var check=new Date(daterange);\n      if(check >= dateFrom && check <= to && msg.probRecords[j][\"Status*\"]===\"Draft\" ) {\n              problemCount++;\n          }\n          if(i===1) {\n             if(check >= dateFrom && check <= to && msg.probRecords[j][\"Status*\"]===\"Draft\" ) {\n                 var oneDay = 24*60*60*1000;\n                 var dayy1=new Date(new Date().setHours(0,0,0,0));\n                 var diffDays = Math.round(Math.abs((dayy1.getTime() - check.getTime())/(oneDay)));\n                    msg.probRecords[j][\"ageings\"]=diffDays;\n                    var gDate=msg.probRecords[j][\"Submit Date\"];\n                    msg.probRecords[j][\"Submit Date\"]=gDate.substring(0, gDate.indexOf(' '));\n                  problemArrayDraft.push(msg.probRecords[j]);\n              } \n              if(check >= dateFrom && check <= to && msg.probRecords[j][\"Status*\"]===\"Under Review\" ) {\n                  var oneDay = 24*60*60*1000;\n                 var dayy1=new Date(new Date().setHours(0,0,0,0));\n                 var diffDays = Math.round(Math.abs((dayy1.getTime() - check.getTime())/(oneDay)));\n                    msg.probRecords[j][\"ageings\"]=diffDays;\n                    var gDate=msg.probRecords[j][\"Submit Date\"];\n                    msg.probRecords[j][\"Submit Date\"]=gDate.substring(0, gDate.indexOf(' '));\n                  problemArrayReview.push(msg.probRecords[j]);\n              }\n          }\n    }\n    incidentDataJson[2][i]=problemCount;\n  }\n\n\n  /***total incident count****/\n    for (var j=0;j<msg.aecomData.length;j++) {\n      if(msg.aecomData[j][\"Priority*\"]===\"Low\") {\n        totalIncidentCount++;\n        if(msg.aecomData[j][\"Status*\"]===\"Assigned\" || msg.aecomData[j][\"Status*\"]===\"Pending\") {\n          activeIncident++;\n        }\n      }\n\n    }\n\n\nslaViewData[0][2]=criticalCount;\nslaViewData[0][3]=criticalCount;\nslaViewData[1][2]=highCount;\nslaViewData[1][3]=highCount;\nslaViewData[2][2]=lowCount;\nincidentSummary[\"Total Incidents\"]=totalIncidentCount;\nincidentSummary[\"Active Incidents\"]=activeIncident;\nincidentSummary[\"Non-Active Incidents\"]=totalIncidentCount-activeIncident;\ntableDatas[\"incidentData\"]=incidentDataJson;\ntableDatas[\"slaView\"]=slaViewData;\ntableDatas[\"incidentSummary\"]=incidentSummary;\n\nmsg.tableDatas= JSON.stringify(tableDatas);\nmsg.tableData=tableDatas;\nvar lastSun=getLastSunday(new Date());\nvar lastSun1=new Date(lastSun);\nvar lastSun2=new Date(lastSun1);\nvar lastSun3=new Date(lastSun1);\nvar nextWeek=new Date(lastSun2.setDate(lastSun2.getDate() + 7));\nvar lastWeek=new Date(lastSun3.setDate(lastSun3.getDate() - 10)); \n  var eventArray=[],lasteventArray=[];\n\nfor (var i=0;i<msg.calendarEvents.length;i++) {\n    //console.log(msg.calendarEvents[i].start.dateTime);\n   var imDate=Date.parse(msg.calendarEvents[i].start.dateTime);\n  var calendarDate=new Date(imDate);\n  if(calendarDate>lastSun1 && calendarDate<=nextWeek ) {\n      //console.log(msg.calendarEvents[i].summary)\n      eventArray.push({\"summary\":msg.calendarEvents[i].summary});\n  }\n  if(calendarDate<=lastSun1 && calendarDate>=lastWeek ) {\n     lasteventArray.push({\"summary\":msg.calendarEvents[i].summary});\n\n  }\n  \n \n}\nvar lastSun=getLastSunday(new Date());\nmsg.eventList=eventArray;\nmsg.lastEventList=lasteventArray;\nmsg.problemArrayDraft=problemArrayDraft;\nmsg.problemArrayReview=problemArrayReview;\n\n/***Summary**/\nfunction lw(nameval) {\n  for (var i=0;i<lastWeekSummary.length;i++) {\n    if(lastWeekSummary[i][\"name\"]===nameval && lastWeekSummary[i][\"value\"]!==\"\") {\n      return lastWeekSummary[i];\n    } else {\n        var defaultObj= {\n          \"name\":nameval,\n          \"value\": \"NA\"\n        };\n        return defaultObj;\n    }\n  }\n}\nfor (var i=0;i<msg.summaryData.length;i++)\n{\n    var summarydate=msg.summaryData[i][\"date\"];\n    if(new Date(summarydate).getTime()==new Date(dateArray[1]).getTime()){\n        currentWeekSummary.push(msg.summaryData[i]);\n    } else if (new Date(summarydate).getTime()==new Date(dateArray[2]).getTime()){\n        lastWeekSummary.push(msg.summaryData[i]);\n    }\n}\nconsole.log(\"currentWeek\",currentWeekSummary);\nconsole.log(\"lastWeek\",lastWeekSummary);\nfor (var i=0;i<currentWeekSummary.length;i++) {\n  if(currentWeekSummary[i][\"value\"]!==\"\") {\n    if (currentWeekSummary[i][\"name\"]===\"keyRisk\") {\n      msg.keyrisk=currentWeekSummary[i];\n    } else if (currentWeekSummary[i][\"name\"]===\"accomp\") {\n      msg.accomp=currentWeekSummary[i];\n    }\n    finalWeekArray.push(currentWeekSummary[i]);\n  } else {\n      var lastWeekObj=lw(currentWeekSummary[i][\"name\"]);\n      if (lastWeekObj[\"name\"]===\"keyRisk\") {\n        msg.keyrisk=lastWeekObj;\n      } else if (lastWeekObj[\"name\"]===\"accomp\") {\n        msg.accomp=lastWeekObj;\n      }\n      finalWeekArray.push(lastWeekObj);\n  }\n\n} \nconsole.log(\"finalWeekArray\",finalWeekArray);\nconsole.log(\"keyrisk\",msg.keyrisk);\nconsole.log(\"accomp\",msg.accomp);\n//msg.currentWeekSummary=currentWeekSummary;\n//msg.lastWeekSummary=lastWeekSummary;\nmsg.finalWeekArray=finalWeekArray;\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 586.3888702392578,
        "y": 129.66666316986084,
        "wires": [
            [
                "21b1217f.ab706e"
            ]
        ]
    },
    {
        "id": "21b1217f.ab706e",
        "type": "template",
        "z": "73c2b0f6.41dab",
        "name": "",
        "field": "payload",
        "fieldType": "msg",
        "format": "handlebars",
        "syntax": "mustache",
        "template": "<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n    <meta charset=\"UTF-8\">\n    <title>MNS-Reporting</title>\n    <link rel=\"stylesheet\" type=\"text/css\" href=\"assets/wsr-automation/css/style.css\">\n    <!--<script src=\"https://ajax.googleapis.com/ajax/libs/jquery/1.12.0/jquery.min.js\"></script>-->\n    <!--<script src=\"http://ajax.googleapis.com/ajax/libs/angularjs/1.4.8/angular.min.js\"></script>-->\n    <script src=\"assets/wsr-automation/js/angular.min.js\"></script>\n    <script src=\"assets/wsr-automation/js/jquery-3.1.1.js\"></script>\n</head>\n<body>\n    <main class=\"container\" ng-app=\"weeklyReports\" ng-controller=\"reportsCtrl\">\n        <script type=\"text/ng-template\" id=\"incidentDataTable.html\">\n            <tr ng-repeat=\"data in dataFromTable\">\n                <td ng-repeat=\"values in data track by $index\" ng-class=\"values\" ng-bind=\"values\"></td>\n            </tr>\n        </script>\n        <script type=\"text/ng-template\" id=\"slaViewTable.html\">\n            <tr>\n                <td>Incident</td><td>SLA</td><td>Reported</td><td>Acheived</td><td>Breached</td>\n            </tr>\n            <tr ng-repeat=\"data in dataFromTable\">\n                <td ng-repeat=\"values in data track by $index\" ng-bind=\"values\"></td>\n            </tr>\n        </script>\n        <script type=\"text/ng-template\" id=\"incidentSumTable.html\">\n            <tr>\n                <td ng-repeat=\"(key,value) in dataFromTable\" ng-bind=\"key\"></td>\n            </tr>\n            <tr>\n                <td ng-repeat=\"data in dataFromTable\" ng-bind=\"data\"></td>\n            </tr>\n        </script>\n         \n        <div class=\"clearfix\">\n            <img src=\"assets/wsr-automation/images/mns-logo.jpg\" alt=\"Marks and Spencer logo\" id=\"mnsLogo\">\n            <img src=\"assets/wsr-automation/images/sapient-nitro.png\" alt=\"SapientNitro logo\" id=\"sapientLogo\">\n        </div>\n        <div class=\"clearfix\">\n            <img src=\"assets/wsr-automation/images/print-icon.png\" alt=\"Print Logo\" id=\"printLogo\" ng-click=\"printOption()\">\n        </div>\n\n        <section class=\"clearfix\">\n            <h1>\n                M&S eCom Support Weekly Status Report - Week Ending  {{tableData.date}}\n            </h1>\n            <table id=\"incidents\">\n                <caption>Incidents originating in Week ending {{tableData.date}}</caption>\n                <tbody id=\"incidentDataTable\" table-dir dataparam=tableDatas.incidentData></tbody>\n            </table>\n            <table id=\"slaView\">\n                <caption>SLA View for Week ending {{tableData.date}}</caption>\n                <tbody id=\"slaViewTable\" table-dir dataparam=\"tableDatas.slaView\"></tbody>\n            </table>\n            <table id=\"incidentSummary\" style=\"clear: both;\">\n                <caption>Incident Summary till {{tableData.date}}</caption>\n                <tbody id=\"incidentSumTable\" table-dir dataparam=\"tableDatas.incidentSummary\"></tbody>\n            </table>\n        </section>\n\n        <section>\n            <!--<h1>\n                M&S eCom Support Weekly Status Report - Week Ending  {{tableData.date}}\n            </h1>-->\n            <div id=\"keyUpdates\" class=\"sections\">\n                <div class=\"header-div\">\n                    <span class=\"edit-button\"></span>\n                    <h2 class=\"headlines\">Key updates</h2>\n                </div>\n\n                <div id=\"myArea1\" class=\"edit-div\">\n                    <div>\n                        <h3>Progress Last Week RAYG : GREEN</h3>\n                        <ul>\n                            <li>Total <span>69</span> incidents were raised in last week. Pending triage incidents are currently <span>29</span>.</li>\n                            <li>1 Sev 2's were raised last week.\n                                <ul>\n                                    <li>Sev 2 | INC000021527174 | EMAIL-PROBE (Site Confidence Alert:Script Step[28065111]) - Site Confidence Alert Script Step - Site Confidence Journey was failing</li>\n                                </ul>\n                            </li>\n                        </ul>\n                        <h3>Business Events</h3>\n                        <ul>\n                            <li>NA</li>\n                        </ul>\n                        \n                        <!--<ul>\n                            <li><span>2</span> Open (0 Draft ,2 Pending, 0 Under Review)</li>\n                        </ul>-->\n                        \n                        <!--<ul>\n                            <li>PROD | B&C | THROTTLE | Moving Mobile/App to -6 and Basket change <span>21st Mar</span></li>\n                            <li>PROD | Throttling to 100% New Basket for CS and Stores <span>23rd Mar</span></li>\n                            <li>PROD | CM-182 | SPARKS - FE change for Sparks FAQs link <span>24th Mar</span></li>\n                            <li>PROD | CM-183 | Whitelisting Omniture rest API Url for Prod Servers <span>24th Mar</span></li>\n                            <li>PROD | Timezone change to BST <span>27th Mar</span></li>\n                            <li>SIT3 | R26 Deployment <span>21st Mar</span></li>\n                            <li>SIT3/B | Apply RHEL Patch <span>23rd Mar</span></li>\n                        </ul>-->\n                    </div>\n                </div>\n                <div class=\"noneditable-container\" style=\"border-top:solid 1px black;padding-left:4px;\">\n\n                        <h3>Problem Record</h3>\n                        <table>\n\n                            {{#problemArrayDraft.length}}\n\n                                        <tr>\n                                            <td>Problem ID</td>\n                                            <td>Summary</th>\n                                            <td>Assignee</td>\n                                            <td>Status</td>\n                                            <td>Ageing</td>\n                                            <td>Open Date</td>\n\n                                        </tr>\n                            {{/problemArrayDraft.length}}\n                            {{#problemArrayDraft}}\n                                <tr> \n                                    <td>{{Problem ID*+}}</td>\n                                    <td>{{Summary*}}</td>\n                                    <td>{{Assignee+}}</td>\n                                    <td>{{Status*}}</td>\n                                    <td>{{ageings}}</td>\n                                    <td>{{Submit Date}}</td>\n\n                                </tr>\n                            {{/problemArrayDraft}}\n                        </table>\n\n                        \n                        <h3>Environments</h3>\n                        <ul>\n                            {{#lastEventList}}\n                            <li>\n                                {{summary}}\n                            </li>\n                            {{/lastEventList}}\n                        </ul>\n                </div>\n            </div>\n            <div id=\"nextWeekPlan\" class=\"sections\" >\n                <div class=\"header-div\">\n                    <span class=\"edit-button\"></span>\n                    <h2 class=\"headlines\"> Plan for next week</h2>\n                </div>\n\n                <div id=\"nextWeek\" class=\"edit-div\" >\n                    <h3>Business Events</h3>\n                    <ul>\n                        <li>NA</li>\n                    </ul>\n                        \n                    <!--<ul>\n                        <li>PROD | RHEL Patching DR <span>28th Mar</span></li>\n                        <li>PROD | Bing SIte Authorisation Update in AKAMAI <span>29th Mar</span></li>\n                        <li>PROD | RHEL Patching BURST <span>29th Mar</span></li>\n                        <li>PROD | R26 Deployment <span>30th Mar</span></li>\n                        <li>DR | QA3 | R26 Deployment <span>31st Mar</span></li>\n                    </ul>-->\n                </div>\n                <div class=\"noneditable-container\" style=\"border-top:solid 1px black;padding-left:4px;\">\n                    <h3>Environments</h3>\n                        <ul>\n                            {{#eventList}}\n                            <li>\n                                {{summary}}\n                            </li>\n                            {{/eventList}}\n                        </ul>\n                </div>\n            </div>\n            <div id=\"risksIssues\" class=\"sections\">\n                <div class=\"header-div\">\n                    <span class=\"edit-button\"></span>\n                    <h2 class=\"headlines\">Key risks/issues</h2>\n                </div>\n<pre><div class=\"edit_area\" id=\"keyRisk\" style=\"min-height:50px\">{{#keyrisk}}{{{value}}}{{/keyrisk}}</div></pre>\n                <!--<div id=\"risk\" class=\"edit-div\">\n                    <ul>\n                        <!--<li>Single Prod/ non-Prod account for Bing request. There is threshhold of 50 requested in 24 hrs</li>\n                        <li>Stageprop session killed twice</li>-->\n                       <!-- <li>NA</li>\n                    </ul>\n                </div>-->\n            </div>\n            <div id=\"accomplishments\" class=\"sections\">\n                <div class=\"header-div\">\n                    <span class=\"edit-button\"></span>\n                    <h2 class=\"headlines\">Accomplishments</h2>\n                </div>\n               <pre><div class=\"edit_area\" id=\"accomp\" style=\"min-height:50px\">{{#accomp}}{{{value}}}{{/accomp}}</div></pre>\n               <!-- <div id=\"accomp\" class=\"edit-div\">\n                    <ul>\n                        <!--<li>Timezone changed from GMT to BST has been successfully completed on 27th March.</li>-->\n\n                <!--    </ul>\n                </div>-->\n\n            </div>\n            <!--<div id=\"keyDependencies\" class=\"sections\">\n                <div class=\"header-div\">\n                    <span class=\"edit-button\"></span>\n                    <h2 class=\"headlines\">Key dependencies</h2>\n                </div>\n                    <div class=\"edit_area\" id=\"keydep\" style=\"min-height:50px\">\n                    \n                    </div>\n \n            </div>-->\n            <!--<div id=\"keyDependencies\" class=\"sections\">\n                <div class=\"header-div\">\n                    <span class=\"edit-button\"></span>\n                    <h2 class=\"headlines\">Key dependencies</h2>\n                </div>\n                <div id=\"keyDepend\" class=\"edit-div\">\n                    <ul>\n                                            <li>NA</li>\n\n                    </ul>\n                </div>\n            </div>-->\n            \n            <!--<div class=\"edit\" id=\"div_1\">Dolor</div>\n                <div class=\"edit_area\" id=\"div_2\">Lorem ipsum dolor sit amet, consectetuer\n                adipiscing elit, sed diam nonummy nibh euismod tincidunt ut laoreet dolore\n                magna aliquam erat volutpat.\n                </div>-->\n        </section>\n    </main>\n\n    <script src=\"assets/wsr-automation/js/app.js\"></script>\n    <script src=\"assets/wsr-automation/js/executiveSummary/newcontroller.js\"></script>\n    <script src=\"assets/wsr-automation/js/common/createTable.directive.js\"></script>\n    <!--<script src='http://js.nicedit.com/nicEdit-latest.js'></script>-->\n    <script src='assets/wsr-automation/js/common/jqueryeditable.js'></script>\n<style>\n    .edit_area textarea {\n        padding:1px;\n    }\n    .edit_area {\n        padding:1px;\n    }\n</style>\n<script type=\"text/javascript\">\nvar tableDatas={{{tableDatas}}};\nvar dateDisplay=tableDatas.date;\n//var accompl=accomp.value;\n\n$(document).ready(function() {\n    //$(\"#accomplishments .edit_area\").html(accompl);\n     $('.edit').editable('http://www.example.com/save.php', {\n         indicator : 'Saving...',\n         tooltip   : 'Click to edit...'\n     });\n     /*$('.edit_area').editable('http://www.example.com/save.php', {\n         type      : 'textarea',\n         cancel    : 'Cancel',\n         submit    : 'OK',\n         indicator : '<img src=\"assets/images/edit-button.png\">',\n         tooltip   : 'Click to edit...'\n     });*/\n\n     $('.edit_area').editable(function(value, settings) {\n       // console.log(tableDatas);\n       var idName=$(this).attr(\"id\");\n       //value=value.trim();\n         //console.log(value);\n        // console.log(settings);\n                   //  data     : {\"date\":new Date(dateDisplay),idName:value},\n            var postData= {\n                \"date\":new Date(dateDisplay),\n                \"name\":idName,\n                \"value\":value\n            }\n            //postData[idName]=value;\n            //postData[\"name\"]=idName;\n         $.ajax({\n            type     : \"POST\",\n            cache    : false,\n            url      : \"http://localhost/writeSummary\",\n            data     : postData,\n            success  : function(data) {\n               // $(\".printArea\").empty().append(data).css('visibility','visible');\n               console.log(\"success\");\n              // console.log(value);\n               \n            }\n        });//ajax\n         return(value);\n      }, {\n         type    : 'textarea',\n         submit  : 'OK',\n        cancel    : 'Cancel'\n\n     });\n });\n</script>\n</body>\n\n</html>\n\n\n\n",
        "x": 725.1388854980469,
        "y": 106.4444580078125,
        "wires": [
            [
                "63384f4a.4ae5"
            ]
        ]
    },
    {
        "id": "54d01954.044fc8",
        "type": "http in",
        "z": "73c2b0f6.41dab",
        "name": "",
        "url": "/trends",
        "method": "get",
        "swaggerDoc": "",
        "x": 75,
        "y": 313,
        "wires": [
            [
                "d2c752de.33b6e",
                "ef656852.ef2638",
                "6bd2d57e.2b6dcc",
                "b74868ad.b90be8",
                "14195f90.4adf4"
            ]
        ]
    },
    {
        "id": "21270523.8442da",
        "type": "template",
        "z": "73c2b0f6.41dab",
        "name": "",
        "field": "payload",
        "fieldType": "msg",
        "format": "handlebars",
        "syntax": "mustache",
        "template": "<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n    <meta charset=\"UTF-8\">\n    <title>MNS-Reporting</title>\n    <link rel=\"stylesheet\" type=\"text/css\" href=\"assets/wsr-automation/css/style.css\">\n    <script src=\"assets/wsr-automation/js/angular.min.js\"></script>\n    <script src=\"assets/wsr-automation/js/jquery-3.1.1.js\"></script>\n    <script src=\"assets/wsr-automation/js/ng-google-chart.min.js\"></script>\n<script type=\"text/javascript\">\nvar chartObject={{{chartObject}}};\nvar chartObject1={{{chartObject1}}};\nvar chartObject2={{{chartObject2}}};\nvar chartObject3={{{chartObject3}}};\nvar chartObject4={{{chartObject4}}}\nvar chartObject5={{{chartObject5}}};\n\nvar tableDatas={{{tableDatas}}};\nvar dateDisplay=tableDatas.date;\n\n</script>\n<script src=\"assets/wsr-automation/js/app.js\"></script>\n    <script src=\"assets/wsr-automation/js/trends/newtrendscontroller.js\"></script>\n    <script src=\"assets/wsr-automation/js/common/createTable.directive.js\"></script>\n    <!--<script src=\"https://ajax.googleapis.com/ajax/libs/jquery/1.12.0/jquery.min.js\"></script>\n    <script src=\"http://ajax.googleapis.com/ajax/libs/angularjs/1.4.8/angular.min.js\"></script>-->\n    \n       <!-- <script src='http://js.nicedit.com/nicEdit-latest.js'></script>-->\n\n\n</head>\n<body>\n    <main class=\"container\" ng-app=\"trendsReport\" ng-controller=\"trendsCtrl\">\n        <script type=\"text/ng-template\" id=\"incidentBurnTable.html\">\n            <tr ng-repeat=\"data in dataFromTable\">\n                <td ng-repeat=\"values in data track by $index\" ng-class=\"values\" ng-bind=\"values\"></td>\n            </tr>\n        </script>\n        <script type=\"text/ng-template\" id=\"incidentAgeTable.html\">\n            <tr>\n                <td>Ageing</td><td>0-7 Days</td><td>8-14 Days</td><td>15-30 Days</td><td>30+ Days</td>\n            </tr>\n            <tr ng-repeat=\"data in dataFromTable\">\n                <td ng-repeat=\"values in data track by $index\" ng-bind=\"values\"></td>\n            </tr>\n        </script>\n        <script type=\"text/ng-template\" id=\"incidentSumTable.html\">\n            <tr>\n                <td ng-repeat=\"(key,value) in dataFromTable\" ng-bind=\"key\"></td>\n            </tr>\n            <tr>\n                <td ng-repeat=\"data in dataFromTable\" ng-bind=\"data\"></td>\n            </tr>\n        </script>\n        <script type=\"text/ng-template\" id=\"categorizationTable.html\">\n            <!--<tr>\n                <td>Categorization</td><td>Current Week</td><td>Week ending 20th Mar</td><td>Week ending 6th Mar</td><td>Week ending 28th Feb</td>\n            </tr>-->\n            <tr ng-repeat=\"data in dataFromTable\">\n                <td ng-repeat=\"values in data track by $index\" ng-class=\"values\" ng-bind=\"values\"></td>\n            </tr>\n        </script>\n        <script type=\"text/ng-template\" id=\"weeklyAgeingTable.html\">\n            <tr>\n                <td>Ageing</td><td>0-7 Days</td><td>8-14 Days</td><td>15-30 Days</td><td>30+ Days</td>\n            </tr>\n            <tr ng-repeat=\"data in dataFromTable\">\n                <td ng-repeat=\"values in data track by $index\" ng-class=\"values\" ng-bind=\"values\"></td>\n            </tr>\n        </script>\n        <script type=\"text/ng-template\" id=\"releaseAlignmentTable.html\">\n            <tr>\n                <td>Row Labels</td><td>Not Aligned</td><td>Release 26</td><td>Grand Total</td>\n            </tr>\n            <tr ng-repeat=\"data in dataFromTable\">\n                <td ng-repeat=\"values in data track by $index\" ng-class=\"values\" ng-bind=\"values\"></td>\n            </tr>\n        </script>\n        <div class=\"clearfix\">\n            <img src=\"assets/wsr-automation/images/mns-logo.jpg\" alt=\"Marks and Spencer logo\" id=\"mnsLogo\">\n            <img src=\"assets/wsr-automation/images/sapient-nitro.png\" alt=\"SapientNitro logo\" id=\"sapientLogo\">\n        </div>\n        <div class=\"clearfix\">\n            <img src=\"assets/wsr-automation/images/print-icon.png\" alt=\"Print Logo\" id=\"printLogo\" ng-click=\"printOption()\">\n        </div>\n\n        <section class=\"clearfix\">\n            <table id=\"incidentBurnRate\" style=\"width:52%\">\n                <caption>Overall Incident Burn Rate - Weekly View  (Sev3&4)  </caption>\n                <tbody id=\"incidentBurnTable\" table-dir dataparam=\"tableDatas.incidentBurn\"></tbody>\n                <!--<tfoot>\n                    <tr>\n                      <td>Total Open</td>\n                      <td>{{totalOpen}}</td>\n                    </tr>\n                 </tfoot>-->\n            </table>\n            <table id=\"incidentAgeing\">\n                <caption>Overall Incident Ageing for Sev3 & 4</caption>\n                <tbody id=\"incidentAgeTable\" table-dir dataparam=\"tableDatas.incidentAgeing\"></tbody>\n            </table>\n        </section>\n                <section class=\"clearfix\" style=\"float:left;width:100%;margin-top:1%;\">\n            <section class=\"left-chart\">\n                <h4>Overall Incident Burn Rate</h4>\n                <div id=\"chartDiv\" class=\"chart-width\" google-chart chart=\"chartObject\" style=\"{{chart.cssStyle}}\"/>\n            </section>\n            <section class=\"right-chart\">\n                <h4>Overall Incident Ageing</h4>\n    \n                <div id=\"IncidentAgeChart\" class=\"chart-width\" google-chart chart=\"chartObject1\" style=\"{{chart.cssStyle}}\"/>\n    \n            </section>\n        </section>\n\n        <section class=\"clearfix\">\n            <div class=\"panel-message left-panel\" style=\"width: 52%;\">\n                {{#summaryInfo}}\n                    <p>{{oneWeekCritical}} Sev 1 was raised last week</p>\n                    <p>{{oneWeekHigh}} Sev 2 was raised last week</p>\n                    {{#criticalIncident}}\n                    <p>-{{Priority}} | {{incidentId}} | {{summary}}</p>\n                    {{/criticalIncident}}\n                    {{#highIncident}}\n                    <p>-{{Priority}} | {{incidentId}} | {{summary}}</p>\n                    {{/highIncident}}\n                {{/summaryInfo}}\n            </div>\n            <div class=\"panel-message right-panel \">\n            <div class=\"header-div\">\n                    <span class=\"edit-button\"></span>\n                    <h2 class=\"headlines\">Summary</h2>\n            </div>\n            <div id=\"editPanel1\" class=\"edit-div\">\n               <!-- <p>- Incident ageing  has been  under control</p>\n                <p>- Incident older than 15 days</p>\n                <p>- INC000019293754 -There is a spike in the 500 error for the command /ordercalculate. There are about 68 customer sessions until now out of which 66 customers have abandoned their basket</p>\n                <p>- INC000018829506 | Sev3 | Increase in count of 404  after R24</p>-->\n            </div>\n            </div>\n        </section>\n        <section class=\"clearfix\" style=\"clear:both\">\n            <table id=\"categorization\">\n                <caption>Categorization of Incidents - Weekly View  </caption>\n                <tbody id=\"categorizationTable\" table-dir dataparam=\"tableDatas.categorisation\"></tbody>\n            </table>\n            <section class=\"right-chart\"> \n                <!--<h4>Categorization of Incidents</h4>-->\n                <div id=\"CategorizationChart\" class=\"chart-width\" google-chart chart=\"chartObject2\" style=\"{{chart.cssStyle}}\"/>\n            </section>\n        </section>\n        <!--<section class=\"clearfix\">\n            <div class=\"panel-message left-panel\">\n                <p>71  Incidents closeds</p>\n                <p>- 12 Connectivity Issue 3rd Party - Site Confidence</p>\n                <p>- 12 Misdirected/ Invalid call</p>\n                <p>- 12 Known Error</p>\n                <p>- 11 Duplicate calls</p>\n            </div>\n        </section>-->\n        <section class=\"clearfix\" style=\"width: 100%;float:left;margin-top: 3%;\">\n            <table id=\"weeklyAge\" style=\"margin-top:5%;width:52%;\">\n                <caption>Overall Problem Record Ageing - Weekly View  </caption>\n                <tbody id=\"weeklyAgeingTable\" table-dir dataparam=\"tableDatas.probrecordAgeing\"></tbody>\n            </table>\n            <!--<table id=\"releaseAlignment\">\n                <caption>Incidents - Release Alignment : as per JIRA  </caption>\n                <tbody id=\"releaseAlignmentTable\" table-dir dataparam=\"\"></tbody>\n            </table>-->\n            <section class=\"left-chart\" style=\"width: 43%;float: right;\">\n            <h4>Overall Problem Record Ageing</h4>\n            <div id=\"weeklyAgeingChart\" class=\"chart-width\" google-chart chart=\"chartObject3\" style=\"{{chart.cssStyle}}\"/>\n        </section>\n        </section>\n        <section class=\"clearfix\" style=\"float: left;width: 100%;margin-top: 5%;\">\n\n        <section class=\"right-chart\">\n            <h4>Daily Incidents Count</h4>\n            <div id=\"releaseAlignChart\" class=\"chart-width\" google-chart chart=\"chartObject4\" style=\"{{chart.cssStyle}}\"/>\n        </section>\n        <section class=\"left-chart\" style=\"width:50%\">\n            <h4>Weekly Incidents Distribution</h4>\n\n            <div id=\"weeklyAgeingChart1\" class=\"chart-width\" google-chart chart=\"chartObject5\" style=\"{{chart.cssStyle}}\"/>\n        </section>\n        </section>\n        <!--<section class=\"right-chart\">\n            <div id=\"releaseAlignChart2\" class=\"chart-width\" google-chart chart=\"chartObject6\" style=\"{{chart.cssStyle}}\"/>\n        </section>-->\n        <section class=\"clearfix\">\n            <div class=\"panel-message left-panel \">\n                <div class=\"header-div\">\n                        <span class=\"edit-button\"></span>\n                        <h2 class=\"headlines\">Summary</h2>\n                </div>\n            <div id=\"editPanel2\" class=\"edit-div\">\n               <!-- <p>- 0  Under Review for Closure</p>\n                <p>- 0 Draft</p>\n                <p>- 0 Under Investigation</p>\n                <p>- 2 Pending with 3rd parties</p>\n                <p>- 0 Assigned</p>-->\n            </div>\n            </div>\n            <!--<div class=\"panel-message right-panel\">\n               <p>- 65 incidents are not aligned to any Release</p>\n                <p>- 0 Pending - Client Action</p>\n                <p>- 1 Pending 3rd Party</p>\n                <p>- 0 Future Enhancement</p>\n                <p>- 0 Client Hold</p>\n                <p>- 0 Under Monitoring</p>\n                <p>- 0 In progress</p>\n            </div>-->\n        </section>\n    </main>\n    \n    \n    \n</body>\n</html>\n",
        "x": 686.5000152587891,
        "y": 193.25,
        "wires": [
            [
                "167570ac.a9067f"
            ]
        ]
    },
    {
        "id": "900c297a.032e28",
        "type": "function",
        "z": "73c2b0f6.41dab",
        "name": "",
        "func": "console.log(\"function\");\nvar tableDatas={};\nvar incidentBurn=[\n    [\"Weekly Report (MM/DD/YYYY)\"],\n    [\"New\"],\n    [\"Resolved\"]/*,\n    [\"Open\"],\n    [\"Total Open\"]*/\n];\nvar incidentAgeing= [\n  [\"Incident Count\"]\n];\nvar probrecordAgeing= [\n  [\"Problem Records\"]\n];\nvar categorisation =[\n  [\"Categorization\"],\n  [\"Site Confidence Issues\"],\n    [\"Application Error\"],\n    [\"Service Request IT\"],\n    [\"Service Request Business\"],\n    [\"Misdirected/ Invalid call\"],\n    [\"Training Issues\"],\n    [\"Duplicate call\"],\n    [\"Security Breach\"],\n    [\"Known Error\"],\n    [\"Connectivity Issue - 3rd Party\"]\n];\nvar dailyIncidents=[\n[\"Days\"],\n[\"Incident Count\"],\n[\"Date\"]\n];\n\n\n\n  function nextChar(c) {\n      return String.fromCharCode(c.charCodeAt(0) + 1);\n  }\n\n  var chartObject ={\n  \"type\": \"LineChart\",\n    \"displayed\": false,\n    \"data\": {\n      \"cols\": [{\n          \"id\": \"A\",\n          \"label\": \"NEW A\",\n          \"type\": \"string\"\n        }\n  ],\n      \"rows\":[]\n    },\n    \"options\": {\n      \"title\": \"\",\n              \"height\": 230,\n\n      \"isStacked\": \"true\",\n      \"fill\": 20,\n      \"legend\": {\n        \"position\": \"bottom\"\n      },\n      \"colors\": [\n        \"#4A7EBB\",\n        \"#ff0000\",\n        \"#98B954\",\n        \"#7D60A0\"\n      ],\n      \"displayExactValues\": true,\n      \"vAxis\": {\n        \"title\": \"\",\n        \"gridlines\": {\n          \"count\": 10,\n          \"color\":\"#ffffff\"\n        }\n      },\n      \"hAxis\": {\n        \"title\": \"\",\n        \"gridlines\": {\n          \"color\":\"#000000\"\n        }\n        \n      // slantedText: true,  /* Enable slantedText for horizontal axis */\n       //slantedTextAngle: 90 /* Define slant Angle */\n   \n      }\n    },\n    \"formatters\": {}\n  };\n  var chartObject1= {\n    \"type\": \"BarChart\",\n    \"displayed\": true,\n    \"data\": {\n      \"cols\": [\n        {\n          \"id\": \"A\",\n          \"label\": \"NEW A\",\n          \"type\": \"string\"\n        },\n        {\n          \"id\": \"B\",\n          \"label\": \"Incident Count\",\n          \"type\": \"number\"\n        },\n        {\n          \"id\":\"C\",\n          \"type\": \"string\", \n          \"role\": \"annotation\"\n        }\n      ],\n      \"rows\": []\n    },\n    \"options\": {\n      \"title\": \"\",\n      \"isStacked\": \"false\",\n      \"fill\": 20,\n      \"displayExactValues\": true,\n      \"colors\": [\n        \"#92D050\"\n      ],\n      \"legend\": {\n        \"position\": \"bottom\"\n      },\n      \"vAxis\": {\n        \"title\": \"\",\n        \"gridlines\": {\n          \"count\": 10,\n            \"color\":\"#ffffff\"\n\n        }\n      },\n      \"orientation\": \"horizontal\",\n      \"hAxis\": {\n        \"title\": \"\"\n      },\n      \"annotations\":{\n        \"alwaysOutside\":true,\n        \"textStyle\": {\n            \"bold\": true,\n            \"color\": '#000000',\n          },\n          \"stem\" : {\n            \"length\":0\n          }\n      }\n    },\n    \n    \"formatters\": {}\n\n  }\n\n  var chartObject3 = {\n    \"type\": \"BarChart\",\n    \"displayed\": true,\n    \"data\": {\n      \"cols\": [\n        {\n          \"id\": \"A\",\n          \"label\": \"weeklyAgeing\",\n          \"type\": \"string\"\n        },\n        {\n          \"id\": \"B\",\n          \"label\": \"Problem Records\",\n          \"type\": \"number\"\n        },\n        {\n          \"id\":\"C\",\n          \"type\": \"string\", \n          \"role\": \"annotation\"\n        }\n      ],\n      \"rows\": []\n    },\n    \"options\": {\n      \"title\": \"\",\n      \"isStacked\": \"false\",\n      \"fill\": 20,\n      \"displayExactValues\": true,\n      \"width\": 600,\n      \"colors\": [\n        \"#92D050\"\n      ],\n      \"legend\": {\n        \"position\": \"bottom\"\n      },\n      \"vAxis\": {\n        \"title\": \"\",\n        \"gridlines\": {\n          \"count\": 4,\n            \"color\":\"#ffffff\"\n\n        }\n      },\n      \"orientation\": \"horizontal\",\n      \"hAxis\": {\n        \"title\": \"\"\n      },\n      \"annotations\":{\n        \"alwaysOutside\":true,\n        \"textStyle\": {\n            \"bold\": true,\n            \"color\": '#000000',\n          },\n          \"stem\" : {\n            \"length\":0\n          }\n      }\n\n    },\n    \"formatters\": {}\n  }\n\n  var chartObject4 = {\n    \"type\": \"BarChart\",\n    \"displayed\": true,\n    \"data\": {\n      \"cols\": [\n        {\n          \"id\": \"A\",\n          \"label\": \"Daily Incidents\",\n          \"type\": \"string\"\n        },\n        {\n          \"id\": \"B\",\n          \"label\": \"Daily Incidents Count\",\n          \"type\": \"number\"\n        },\n        {\n          \"id\":\"C\",\n          \"type\": \"string\", \n          \"role\": \"annotation\"\n        }\n      ],\n      \"rows\": []\n    },\n    \"options\": {\n      \"title\": \"\",\n      \"isStacked\": \"false\",\n      \"fill\": 20,\n      \"displayExactValues\": true,\n      \"width\": 600,\n      \"height\":250,\n      \"colors\": [\n        \"#92D050\"\n      ],\n      \"legend\": {\n        \"position\": \"bottom\"\n      },\n      \"vAxis\": {\n        \"title\": \"\",\n        \"gridlines\": {\n          \"count\": 4,\n            \"color\":\"#ffffff\"\n\n        }\n      },\n      \"orientation\": \"horizontal\",\n      \"hAxis\": {\n        \"title\": \"\"\n      },\n      \"annotations\":{\n        \"alwaysOutside\":true,\n        \"textStyle\": {\n            \"bold\": true,\n            \"color\": '#000000',\n          },\n          \"stem\" : {\n            \"length\":0\n          }\n      }\n    },\n    \"formatters\": {}\n  }\n\n  var chartObject2= {\n    \"type\": \"ComboChart\",\n    \"displayed\": true,\n    \"data\": {\n      \"cols\": [\n        {\n          \"id\": \"A\",\n          \"label\": \"NEW A\",\n          \"type\": \"string\"\n        },\n        {\n          \"id\": \"B\",\n          \"label\": \"Current Week\",\n          \"type\": \"number\"\n        },\n                {\n          \"id\":\"C\",\n          \"type\": \"string\", \n          \"role\": \"annotation\"\n        },\n        {\n          \"id\": \"B\",\n          \"label\": \"\",\n          \"type\": \"number\"\n        }\n      ],\n      \"rows\": []\n    },\n    \"options\": {\n      \"title\": \"\",\n      \"isStacked\": \"false\",\n      \"fill\": 20,\n      \"displayExactValues\": true,\n      \"seriesType\": \"bars\",\n      \"width\": 600,\n      \"height\":400,\n      \"series\": {\n        \"1\": {\n          \"type\": \"line\"\n        }\n      },\n      \"colors\": [\n        \"#92D050\",\n        \"#D17E7C\"\n      ],\n      \"legend\": {\n        \"position\": \"bottom\"\n      },\n      \"vAxis\": {\n        \"title\": \"\",\n        \"gridlines\": {\n          \"count\": 5,\n            \"color\":\"#ffffff\"\n\n        }\n      },\n      \"orientation\": \"horizontal\",\n      \"hAxis\": {\n        \"title\": \"\"\n      },\n      \"annotations\":{\n        \"alwaysOutside\":true,\n        \"textStyle\": {\n            \"bold\": true,\n            \"color\": '#000000',\n          },\n          \"stem\" : {\n            \"length\":0\n          }\n      }\n    },\n    \"formatters\": {}\n  }\n\n\nfunction getfulldate(today) { //returns date in mm/dd/yyyy format\n  var currentDate=today.getDate(),\n    currentMonth=today.getMonth()+1;\n  var x=(currentMonth<10)?('0'+currentMonth):currentMonth;\n  var y=(currentDate<10)?('0'+currentDate):currentDate;\n  return (x+'/'+y+'/'+today.getFullYear());\n}\nfunction getLastSunday(d) { //returns last sunday date takes input as mm/dd/yyyy\n    var t = new Date(d);\n    t.setDate(t.getDate() - t.getDay());\n    return t;\n}\nfunction getDateStamp(dateStamp) {\n  var monthName=[\"Jan\", \"Feb\", \"Mar\", \"Apr\", \"May\", \"June\",\"July\", \"Aug\", \"Sept\", \"Oct\", \"Nov\", \"Dec\"];\n  var newDate= new Date(dateStamp);\n  return newDate.getDate()+\"-\"+monthName[newDate.getMonth()]+\"-\"+newDate.getFullYear();\n}\nvar dateArray=[];\nvar lastSundaydate=getLastSunday(getfulldate(new Date()));\ntableDatas[\"date\"]=getDateStamp(lastSundaydate);\nvar lastSunday=getfulldate(lastSundaydate);\nvar i=2;\ndateArray[i-1]=lastSunday;\nincidentBurn[0][i-1]=getDateStamp(new Date(lastSunday));\n//incidentBurn[0][i-1]=lastSunday;\ncategorisation[0][i-1]=getDateStamp(new Date(lastSunday));\nvar lastSunday1=new Date(lastSunday);\ndailyIncidents[0][1]=getfulldate(lastSunday1);\ndailyIncidents[2][1]=getDateStamp(new Date(lastSunday1));\n//console.log(new Date(lastSunday));\n//for (var i=1;i<7;i++) {\ndailyIncidents[0][2]=getfulldate(new Date(lastSunday1.getTime() - (24*60*60*1000*1)));\ndailyIncidents[2][2]=getDateStamp(new Date(new Date(lastSunday1.getTime() - (24*60*60*1000*1))));\n\ndailyIncidents[0][3]=getfulldate(new Date(lastSunday1.getTime() - (24*60*60*1000*2)));\ndailyIncidents[2][3]=getDateStamp(new Date(new Date(lastSunday1.getTime() - (24*60*60*1000*2))));\n\ndailyIncidents[0][4]=getfulldate(new Date(lastSunday1.getTime() - (24*60*60*1000*3)));\ndailyIncidents[2][4]=getDateStamp(new Date(new Date(lastSunday1.getTime() - (24*60*60*1000*3))));\n\ndailyIncidents[0][5]=getfulldate(new Date(lastSunday1.getTime() - (24*60*60*1000*4)));\ndailyIncidents[2][5]=getDateStamp(new Date(new Date(lastSunday1.getTime() - (24*60*60*1000*4))));\n\ndailyIncidents[0][6]=getfulldate(new Date(lastSunday1.getTime() - (24*60*60*1000*5)));\ndailyIncidents[2][6]=getDateStamp(new Date(new Date(lastSunday1.getTime() - (24*60*60*1000*5))));\n\ndailyIncidents[0][7]=getfulldate(new Date(lastSunday1.getTime() - (24*60*60*1000*6)));\ndailyIncidents[2][7]=getDateStamp(new Date(new Date(lastSunday1.getTime() - (24*60*60*1000*6))));\n\nfor (var z=1;z<dailyIncidents[0].length;z++) {\nvar dateDaily=new Date(dailyIncidents[0][z]);\nvar sev1sev2=0,sev3sev4=0;\n  for (var je=0;je<msg.incidentData.length;je++) {\n    var getDate1=msg.incidentData[je][\"Reported Date+\"];\n      var daterange1=getDate1.substring(0, getDate1.indexOf(' '));\n      var check1=new Date(daterange1);\n      //console.log(check1)\n      if(check1.getTime()==dateDaily.getTime() && (msg.incidentData[je][\"Priority*\"]===\"Critical\" || msg.incidentData[je][\"Priority*\"]===\"High\")) {\n        sev1sev2++;\n       }\n  }\n  for (var je=0;je<msg.aecomData.length;je++) {\n    var getDate2=msg.aecomData[je][\"Reported Date+\"];\n      var daterange2=getDate2.substring(0, getDate2.indexOf(' '));\n      var check2=new Date(daterange2);\n      //console.log(check1)\n      if(check2.getTime()==dateDaily.getTime() && (msg.aecomData[je][\"Priority*\"]===\"Medium\" || msg.aecomData[je][\"Priority*\"]===\"Low\")) {\n        sev3sev4++;\n       }\n  }\n  dailyIncidents[1][z]=sev1sev2+sev3sev4;\n    //dailyIncidents[1][z+1]=sev3sev4;\n}\nvar sev1Count=0,sev2Count=0,sev3Count=0,sev4Count=0;\n\n/*var mySunday=getLastSunday(getfulldate(new Date()));\nvar mySundaydate=getfulldate(mySunday);\ndailyIncidents[0][1]=mySundaydate;\nconsole.log(dailyIncidents);\nfor (var i=1;i<=6;i++) {\n  //console.log(new Date(getfulldate(getfulldate(new Date()).getDate();\n  //var ndate=new Date(new Date(mySundaydate).setDate(new Date(mySundaydate).getDate() - i)).setHours(0,0,0,0);\n  //console.log(ndate);\n  //console.log(new Date(new Date(new Date(getfulldate(getLastSunday(getfulldate(new Date())))).setDate(new Date(getfulldate(getLastSunday(getfulldate(new Date())))).getDate() - i)).setHours(0,0,0,0)));\n\n}*/\n/***daily data**/\n/*var dailyIncidents=[\n[\"Days\"],\n[\"Incident Count\"]\n];\nvar mySunday=getLastSunday(getfulldate(new Date()));\nvar mySundaydate=getfulldate(mySunday);\ndailyIncidents[0][1]=mySundaydate;\nfor (var i=1;i<=6;i++) {\n  console.log(new Date(new Date(new Date(mySundaydate).setDate(new Date(mySundaydate).getDate() - i)).setHours(0,0,0,0)));\n\n}*/\n\n/****/\ndo{\n  var newlastSundaydate=new Date(lastSundaydate.setDate(lastSundaydate.getDate() - 7));\n  var newlastSunday=getfulldate(newlastSundaydate);\n  dateArray[i]=newlastSunday;\n  incidentBurn[0][i]=getDateStamp(new Date(newlastSunday));\n  //incidentBurn[0][i]=newlastSunday;\n  categorisation[0][i]=getDateStamp(new Date(newlastSunday));\n  lastSundaydate=newlastSundaydate;\n  lastSunday=newlastSunday;\n  i++;\n} while(i<7);\n//console.log(\"dateArray\",dateArray);\n//console.log(\"incidentBurn\",incidentBurn);\n\nvar criticalCount=0,highCount=0,lowCount=0,incidentAgePopulate=true,checkforFirstItr=true,incidentAge1=0,incidentAge2=0,incidentAge3=0,incidentAge4=0,ProbRecordAge1=0,ProbRecordAge2=0,ProbRecordAge3=0,ProbRecordAge4=0,oneWeekCritical=0,oneWeekHigh=0,criticalIncidentObj=[],highIncidentObj=[];\n/***Find date range***/\nvar todayDate=new Date();\ntodayDate.setHours(0,0,0);\nvar day1=new Date(todayDate.setDate(todayDate.getDate() - 1)).setHours(0,0,0,0);\nvar day7=new Date(todayDate.setDate(todayDate.getDate() - 7)).setHours(0,0,0,0);\nvar day8=new Date(todayDate.setDate(todayDate.getDate() - 1)).setHours(0,0,0,0);\nvar day14=new Date(todayDate.setDate(todayDate.getDate() - 6)).setHours(0,0,0,0);\nvar day15=new Date(todayDate.setDate(todayDate.getDate() - 1)).setHours(0,0,0,0);\nvar day30=new Date(todayDate.setDate(todayDate.getDate() - 6)).setHours(0,0,0,0);\nvar today=new Date();\nvar day6=new Date(new Date().setDate(new Date().getDate()-25));\nfor (var i=1;i<incidentBurn[0].length;i++) {\n  //var dateTo=incidentBurn[0][i];\n  var dateTo=dateArray[i];\n    var to=new Date(dateTo);\n    var newto=new Date(dateTo);\n    var dateFrom=new Date(newto.setDate(newto.getDate() - 6));\n    var category=[0,0,0,0,0,0,0,0,0,0];\n\n    var incidentCount=0,d13=0,e13=0,b13=0,c13=0,d14=0,e14=0,f3a=0,f3b=0,f4a=0,f4b=0,f5a=0,f5b=0;\n  for (var j=0;j<msg.incidentData.length;j++) {\n    var getDate=msg.incidentData[j][\"Reported Date+\"];\n      var daterange=getDate.substring(0, getDate.indexOf(' '));\n      var check=new Date(daterange);\n      var getClosedDate=msg.incidentData[j][\"Closed Date\"];\n\n\n      /****incident ageing****/\n      if (incidentAgePopulate && (msg.incidentData[j][\"Status*\"]===\"Assigned\" || msg.incidentData[j][\"Status*\"]===\"Pending\")) {\n      \n      if(check<=day1 && check>=day7) {\n        incidentAge1++;\n      } else if (check<=day8 && check>=day14) {\n        incidentAge2++;\n      } else if (check<=day15 && check>=day30) {\n        incidentAge3++\n      } else incidentAge4++;\n    } else if (incidentAgePopulate) {\n\n      if(check<=today && check>=day6) {\n\n        if(msg.incidentData[j][\"Priority*\"]===\"Critical\") {\n          oneWeekCritical++;\n          criticalIncidentObj.push({\"Priority\":\"Sev1\",\"incidentId\":msg.incidentData[j][\"Incident ID*+\"],\"summary\":msg.incidentData[j][\"Summary*\"]});\n\n        }\n        else if (msg.incidentData[j][\"Priority*\"]===\"High\"){\n          oneWeekHigh++;\n          highIncidentObj.push({\"Priority\":\"Sev2\",\"incidentId\":msg.incidentData[j][\"Incident ID*+\"],\"summary\":msg.incidentData[j][\"Summary*\"]});\n        }\n\n      } \n\n      if(check >= dateFrom && check <= to ) {\n        if(msg.incidentData[j][\"Priority*\"]===\"Critical\")\n        {\n          sev1Count++;\n        } else if (msg.incidentData[j][\"Priority*\"]===\"High\") {\n          sev2Count++;\n        }\n          \n        }\n\n\n    }\n    /**/\n\n      if(msg.incidentData[j][\"Status*\"]===\"Assigned\" && (msg.incidentData[j][\"Priority*\"]===\"Medium\" || msg.incidentData[j][\"Priority*\"]===\"Critical\" || msg.incidentData[j][\"Priority*\"]===\"High\"))\n    {\n      f3a++;\n    }\n    else if(msg.incidentData[j][\"Status*\"]===\"In Progress\" && (msg.incidentData[j][\"Priority*\"]===\"Medium\" || msg.incidentData[j][\"Priority*\"]===\"Critical\" || msg.incidentData[j][\"Priority*\"]===\"High\"))\n    {\n      f4a++;\n    } \n    else if (msg.incidentData[j][\"Status*\"]===\"Pending\" && (msg.incidentData[j][\"Priority*\"]===\"Medium\" || msg.incidentData[j][\"Priority*\"]===\"Critical\" || msg.incidentData[j][\"Priority*\"]===\"High\"))\n    {\n      f5a++;\n    } \n\n      if(getClosedDate!==undefined) {\n        var ClosedDaterange=new Date(getClosedDate.substring(0, getClosedDate.indexOf(' ')));\n        if(ClosedDaterange >= dateFrom && ClosedDaterange <= to) {\n          if(msg.incidentData[j][\"Priority*\"]===\"Medium\")\n        {\n          d14++;\n        }\n        }\n\n      }\n    if(check >= dateFrom && check <= to ) {\n      if(msg.incidentData[j][\"Priority*\"]===\"Medium\")\n      {\n        d13++;\n      }\n      if(msg.incidentData[j][\"Priority*\"]===\"Low\")\n      {\n        e13++;\n      }\n      if(msg.incidentData[j][\"Priority*\"]===\"Critical\")\n      {\n        b13++;\n      }\n      if(msg.incidentData[j][\"Priority*\"]===\"High\")\n      {\n        c13++;\n      }\n\n      if(msg.incidentData[j][\"Resolution Categorization Tier 2\"]===\"Site Confidence Issues\") {\n        category[0]++;\n      } else if (msg.incidentData[j][\"Resolution Categorization Tier 2\"]===\"Application Error\") {\n        category[1]++;\n      } else if(msg.incidentData[j][\"Resolution Categorization Tier 2\"]===\"Service Request IT\") {\n        category[2]++;\n      } else if(msg.incidentData[j][\"Resolution Categorization Tier 2\"]===\"Service Request Business\") {\n        category[3]++;\n      } else if(msg.incidentData[j][\"Resolution Categorization Tier 2\"]===\"Misdirected/ Invalid call\") {\n        category[4]++;\n      } else if(msg.incidentData[j][\"Resolution Categorization Tier 2\"]===\"Training Issues\") {\n        category[5]++;\n      } else if(msg.incidentData[j][\"Resolution Categorization Tier 2\"]===\"Duplicate call\") {\n        category[6]++;\n      } else if(msg.incidentData[j][\"Resolution Categorization Tier 2\"]===\"Security Breach\") {\n        category[7]++;\n      } else if(msg.incidentData[j][\"Resolution Categorization Tier 2\"]===\"Known Error\") {\n        category[8]++;\n      } else if(msg.incidentData[j][\"Resolution Categorization Tier 2\"]===\"Connectivity Issue - 3rd Party\") {\n        category[9]++;\n      } \n          \n      }\n      \n  }\n\n  for (var j=0;j<10;j++) {\n    categorisation[j+1][i]=category[j];\n  }\n  incidentAgePopulate=false;\n  for (var j=0;j<msg.aecomData.length;j++) {\n    var getDate=msg.aecomData[j][\"Reported Date+\"];\n      var daterange=getDate.substring(0, getDate.indexOf(' '));\n      var check=new Date(daterange);\n      var getClosedDate=msg.aecomData[j][\"Last Modified Date\"];\n\n      if(msg.aecomData[j][\"Status*\"]===\"Assigned\" && msg.aecomData[j][\"Priority*\"]===\"Low\") {\n        f3b++;\n      }\n      \n      else if(msg.aecomData[j][\"Status*\"]===\"In Progress\" && msg.aecomData[j][\"Priority*\"]===\"Low\") {\n        f4b++;\n      }\n      else if (msg.aecomData[j][\"Status*\"]===\"Pending\" && msg.aecomData[j][\"Priority*\"]===\"Low\") {\n        f5b++;\n      }\n\n      if(getClosedDate !==undefined) {\n        var ClosedDaterange=new Date(getClosedDate.substring(0, getClosedDate.indexOf(' ')));\n        if(ClosedDaterange >= dateFrom && ClosedDaterange <= to) {\n          if(msg.aecomData[j][\"Priority*\"]===\"Low\" && (msg.aecomData[j][\"Status*\"]===\"Resolved\" || msg.incidentData[j][\"Status*\"]===\"Closed\"))\n        {\n          e14++;\n        }\n        }\n      }\n    if(check >= dateFrom && check <= to ) {\n      \n      if(msg.aecomData[j][\"Priority*\"]===\"Low\")\n      {\n        e13++;\n      }\n        \n      }\n      if(checkforFirstItr) {\n        if(check >= dateFrom && check <= to ) {\n        if(msg.aecomData[j][\"Priority*\"]===\"Medium\")\n        {\n          sev3Count++;\n        } else if (msg.aecomData[j][\"Priority*\"]===\"Low\") {\n          sev4Count++;\n        }\n          \n        }\n      }\n      \n  }\n  incidentBurn[1][i]=d13+e13;\n  incidentBurn[2][i]=d14+e14;\n  //incidentBurn[3][i]=f3a+f3b+f4a+f4b;\n  msg.totalOpen=f3a+f3b+f4a+f4b+f5a+f5b;\n  checkforFirstItr=false;\n}\n//populating incidentAgeing \nincidentAgeing[0].push(incidentAge1,incidentAge2,incidentAge3,incidentAge4);\n\n/***populating incidentAgeingChart data***/\n  var alpha='A';\n  for (var i=0;i<incidentAgeing.length;i++) {\n    /*var charObj=\n    {\n          \"id\": \"\",\n          \"label\": \"\",\n          \"type\": \"number\"\n        };\n      charObj.id=nextChar(alpha);\n      alpha=nextChar(alpha);\n      charObj.label=incidentAgeing[i][0];\n      chartObject1.data.cols.push(charObj);*/\n  }\n  var daysCount=[\"0-7 Days\",\"8-14 Days\",\"15-30 Days\",\"30+ Days\"];\n  for (var j=1;j<incidentAgeing[0].length;j++){\n    var abc={\n    \"c\": []\n    };\n    var obj= {\n          \"v\": j-1,\n          \"f\": daysCount[j-1]\n        }\n        var obj1=\n        {\n          \"v\": incidentAgeing[0][j]\n        };\n    \n    abc.c.push(obj);\n    abc.c.push(obj1);\n    abc.c.push(obj1);\n    chartObject1.data.rows.push(abc);\n  }\n/***populating incidentBurnChart data***/\n\nvar alpha='A';\n\nfor (var i=1;i<incidentBurn.length;i++) {\n  var charObj=\n  {\n      \"id\": \"\",\n      \"label\": \"\",\n      \"type\": \"number\"\n    };\n    charObj.id=nextChar(alpha);\n    alpha=nextChar(alpha);\n    charObj.label=incidentBurn[i][0];\n    chartObject.data.cols.push(charObj);\n}\n\nfor (var i=1;i<incidentBurn[0].length;i++) {\n  var abc={\n  \"c\": []\n  };\n  for (var j=0;j<incidentBurn.length;j++){\n    if(i===1 && j===0) {\n      var obj={\n              \"v\": 0,\n              \"f\": incidentBurn[j][i]\n            }\n    } else {\n      var obj={\n        \"v\":incidentBurn[j][i]\n      }\n    }\n    abc.c.push(obj);\n  }\n  chartObject.data.rows.push(abc);\n}\n\n\nfor (var i=1;i<dailyIncidents[0].length;i++) {\n  var abc={\n  \"c\": []\n  };\n      var obj={\n              \"v\": i-1,\n              \"f\": dailyIncidents[2][i]\n            }\n      var obj1={\n        \"v\":dailyIncidents[1][i]\n      }\n    abc.c.push(obj);\n    abc.c.push(obj1);\n    abc.c.push(obj1);\n\n  chartObject4.data.rows.push(abc);\n}\n/***probrecord Ageing***/\nfor (var i=0;i<msg.probRecords.length;i++) {\n    var getDate=msg.probRecords[i][\"Submit Date\"];\n    var daterange=getDate.substring(0, getDate.indexOf(' '));\n    var check=new Date(daterange);\n    /****probRecord ageing****/\n    if (msg.probRecords[i][\"Status*\"]===\"Draft\" || msg.probRecords[i][\"Status*\"]===\"Under Review\"){\n    if(check<=day1 && check>=day7) {\n      ProbRecordAge1++;\n    } else if (check<=day8 && check>=day14) {\n      ProbRecordAge2++;\n    } else if (check<=day15 && check>=day30) {\n      ProbRecordAge3++\n    } else ProbRecordAge4++;\n  }\n  \n}\nprobrecordAgeing[0].push(ProbRecordAge1,ProbRecordAge2,ProbRecordAge3,ProbRecordAge4);\n\nfor (var j=1;j<probrecordAgeing[0].length;j++){\n    var abc={\n    \"c\": []\n    };\n    var obj= {\n          \"v\": j-1,\n          \"f\": daysCount[j-1]\n        }\n        var obj1=\n        {\n          \"v\": probrecordAgeing[0][j]\n        };\n    \n    abc.c.push(obj);\n    abc.c.push(obj1);\n    abc.c.push(obj1);\n    chartObject3.data.rows.push(abc);\n  }\n\n  for (var i=1;i<categorisation.length;i++) {\n    //console.log(categorisation[i+1][0]);\n    var abc={\n      \"c\":[]\n    };\n    var obj={\n      \"v\":i,\n      \"f\":categorisation[i][0]\n    }\n    var obj1= {\n      \"v\":categorisation[i][1]\n    };\n    var obj2={\n      \"v\":categorisation[i][2]\n    }\n    abc.c.push(obj);\n    abc.c.push(obj1);\n    abc.c.push(obj1);\n\n    abc.c.push(obj2);\n    chartObject2.data.rows.push(abc);\n\n  }\n  chartObject2.data.cols[1][\"label\"]=\"Current week \"+categorisation[0][1];\n  chartObject2.data.cols[3][\"label\"]=\"week ending \"+categorisation[0][2];\n\n  var chartObject5={\n    \"type\": \"PieChart\",\n    \"displayed\": false,\n    \"data\": {\n      \"cols\": [\n        {\n          \"id\": \"A\",\n          \"label\": \"NEW A\",\n          \"type\": \"string\"\n        },\n        {\n          \"id\": \"B\",\n          \"label\": \"Sev1\",\n          \"type\": \"number\"\n        },\n        {\n          \"id\": \"C\",\n          \"label\": \"Sev2\",\n          \"type\": \"number\"\n        }\n      ],\n      \"rows\": [\n        {\n          \"c\": [\n            {\n              \"v\": 1,\n              \"f\": \"Sev1\"\n            },\n            {\n              \"v\": sev1Count\n            }\n          ]\n        },\n        {\n          \"c\": [\n            {\n              \"v\": 2,\n              \"f\": \"Sev2\"\n            },\n            {\n              \"v\": sev2Count\n            }\n\n          ]\n        },\n        {\n          \"c\": [\n            {\n              \"v\": 3,\n              \"f\": \"Sev3\"\n            },\n            {\n              \"v\": sev3Count\n            }\n          ]\n        },\n        {\n          \"c\": [\n            {\n              \"v\": 4,\n              \"f\": \"Sev4\"\n            },\n            {\n              \"v\": sev4Count\n            }\n          ]\n        }\n        \n        \n        \n      ]\n    },\n    \"options\": {\n      \"title\": \"\",\n      \"isStacked\": \"true\",\n      \"fill\": 20,\n      \"displayExactValues\": true,\n      //\"seriesType\": \"bars\",\n      \"width\": 600,\n      \"colors\": [\n        \"#92D050\",\n        \"#D20000\",\n        \"#E17E7C\",\n        \"#127E7C\"\n      ],\n      \"vAxis\": {\n        \"title\": \"\",\n        \"gridlines\": {\n          \"count\": 10,\n            \"color\":\"#ffffff\"\n\n        }\n      },\n      //\"orientation\": \"horizontal\",\n      \"hAxis\": {\n        \"title\": \"\"\n      }\n    },\n    \"formatters\": {}\n  }\n  \nmsg.chartObject=JSON.stringify(chartObject);\nmsg.chartObject1=JSON.stringify(chartObject1);\nmsg.chartObject2=JSON.stringify(chartObject2);\nmsg.chartObject3=JSON.stringify(chartObject3);\nmsg.chartObject4=JSON.stringify(chartObject4);\nmsg.chartObject5=JSON.stringify(chartObject5);\ntableDatas[\"incidentBurn\"]=incidentBurn;\ntableDatas[\"incidentAgeing\"]=incidentAgeing;\ntableDatas[\"probrecordAgeing\"]=probrecordAgeing;\ntableDatas[\"categorisation\"]=categorisation;\nmsg.tableDatas= JSON.stringify(tableDatas);\nmsg.tableData=tableDatas;\nmsg.summaryInfo={\n  \"oneWeekCritical\":oneWeekCritical,\n  \"oneWeekHigh\":oneWeekHigh,\n  \"criticalIncident\":criticalIncidentObj,\n  \"highIncident\":highIncidentObj\n}\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 589.9999847412109,
        "y": 260.2500305175781,
        "wires": [
            [
                "21270523.8442da"
            ]
        ]
    },
    {
        "id": "ce43d020.cf207",
        "type": "inject",
        "z": "61f45e89.e9959",
        "name": "",
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "repeat": "",
        "crontab": "",
        "once": false,
        "x": 88.82670593261719,
        "y": 33.090911865234375,
        "wires": [
            [
                "8db0206f.48788"
            ]
        ]
    },
    {
        "id": "4fec9876.a5ab68",
        "type": "csv",
        "z": "61f45e89.e9959",
        "name": "CSV content",
        "sep": ",",
        "hdrin": true,
        "hdrout": "",
        "multi": "one",
        "ret": "\\n",
        "temp": "Incident ID*+,Last Name+,First Name+,Service*+,Priority*,Status*,Assigned Group*+,Assignee+,Target Date,SLM Real Time Status,Reported Date+,Last Modified By,Last Modified Date,Pending Elapsed Time,Pending Start Time,Product Name+*,Responded Date+,Submit Date,Submitter*,Resolution Categorization Tier 1,Resolution Categorization Tier 2,Response",
        "x": 422.8267059326172,
        "y": 25.090911865234375,
        "wires": [
            [
                "68f00d2a.165314"
            ]
        ]
    },
    {
        "id": "68f00d2a.165314",
        "type": "function",
        "z": "61f45e89.e9959",
        "name": "",
        "func": "\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 552.8267059326172,
        "y": 75.09091186523438,
        "wires": [
            [
                "fbe785b5.c942f8"
            ]
        ]
    },
    {
        "id": "fbe785b5.c942f8",
        "type": "mongodb out",
        "z": "61f45e89.e9959",
        "mongodb": "c60cb185.3a934",
        "name": "Aecom-csv",
        "collection": "Aecom-data",
        "payonly": true,
        "upsert": true,
        "multi": true,
        "operation": "store",
        "x": 722.8267059326172,
        "y": 50.090911865234375,
        "wires": []
    },
    {
        "id": "8db0206f.48788",
        "type": "file in",
        "z": "61f45e89.e9959",
        "name": "",
        "filename": "D:/csv-files/aecomRGVcsv.csv",
        "format": "utf8",
        "x": 189.82666015625,
        "y": 86.09091186523438,
        "wires": [
            [
                "4fec9876.a5ab68"
            ]
        ]
    },
    {
        "id": "3523d4be.fb800c",
        "type": "http in",
        "z": "61f45e89.e9959",
        "name": "",
        "url": "/getaecom",
        "method": "get",
        "swaggerDoc": "",
        "x": 85,
        "y": 656.022705078125,
        "wires": [
            [
                "1021a67a.af2b8a"
            ]
        ]
    },
    {
        "id": "e1ef9f48.f82f5",
        "type": "mongodb in",
        "z": "61f45e89.e9959",
        "mongodb": "c60cb185.3a934",
        "name": "",
        "collection": "Aecom-data",
        "operation": "find",
        "x": 386,
        "y": 674.022705078125,
        "wires": [
            [
                "6d1adb7c.e41cb4"
            ]
        ]
    },
    {
        "id": "6d1adb7c.e41cb4",
        "type": "json",
        "z": "61f45e89.e9959",
        "name": "",
        "x": 531,
        "y": 748.022705078125,
        "wires": [
            [
                "43333388.b7ec6c"
            ]
        ]
    },
    {
        "id": "7260f245.c3057c",
        "type": "http response",
        "z": "61f45e89.e9959",
        "name": "",
        "x": 837,
        "y": 722.022705078125,
        "wires": []
    },
    {
        "id": "43333388.b7ec6c",
        "type": "function",
        "z": "61f45e89.e9959",
        "name": "",
        "func": "return msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 666,
        "y": 694.022705078125,
        "wires": [
            [
                "7260f245.c3057c"
            ]
        ]
    },
    {
        "id": "1021a67a.af2b8a",
        "type": "function",
        "z": "61f45e89.e9959",
        "name": "",
        "func": "msg.skip=0;\nmsg.limit=0;\nmsg.payload={};\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 141,
        "y": 741.022705078125,
        "wires": [
            [
                "e1ef9f48.f82f5"
            ]
        ]
    },
    {
        "id": "ef656852.ef2638",
        "type": "http request",
        "z": "73c2b0f6.41dab",
        "name": "",
        "method": "GET",
        "ret": "txt",
        "url": "http://127.0.0.1:80/getaecom",
        "tls": "",
        "x": 269.1896057128906,
        "y": 316.1761474609375,
        "wires": [
            [
                "579dafa5.64bd1"
            ]
        ]
    },
    {
        "id": "579dafa5.64bd1",
        "type": "function",
        "z": "73c2b0f6.41dab",
        "name": "",
        "func": "msg.identifier=\"aecom\";\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 450.9431610107422,
        "y": 287.08380126953125,
        "wires": [
            [
                "ce75b255.31529"
            ]
        ]
    },
    {
        "id": "b74868ad.b90be8",
        "type": "gcalendar",
        "z": "73c2b0f6.41dab",
        "name": "",
        "topic": "gcalendar",
        "calendarId": "primary",
        "x": 243.88884735107422,
        "y": 83.00000762939453,
        "wires": [
            [
                "76e5561.61c34a8"
            ]
        ]
    },
    {
        "id": "76e5561.61c34a8",
        "type": "function",
        "z": "73c2b0f6.41dab",
        "name": "",
        "func": "msg.identifier=\"calendar-event\";\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 424,
        "y": 70.77777671813965,
        "wires": [
            [
                "ce75b255.31529"
            ]
        ]
    },
    {
        "id": "79ac9c3c.7aeed4",
        "type": "http in",
        "z": "73c2b0f6.41dab",
        "name": "",
        "url": "/categoryPage",
        "method": "get",
        "swaggerDoc": "",
        "x": 128.95738220214844,
        "y": 440.593710899353,
        "wires": [
            [
                "2c6a95de.80a52a"
            ]
        ]
    },
    {
        "id": "2c6a95de.80a52a",
        "type": "http request",
        "z": "73c2b0f6.41dab",
        "name": "",
        "method": "GET",
        "ret": "txt",
        "url": "http://127.0.0.1:80/getjson",
        "tls": "",
        "x": 107.95454406738281,
        "y": 378.0511169433594,
        "wires": [
            [
                "96d04027.de742"
            ]
        ]
    },
    {
        "id": "964ca15d.00a79",
        "type": "template",
        "z": "73c2b0f6.41dab",
        "name": "",
        "field": "payload",
        "fieldType": "msg",
        "format": "handlebars",
        "syntax": "mustache",
        "template": " \n<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n    <meta charset=\"UTF-8\">\n    <title>MNS-Reporting</title>\n    <link rel=\"stylesheet\" type=\"text/css\" href=\"assets/wsr-automation/css/style.css\">\n    <style>\n        h2 {\n            text-align:center;\n        }\n    </style>\n    <script src=\"https://ajax.googleapis.com/ajax/libs/jquery/1.12.0/jquery.min.js\"></script>\n\n    <script type=\"text/javascript\">\n    $(document).ready(function(){\n        $('select').on('change',function(e){\n            $.ajax({\n                type     : \"POST\",\n                cache    : false,\n                url      : \"http://localhost/updateData\",\n                data     : $(this).closest('tr').find('input,select').serialize(),\n                success  : function(data) {\n                    $(e.target).closest('tr').find(\".category2\").html(e.target.value);\n                //     console.log(e.target.value);\n                }\n            });\n        });\n    });\n    </script>\n</head>\n<body>\n    <h2>Categorisation for week ending {{weekDate}}</h2>\n<table>\n\n    {{#categoryArray.length}}\n        <tr>\n            <td>Incident Id</td>\n            <td>Last Resolved Date</td>\n            <td>Summary</th>\n            <td>Existing Categorisation</td>\n            <td >Updated Categorisation</td>\n            <td>Category List</td>\n\n        </tr>\n    {{/categoryArray.length}}\n    {{#categoryArray}}\n        <form class=\"formcl\" action=\"updateData\" method=\"POST\">\n        <tr> \n        <input type=\"hidden\" value=\"{{Priority*}}\" name=\"Priority*\"/>\n        <input type=\"hidden\" value=\"{{Impact*}}\" name=\"Impact*\"/>\n        <input type=\"hidden\" value=\"{{Summary*}}\" name=\"Summary*\"/>\n        <input type=\"hidden\" value=\"{{Incident ID*+}}\" name=\"Incident ID*+\"/>\n        <input type=\"hidden\" value=\"{{Status*}}\" name=\"Status*\"/>\n                <input type=\"hidden\" value=\"{{Status_Reason_Hidden}}\" name=\"Status_Reason_Hidden\"/>\n        <input type=\"hidden\" value=\"{{Vendor Ticket Number}}\" name=\"Vendor Ticket Number\"/>\n        <input type=\"hidden\" value=\"{{Assignee+}}\" name=\"Assignee+\"/>\n                <input type=\"hidden\" value=\"{{Reported Date+}}\" name=\"Reported Date+\"/>\n        <input type=\"hidden\" value=\"{{Responded Date+}}\" name=\"Responded Date+\"/>\n        <input type=\"hidden\" value=\"{{Last Resolved Date}}\" name=\"Last Resolved Date\"/>\n        <input type=\"hidden\" value=\"{{Closed Date}}\" name=\"Closed Date\"/>\n        <input type=\"hidden\" value=\"{{First Name+}}\" name=\"First Name+\"/>\n        <input type=\"hidden\" value=\"{{Last Name+}}\" name=\"Last Name+\"/>\n        <input type=\"hidden\" value=\"{{Resolution Categorization Tier 1}}\" name=\"Resolution Categorization Tier 1\"/>\n\n        \n\n            <td>{{Incident ID*+}}</td>\n            <td>{{Last Resolved Date}}</td>\n            <td>{{Summary*}}</td>\n            <td>{{Resolution Categorization Tier 1}}</td>\n            <td class=\"category2\">{{Resolution Categorization Tier 2}}</td>\n            <td>   \n                <!--<select name=\"cate\" class=\"select-category\" onchange=\"this.form.submit()\">-->\n                <select name=\"cate\" class=\"select-category\" >\n                <option>Site Confidence Issues</option>\n                <option>Application Error</option>\n                <option>Service Request IT</option>\n                <option>Service Request Business</option>\n                <option>Misdirected/ Invalid call</option>\n                <option>Training Issues</option>\n                <option>Duplicate call</option>\n                <option>Security Breach</option>\n                <option>Known Error</option>\n                <option>Connectivity Issue - 3rd Party</option>\n\n                </select>\n\n                </td>\n        </tr>\n        </form>\n\n    {{/categoryArray}}\n</table>\n\n</body>\n</html>",
        "x": 512.9630279541016,
        "y": 428.78692626953125,
        "wires": [
            [
                "399095f0.1de05a"
            ]
        ]
    },
    {
        "id": "399095f0.1de05a",
        "type": "http response",
        "z": "73c2b0f6.41dab",
        "name": "",
        "x": 629.9573211669922,
        "y": 364.1817846298218,
        "wires": []
    },
    {
        "id": "96d04027.de742",
        "type": "function",
        "z": "73c2b0f6.41dab",
        "name": "",
        "func": "//console.log(typeof(msg.payload));\nvar categoryData=JSON.parse(msg.payload);\n\nvar dateArray=[],catArray=[];\nfunction getfulldate(today) { //returns date in mm/dd/yyyy format\n  var currentDate=today.getDate(),\n    currentMonth=today.getMonth()+1;\n  var x=(currentMonth<10)?('0'+currentMonth):currentMonth;\n  var y=(currentDate<10)?('0'+currentDate):currentDate;\n  return (x+'/'+y+'/'+today.getFullYear());\n}\nfunction getLastSunday(d) { //returns last sunday date takes input as mm/dd/yyyy\n    var t = new Date(d);\n    t.setDate(t.getDate() - t.getDay());\n    return t;\n}\nfunction getDateStamp(dateStamp) {\n  var monthName=[\"Jan\", \"Feb\", \"Mar\", \"Apr\", \"May\", \"June\",\"July\", \"Aug\", \"Sept\", \"Oct\", \"Nov\", \"Dec\"];\n  var newDate= new Date(dateStamp);\n  return newDate.getDate()+\"-\"+monthName[newDate.getMonth()]+\"-\"+newDate.getFullYear();\n}\n\nvar lastSundaydate=getLastSunday(getfulldate(new Date()));\nvar lastSunday=getfulldate(lastSundaydate);\n\ndateArray[0]=lastSunday;\nmsg.weekDate=getDateStamp(lastSundaydate);\n\n    var dateTo=dateArray[0];\n    var to=new Date(dateTo);\n    var newto=new Date(dateTo);\n    var dateFrom=new Date(newto.setDate(newto.getDate() - 6));\n    var incidentCount=0;\n    for (var j=0;j<categoryData.length;j++) {\n        var getDate=categoryData[j][\"Reported Date+\"];\n        var daterange=getDate.substring(0, getDate.indexOf(' '));\n        var check=new Date(daterange);\n        if(check >= dateFrom && check <= to ) {\n            catArray.push(categoryData[j]);\n        }\n    }\nmsg.categoryArray=catArray;\nconsole.log(dateArray);\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 362.9545440673828,
        "y": 396.87213134765625,
        "wires": [
            [
                "964ca15d.00a79"
            ]
        ]
    },
    {
        "id": "86c7c3f9.686f",
        "type": "mongodb out",
        "z": "61f45e89.e9959",
        "mongodb": "c60cb185.3a934",
        "name": "",
        "collection": "all-incidentsData",
        "payonly": false,
        "upsert": false,
        "multi": false,
        "operation": "update",
        "x": 492.96022033691406,
        "y": 816.7471923828125,
        "wires": []
    },
    {
        "id": "d6924077.748f9",
        "type": "function",
        "z": "61f45e89.e9959",
        "name": "",
        "func": "msg.query={\"Incident ID*+\":msg.payload[\"Incident ID*+\"]};\n//msg.payload={\"Priority*\":\"xyz\",\"Impact*\":\"1-Extensive/Widespread\",\"Summary*\":\"ZABBIX (loyalty_prod_ip-10-186-8-193[201921]) - Alert that started at 2016.11.02 20:20:36 UTC\",\"Incident ID*+\":\"INC000057571413\",\"Status*\":\"Closed\",\"Status_Reason_Hidden\":\"Automated Resolution Reported\",\"Assignee+\":\"Divyanash Khandelwal\",\"Reported Date+\":\"11/3/2016 1:54:07 AM\",\"Last Resolved Date\":\"11/3/2016 3:24:27 AM\",\"Closed Date\":\"11/10/2016 7:30:11 AM\",\"First Name+\":\"Netcool Generic\",\"Last Name+\":\"User\",\"Resolution Categorization Tier 1\":msg.payload.cate};\nmsg.payload={\"Priority*\":msg.payload[\"Priority*\"],\"Impact*\":msg.payload[\"Impact*\"],\"Summary*\":msg.payload[\"Summary*\"],\"Incident ID*+\":msg.payload[\"Incident ID*+\"],\"Status*\":msg.payload[\"Status*\"],\"Status_Reason_Hidden\":msg.payload[\"Status_Reason_Hidden\"],\"Assignee+\":msg.payload[\"Assignee+\"],\"Reported Date+\":msg.payload[\"Reported Date+\"],\"Last Resolved Date\":msg.payload[\"Last Resolved Date\"],\"Closed Date\":msg.payload[\"Closed Date\"],\"First Name+\":msg.payload[\"First Name+\"],\"Last Name+\":msg.payload[\"Last Name+\"],\"Resolution Categorization Tier 1\":msg.payload[\"Resolution Categorization Tier 1\"],\"Resolution Categorization Tier 2\":msg.payload.cate};\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 319.9516906738281,
        "y": 894.6051025390625,
        "wires": [
            [
                "86c7c3f9.686f",
                "98d7961b.42b3c8"
            ]
        ]
    },
    {
        "id": "4699e519.6787bc",
        "type": "http in",
        "z": "61f45e89.e9959",
        "name": "",
        "url": "/updateData",
        "method": "post",
        "swaggerDoc": "",
        "x": 95,
        "y": 794.3209838867188,
        "wires": [
            [
                "191945cd.9c0a1a"
            ]
        ]
    },
    {
        "id": "191945cd.9c0a1a",
        "type": "function",
        "z": "61f45e89.e9959",
        "name": "",
        "func": "console.log(msg.payload);\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 209.9630584716797,
        "y": 839.0539582307676,
        "wires": [
            [
                "d6924077.748f9"
            ]
        ]
    },
    {
        "id": "98d7961b.42b3c8",
        "type": "http response",
        "z": "61f45e89.e9959",
        "name": "",
        "x": 619.9545135498047,
        "y": 938.9090576171875,
        "wires": []
    },
    {
        "id": "b7fbe2a9.20018",
        "type": "mongodb out",
        "z": "61f45e89.e9959",
        "mongodb": "c60cb185.3a934",
        "name": "",
        "collection": "keyDepend",
        "payonly": false,
        "upsert": true,
        "multi": false,
        "operation": "update",
        "x": 472.96022033691406,
        "y": 983.8181762695312,
        "wires": []
    },
    {
        "id": "1e483059.32914",
        "type": "function",
        "z": "61f45e89.e9959",
        "name": "",
        "func": "msg.query={\"date\":msg.payload[\"date\"],\"name\":msg.payload[\"name\"]};\n//msg.payload={\"Priority*\":\"xyz\",\"Impact*\":\"1-Extensive/Widespread\",\"Summary*\":\"ZABBIX (loyalty_prod_ip-10-186-8-193[201921]) - Alert that started at 2016.11.02 20:20:36 UTC\",\"Incident ID*+\":\"INC000057571413\",\"Status*\":\"Closed\",\"Status_Reason_Hidden\":\"Automated Resolution Reported\",\"Assignee+\":\"Divyanash Khandelwal\",\"Reported Date+\":\"11/3/2016 1:54:07 AM\",\"Last Resolved Date\":\"11/3/2016 3:24:27 AM\",\"Closed Date\":\"11/10/2016 7:30:11 AM\",\"First Name+\":\"Netcool Generic\",\"Last Name+\":\"User\",\"Resolution Categorization Tier 1\":msg.payload.cate};\n//msg.payload={\"Priority*\":msg.payload[\"Priority*\"],\"Impact*\":msg.payload[\"Impact*\"],\"Summary*\":msg.payload[\"Summary*\"],\"Incident ID*+\":msg.payload[\"Incident ID*+\"],\"Status*\":msg.payload[\"Status*\"],\"Status_Reason_Hidden\":msg.payload[\"Status_Reason_Hidden\"],\"Assignee+\":msg.payload[\"Assignee+\"],\"Reported Date+\":msg.payload[\"Reported Date+\"],\"Last Resolved Date\":msg.payload[\"Last Resolved Date\"],\"Closed Date\":msg.payload[\"Closed Date\"],\"First Name+\":msg.payload[\"First Name+\"],\"Last Name+\":msg.payload[\"Last Name+\"],\"Resolution Categorization Tier 1\":msg.payload.cate};\n//msg.payload={\"date\":msg.payload[\"date\"],\"keydependecies\":msg.payload[\"keydepend\"]};\nmsg.payload=msg.payload;\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 319.9516906738281,
        "y": 1061.6760864257812,
        "wires": [
            [
                "b7fbe2a9.20018",
                "2136f39e.6a852c"
            ]
        ]
    },
    {
        "id": "33196960.007c76",
        "type": "http in",
        "z": "61f45e89.e9959",
        "name": "",
        "url": "/writeSummary",
        "method": "post",
        "swaggerDoc": "",
        "x": 105,
        "y": 961.3919677734375,
        "wires": [
            [
                "a20ffcd5.d4175"
            ]
        ]
    },
    {
        "id": "a20ffcd5.d4175",
        "type": "function",
        "z": "61f45e89.e9959",
        "name": "",
        "func": "console.log(\"payload\",msg.payload);\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 209.9630584716797,
        "y": 1006.1249421174864,
        "wires": [
            [
                "1e483059.32914"
            ]
        ]
    },
    {
        "id": "2136f39e.6a852c",
        "type": "http response",
        "z": "61f45e89.e9959",
        "name": "",
        "x": 619.9545135498047,
        "y": 1105.9800415039062,
        "wires": []
    },
    {
        "id": "61cd4373.4f36bc",
        "type": "http in",
        "z": "bc71bbb2.5d89a8",
        "name": "",
        "url": "/wsr1",
        "method": "get",
        "swaggerDoc": "",
        "x": 88.71349334716797,
        "y": 422.98701000213623,
        "wires": [
            [
                "902ae812.a4b1a8",
                "461c612e.1e417",
                "4955313b.e67d4",
                "d7d79b1a.cbdc08"
            ]
        ]
    },
    {
        "id": "fe957f17.e73db",
        "type": "http response",
        "z": "bc71bbb2.5d89a8",
        "name": "",
        "x": 965.7849006652832,
        "y": 381.34412574768066,
        "wires": []
    },
    {
        "id": "902ae812.a4b1a8",
        "type": "http request",
        "z": "bc71bbb2.5d89a8",
        "name": "",
        "method": "GET",
        "ret": "txt",
        "url": "http://127.0.0.1:80/getjson",
        "tls": "",
        "x": 307.9991683959961,
        "y": 360.1298542022705,
        "wires": [
            [
                "2b01decb.45f002"
            ]
        ]
    },
    {
        "id": "2b01decb.45f002",
        "type": "function",
        "z": "bc71bbb2.5d89a8",
        "name": "",
        "func": "msg.identifier = 'all-incidents';\nconsole.log(msg.identifier);\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 455.85633087158203,
        "y": 354.5584487915039,
        "wires": [
            [
                "5b66a3cd.9159fc"
            ]
        ]
    },
    {
        "id": "461c612e.1e417",
        "type": "http request",
        "z": "bc71bbb2.5d89a8",
        "name": "",
        "method": "GET",
        "ret": "txt",
        "url": "http://127.0.0.1:80/getpr",
        "tls": "",
        "x": 306.6063575744629,
        "y": 472.4870185852051,
        "wires": [
            [
                "795a0b33.bec454"
            ]
        ]
    },
    {
        "id": "795a0b33.bec454",
        "type": "function",
        "z": "bc71bbb2.5d89a8",
        "name": "",
        "func": "msg.identifier=\"problem-record\";\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 404.85633087158203,
        "y": 405.5584487915039,
        "wires": [
            [
                "5b66a3cd.9159fc"
            ]
        ]
    },
    {
        "id": "5b66a3cd.9159fc",
        "type": "function",
        "z": "bc71bbb2.5d89a8",
        "name": "",
        "func": "if (!context.data){\n   context.data = {\n       csvdata: {}\n   };\n} \nif(msg.identifier === \"all-incidents\"){\n    context.data.csvdata.allIncident = msg.payload;\n} else if(msg.identifier === \"aecom\") {\n    context.data.csvdata.aecomData = msg.payload;\n} else if (msg.identifier === \"calendar-event\") {\n    context.data.csvdata.calendarEvent=msg.payload;\n}\nelse {\n    context.data.csvdata.probRecords = msg.payload;\n}\nif(context.data.csvdata.allIncident && context.data.csvdata.probRecords && context.data.csvdata.aecomData && context.data.csvdata.calendarEvent){\n     msg.payload = context.data;\n     context.data = null;\n     msg.incidentData=JSON.parse(msg.payload.csvdata.allIncident);\n     msg.probRecords=JSON.parse(msg.payload.csvdata.probRecords);\n    msg.aecomData=JSON.parse(msg.payload.csvdata.aecomData);\n    msg.calendarEvents=msg.payload.csvdata.calendarEvent;\nreturn msg;\n/*if (msg.req.url===\"/wsr1\"){\n    return msg;\n} else {\n    return [null,msg];\n} */\n //   return msg;\n}",
        "outputs": "1",
        "noerr": 0,
        "x": 538.1062698364258,
        "y": 441.5584487915039,
        "wires": [
            [
                "e2737957.7faaf8"
            ]
        ]
    },
    {
        "id": "f069581c.a0f308",
        "type": "function",
        "z": "bc71bbb2.5d89a8",
        "name": "",
        "func": "var tableDatas={};\nvar incidentDataJson=[\n    [\"Weekly Report (MM/DD/YYYY)\"],\n    //[\"Overall\",\"Green\",\"Green\",\"Green\",\"Green\",\"Green\",\"Green\"],\n    [\"Incidents\"],\n    [\"Problem Records\"]\n];\nvar slaViewData= [\n\t[\"Sev1\",\"4hours\",,,0],\n\t[\"Sev2\",\"8hours\",,,0],\n\t[\"Sev3/4\",\"NA\",,\"NA\",\"NA\"]\n];\nvar incidentSummary = {};\n\t\t\n\nfunction getfulldate(today) { //returns date in mm/dd/yyyy format\n\tvar currentDate=today.getDate(),\n\t\tcurrentMonth=today.getMonth()+1;\n\tvar x=(currentMonth<10)?('0'+currentMonth):currentMonth;\n\tvar y=(currentDate<10)?('0'+currentDate):currentDate;\n\treturn (x+'/'+y+'/'+today.getFullYear());\n}\nfunction getLastSunday(d) { //returns last sunday date takes input as mm/dd/yyyy\n  \tvar t = new Date(d);\n  \tt.setDate(t.getDate() - t.getDay());\n  \treturn t;\n}\nfunction getDateStamp(dateStamp) {\n\tvar monthName=[\"Jan\", \"Feb\", \"Mar\", \"Apr\", \"May\", \"June\",\"July\", \"Aug\", \"Sept\", \"Oct\", \"Nov\", \"Dec\"];\n\tvar newDate= new Date(dateStamp);\n\treturn newDate.getDate()+\"-\"+monthName[newDate.getMonth()]+\"-\"+newDate.getFullYear();\n}\n\nvar lastSundaydate=getLastSunday(getfulldate(new Date()));\ntableDatas[\"date\"]=getDateStamp(lastSundaydate);\nvar lastSunday=getfulldate(lastSundaydate);\nvar i=2;\nincidentDataJson[0][i-1]=lastSunday;\ndo{\n\tvar newlastSundaydate=new Date(lastSundaydate.setDate(lastSundaydate.getDate() - 7));\n\tvar newlastSunday=getfulldate(newlastSundaydate);\n\tincidentDataJson[0][i]=newlastSunday;\n\tlastSundaydate=newlastSundaydate;\n\tlastSunday=newlastSunday;\n\ti++;\n} while(i<7);\n\n\n/***incident Count ***/\nvar firstEl=true,criticalCount=0,highCount=0,lowCount=0,totalIncidentCount=0,activeIncident=0;\n\nfor (var i=1;i<incidentDataJson[0].length;i++) {\n\n\tvar dateTo=incidentDataJson[0][i];\n    var to=new Date(dateTo);\n    var newto=new Date(dateTo);\n    var dateFrom=new Date(newto.setDate(newto.getDate() - 6));\n    var incidentCount=0;\n\tfor (var j=0;j<msg.incidentData.length;j++) {\n\t\tvar getDate=msg.incidentData[j][\"Reported Date+\"];\n\t\t//console.log(getDate);\n\t    var daterange=getDate.substring(0, getDate.indexOf(' '));\n\t    var check=new Date(daterange);\n\t    if(firstEl && (msg.incidentData[j][\"Priority*\"]===\"Medium\" || msg.incidentData[j][\"Priority*\"]===\"Critical\" || msg.incidentData[j][\"Priority*\"]===\"High\")) {\n    \t\ttotalIncidentCount++;\n        \tif(msg.incidentData[j][\"Status*\"]===\"Assigned\" || msg.incidentData[j][\"Status*\"]===\"Pending\") {\n\t\t\t\tactiveIncident++;\n\t\t\t}\n\t\t}\n\t\tif(check >= dateFrom && check <= to ) {\n        \tincidentCount++;\n        \tif(msg.incidentData[j][\"Priority*\"]===\"Critical\" && firstEl) {\n        \t\tcriticalCount++;\n        \t}\n        \tif(msg.incidentData[j][\"Priority*\"]===\"High\" && firstEl) {\n        \t\thighCount++;\n        \t}\n        \tif((msg.incidentData[j][\"Priority*\"]===\"Medium\" || msg.incidentData[j][\"Priority*\"]===\"Low\") && firstEl) {\n        \t\tlowCount++;\n        \t}\n\n\n    \t}\n\t}\n\tfirstEl=false;\n\tincidentDataJson[1][i]=incidentCount;\n}\n\n\n/***problem Count ***/\nvar problemArrayDraft=[],problemArrayReview=[];\n\tfor (var i=1;i<incidentDataJson[0].length;i++) {\n\t\tvar dateTo=incidentDataJson[0][i];\n        var to=new Date(dateTo);\n        var newto=new Date(dateTo);\n        var dateFrom=new Date(newto.setDate(newto.getDate() - 6));\n        var problemCount=0;\n\t\tfor (var j=0;j<msg.probRecords.length;j++) {\n\t\t\tvar getDate=msg.probRecords[j][\"Submit Date\"];\n\t\t    var daterange=getDate.substring(0, getDate.indexOf(' '));\n\t\t    var check=new Date(daterange);\n\t\t\tif(check >= dateFrom && check <= to && msg.probRecords[j][\"Status*\"]===\"Draft\" ) {\n            \tproblemCount++;\n        \t}\n        \tif(i===1) {\n        \t   if(check >= dateFrom && check <= to && msg.probRecords[j][\"Status*\"]===\"Draft\" ) {\n        \t       var oneDay = 24*60*60*1000;\n        \t       var dayy1=new Date(new Date().setHours(0,0,0,0));\n        \t       var diffDays = Math.round(Math.abs((dayy1.getTime() - check.getTime())/(oneDay)));\n                    msg.probRecords[j][\"ageings\"]=diffDays;\n            \t    problemArrayDraft.push(msg.probRecords[j]);\n        \t    } \n        \t    if(check >= dateFrom && check <= to && msg.probRecords[j][\"Status*\"]===\"Under Review\" ) {\n            \t    problemArrayReview.push(msg.probRecords[j]);\n        \t    }\n        \t}\n\t\t}\n\t\tincidentDataJson[2][i]=problemCount;\n\t}\n\n\n\t/***total incident count****/\n\t\tfor (var j=0;j<msg.aecomData.length;j++) {\n\t\t\tif(msg.aecomData[j][\"Priority*\"]===\"Low\") {\n\t\t\t\ttotalIncidentCount++;\n\t\t\t\tif(msg.aecomData[j][\"Status*\"]===\"Assigned\" || msg.aecomData[j][\"Status*\"]===\"Pending\") {\n\t\t\t\t\tactiveIncident++;\n\t\t\t\t}\n\t\t\t}\n\n\t\t}\n\n\nslaViewData[0][2]=criticalCount;\nslaViewData[0][3]=criticalCount;\nslaViewData[1][2]=highCount;\nslaViewData[1][3]=highCount;\nslaViewData[2][2]=lowCount;\nincidentSummary[\"Total Incidents\"]=totalIncidentCount;\nincidentSummary[\"Active Incidents\"]=activeIncident;\nincidentSummary[\"Non-Active Incidents\"]=totalIncidentCount-activeIncident;\ntableDatas[\"incidentData\"]=incidentDataJson;\ntableDatas[\"slaView\"]=slaViewData;\ntableDatas[\"incidentSummary\"]=incidentSummary;\n\nmsg.tableDatas= JSON.stringify(tableDatas);\nmsg.tableData=tableDatas;\nvar lastSun=getLastSunday(new Date());\nvar lastSun1=new Date(lastSun);\nvar lastSun2=new Date(lastSun1);\nvar lastSun3=new Date(lastSun1);\nvar nextWeek=new Date(lastSun2.setDate(lastSun2.getDate() + 7));\nvar lastWeek=new Date(lastSun3.setDate(lastSun3.getDate() - 10)); \n  var eventArray=[],lasteventArray=[];\n\nfor (var i=0;i<msg.calendarEvents.length;i++) {\n    //console.log(msg.calendarEvents[i].start.dateTime);\n   var imDate=Date.parse(msg.calendarEvents[i].start.dateTime);\n  var calendarDate=new Date(imDate);\n  if(calendarDate>lastSun1 && calendarDate<=nextWeek ) {\n      //console.log(calendarDate);\n      //console.log(msg.calendarEvents[i].summary)\n      eventArray.push({\"summary\":msg.calendarEvents[i].summary});\n  }\n  if(calendarDate<=lastSun1 && calendarDate>=lastWeek ) {\n          console.log(msg.calendarEvents[i].summary)\n\n     lasteventArray.push({\"summary\":msg.calendarEvents[i].summary});\n\n  }\n  \n \n}\nvar lastSun=getLastSunday(new Date());\nmsg.eventList=eventArray;\nmsg.lastEventList=lasteventArray;\nmsg.problemArrayDraft=problemArrayDraft;\nmsg.problemArrayReview=problemArrayReview;\n\n//var lastSun1=new Date(lastSun).toISOString();\n//var logDate=\n//console.log(new Date(lastSun).toISOString());\n//console.log(getLastSunday(new Date()));\n//console.log(msg.calendarEvents);\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 631.0705871582031,
        "y": 330.55842208862305,
        "wires": [
            [
                "338ce4c1.b923ac"
            ]
        ]
    },
    {
        "id": "338ce4c1.b923ac",
        "type": "template",
        "z": "bc71bbb2.5d89a8",
        "name": "",
        "field": "payload",
        "fieldType": "msg",
        "format": "handlebars",
        "syntax": "mustache",
        "template": "<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n    <meta charset=\"UTF-8\">\n    <title>MNS-Reporting</title>\n    <link rel=\"stylesheet\" type=\"text/css\" href=\"assets/wsr-automation/css/style.css\">\n    <script src=\"https://ajax.googleapis.com/ajax/libs/jquery/1.12.0/jquery.min.js\"></script>\n    <script src=\"http://ajax.googleapis.com/ajax/libs/angularjs/1.4.8/angular.min.js\"></script>\n    <script src=\"assets/wsr-automation/js/app.js\"></script>\n    <script src=\"assets/wsr-automation/js/executiveSummary/newcontroller.js\"></script>\n    <script src=\"assets/wsr-automation/js/common/createTable.directive.js\"></script>\n    <script src='http://js.nicedit.com/nicEdit-latest.js'></script>\n<script type=\"text/javascript\">\nvar tableDatas={{{tableDatas}}};\nvar dateDisplay=tableDatas.date;\n</script>\n</head>\n<body>\n    <main class=\"container\" ng-app=\"weeklyReports\" ng-controller=\"reportsCtrl\">\n        <script type=\"text/ng-template\" id=\"incidentDataTable.html\">\n            <tr ng-repeat=\"data in dataFromTable\">\n                <td ng-repeat=\"values in data track by $index\" ng-class=\"values\" ng-bind=\"values\"></td>\n            </tr>\n        </script>\n        <script type=\"text/ng-template\" id=\"slaViewTable.html\">\n            <tr>\n                <td>Incident</td><td>SLA</td><td>Reported</td><td>Acheived</td><td>Breached</td>\n            </tr>\n            <tr ng-repeat=\"data in dataFromTable\">\n                <td ng-repeat=\"values in data track by $index\" ng-bind=\"values\"></td>\n            </tr>\n        </script>\n        <script type=\"text/ng-template\" id=\"incidentSumTable.html\">\n            <tr>\n                <td ng-repeat=\"(key,value) in dataFromTable\" ng-bind=\"key\"></td>\n            </tr>\n            <tr>\n                <td ng-repeat=\"data in dataFromTable\" ng-bind=\"data\"></td>\n            </tr>\n        </script>\n         \n        <div class=\"clearfix\">\n            <img src=\"assets/wsr-automation/images/mns-logo.jpg\" alt=\"Marks and Spencer logo\" id=\"mnsLogo\">\n            <img src=\"assets/wsr-automation/images/sapient-nitro.png\" alt=\"SapientNitro logo\" id=\"sapientLogo\">\n        </div>\n        <div class=\"clearfix\">\n            <img src=\"assets/wsr-automation/images/print-icon.png\" alt=\"Print Logo\" id=\"printLogo\" ng-click=\"printOption()\">\n        </div>\n\n        <section class=\"clearfix\">\n            <h1>\n                M&S eCom Support Weekly Status Report - Week Ending  {{tableData.date}}\n            </h1>\n            <table id=\"incidents\">\n                <caption>Incidents originating in Week ending {{tableData.date}}</caption>\n                <tbody id=\"incidentDataTable\" table-dir dataparam=tableDatas.incidentData></tbody>\n            </table>\n            <table id=\"slaView\">\n                <caption>SLA View for Week ending {{tableData.date}}</caption>\n                <tbody id=\"slaViewTable\" table-dir dataparam=\"tableDatas.slaView\"></tbody>\n            </table>\n            <table id=\"incidentSummary\" style=\"clear: both;\">\n                <caption>Incident Summary till {{tableData.date}}</caption>\n                <tbody id=\"incidentSumTable\" table-dir dataparam=\"tableDatas.incidentSummary\"></tbody>\n            </table>\n        </section>\n\n        <section>\n            <!--<h1>\n                M&S eCom Support Weekly Status Report - Week Ending  {{tableData.date}}\n            </h1>-->\n            <div id=\"keyUpdates\" class=\"sections\">\n                <div class=\"header-div\">\n                    <span class=\"edit-button\"></span>\n                    <h2 class=\"headlines\">Key updates</h2>\n                </div>\n\n                <div id=\"myArea1\" class=\"edit-div\">\n                    <div>\n                        <h3>Progress Last Week RAYG : GREEN</h3>\n                        <ul>\n                            <li>Total <span>69</span> incidents were raised in last week. Pending triage incidents are currently <span>29</span>.</li>\n                            <li>1 Sev 2's were raised last week.\n                                <ul>\n                                    <li>Sev 2 | INC000021527174 | EMAIL-PROBE (Site Confidence Alert:Script Step[28065111]) - Site Confidence Alert Script Step - Site Confidence Journey was failing</li>\n                                </ul>\n                            </li>\n                        </ul>\n                        <h3>Business Events</h3>\n                        <ul>\n                            <li>NA</li>\n                        </ul>\n                        \n                        <!--<ul>\n                            <li><span>2</span> Open (0 Draft ,2 Pending, 0 Under Review)</li>\n                        </ul>-->\n                        \n                        <!--<ul>\n                            <li>PROD | B&C | THROTTLE | Moving Mobile/App to -6 and Basket change <span>21st Mar</span></li>\n                            <li>PROD | Throttling to 100% New Basket for CS and Stores <span>23rd Mar</span></li>\n                            <li>PROD | CM-182 | SPARKS - FE change for Sparks FAQs link <span>24th Mar</span></li>\n                            <li>PROD | CM-183 | Whitelisting Omniture rest API Url for Prod Servers <span>24th Mar</span></li>\n                            <li>PROD | Timezone change to BST <span>27th Mar</span></li>\n                            <li>SIT3 | R26 Deployment <span>21st Mar</span></li>\n                            <li>SIT3/B | Apply RHEL Patch <span>23rd Mar</span></li>\n                        </ul>-->\n                    </div>\n                </div>\n                <div class=\"noneditable-container\" style=\"border-top:solid 1px black;padding-left:4px;\">\n\n                        <h3>Problem Record</h3>\n                        <table>\n\n                            {{#problemArrayDraft.length}}\n\n                                        <tr>\n                                            <td>Problem ID</td>\n                                            <td>Summary</th>\n                                            <td>Assignee</td>\n                                            <td>Status</td>\n                                            <td>Ageing</td>\n                                            <td>Open Date</td>\n\n                                        </tr>\n                            {{/problemArrayDraft.length}}\n                            {{#problemArrayDraft}}\n                                <tr> \n                                    <td>{{Problem ID*+}}</td>\n                                    <td>{{Summary*}}</td>\n                                    <td>{{Assignee+}}</td>\n                                    <td>{{Status*}}</td>\n                                    <td>{{ageings}}</td>\n                                    <td>{{Submit Date}}</td>\n\n                                </tr>\n                            {{/problemArrayDraft}}\n                        </table>\n\n                        \n                        <h3>Environments</h3>\n                        <ul>\n                            {{#lastEventList}}\n                            <li>\n                                {{summary}}\n                            </li>\n                            {{/lastEventList}}\n                        </ul>\n                </div>\n            </div>\n            <div id=\"nextWeekPlan\" class=\"sections\" >\n                <div class=\"header-div\">\n                    <span class=\"edit-button\"></span>\n                    <h2 class=\"headlines\"> Plan for next week</h2>\n                </div>\n\n                <div id=\"nextWeek\" class=\"edit-div\" >\n                    <h3>Business Events</h3>\n                    <ul>\n                        <li>NA</li>\n                    </ul>\n                        \n                    <!--<ul>\n                        <li>PROD | RHEL Patching DR <span>28th Mar</span></li>\n                        <li>PROD | Bing SIte Authorisation Update in AKAMAI <span>29th Mar</span></li>\n                        <li>PROD | RHEL Patching BURST <span>29th Mar</span></li>\n                        <li>PROD | R26 Deployment <span>30th Mar</span></li>\n                        <li>DR | QA3 | R26 Deployment <span>31st Mar</span></li>\n                    </ul>-->\n                </div>\n                <div class=\"noneditable-container\" style=\"border-top:solid 1px black;padding-left:4px;\">\n                    <h3>Environments</h3>\n                        <ul>\n                            {{#eventList}}\n                            <li>\n                                {{summary}}\n                            </li>\n                            {{/eventList}}\n                        </ul>\n                </div>\n            </div>\n            <div id=\"risksIssues\" class=\"sections\">\n                <div class=\"header-div\">\n                    <span class=\"edit-button\"></span>\n                    <h2 class=\"headlines\">Key risks/issues</h2>\n                </div>\n\n                <div id=\"risk\" class=\"edit-div\">\n                    <ul>\n                        <!--<li>Single Prod/ non-Prod account for Bing request. There is threshhold of 50 requested in 24 hrs</li>\n                        <li>Stageprop session killed twice</li>-->\n                        <li>NA</li>\n                    </ul>\n                </div>\n            </div>\n            <div id=\"accomplishments\" class=\"sections\">\n                <div class=\"header-div\">\n                    <span class=\"edit-button\"></span>\n                    <h2 class=\"headlines\">Accomplishments</h2>\n                </div>\n\n                <div id=\"accomp\" class=\"edit-div\">\n                    <ul>\n                        <!--<li>Timezone changed from GMT to BST has been successfully completed on 27th March.</li>-->\n                                                <li>NA</li>\n\n                    </ul>\n                </div>\n            </div>\n            <div id=\"keyDependencies\" class=\"sections\">\n                <div class=\"header-div\">\n                    <span class=\"edit-button\"></span>\n                    <h2 class=\"headlines\">Key dependencies</h2>\n                </div>\n                <div id=\"keyDepend\" class=\"edit-div\">\n                    <ul>\n                                            <li>NA</li>\n\n                    </ul>\n                </div>\n            </div>\n        </section>\n    </main>\n</body>\n</html>\n\n\n\n",
        "x": 747.8206462860107,
        "y": 299.844181060791,
        "wires": [
            [
                "ffcfb067.680ce"
            ]
        ]
    },
    {
        "id": "af5d8206.1b371",
        "type": "template",
        "z": "bc71bbb2.5d89a8",
        "name": "",
        "field": "payload1",
        "fieldType": "msg",
        "format": "handlebars",
        "syntax": "mustache",
        "template": "<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n    <meta charset=\"UTF-8\">\n    <title>MNS-Reporting</title>\n    <link rel=\"stylesheet\" type=\"text/css\" href=\"assets/wsr-automation/css/style.css\">\n    <script src=\"https://ajax.googleapis.com/ajax/libs/jquery/1.12.0/jquery.min.js\"></script>\n    <script src=\"http://ajax.googleapis.com/ajax/libs/angularjs/1.4.8/angular.min.js\"></script>\n    <script src=\"assets/wsr-automation/js/app.js\"></script>\n    <script src=\"assets/wsr-automation/js/ng-google-chart.min.js\"></script>\n    <script src=\"assets/wsr-automation/js/trends/newtrendscontroller.js\"></script>\n    <script src=\"assets/wsr-automation/js/common/createTable.directive.js\"></script>\n        <script src='http://js.nicedit.com/nicEdit-latest.js'></script>\n\n<script type=\"text/javascript\">\nvar chartObject={{{chartObject}}};\nvar chartObject1={{{chartObject1}}};\nvar chartObject2={{{chartObject2}}};\nvar chartObject3={{{chartObject3}}};\nvar chartObject4={{{chartObject4}}}\nvar chartObject5={{{chartObject5}}};\n\nvar tableDatas={{{tableDatas}}};\nvar dateDisplay=tableDatas.date;\n//console.log(dateDisplay);\n  \n</script>\n</head>\n<body>\n    <main class=\"container\" ng-app=\"trendsReport\" ng-controller=\"trendsCtrl\">\n        <script type=\"text/ng-template\" id=\"incidentBurnTable.html\">\n            <tr ng-repeat=\"data in dataFromTable\">\n                <td ng-repeat=\"values in data track by $index\" ng-class=\"values\" ng-bind=\"values\"></td>\n            </tr>\n        </script>\n        <script type=\"text/ng-template\" id=\"incidentAgeTable.html\">\n            <tr>\n                <td>Ageing</td><td>0-7 Days</td><td>8-14 Days</td><td>15-30 Days</td><td>30+ Days</td>\n            </tr>\n            <tr ng-repeat=\"data in dataFromTable\">\n                <td ng-repeat=\"values in data track by $index\" ng-bind=\"values\"></td>\n            </tr>\n        </script>\n        <script type=\"text/ng-template\" id=\"incidentSumTable.html\">\n            <tr>\n                <td ng-repeat=\"(key,value) in dataFromTable\" ng-bind=\"key\"></td>\n            </tr>\n            <tr>\n                <td ng-repeat=\"data in dataFromTable\" ng-bind=\"data\"></td>\n            </tr>\n        </script>\n        <script type=\"text/ng-template\" id=\"categorizationTable.html\">\n            <!--<tr>\n                <td>Categorization</td><td>Current Week</td><td>Week ending 20th Mar</td><td>Week ending 6th Mar</td><td>Week ending 28th Feb</td>\n            </tr>-->\n            <tr ng-repeat=\"data in dataFromTable\">\n                <td ng-repeat=\"values in data track by $index\" ng-class=\"values\" ng-bind=\"values\"></td>\n            </tr>\n        </script>\n        <script type=\"text/ng-template\" id=\"weeklyAgeingTable.html\">\n            <tr>\n                <td>Ageing</td><td>0-7 Days</td><td>8-14 Days</td><td>15-30 Days</td><td>30+ Days</td>\n            </tr>\n            <tr ng-repeat=\"data in dataFromTable\">\n                <td ng-repeat=\"values in data track by $index\" ng-class=\"values\" ng-bind=\"values\"></td>\n            </tr>\n        </script>\n        <script type=\"text/ng-template\" id=\"releaseAlignmentTable.html\">\n            <tr>\n                <td>Row Labels</td><td>Not Aligned</td><td>Release 26</td><td>Grand Total</td>\n            </tr>\n            <tr ng-repeat=\"data in dataFromTable\">\n                <td ng-repeat=\"values in data track by $index\" ng-class=\"values\" ng-bind=\"values\"></td>\n            </tr>\n        </script>\n        <div class=\"clearfix\">\n            <img src=\"assets/wsr-automation/images/mns-logo.jpg\" alt=\"Marks and Spencer logo\" id=\"mnsLogo\">\n            <img src=\"assets/wsr-automation/images/sapient-nitro.png\" alt=\"SapientNitro logo\" id=\"sapientLogo\">\n        </div>\n        <div class=\"clearfix\">\n            <img src=\"assets/wsr-automation/images/print-icon.png\" alt=\"Print Logo\" id=\"printLogo\" ng-click=\"printOption()\">\n        </div>\n\n        <section class=\"clearfix\">\n            <table id=\"incidentBurnRate\">\n                <caption>Overall Incident Burn Rate - Weekly View  (Sev3&4)  </caption>\n                <tbody id=\"incidentBurnTable\" table-dir dataparam=\"tableDatas.incidentBurn\"></tbody>\n                <tfoot>\n                    <tr>\n                      <td>Total Open</td>\n                      <td>{{totalOpen}}</td>\n                    </tr>\n                 </tfoot>\n            </table>\n            <table id=\"incidentAgeing\">\n                <caption>Overall Incident Ageing for Sev3 & 4</caption>\n                <tbody id=\"incidentAgeTable\" table-dir dataparam=\"tableDatas.incidentAgeing\"></tbody>\n            </table>\n        </section>\n        <section class=\"clearfix\">\n            <div class=\"panel-message left-panel\" style=\"width: 52%;\">\n                {{#summaryInfo}}\n                    <p>{{oneWeekCritical}} Sev 1 was raised last week</p>\n                    <p>{{oneWeekHigh}} Sev 2 was raised last week</p>\n                    {{#criticalIncident}}\n                    <p>-{{Priority}} | {{incidentId}} | {{summary}}</p>\n                    {{/criticalIncident}}\n                    {{#highIncident}}\n                    <p>-{{Priority}} | {{incidentId}} | {{summary}}</p>\n                    {{/highIncident}}\n                {{/summaryInfo}}\n            </div>\n            <div class=\"panel-message right-panel \">\n            <div class=\"header-div\">\n                    <span class=\"edit-button\"></span>\n                    <h2 class=\"headlines\">Summary</h2>\n            </div>\n            <div id=\"editPanel1\" class=\"edit-div\">\n               <!-- <p>- Incident ageing  has been  under control</p>\n                <p>- Incident older than 15 days</p>\n                <p>- INC000019293754 -There is a spike in the 500 error for the command /ordercalculate. There are about 68 customer sessions until now out of which 66 customers have abandoned their basket</p>\n                <p>- INC000018829506 | Sev3 | Increase in count of 404  after R24</p>-->\n            </div>\n            </div>\n        </section>\n        <section class=\"left-chart\">\n            \n            <div id=\"chartDiv\" class=\"chart-width\" google-chart chart=\"chartObject\" style=\"{{chart.cssStyle}}\"/>\n        </section>\n        <section class=\"right-chart\">\n            <div id=\"IncidentAgeChart\" class=\"chart-width\" google-chart chart=\"chartObject1\" style=\"{{chart.cssStyle}}\"/>\n\n        </section>\n        <section class=\"clearfix\">\n            <table id=\"categorization\">\n                <caption>Categorization of Incidents - Weekly View  </caption>\n                <tbody id=\"categorizationTable\" table-dir dataparam=\"tableDatas.categorisation\"></tbody>\n            </table>\n            <section class=\"right-chart\"> \n                <div id=\"CategorizationChart\" class=\"chart-width\" google-chart chart=\"chartObject2\" style=\"{{chart.cssStyle}}\"/>\n            </section>\n        </section>\n        <!--<section class=\"clearfix\">\n            <div class=\"panel-message left-panel\">\n                <p>71  Incidents closeds</p>\n                <p>- 12 Connectivity Issue 3rd Party - Site Confidence</p>\n                <p>- 12 Misdirected/ Invalid call</p>\n                <p>- 12 Known Error</p>\n                <p>- 11 Duplicate calls</p>\n            </div>\n        </section>-->\n        <section class=\"clearfix\" style=\"width:52%;float:left;\">\n            <table id=\"weeklyAge\">\n                <caption>Overall Problem Record Ageing - Weekly View  </caption>\n                <tbody id=\"weeklyAgeingTable\" table-dir dataparam=\"tableDatas.probrecordAgeing\"></tbody>\n            </table>\n            <!--<table id=\"releaseAlignment\">\n                <caption>Incidents - Release Alignment : as per JIRA  </caption>\n                <tbody id=\"releaseAlignmentTable\" table-dir dataparam=\"\"></tbody>\n            </table>-->\n        </section>\n         <section class=\"left-chart\" style=\"width:100%\">\n            <div id=\"weeklyAgeingChart\" class=\"chart-width\" google-chart chart=\"chartObject3\" style=\"{{chart.cssStyle}}\"/>\n        </section>\n        <section class=\"right-chart\">\n            <div id=\"releaseAlignChart\" class=\"chart-width\" google-chart chart=\"chartObject4\" style=\"{{chart.cssStyle}}\"/>\n        </section>\n        <section class=\"left-chart\" style=\"width:50%\">\n            <div id=\"weeklyAgeingChart1\" class=\"chart-width\" google-chart chart=\"chartObject5\" style=\"{{chart.cssStyle}}\"/>\n        </section>\n        <!--<section class=\"right-chart\">\n            <div id=\"releaseAlignChart2\" class=\"chart-width\" google-chart chart=\"chartObject6\" style=\"{{chart.cssStyle}}\"/>\n        </section>-->\n        <section class=\"clearfix\">\n            <div class=\"panel-message left-panel \">\n                <div class=\"header-div\">\n                        <span class=\"edit-button\"></span>\n                        <h2 class=\"headlines\">Summary</h2>\n                </div>\n            <div id=\"editPanel2\" class=\"edit-div\">\n               <!-- <p>- 0  Under Review for Closure</p>\n                <p>- 0 Draft</p>\n                <p>- 0 Under Investigation</p>\n                <p>- 2 Pending with 3rd parties</p>\n                <p>- 0 Assigned</p>-->\n            </div>\n            </div>\n            <!--<div class=\"panel-message right-panel\">\n               <p>- 65 incidents are not aligned to any Release</p>\n                <p>- 0 Pending - Client Action</p>\n                <p>- 1 Pending 3rd Party</p>\n                <p>- 0 Future Enhancement</p>\n                <p>- 0 Client Hold</p>\n                <p>- 0 Under Monitoring</p>\n                <p>- 0 In progress</p>\n            </div>-->\n        </section>\n    </main>\n</body>\n</html>\n",
        "x": 771.4992065429688,
        "y": 533.9513549804688,
        "wires": [
            []
        ]
    },
    {
        "id": "942c03a1.297d6",
        "type": "function",
        "z": "bc71bbb2.5d89a8",
        "name": "",
        "func": "var tableDatas={};\nvar incidentBurn=[\n    [\"Weekly Report (MM/DD/YYYY)\"],\n    [\"New\"],\n    [\"Resolved\"]/*,\n    [\"Open\"],\n    [\"Total Open\"]*/\n];\nvar incidentAgeing= [\n\t[\"Incident Count\"]\n];\nvar probrecordAgeing= [\n\t[\"Problem Records\"]\n];\nvar categorisation =[\n\t[\"Categorization\"],\n\t[\"Site Confidence Issues\"],\n    [\"Application Error\"],\n    [\"Service Request IT\"],\n    [\"Service Request Business\"],\n    [\"Misdirected/ Invalid call\"],\n    [\"Training Issues\"],\n    [\"Duplicate call\"],\n    [\"Security Breach\"],\n    [\"Known Error\"],\n    [\"Connectivity Issue - 3rd Party\"]\n];\nvar dailyIncidents=[\n[\"Days\"],\n[\"Incident Count\"]\n];\n\n\n\n\tfunction nextChar(c) {\n    \treturn String.fromCharCode(c.charCodeAt(0) + 1);\n\t}\n\n\tvar chartObject ={\n\t\"type\": \"LineChart\",\n    \"displayed\": false,\n    \"data\": {\n    \t\"cols\": [{\n          \"id\": \"A\",\n          \"label\": \"NEW A\",\n          \"type\": \"string\"\n        }\n\t],\n    \t\"rows\":[]\n    },\n    \"options\": {\n      \"title\": \"Overall Incident Burn Rate\",\n      \"isStacked\": \"true\",\n      \"fill\": 20,\n      \"legend\": {\n        \"position\": \"bottom\"\n      },\n      \"colors\": [\n        \"#4A7EBB\",\n        \"#ff0000\",\n        \"#98B954\",\n        \"#7D60A0\"\n      ],\n      \"displayExactValues\": true,\n      \"vAxis\": {\n        \"title\": \"\",\n        \"gridlines\": {\n          \"count\": 10\n        }\n      },\n      \"hAxis\": {\n        \"title\": \"\"\n      }\n    },\n    \"formatters\": {}\n\t};\n\tvar chartObject1= {\n    \"type\": \"BarChart\",\n    \"displayed\": false,\n    \"data\": {\n      \"cols\": [\n        {\n          \"id\": \"A\",\n          \"label\": \"NEW A\",\n          \"type\": \"string\"\n        }/*,\n        {\n          \"id\": \"B\",\n          \"label\": \"Incident Count\",\n          \"type\": \"number\"\n        }*/\n      ],\n      \"rows\": []\n    },\n    \"options\": {\n      \"title\": \"Overall Incident Ageing \",\n      \"isStacked\": \"false\",\n      \"fill\": 20,\n      \"displayExactValues\": true,\n      \"colors\": [\n        \"#92D050\"\n      ],\n      \"vAxis\": {\n        \"title\": \"\",\n        \"gridlines\": {\n          \"count\": 10\n        }\n      },\n      \"orientation\": \"horizontal\",\n      \"hAxis\": {\n        \"title\": \"\"\n      }\n    },\n    \"formatters\": {}\n  }\n\n  var chartObject3 = {\n    \"type\": \"BarChart\",\n    \"displayed\": false,\n    \"data\": {\n      \"cols\": [\n        {\n          \"id\": \"A\",\n          \"label\": \"weeklyAgeing\",\n          \"type\": \"string\"\n        },\n        {\n          \"id\": \"B\",\n          \"label\": \"Problem Records\",\n          \"type\": \"number\"\n        }\n      ],\n      \"rows\": []\n    },\n    \"options\": {\n      \"title\": \"Problem Record Ageing\",\n      \"isStacked\": \"false\",\n      \"fill\": 20,\n      \"displayExactValues\": true,\n      \"width\": 600,\n      \"colors\": [\n        \"#92D050\"\n      ],\n      \"vAxis\": {\n        \"title\": \"\",\n        \"gridlines\": {\n          \"count\": 4\n        }\n      },\n      \"orientation\": \"horizontal\",\n      \"hAxis\": {\n        \"title\": \"\"\n      }\n    },\n    \"formatters\": {}\n  }\n\n  var chartObject4 = {\n    \"type\": \"BarChart\",\n    \"displayed\": false,\n    \"data\": {\n      \"cols\": [\n        {\n          \"id\": \"A\",\n          \"label\": \"Daily Incidents\",\n          \"type\": \"string\"\n        },\n        {\n          \"id\": \"B\",\n          \"label\": \"Daily Incidents Count\",\n          \"type\": \"number\"\n        }\n      ],\n      \"rows\": []\n    },\n    \"options\": {\n      \"title\": \"Daily Incidents Count\",\n      \"isStacked\": \"false\",\n      \"fill\": 20,\n      \"displayExactValues\": true,\n      \"width\": 600,\n      \"colors\": [\n        \"#92D050\"\n      ],\n      \"vAxis\": {\n        \"title\": \"\",\n        \"gridlines\": {\n          \"count\": 4\n        }\n      },\n      \"orientation\": \"horizontal\",\n      \"hAxis\": {\n        \"title\": \"\"\n      }\n    },\n    \"formatters\": {}\n  }\n\n  var chartObject2= {\n    \"type\": \"ComboChart\",\n    \"displayed\": false,\n    \"data\": {\n      \"cols\": [\n        {\n          \"id\": \"A\",\n          \"label\": \"NEW A\",\n          \"type\": \"string\"\n        },\n        {\n          \"id\": \"B\",\n          \"label\": \"Current Week\",\n          \"type\": \"number\"\n        },\n        {\n          \"id\": \"B\",\n          \"label\": \"\",\n          \"type\": \"number\"\n        }\n      ],\n      \"rows\": []\n    },\n    \"options\": {\n      \"title\": \"\",\n      \"isStacked\": \"false\",\n      \"fill\": 20,\n      \"displayExactValues\": true,\n      \"seriesType\": \"bars\",\n      \"width\": 600,\n      \"series\": {\n        \"1\": {\n          \"type\": \"line\"\n        }\n      },\n      \"colors\": [\n        \"#92D050\",\n        \"#D17E7C\"\n      ],\n      \"vAxis\": {\n        \"title\": \"\",\n        \"gridlines\": {\n          \"count\": 10\n        }\n      },\n      \"orientation\": \"horizontal\",\n      \"hAxis\": {\n        \"title\": \"\"\n      }\n    },\n    \"formatters\": {}\n  }\n\n\nfunction getfulldate(today) { //returns date in mm/dd/yyyy format\n\tvar currentDate=today.getDate(),\n\t\tcurrentMonth=today.getMonth()+1;\n\tvar x=(currentMonth<10)?('0'+currentMonth):currentMonth;\n\tvar y=(currentDate<10)?('0'+currentDate):currentDate;\n\treturn (x+'/'+y+'/'+today.getFullYear());\n}\nfunction getLastSunday(d) { //returns last sunday date takes input as mm/dd/yyyy\n  \tvar t = new Date(d);\n  \tt.setDate(t.getDate() - t.getDay());\n  \treturn t;\n}\nfunction getDateStamp(dateStamp) {\n\tvar monthName=[\"Jan\", \"Feb\", \"Mar\", \"Apr\", \"May\", \"June\",\"July\", \"Aug\", \"Sept\", \"Oct\", \"Nov\", \"Dec\"];\n\tvar newDate= new Date(dateStamp);\n\treturn newDate.getDate()+\"-\"+monthName[newDate.getMonth()]+\"-\"+newDate.getFullYear();\n}\n\nvar lastSundaydate=getLastSunday(getfulldate(new Date()));\ntableDatas[\"date\"]=getDateStamp(lastSundaydate);\nvar lastSunday=getfulldate(lastSundaydate);\nvar i=2;\nincidentBurn[0][i-1]=lastSunday;\ncategorisation[0][i-1]=lastSunday;\nvar lastSunday1=new Date(lastSunday);\ndailyIncidents[0][1]=getfulldate(lastSunday1);\n//console.log(new Date(lastSunday));\n//for (var i=1;i<7;i++) {\ndailyIncidents[0][2]=getfulldate(new Date(lastSunday1.getTime() - (24*60*60*1000*1)));\ndailyIncidents[0][3]=getfulldate(new Date(lastSunday1.getTime() - (24*60*60*1000*2)));\ndailyIncidents[0][4]=getfulldate(new Date(lastSunday1.getTime() - (24*60*60*1000*3)));\ndailyIncidents[0][5]=getfulldate(new Date(lastSunday1.getTime() - (24*60*60*1000*4)));\ndailyIncidents[0][6]=getfulldate(new Date(lastSunday1.getTime() - (24*60*60*1000*5)));\ndailyIncidents[0][7]=getfulldate(new Date(lastSunday1.getTime() - (24*60*60*1000*6)));\n\nfor (var z=1;z<dailyIncidents[0].length;z++) {\nvar dateDaily=new Date(dailyIncidents[0][z]);\nvar sev1sev2=0,sev3sev4=0;\n\tfor (var je=0;je<msg.incidentData.length;je++) {\n\t\tvar getDate1=msg.incidentData[je][\"Reported Date+\"];\n\t    var daterange1=getDate1.substring(0, getDate1.indexOf(' '));\n\t    var check1=new Date(daterange1);\n\t    //console.log(check1)\n\t    if(check1.getTime()==dateDaily.getTime() && (msg.incidentData[je][\"Priority*\"]===\"Critical\" || msg.incidentData[je][\"Priority*\"]===\"High\")) {\n\t    \tsev1sev2++;\n\t     }\n\t}\n\tfor (var je=0;je<msg.aecomData.length;je++) {\n\t\tvar getDate2=msg.aecomData[je][\"Reported Date+\"];\n\t    var daterange2=getDate2.substring(0, getDate2.indexOf(' '));\n\t    var check2=new Date(daterange2);\n\t    //console.log(check1)\n\t    if(check2.getTime()==dateDaily.getTime() && (msg.aecomData[je][\"Priority*\"]===\"Medium\" || msg.aecomData[je][\"Priority*\"]===\"Low\")) {\n\t    \tsev3sev4++;\n\t     }\n\t}\n\tdailyIncidents[1][z]=sev1sev2+sev3sev4;\n\t\t//dailyIncidents[1][z+1]=sev3sev4;\n}\nvar sev1Count=0,sev2Count=0,sev3Count=0,sev4Count=0;\n\n/*var mySunday=getLastSunday(getfulldate(new Date()));\nvar mySundaydate=getfulldate(mySunday);\ndailyIncidents[0][1]=mySundaydate;\nconsole.log(dailyIncidents);\nfor (var i=1;i<=6;i++) {\n\t//console.log(new Date(getfulldate(getfulldate(new Date()).getDate();\n\t//var ndate=new Date(new Date(mySundaydate).setDate(new Date(mySundaydate).getDate() - i)).setHours(0,0,0,0);\n\t//console.log(ndate);\n\t//console.log(new Date(new Date(new Date(getfulldate(getLastSunday(getfulldate(new Date())))).setDate(new Date(getfulldate(getLastSunday(getfulldate(new Date())))).getDate() - i)).setHours(0,0,0,0)));\n\n}*/\n/***daily data**/\n/*var dailyIncidents=[\n[\"Days\"],\n[\"Incident Count\"]\n];\nvar mySunday=getLastSunday(getfulldate(new Date()));\nvar mySundaydate=getfulldate(mySunday);\ndailyIncidents[0][1]=mySundaydate;\nfor (var i=1;i<=6;i++) {\n\tconsole.log(new Date(new Date(new Date(mySundaydate).setDate(new Date(mySundaydate).getDate() - i)).setHours(0,0,0,0)));\n\n}*/\n\n/****/\ndo{\n\tvar newlastSundaydate=new Date(lastSundaydate.setDate(lastSundaydate.getDate() - 7));\n\tvar newlastSunday=getfulldate(newlastSundaydate);\n\tincidentBurn[0][i]=newlastSunday;\n\tcategorisation[0][i]=newlastSunday;\n\tlastSundaydate=newlastSundaydate;\n\tlastSunday=newlastSunday;\n\ti++;\n} while(i<7);\n\n\nvar criticalCount=0,highCount=0,lowCount=0,incidentAgePopulate=true,checkforFirstItr=true,incidentAge1=0,incidentAge2=0,incidentAge3=0,incidentAge4=0,ProbRecordAge1=0,ProbRecordAge2=0,ProbRecordAge3=0,ProbRecordAge4=0,oneWeekCritical=0,oneWeekHigh=0,criticalIncidentObj=[],highIncidentObj=[];\n/***Find date range***/\nvar todayDate=new Date();\ntodayDate.setHours(0,0,0);\nvar day1=new Date(todayDate.setDate(todayDate.getDate() - 1)).setHours(0,0,0,0);\nvar day7=new Date(todayDate.setDate(todayDate.getDate() - 7)).setHours(0,0,0,0);\nvar day8=new Date(todayDate.setDate(todayDate.getDate() - 1)).setHours(0,0,0,0);\nvar day14=new Date(todayDate.setDate(todayDate.getDate() - 6)).setHours(0,0,0,0);\nvar day15=new Date(todayDate.setDate(todayDate.getDate() - 1)).setHours(0,0,0,0);\nvar day30=new Date(todayDate.setDate(todayDate.getDate() - 6)).setHours(0,0,0,0);\nvar today=new Date();\nvar day6=new Date(new Date().setDate(new Date().getDate()-25));\nfor (var i=1;i<incidentBurn[0].length;i++) {\n\tvar dateTo=incidentBurn[0][i];\n    var to=new Date(dateTo);\n    var newto=new Date(dateTo);\n    var dateFrom=new Date(newto.setDate(newto.getDate() - 6));\n    var category=[0,0,0,0,0,0,0,0,0,0];\n\n    var incidentCount=0,d13=0,e13=0,b13=0,c13=0,d14=0,e14=0,f3a=0,f3b=0,f4a=0,f4b=0,f5a=0,f5b=0;\n\tfor (var j=0;j<msg.incidentData.length;j++) {\n\t\tvar getDate=msg.incidentData[j][\"Reported Date+\"];\n\t    var daterange=getDate.substring(0, getDate.indexOf(' '));\n\t    var check=new Date(daterange);\n\t    var getClosedDate=msg.incidentData[j][\"Closed Date\"];\n\n\n\t    /****incident ageing****/\n\t    if (incidentAgePopulate && (msg.incidentData[j][\"Status*\"]===\"Assigned\" || msg.incidentData[j][\"Status*\"]===\"Pending\")) {\n\t\t\t\n\t\t\tif(check<=day1 && check>=day7) {\n\t\t\t\tincidentAge1++;\n\t\t\t} else if (check<=day8 && check>=day14) {\n\t\t\t\tincidentAge2++;\n\t\t\t} else if (check<=day15 && check>=day30) {\n\t\t\t\tincidentAge3++\n\t\t\t} else incidentAge4++;\n\t\t} else if (incidentAgePopulate) {\n\n\t\t\tif(check<=today && check>=day6) {\n\n\t\t\t\tif(msg.incidentData[j][\"Priority*\"]===\"Critical\") {\n\t\t\t\t\toneWeekCritical++;\n\t\t\t\t\tcriticalIncidentObj.push({\"Priority\":\"Sev1\",\"incidentId\":msg.incidentData[j][\"Incident ID*+\"],\"summary\":msg.incidentData[j][\"Summary*\"]});\n\n\t\t\t\t}\n\t\t\t\telse if (msg.incidentData[j][\"Priority*\"]===\"High\"){\n\t\t\t\t\toneWeekHigh++;\n\t\t\t\t\thighIncidentObj.push({\"Priority\":\"Sev2\",\"incidentId\":msg.incidentData[j][\"Incident ID*+\"],\"summary\":msg.incidentData[j][\"Summary*\"]});\n\t\t\t\t}\n\n\t\t\t} \n\n\t\t\tif(check >= dateFrom && check <= to ) {\n\t\t\t\tif(msg.incidentData[j][\"Priority*\"]===\"Critical\")\n\t\t\t\t{\n\t\t\t\t\tsev1Count++;\n\t\t\t\t} else if (msg.incidentData[j][\"Priority*\"]===\"High\") {\n\t\t\t\t\tsev2Count++;\n\t\t\t\t}\n\t      \t\n\t    \t}\n\n\n\t\t}\n\t\t/**/\n\n\t    if(msg.incidentData[j][\"Status*\"]===\"Assigned\" && (msg.incidentData[j][\"Priority*\"]===\"Medium\" || msg.incidentData[j][\"Priority*\"]===\"Critical\" || msg.incidentData[j][\"Priority*\"]===\"High\"))\n\t\t{\n\t\t\tf3a++;\n\t\t}\n\t\telse if(msg.incidentData[j][\"Status*\"]===\"In Progress\" && (msg.incidentData[j][\"Priority*\"]===\"Medium\" || msg.incidentData[j][\"Priority*\"]===\"Critical\" || msg.incidentData[j][\"Priority*\"]===\"High\"))\n\t\t{\n\t\t\tf4a++;\n\t\t} \n\t\telse if (msg.incidentData[j][\"Status*\"]===\"Pending\" && (msg.incidentData[j][\"Priority*\"]===\"Medium\" || msg.incidentData[j][\"Priority*\"]===\"Critical\" || msg.incidentData[j][\"Priority*\"]===\"High\"))\n\t\t{\n\t\t\tf5a++;\n\t\t} \n\n\t    if(getClosedDate!==undefined) {\n\t    \tvar ClosedDaterange=new Date(getClosedDate.substring(0, getClosedDate.indexOf(' ')));\n\t    \tif(ClosedDaterange >= dateFrom && ClosedDaterange <= to) {\n\t    \t\tif(msg.incidentData[j][\"Priority*\"]===\"Medium\")\n\t\t\t\t{\n\t\t\t\t\td14++;\n\t\t\t\t}\n    \t\t}\n\n\t    }\n\t\tif(check >= dateFrom && check <= to ) {\n\t\t\tif(msg.incidentData[j][\"Priority*\"]===\"Medium\")\n\t\t\t{\n\t\t\t\td13++;\n\t\t\t}\n\t\t\tif(msg.incidentData[j][\"Priority*\"]===\"Low\")\n\t\t\t{\n\t\t\t\te13++;\n\t\t\t}\n\t\t\tif(msg.incidentData[j][\"Priority*\"]===\"Critical\")\n\t\t\t{\n\t\t\t\tb13++;\n\t\t\t}\n\t\t\tif(msg.incidentData[j][\"Priority*\"]===\"High\")\n\t\t\t{\n\t\t\t\tc13++;\n\t\t\t}\n\n\t\t\tif(msg.incidentData[j][\"Resolution Categorization Tier 1\"]===\"Site Confidence Issues\") {\n\t\t\t\tcategory[0]++;\n\t\t\t} else if (msg.incidentData[j][\"Resolution Categorization Tier 1\"]===\"Application Error\") {\n\t\t\t\tcategory[1]++;\n\t\t\t} else if(msg.incidentData[j][\"Resolution Categorization Tier 1\"]===\"Service Request IT\") {\n\t\t\t\tcategory[2]++;\n\t\t\t} else if(msg.incidentData[j][\"Resolution Categorization Tier 1\"]===\"Service Request Business\") {\n\t\t\t\tcategory[3]++;\n\t\t\t} else if(msg.incidentData[j][\"Resolution Categorization Tier 1\"]===\"Misdirected/ Invalid call\") {\n\t\t\t\tcategory[4]++;\n\t\t\t} else if(msg.incidentData[j][\"Resolution Categorization Tier 1\"]===\"Training Issues\") {\n\t\t\t\tcategory[5]++;\n\t\t\t} else if(msg.incidentData[j][\"Resolution Categorization Tier 1\"]===\"Duplicate call\") {\n\t\t\t\tcategory[6]++;\n\t\t\t} else if(msg.incidentData[j][\"Resolution Categorization Tier 1\"]===\"Security Breach\") {\n\t\t\t\tcategory[7]++;\n\t\t\t} else if(msg.incidentData[j][\"Resolution Categorization Tier 1\"]===\"Known Error\") {\n\t\t\t\tcategory[8]++;\n\t\t\t} else if(msg.incidentData[j][\"Resolution Categorization Tier 1\"]===\"Connectivity Issue - 3rd Party\") {\n\t\t\t\tcategory[9]++;\n\t\t\t} \n        \t\n    \t}\n    \t\n\t}\n\n\tfor (var j=0;j<10;j++) {\n\t\tcategorisation[j+1][i]=category[j];\n\t}\n\tincidentAgePopulate=false;\n\tfor (var j=0;j<msg.aecomData.length;j++) {\n\t\tvar getDate=msg.aecomData[j][\"Reported Date+\"];\n\t    var daterange=getDate.substring(0, getDate.indexOf(' '));\n\t    var check=new Date(daterange);\n\t    var getClosedDate=msg.aecomData[j][\"Last Modified Date\"];\n\n\t    if(msg.aecomData[j][\"Status*\"]===\"Assigned\" && msg.aecomData[j][\"Priority*\"]===\"Low\") {\n\t    \tf3b++;\n\t    }\n\t    \n\t    else if(msg.aecomData[j][\"Status*\"]===\"In Progress\" && msg.aecomData[j][\"Priority*\"]===\"Low\") {\n\t    \tf4b++;\n\t    }\n\t    else if (msg.aecomData[j][\"Status*\"]===\"Pending\" && msg.aecomData[j][\"Priority*\"]===\"Low\") {\n\t    \tf5b++;\n\t    }\n\n\t    if(getClosedDate !==undefined) {\n\t    \tvar ClosedDaterange=new Date(getClosedDate.substring(0, getClosedDate.indexOf(' ')));\n\t    \tif(ClosedDaterange >= dateFrom && ClosedDaterange <= to) {\n\t    \t\tif(msg.aecomData[j][\"Priority*\"]===\"Low\" && (msg.aecomData[j][\"Status*\"]===\"Resolved\" || msg.incidentData[j][\"Status*\"]===\"Closed\"))\n\t\t\t\t{\n\t\t\t\t\te14++;\n\t\t\t\t}\n    \t\t}\n\t    }\n\t\tif(check >= dateFrom && check <= to ) {\n\t\t\t\n\t\t\tif(msg.aecomData[j][\"Priority*\"]===\"Low\")\n\t\t\t{\n\t\t\t\te13++;\n\t\t\t}\n       \t\n    \t}\n    \tif(checkforFirstItr) {\n\t    \tif(check >= dateFrom && check <= to ) {\n\t\t\t\tif(msg.aecomData[j][\"Priority*\"]===\"Medium\")\n\t\t\t\t{\n\t\t\t\t\tsev3Count++;\n\t\t\t\t} else if (msg.aecomData[j][\"Priority*\"]===\"Low\") {\n\t\t\t\t\tsev4Count++;\n\t\t\t\t}\n\t      \t\n\t    \t}\n\t    }\n    \t\n\t}\n\tincidentBurn[1][i]=d13+e13;\n\tincidentBurn[2][i]=d14+e14;\n\t//incidentBurn[3][i]=f3a+f3b+f4a+f4b;\n\tmsg.totalOpen=f3a+f3b+f4a+f4b+f5a+f5b;\n\tcheckforFirstItr=false;\n}\n//populating incidentAgeing \nincidentAgeing[0].push(incidentAge1,incidentAge2,incidentAge3,incidentAge4);\n\n/***populating incidentAgeingChart data***/\n  var alpha='A';\n\tfor (var i=0;i<incidentAgeing.length;i++) {\n\t\tvar charObj=\n\t\t{\n          \"id\": \"\",\n          \"label\": \"\",\n          \"type\": \"number\"\n        };\n\t    charObj.id=nextChar(alpha);\n\t    alpha=nextChar(alpha);\n\t    charObj.label=incidentAgeing[i][0];\n\t    chartObject1.data.cols.push(charObj);\n\t}\n\tvar daysCount=[\"0-7 Days\",\"8-14 Days\",\"15-30 Days\",\"30+ Days\"];\n\tfor (var j=1;j<incidentAgeing[0].length;j++){\n\t\tvar abc={\n\t\t\"c\": []\n\t\t};\n\t\tvar obj= {\n          \"v\": j-1,\n          \"f\": daysCount[j-1]\n        }\n        var obj1=\n        {\n          \"v\": incidentAgeing[0][j]\n        };\n\t\t\n\t\tabc.c.push(obj);\n\t\tabc.c.push(obj1);\n\t\tchartObject1.data.rows.push(abc);\n\t}\n/***populating incidentBurnChart data***/\n\nvar alpha='A';\n\nfor (var i=1;i<incidentBurn.length;i++) {\n\tvar charObj=\n\t{\n      \"id\": \"\",\n      \"label\": \"\",\n      \"type\": \"number\"\n    };\n    charObj.id=nextChar(alpha);\n    alpha=nextChar(alpha);\n    charObj.label=incidentBurn[i][0];\n    chartObject.data.cols.push(charObj);\n}\n\nfor (var i=1;i<incidentBurn[0].length;i++) {\n\tvar abc={\n\t\"c\": []\n\t};\n\tfor (var j=0;j<incidentBurn.length;j++){\n\t\tif(i===1 && j===0) {\n\t\t\tvar obj={\n              \"v\": 0,\n              \"f\": incidentBurn[j][i]\n            }\n\t\t} else {\n\t\t\tvar obj={\n\t\t\t\t\"v\":incidentBurn[j][i]\n\t\t\t}\n\t\t}\n\t\tabc.c.push(obj);\n\t}\n\tchartObject.data.rows.push(abc);\n}\n\n\nfor (var i=1;i<dailyIncidents[0].length;i++) {\n\tvar abc={\n\t\"c\": []\n\t};\n\t\t\tvar obj={\n              \"v\": i-1,\n              \"f\": dailyIncidents[0][i]\n            }\n\t\t\tvar obj1={\n\t\t\t\t\"v\":dailyIncidents[1][i]\n\t\t\t}\n\t\tabc.c.push(obj);\n\t\tabc.c.push(obj1);\n\n\tchartObject4.data.rows.push(abc);\n}\n/***probrecord Ageing***/\nfor (var i=0;i<msg.probRecords.length;i++) {\n    var getDate=msg.probRecords[i][\"Submit Date\"];\n    var daterange=getDate.substring(0, getDate.indexOf(' '));\n    var check=new Date(daterange);\n    /****probRecord ageing****/\n    if (msg.probRecords[i][\"Status*\"]===\"Draft\" || msg.probRecords[i][\"Status*\"]===\"Under Review\"){\n\t\tif(check<=day1 && check>=day7) {\n\t\t\tProbRecordAge1++;\n\t\t} else if (check<=day8 && check>=day14) {\n\t\t\tProbRecordAge2++;\n\t\t} else if (check<=day15 && check>=day30) {\n\t\t\tProbRecordAge3++\n\t\t} else ProbRecordAge4++;\n\t}\n\t\n}\nprobrecordAgeing[0].push(ProbRecordAge1,ProbRecordAge2,ProbRecordAge3,ProbRecordAge4);\n\nfor (var j=1;j<probrecordAgeing[0].length;j++){\n\t\tvar abc={\n\t\t\"c\": []\n\t\t};\n\t\tvar obj= {\n          \"v\": j-1,\n          \"f\": daysCount[j-1]\n        }\n        var obj1=\n        {\n          \"v\": probrecordAgeing[0][j]\n        };\n\t\t\n\t\tabc.c.push(obj);\n\t\tabc.c.push(obj1);\n\t\tchartObject3.data.rows.push(abc);\n\t}\n\n\tfor (var i=1;i<categorisation.length;i++) {\n\t\t//console.log(categorisation[i+1][0]);\n\t\tvar abc={\n\t\t\t\"c\":[]\n\t\t};\n\t\tvar obj={\n\t\t\t\"v\":i,\n\t\t\t\"f\":categorisation[i][0]\n\t\t}\n\t\tvar obj1= {\n\t\t\t\"v\":categorisation[i][1]\n\t\t};\n\t\tvar obj2={\n\t\t\t\"v\":categorisation[i][2]\n\t\t}\n\t\tabc.c.push(obj);\n\t\tabc.c.push(obj1);\n\t\tabc.c.push(obj2);\n\t\tchartObject2.data.rows.push(abc);\n\n\t}\n\tchartObject2.data.cols[1][\"label\"]=\"Current week \"+categorisation[0][1];\n\tchartObject2.data.cols[2][\"label\"]=\"week ending \"+categorisation[0][2];\n\n\tvar chartObject5={\n    \"type\": \"PieChart\",\n    \"displayed\": false,\n    \"data\": {\n      \"cols\": [\n        {\n          \"id\": \"A\",\n          \"label\": \"NEW A\",\n          \"type\": \"string\"\n        },\n        {\n          \"id\": \"B\",\n          \"label\": \"Sev1\",\n          \"type\": \"number\"\n        },\n        {\n          \"id\": \"C\",\n          \"label\": \"Sev2\",\n          \"type\": \"number\"\n        }\n      ],\n      \"rows\": [\n        {\n          \"c\": [\n            {\n              \"v\": 1,\n              \"f\": \"Sev1\"\n            },\n            {\n              \"v\": sev1Count\n            }\n          ]\n        },\n        {\n          \"c\": [\n            {\n              \"v\": 2,\n              \"f\": \"Sev2\"\n            },\n            {\n              \"v\": sev2Count\n            }\n\n          ]\n        },\n        {\n          \"c\": [\n            {\n              \"v\": 3,\n              \"f\": \"Sev3\"\n            },\n            {\n              \"v\": sev3Count\n            }\n          ]\n        },\n        {\n          \"c\": [\n            {\n              \"v\": 4,\n              \"f\": \"Sev4\"\n            },\n            {\n              \"v\": sev4Count\n            }\n          ]\n        }\n        \n        \n        \n      ]\n    },\n    \"options\": {\n      \"title\": \"Weekly Distribution\",\n      \"isStacked\": \"true\",\n      \"fill\": 20,\n      \"displayExactValues\": true,\n      //\"seriesType\": \"bars\",\n      \"width\": 600,\n      \"colors\": [\n        \"#92D050\",\n        \"#D20000\",\n        \"#E17E7C\",\n        \"#127E7C\"\n      ],\n      \"vAxis\": {\n        \"title\": \"\",\n        \"gridlines\": {\n          \"count\": 10\n        }\n      },\n      //\"orientation\": \"horizontal\",\n      \"hAxis\": {\n        \"title\": \"\"\n      }\n    },\n    \"formatters\": {}\n  }\n\t\nmsg.chartObject=JSON.stringify(chartObject);\nmsg.chartObject1=JSON.stringify(chartObject1);\nmsg.chartObject2=JSON.stringify(chartObject2);\nmsg.chartObject3=JSON.stringify(chartObject3);\nmsg.chartObject4=JSON.stringify(chartObject4);\nmsg.chartObject5=JSON.stringify(chartObject5);\ntableDatas[\"incidentBurn\"]=incidentBurn;\ntableDatas[\"incidentAgeing\"]=incidentAgeing;\ntableDatas[\"probrecordAgeing\"]=probrecordAgeing;\ntableDatas[\"categorisation\"]=categorisation;\nmsg.tableDatas= JSON.stringify(tableDatas);\nmsg.tableData=tableDatas;\nmsg.summaryInfo={\n\t\"oneWeekCritical\":oneWeekCritical,\n\t\"oneWeekHigh\":oneWeekHigh,\n\t\"criticalIncident\":criticalIncidentObj,\n\t\"highIncident\":highIncidentObj\n}\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 650.856330871582,
        "y": 497.80847549438477,
        "wires": [
            [
                "af5d8206.1b371"
            ]
        ]
    },
    {
        "id": "4955313b.e67d4",
        "type": "http request",
        "z": "bc71bbb2.5d89a8",
        "name": "",
        "method": "GET",
        "ret": "txt",
        "url": "http://127.0.0.1:80/getaecom",
        "tls": "",
        "x": 307.0459518432617,
        "y": 553.7345962524414,
        "wires": [
            [
                "96adce3f.0cbae"
            ]
        ]
    },
    {
        "id": "96adce3f.0cbae",
        "type": "function",
        "z": "bc71bbb2.5d89a8",
        "name": "",
        "func": "msg.identifier=\"aecom\";\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 488.7995071411133,
        "y": 524.6422500610352,
        "wires": [
            [
                "5b66a3cd.9159fc"
            ]
        ]
    },
    {
        "id": "d7d79b1a.cbdc08",
        "type": "gcalendar",
        "z": "bc71bbb2.5d89a8",
        "name": "",
        "topic": "gcalendar",
        "calendarId": "primary",
        "x": 318.5706100463867,
        "y": 301.98701667785645,
        "wires": [
            [
                "b00b74c4.18d908"
            ]
        ]
    },
    {
        "id": "b00b74c4.18d908",
        "type": "function",
        "z": "bc71bbb2.5d89a8",
        "name": "",
        "func": "msg.identifier=\"calendar-event\";\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 501.85633087158203,
        "y": 260.5584487915039,
        "wires": [
            [
                "5b66a3cd.9159fc"
            ]
        ]
    },
    {
        "id": "a9e645b.3caafb8",
        "type": "http in",
        "z": "bc71bbb2.5d89a8",
        "name": "",
        "url": "/categoryPage1",
        "method": "get",
        "swaggerDoc": "",
        "x": 176.81372833251953,
        "y": 678.1521596908569,
        "wires": [
            [
                "4fbd53f9.0424fc"
            ]
        ]
    },
    {
        "id": "4fbd53f9.0424fc",
        "type": "http request",
        "z": "bc71bbb2.5d89a8",
        "name": "",
        "method": "GET",
        "ret": "txt",
        "url": "http://127.0.0.1:80/getjson",
        "tls": "",
        "x": 188.8108901977539,
        "y": 618.6095733642578,
        "wires": [
            [
                "4c61d572.9c8cbc"
            ]
        ]
    },
    {
        "id": "54e02e2c.524c7",
        "type": "template",
        "z": "bc71bbb2.5d89a8",
        "name": "",
        "field": "payload",
        "fieldType": "msg",
        "format": "handlebars",
        "syntax": "mustache",
        "template": " \n<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n    <meta charset=\"UTF-8\">\n    <title>MNS-Reporting</title>\n    <link rel=\"stylesheet\" type=\"text/css\" href=\"assets/wsr-automation/css/style.css\">\n        <script src=\"https://ajax.googleapis.com/ajax/libs/jquery/1.12.0/jquery.min.js\"></script>\n\n    <script type=\"text/javascript\">\n    $(document).ready(function(){\n        \n    \n      $('select').on('change',function(e){\n    $.ajax({\n        type     : \"POST\",\n        cache    : false,\n        url      : \"http://localhost/updateData\",\n        data     : $(this).closest('tr').find('input,select').serialize(),\n        success  : function(data) {\n           // $(\".printArea\").empty().append(data).css('visibility','visible');\n           console.log(\"success\")\n        }\n    });\n//}\n});\n});\n    </script>\n</head>\n<body>\n<table>\n\n    {{#categoryData.length}}\n        <tr>\n            <td>Incident Id</td>\n            <td>Summary</th>\n            <td>Categorisation</td>\n            <td>Category List</td>\n\n        </tr>\n    {{/categoryData.length}}\n    {{#categoryData}}\n        <form class=\"formcl\" action=\"updateData\" method=\"POST\">\n        <tr> \n        <input type=\"hidden\" value=\"{{Priority*}}\" name=\"Priority*\"/>\n        <input type=\"hidden\" value=\"{{Impact*}}\" name=\"Impact*\"/>\n        <input type=\"hidden\" value=\"{{Summary*}}\" name=\"Summary*\"/>\n        <input type=\"hidden\" value=\"{{Incident ID*+}}\" name=\"Incident ID*+\"/>\n        <input type=\"hidden\" value=\"{{Status*}}\" name=\"Status*\"/>\n                <input type=\"hidden\" value=\"{{Status_Reason_Hidden}}\" name=\"Status_Reason_Hidden\"/>\n        <input type=\"hidden\" value=\"{{Vendor Ticket Number}}\" name=\"Vendor Ticket Number\"/>\n        <input type=\"hidden\" value=\"{{Assignee+}}\" name=\"Assignee+\"/>\n                <input type=\"hidden\" value=\"{{Reported Date+}}\" name=\"Reported Date+\"/>\n        <input type=\"hidden\" value=\"{{Responded Date+}}\" name=\"Responded Date+\"/>\n        <input type=\"hidden\" value=\"{{Last Resolved Date}}\" name=\"Last Resolved Date\"/>\n        <input type=\"hidden\" value=\"{{Closed Date}}\" name=\"Closed Date\"/>\n        <input type=\"hidden\" value=\"{{First Name+}}\" name=\"First Name+\"/>\n        <input type=\"hidden\" value=\"{{Last Name+}}\" name=\"Last Name+\"/>\n\n            <td>{{Incident ID*+}}</td>\n            <td>{{Summary*}}</td>\n            <td>{{Resolution Categorization Tier 1}}</td>\n            <td>   \n                <!--<select name=\"cate\" class=\"select-category\" onchange=\"this.form.submit()\">-->\n                <select name=\"cate\" class=\"select-category\" >\n                <option>Site Confidence Issues</option>\n                <option>Application Error</option>\n                <option>Service Request IT</option>\n                <option>Service Request Business</option>\n                <option>Misdirected/ Invalid call</option>\n                <option>Training Issues</option>\n                <option>Duplicate call</option>\n                <option>Security Breach</option>\n                <option>Known Error</option>\n                <option>Connectivity Issue - 3rd Party</option>\n\n                </select>\n\n                </td>\n        </tr>\n        </form>\n\n    {{/categoryData}}\n</table>\n\n</body>\n</html>",
        "x": 503.81937408447266,
        "y": 618.3453750610352,
        "wires": [
            [
                "e889bdc2.aa32d"
            ]
        ]
    },
    {
        "id": "e889bdc2.aa32d",
        "type": "http response",
        "z": "bc71bbb2.5d89a8",
        "name": "",
        "x": 667.8136672973633,
        "y": 601.7402334213257,
        "wires": []
    },
    {
        "id": "4c61d572.9c8cbc",
        "type": "function",
        "z": "bc71bbb2.5d89a8",
        "name": "",
        "func": "//console.log(typeof(msg.payload));\nmsg.categoryData=JSON.parse(msg.payload);\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 350.8108901977539,
        "y": 618.4305801391602,
        "wires": [
            [
                "54e02e2c.524c7"
            ]
        ]
    },
    {
        "id": "794f91b5.d3d14",
        "type": "template",
        "z": "bc71bbb2.5d89a8",
        "name": "",
        "field": "payload",
        "fieldType": "msg",
        "format": "handlebars",
        "syntax": "mustache",
        "template": "<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n    <meta charset=\"UTF-8\">\n    <title>MNS-Reporting</title>\n    <link rel=\"stylesheet\" type=\"text/css\" href=\"assets/wsr-automation/css/style.css\">\n    <script src=\"https://ajax.googleapis.com/ajax/libs/jquery/1.12.0/jquery.min.js\"></script>\n    <script src=\"http://ajax.googleapis.com/ajax/libs/angularjs/1.4.8/angular.min.js\"></script>\n    <script src=\"assets/wsr-automation/js/app.js\"></script>\n    <script src=\"assets/wsr-automation/js/executiveSummary/newcontroller.js\"></script>\n    <script src=\"assets/wsr-automation/js/common/createTable.directive.js\"></script>\n    <script src='http://js.nicedit.com/nicEdit-latest.js'></script>\n<link rel=\"stylesheet\" type=\"text/css\" href=\"assets/wsr-automation/css/style.css\">\n    <script src=\"https://ajax.googleapis.com/ajax/libs/jquery/1.12.0/jquery.min.js\"></script>\n    <script src=\"http://ajax.googleapis.com/ajax/libs/angularjs/1.4.8/angular.min.js\"></script>\n    <script src=\"assets/wsr-automation/js/app.js\"></script>\n    <script src=\"assets/wsr-automation/js/ng-google-chart.min.js\"></script>\n    <script src=\"assets/wsr-automation/js/trends/newtrendscontroller.js\"></script>\n    <script src=\"assets/wsr-automation/js/common/createTable.directive.js\"></script>\n        <script src='http://js.nicedit.com/nicEdit-latest.js'></script>\n<script type=\"text/javascript\">\nvar tableDatas={{{tableDatas}}};\nvar dateDisplay=tableDatas.date;\nvar chartObject={{{chartObject}}};\nvar chartObject1={{{chartObject1}}};\nvar chartObject2={{{chartObject2}}};\nvar chartObject3={{{chartObject3}}};\nvar chartObject4={{{chartObject4}}}\nvar chartObject5={{{chartObject5}}};\n\n//console.log(dateDisplay);\n  \n</script>\n</head>\n<body>\nMain dashboard\n    <main class=\"container\" ng-app=\"weeklyReports\" ng-controller=\"reportsCtrl\" >\n        <script type=\"text/ng-template\" id=\"incidentDataTable.html\">\n            <tr ng-repeat=\"data in dataFromTable\">\n                <td ng-repeat=\"values in data track by $index\" ng-class=\"values\" ng-bind=\"values\"></td>\n            </tr>\n        </script>\n        <script type=\"text/ng-template\" id=\"slaViewTable.html\">\n            <tr>\n                <td>Incident</td><td>SLA</td><td>Reported</td><td>Acheived</td><td>Breached</td>\n            </tr>\n            <tr ng-repeat=\"data in dataFromTable\">\n                <td ng-repeat=\"values in data track by $index\" ng-bind=\"values\"></td>\n            </tr>\n        </script>\n        <script type=\"text/ng-template\" id=\"incidentSumTable.html\">\n            <tr>\n                <td ng-repeat=\"(key,value) in dataFromTable\" ng-bind=\"key\"></td>\n            </tr>\n            <tr>\n                <td ng-repeat=\"data in dataFromTable\" ng-bind=\"data\"></td>\n            </tr>\n        </script>\n         \n        <div class=\"clearfix\">\n            <img src=\"assets/wsr-automation/images/mns-logo.jpg\" alt=\"Marks and Spencer logo\" id=\"mnsLogo\">\n            <img src=\"assets/wsr-automation/images/sapient-nitro.png\" alt=\"SapientNitro logo\" id=\"sapientLogo\">\n        </div>\n        <div class=\"clearfix\">\n            <img src=\"assets/wsr-automation/images/print-icon.png\" alt=\"Print Logo\" id=\"printLogo\" ng-click=\"printOption()\">\n        </div>\n\n        <section class=\"clearfix\">\n            <h1>\n                M&S eCom Support Weekly Status Report - Week Ending  {{tableData.date}}\n            </h1>\n            <table id=\"incidents\">\n                <caption>Incidents originating in Week ending {{tableData.date}}</caption>\n                <tbody id=\"incidentDataTable\" table-dir dataparam=tableDatas.incidentData></tbody>\n            </table>\n            <table id=\"slaView\">\n                <caption>SLA View for Week ending {{tableData.date}}</caption>\n                <tbody id=\"slaViewTable\" table-dir dataparam=\"tableDatas.slaView\"></tbody>\n            </table>\n            <table id=\"incidentSummary\" style=\"clear: both;\">\n                <caption>Incident Summary till {{tableData.date}}</caption>\n                <tbody id=\"incidentSumTable\" table-dir dataparam=\"tableDatas.incidentSummary\"></tbody>\n            </table>\n        </section>\n\n        <section>\n            <!--<h1>\n                M&S eCom Support Weekly Status Report - Week Ending  {{tableData.date}}\n            </h1>-->\n            <div id=\"keyUpdates\" class=\"sections\">\n                <div class=\"header-div\">\n                    <span class=\"edit-button\"></span>\n                    <h2 class=\"headlines\">Key updates</h2>\n                </div>\n\n                <div id=\"myArea1\" class=\"edit-div\">\n                    <div>\n                        <h3>Progress Last Week RAYG : GREEN</h3>\n                        <ul>\n                            <li>Total <span>69</span> incidents were raised in last week. Pending triage incidents are currently <span>29</span>.</li>\n                            <li>1 Sev 2's were raised last week.\n                                <ul>\n                                    <li>Sev 2 | INC000021527174 | EMAIL-PROBE (Site Confidence Alert:Script Step[28065111]) - Site Confidence Alert Script Step - Site Confidence Journey was failing</li>\n                                </ul>\n                            </li>\n                        </ul>\n                        <h3>Business Events</h3>\n                        <ul>\n                            <li>NA</li>\n                        </ul>\n                        \n                        <!--<ul>\n                            <li><span>2</span> Open (0 Draft ,2 Pending, 0 Under Review)</li>\n                        </ul>-->\n                        \n                        <!--<ul>\n                            <li>PROD | B&C | THROTTLE | Moving Mobile/App to -6 and Basket change <span>21st Mar</span></li>\n                            <li>PROD | Throttling to 100% New Basket for CS and Stores <span>23rd Mar</span></li>\n                            <li>PROD | CM-182 | SPARKS - FE change for Sparks FAQs link <span>24th Mar</span></li>\n                            <li>PROD | CM-183 | Whitelisting Omniture rest API Url for Prod Servers <span>24th Mar</span></li>\n                            <li>PROD | Timezone change to BST <span>27th Mar</span></li>\n                            <li>SIT3 | R26 Deployment <span>21st Mar</span></li>\n                            <li>SIT3/B | Apply RHEL Patch <span>23rd Mar</span></li>\n                        </ul>-->\n                    </div>\n                </div>\n                <div class=\"noneditable-container\" style=\"border-top:solid 1px black;padding-left:4px;\">\n\n                        <h3>Problem Record</h3>\n                        <table>\n\n                            {{#problemArrayDraft.length}}\n\n                                        <tr>\n                                            <td>Problem ID</td>\n                                            <td>Summary</th>\n                                            <td>Assignee</td>\n                                            <td>Status</td>\n                                            <td>Ageing</td>\n                                            <td>Open Date</td>\n\n                                        </tr>\n                            {{/problemArrayDraft.length}}\n                            {{#problemArrayDraft}}\n                                <tr> \n                                    <td>{{Problem ID*+}}</td>\n                                    <td>{{Summary*}}</td>\n                                    <td>{{Assignee+}}</td>\n                                    <td>{{Status*}}</td>\n                                    <td>{{ageings}}</td>\n                                    <td>{{Submit Date}}</td>\n\n                                </tr>\n                            {{/problemArrayDraft}}\n                        </table>\n\n                        \n                        <h3>Environments</h3>\n                        <ul>\n                            {{#lastEventList}}\n                            <li>\n                                {{summary}}\n                            </li>\n                            {{/lastEventList}}\n                        </ul>\n                </div>\n            </div>\n            <div id=\"nextWeekPlan\" class=\"sections\" >\n                <div class=\"header-div\">\n                    <span class=\"edit-button\"></span>\n                    <h2 class=\"headlines\"> Plan for next week</h2>\n                </div>\n\n                <div id=\"nextWeek\" class=\"edit-div\" >\n                    <h3>Business Events</h3>\n                    <ul>\n                        <li>NA</li>\n                    </ul>\n                        \n                    <!--<ul>\n                        <li>PROD | RHEL Patching DR <span>28th Mar</span></li>\n                        <li>PROD | Bing SIte Authorisation Update in AKAMAI <span>29th Mar</span></li>\n                        <li>PROD | RHEL Patching BURST <span>29th Mar</span></li>\n                        <li>PROD | R26 Deployment <span>30th Mar</span></li>\n                        <li>DR | QA3 | R26 Deployment <span>31st Mar</span></li>\n                    </ul>-->\n                </div>\n                <div class=\"noneditable-container\" style=\"border-top:solid 1px black;padding-left:4px;\">\n                    <h3>Environments</h3>\n                        <ul>\n                            {{#eventList}}\n                            <li>\n                                {{summary}}\n                            </li>\n                            {{/eventList}}\n                        </ul>\n                </div>\n            </div>\n            <div id=\"risksIssues\" class=\"sections\">\n                <div class=\"header-div\">\n                    <span class=\"edit-button\"></span>\n                    <h2 class=\"headlines\">Key risks/issues</h2>\n                </div>\n\n                <div id=\"risk\" class=\"edit-div\">\n                    <ul>\n                        <!--<li>Single Prod/ non-Prod account for Bing request. There is threshhold of 50 requested in 24 hrs</li>\n                        <li>Stageprop session killed twice</li>-->\n                        <li>NA</li>\n                    </ul>\n                </div>\n            </div>\n            <div id=\"accomplishments\" class=\"sections\">\n                <div class=\"header-div\">\n                    <span class=\"edit-button\"></span>\n                    <h2 class=\"headlines\">Accomplishments</h2>\n                </div>\n\n                <div id=\"accomp\" class=\"edit-div\">\n                    <ul>\n                        <!--<li>Timezone changed from GMT to BST has been successfully completed on 27th March.</li>-->\n                                                <li>NA</li>\n\n                    </ul>\n                </div>\n            </div>\n            <div id=\"keyDependencies\" class=\"sections\">\n                <div class=\"header-div\">\n                    <span class=\"edit-button\"></span>\n                    <h2 class=\"headlines\">Key dependencies</h2>\n                </div>\n                <div id=\"keyDepend\" class=\"edit-div\">\n                    <ul>\n                                            <li>NA</li>\n\n                    </ul>\n                </div>\n            </div>\n        </section>\n    </main>\n    <main class=\"container\" ng-app=\"trendsReport\" ng-controller=\"trendsCtrl\" >\n        {{{tableDatas}}}\n        <script type=\"text/ng-template\" id=\"incidentBurnTable.html\">\n            <tr ng-repeat=\"data in dataFromTable\">\n                <td ng-repeat=\"values in data track by $index\" ng-class=\"values\" ng-bind=\"values\"></td>\n            </tr>\n        </script>\n        <script type=\"text/ng-template\" id=\"incidentAgeTable.html\">\n            <tr>\n                <td>Ageing</td><td>0-7 Days</td><td>8-14 Days</td><td>15-30 Days</td><td>30+ Days</td>\n            </tr>\n            <tr ng-repeat=\"data in dataFromTable\">\n                <td ng-repeat=\"values in data track by $index\" ng-bind=\"values\"></td>\n            </tr>\n        </script>\n        <script type=\"text/ng-template\" id=\"incidentSumTable.html\">\n            <tr>\n                <td ng-repeat=\"(key,value) in dataFromTable\" ng-bind=\"key\"></td>\n            </tr>\n            <tr>\n                <td ng-repeat=\"data in dataFromTable\" ng-bind=\"data\"></td>\n            </tr>\n        </script>\n        <script type=\"text/ng-template\" id=\"categorizationTable.html\">\n            <!--<tr>\n                <td>Categorization</td><td>Current Week</td><td>Week ending 20th Mar</td><td>Week ending 6th Mar</td><td>Week ending 28th Feb</td>\n            </tr>-->\n            <tr ng-repeat=\"data in dataFromTable\">\n                <td ng-repeat=\"values in data track by $index\" ng-class=\"values\" ng-bind=\"values\"></td>\n            </tr>\n        </script>\n        <script type=\"text/ng-template\" id=\"weeklyAgeingTable.html\">\n            <tr>\n                <td>Ageing</td><td>0-7 Days</td><td>8-14 Days</td><td>15-30 Days</td><td>30+ Days</td>\n            </tr>\n            <tr ng-repeat=\"data in dataFromTable\">\n                <td ng-repeat=\"values in data track by $index\" ng-class=\"values\" ng-bind=\"values\"></td>\n            </tr>\n        </script>\n        <script type=\"text/ng-template\" id=\"releaseAlignmentTable.html\">\n            <tr>\n                <td>Row Labels</td><td>Not Aligned</td><td>Release 26</td><td>Grand Total</td>\n            </tr>\n            <tr ng-repeat=\"data in dataFromTable\">\n                <td ng-repeat=\"values in data track by $index\" ng-class=\"values\" ng-bind=\"values\"></td>\n            </tr>\n        </script>\n        <div class=\"clearfix\">\n            <img src=\"assets/wsr-automation/images/mns-logo.jpg\" alt=\"Marks and Spencer logo\" id=\"mnsLogo\">\n            <img src=\"assets/wsr-automation/images/sapient-nitro.png\" alt=\"SapientNitro logo\" id=\"sapientLogo\">\n        </div>\n        <div class=\"clearfix\">\n            <img src=\"assets/wsr-automation/images/print-icon.png\" alt=\"Print Logo\" id=\"printLogo\" ng-click=\"printOption()\">\n        </div>\n\n        <section class=\"clearfix\">\n            <table id=\"incidentBurnRate\">\n                <caption>Overall Incident Burn Rate - Weekly View  (Sev3&4)  </caption>\n                <tbody id=\"incidentBurnTable\" table-dir dataparam=\"tableDatas.incidentBurn\"></tbody>\n                <tfoot>\n                    <tr>\n                      <td>Total Open</td>\n                      <td>{{totalOpen}}</td>\n                    </tr>\n                 </tfoot>\n            </table>\n            <table id=\"incidentAgeing\">\n                <caption>Overall Incident Ageing for Sev3 & 4</caption>\n                <tbody id=\"incidentAgeTable\" table-dir dataparam=\"tableDatas.incidentAgeing\"></tbody>\n            </table>\n        </section>\n        <section class=\"clearfix\">\n            <div class=\"panel-message left-panel\" style=\"width: 52%;\">\n                {{#summaryInfo}}\n                    <p>{{oneWeekCritical}} Sev 1 was raised last week</p>\n                    <p>{{oneWeekHigh}} Sev 2 was raised last week</p>\n                    {{#criticalIncident}}\n                    <p>-{{Priority}} | {{incidentId}} | {{summary}}</p>\n                    {{/criticalIncident}}\n                    {{#highIncident}}\n                    <p>-{{Priority}} | {{incidentId}} | {{summary}}</p>\n                    {{/highIncident}}\n                {{/summaryInfo}}\n            </div>\n            <div class=\"panel-message right-panel \">\n            <div class=\"header-div\">\n                    <span class=\"edit-button\"></span>\n                    <h2 class=\"headlines\">Summary</h2>\n            </div>\n            <div id=\"editPanel1\" class=\"edit-div\">\n               <!-- <p>- Incident ageing  has been  under control</p>\n                <p>- Incident older than 15 days</p>\n                <p>- INC000019293754 -There is a spike in the 500 error for the command /ordercalculate. There are about 68 customer sessions until now out of which 66 customers have abandoned their basket</p>\n                <p>- INC000018829506 | Sev3 | Increase in count of 404  after R24</p>-->\n            </div>\n            </div>\n        </section>\n        <section class=\"left-chart\">\n            \n            <div id=\"chartDiv\" class=\"chart-width\" google-chart chart=\"chartObject\" style=\"{{chart.cssStyle}}\"/>\n        </section>\n        <section class=\"right-chart\">\n            <div id=\"IncidentAgeChart\" class=\"chart-width\" google-chart chart=\"chartObject1\" style=\"{{chart.cssStyle}}\"/>\n\n        </section>\n        <section class=\"clearfix\">\n            <table id=\"categorization\">\n                <caption>Categorization of Incidents - Weekly View  </caption>\n                <tbody id=\"categorizationTable\" table-dir dataparam=\"tableDatas.categorisation\"></tbody>\n            </table>\n            <section class=\"right-chart\"> \n                <div id=\"CategorizationChart\" class=\"chart-width\" google-chart chart=\"chartObject2\" style=\"{{chart.cssStyle}}\"/>\n            </section>\n        </section>\n        <!--<section class=\"clearfix\">\n            <div class=\"panel-message left-panel\">\n                <p>71  Incidents closeds</p>\n                <p>- 12 Connectivity Issue 3rd Party - Site Confidence</p>\n                <p>- 12 Misdirected/ Invalid call</p>\n                <p>- 12 Known Error</p>\n                <p>- 11 Duplicate calls</p>\n            </div>\n        </section>-->\n        <section class=\"clearfix\" style=\"width:52%;float:left;\">\n            <table id=\"weeklyAge\">\n                <caption>Overall Problem Record Ageing - Weekly View  </caption>\n                <tbody id=\"weeklyAgeingTable\" table-dir dataparam=\"tableDatas.probrecordAgeing\"></tbody>\n            </table>\n            <!--<table id=\"releaseAlignment\">\n                <caption>Incidents - Release Alignment : as per JIRA  </caption>\n                <tbody id=\"releaseAlignmentTable\" table-dir dataparam=\"\"></tbody>\n            </table>-->\n        </section>\n         <section class=\"left-chart\" style=\"width:100%\">\n            <div id=\"weeklyAgeingChart\" class=\"chart-width\" google-chart chart=\"chartObject3\" style=\"{{chart.cssStyle}}\"/>\n        </section>\n        <section class=\"right-chart\">\n            <div id=\"releaseAlignChart\" class=\"chart-width\" google-chart chart=\"chartObject4\" style=\"{{chart.cssStyle}}\"/>\n        </section>\n        <section class=\"left-chart\" style=\"width:50%\">\n            <div id=\"weeklyAgeingChart1\" class=\"chart-width\" google-chart chart=\"chartObject5\" style=\"{{chart.cssStyle}}\"/>\n        </section>\n        <!--<section class=\"right-chart\">\n            <div id=\"releaseAlignChart2\" class=\"chart-width\" google-chart chart=\"chartObject6\" style=\"{{chart.cssStyle}}\"/>\n        </section>-->\n        <section class=\"clearfix\">\n            <div class=\"panel-message left-panel \">\n                <div class=\"header-div\">\n                        <span class=\"edit-button\"></span>\n                        <h2 class=\"headlines\">Summary</h2>\n                </div>\n            <div id=\"editPanel2\" class=\"edit-div\">\n               <!-- <p>- 0  Under Review for Closure</p>\n                <p>- 0 Draft</p>\n                <p>- 0 Under Investigation</p>\n                <p>- 2 Pending with 3rd parties</p>\n                <p>- 0 Assigned</p>-->\n            </div>\n            </div>\n            <!--<div class=\"panel-message right-panel\">\n               <p>- 65 incidents are not aligned to any Release</p>\n                <p>- 0 Pending - Client Action</p>\n                <p>- 1 Pending 3rd Party</p>\n                <p>- 0 Future Enhancement</p>\n                <p>- 0 Client Hold</p>\n                <p>- 0 Under Monitoring</p>\n                <p>- 0 In progress</p>\n            </div>-->\n        </section>\n    </main>\n\n</body>\n</html>\n",
        "x": 876.796257019043,
        "y": 440.48454666137695,
        "wires": [
            [
                "fe957f17.e73db"
            ]
        ]
    },
    {
        "id": "ffcfb067.680ce",
        "type": "function",
        "z": "bc71bbb2.5d89a8",
        "name": "",
        "func": "",
        "outputs": 1,
        "noerr": 0,
        "x": 895.6534423828125,
        "y": 239.0381145477295,
        "wires": [
            []
        ]
    },
    {
        "id": "e2737957.7faaf8",
        "type": "function",
        "z": "bc71bbb2.5d89a8",
        "name": "",
        "func": "var tableDatas={};\nvar incidentDataJson=[\n    [\"Weekly Report (MM/DD/YYYY)\"],\n    //[\"Overall\",\"Green\",\"Green\",\"Green\",\"Green\",\"Green\",\"Green\"],\n    [\"Incidents\"],\n    [\"Problem Records\"]\n];\nvar slaViewData= [\n\t[\"Sev1\",\"4hours\",,,0],\n\t[\"Sev2\",\"8hours\",,,0],\n\t[\"Sev3/4\",\"NA\",,\"NA\",\"NA\"]\n];\nvar incidentSummary = {};\n\t\t\n\nfunction getfulldate(today) { //returns date in mm/dd/yyyy format\n\tvar currentDate=today.getDate(),\n\t\tcurrentMonth=today.getMonth()+1;\n\tvar x=(currentMonth<10)?('0'+currentMonth):currentMonth;\n\tvar y=(currentDate<10)?('0'+currentDate):currentDate;\n\treturn (x+'/'+y+'/'+today.getFullYear());\n}\nfunction getLastSunday(d) { //returns last sunday date takes input as mm/dd/yyyy\n  \tvar t = new Date(d);\n  \tt.setDate(t.getDate() - t.getDay());\n  \treturn t;\n}\nfunction getDateStamp(dateStamp) {\n\tvar monthName=[\"Jan\", \"Feb\", \"Mar\", \"Apr\", \"May\", \"June\",\"July\", \"Aug\", \"Sept\", \"Oct\", \"Nov\", \"Dec\"];\n\tvar newDate= new Date(dateStamp);\n\treturn newDate.getDate()+\"-\"+monthName[newDate.getMonth()]+\"-\"+newDate.getFullYear();\n}\n\nvar lastSundaydate=getLastSunday(getfulldate(new Date()));\ntableDatas[\"date\"]=getDateStamp(lastSundaydate);\nvar lastSunday=getfulldate(lastSundaydate);\nvar i=2;\nincidentDataJson[0][i-1]=lastSunday;\ndo{\n\tvar newlastSundaydate=new Date(lastSundaydate.setDate(lastSundaydate.getDate() - 7));\n\tvar newlastSunday=getfulldate(newlastSundaydate);\n\tincidentDataJson[0][i]=newlastSunday;\n\tlastSundaydate=newlastSundaydate;\n\tlastSunday=newlastSunday;\n\ti++;\n} while(i<7);\n\n\n/***incident Count ***/\nvar firstEl=true,criticalCount=0,highCount=0,lowCount=0,totalIncidentCount=0,activeIncident=0;\n\nfor (var i=1;i<incidentDataJson[0].length;i++) {\n\n\tvar dateTo=incidentDataJson[0][i];\n    var to=new Date(dateTo);\n    var newto=new Date(dateTo);\n    var dateFrom=new Date(newto.setDate(newto.getDate() - 6));\n    var incidentCount=0;\n\tfor (var j=0;j<msg.incidentData.length;j++) {\n\t\tvar getDate=msg.incidentData[j][\"Reported Date+\"];\n\t\t//console.log(getDate);\n\t    var daterange=getDate.substring(0, getDate.indexOf(' '));\n\t    var check=new Date(daterange);\n\t    if(firstEl && (msg.incidentData[j][\"Priority*\"]===\"Medium\" || msg.incidentData[j][\"Priority*\"]===\"Critical\" || msg.incidentData[j][\"Priority*\"]===\"High\")) {\n    \t\ttotalIncidentCount++;\n        \tif(msg.incidentData[j][\"Status*\"]===\"Assigned\" || msg.incidentData[j][\"Status*\"]===\"Pending\") {\n\t\t\t\tactiveIncident++;\n\t\t\t}\n\t\t}\n\t\tif(check >= dateFrom && check <= to ) {\n        \tincidentCount++;\n        \tif(msg.incidentData[j][\"Priority*\"]===\"Critical\" && firstEl) {\n        \t\tcriticalCount++;\n        \t}\n        \tif(msg.incidentData[j][\"Priority*\"]===\"High\" && firstEl) {\n        \t\thighCount++;\n        \t}\n        \tif((msg.incidentData[j][\"Priority*\"]===\"Medium\" || msg.incidentData[j][\"Priority*\"]===\"Low\") && firstEl) {\n        \t\tlowCount++;\n        \t}\n\n\n    \t}\n\t}\n\tfirstEl=false;\n\tincidentDataJson[1][i]=incidentCount;\n}\n\n\n/***problem Count ***/\nvar problemArrayDraft=[],problemArrayReview=[];\n\tfor (var i=1;i<incidentDataJson[0].length;i++) {\n\t\tvar dateTo=incidentDataJson[0][i];\n        var to=new Date(dateTo);\n        var newto=new Date(dateTo);\n        var dateFrom=new Date(newto.setDate(newto.getDate() - 6));\n        var problemCount=0;\n\t\tfor (var j=0;j<msg.probRecords.length;j++) {\n\t\t\tvar getDate=msg.probRecords[j][\"Submit Date\"];\n\t\t    var daterange=getDate.substring(0, getDate.indexOf(' '));\n\t\t    var check=new Date(daterange);\n\t\t\tif(check >= dateFrom && check <= to && msg.probRecords[j][\"Status*\"]===\"Draft\" ) {\n            \tproblemCount++;\n        \t}\n        \tif(i===1) {\n        \t   if(check >= dateFrom && check <= to && msg.probRecords[j][\"Status*\"]===\"Draft\" ) {\n        \t       var oneDay = 24*60*60*1000;\n        \t       var dayy1=new Date(new Date().setHours(0,0,0,0));\n        \t       var diffDays = Math.round(Math.abs((dayy1.getTime() - check.getTime())/(oneDay)));\n                    msg.probRecords[j][\"ageings\"]=diffDays;\n            \t    problemArrayDraft.push(msg.probRecords[j]);\n        \t    } \n        \t    if(check >= dateFrom && check <= to && msg.probRecords[j][\"Status*\"]===\"Under Review\" ) {\n            \t    problemArrayReview.push(msg.probRecords[j]);\n        \t    }\n        \t}\n\t\t}\n\t\tincidentDataJson[2][i]=problemCount;\n\t}\n\n\n\t/***total incident count****/\n\t\tfor (var j=0;j<msg.aecomData.length;j++) {\n\t\t\tif(msg.aecomData[j][\"Priority*\"]===\"Low\") {\n\t\t\t\ttotalIncidentCount++;\n\t\t\t\tif(msg.aecomData[j][\"Status*\"]===\"Assigned\" || msg.aecomData[j][\"Status*\"]===\"Pending\") {\n\t\t\t\t\tactiveIncident++;\n\t\t\t\t}\n\t\t\t}\n\n\t\t}\n\n\nslaViewData[0][2]=criticalCount;\nslaViewData[0][3]=criticalCount;\nslaViewData[1][2]=highCount;\nslaViewData[1][3]=highCount;\nslaViewData[2][2]=lowCount;\nincidentSummary[\"Total Incidents\"]=totalIncidentCount;\nincidentSummary[\"Active Incidents\"]=activeIncident;\nincidentSummary[\"Non-Active Incidents\"]=totalIncidentCount-activeIncident;\ntableDatas[\"incidentData\"]=incidentDataJson;\ntableDatas[\"slaView\"]=slaViewData;\ntableDatas[\"incidentSummary\"]=incidentSummary;\n\n//msg.tableDatas= JSON.stringify(tableDatas);\n//msg.tableData=tableDatas;\n\nvar lastSun=getLastSunday(new Date());\nvar lastSun1=new Date(lastSun);\nvar lastSun2=new Date(lastSun1);\nvar lastSun3=new Date(lastSun1);\nvar nextWeek=new Date(lastSun2.setDate(lastSun2.getDate() + 7));\nvar lastWeek=new Date(lastSun3.setDate(lastSun3.getDate() - 10)); \n  var eventArray=[],lasteventArray=[];\n\nfor (var i=0;i<msg.calendarEvents.length;i++) {\n    //console.log(msg.calendarEvents[i].start.dateTime);\n   var imDate=Date.parse(msg.calendarEvents[i].start.dateTime);\n  var calendarDate=new Date(imDate);\n  if(calendarDate>lastSun1 && calendarDate<=nextWeek ) {\n      //console.log(calendarDate);\n      //console.log(msg.calendarEvents[i].summary)\n      eventArray.push({\"summary\":msg.calendarEvents[i].summary});\n  }\n  if(calendarDate<=lastSun1 && calendarDate>=lastWeek ) {\n          console.log(msg.calendarEvents[i].summary)\n\n     lasteventArray.push({\"summary\":msg.calendarEvents[i].summary});\n\n  }\n  \n \n}\nvar lastSun=getLastSunday(new Date());\nmsg.eventList=eventArray;\nmsg.lastEventList=lasteventArray;\nmsg.problemArrayDraft=problemArrayDraft;\nmsg.problemArrayReview=problemArrayReview;\nvar incidentBurn=[\n    [\"Weekly Report (MM/DD/YYYY)\"],\n    [\"New\"],\n    [\"Resolved\"]/*,\n    [\"Open\"],\n    [\"Total Open\"]*/\n];\nvar incidentAgeing= [\n\t[\"Incident Count\"]\n];\nvar probrecordAgeing= [\n\t[\"Problem Records\"]\n];\nvar categorisation =[\n\t[\"Categorization\"],\n\t[\"Site Confidence Issues\"],\n    [\"Application Error\"],\n    [\"Service Request IT\"],\n    [\"Service Request Business\"],\n    [\"Misdirected/ Invalid call\"],\n    [\"Training Issues\"],\n    [\"Duplicate call\"],\n    [\"Security Breach\"],\n    [\"Known Error\"],\n    [\"Connectivity Issue - 3rd Party\"]\n];\nvar dailyIncidents=[\n[\"Days\"],\n[\"Incident Count\"]\n];\n\n\n\n\tfunction nextChar(c) {\n    \treturn String.fromCharCode(c.charCodeAt(0) + 1);\n\t}\n\n\tvar chartObject ={\n\t\"type\": \"LineChart\",\n    \"displayed\": false,\n    \"data\": {\n    \t\"cols\": [{\n          \"id\": \"A\",\n          \"label\": \"NEW A\",\n          \"type\": \"string\"\n        }\n\t],\n    \t\"rows\":[]\n    },\n    \"options\": {\n      \"title\": \"Overall Incident Burn Rate\",\n      \"isStacked\": \"true\",\n      \"fill\": 20,\n      \"legend\": {\n        \"position\": \"bottom\"\n      },\n      \"colors\": [\n        \"#4A7EBB\",\n        \"#ff0000\",\n        \"#98B954\",\n        \"#7D60A0\"\n      ],\n      \"displayExactValues\": true,\n      \"vAxis\": {\n        \"title\": \"\",\n        \"gridlines\": {\n          \"count\": 10\n        }\n      },\n      \"hAxis\": {\n        \"title\": \"\"\n      }\n    },\n    \"formatters\": {}\n\t};\n\tvar chartObject1= {\n    \"type\": \"BarChart\",\n    \"displayed\": false,\n    \"data\": {\n      \"cols\": [\n        {\n          \"id\": \"A\",\n          \"label\": \"NEW A\",\n          \"type\": \"string\"\n        }/*,\n        {\n          \"id\": \"B\",\n          \"label\": \"Incident Count\",\n          \"type\": \"number\"\n        }*/\n      ],\n      \"rows\": []\n    },\n    \"options\": {\n      \"title\": \"Overall Incident Ageing \",\n      \"isStacked\": \"false\",\n      \"fill\": 20,\n      \"displayExactValues\": true,\n      \"colors\": [\n        \"#92D050\"\n      ],\n      \"vAxis\": {\n        \"title\": \"\",\n        \"gridlines\": {\n          \"count\": 10\n        }\n      },\n      \"orientation\": \"horizontal\",\n      \"hAxis\": {\n        \"title\": \"\"\n      }\n    },\n    \"formatters\": {}\n  }\n\n  var chartObject3 = {\n    \"type\": \"BarChart\",\n    \"displayed\": false,\n    \"data\": {\n      \"cols\": [\n        {\n          \"id\": \"A\",\n          \"label\": \"weeklyAgeing\",\n          \"type\": \"string\"\n        },\n        {\n          \"id\": \"B\",\n          \"label\": \"Problem Records\",\n          \"type\": \"number\"\n        }\n      ],\n      \"rows\": []\n    },\n    \"options\": {\n      \"title\": \"Problem Record Ageing\",\n      \"isStacked\": \"false\",\n      \"fill\": 20,\n      \"displayExactValues\": true,\n      \"width\": 600,\n      \"colors\": [\n        \"#92D050\"\n      ],\n      \"vAxis\": {\n        \"title\": \"\",\n        \"gridlines\": {\n          \"count\": 4\n        }\n      },\n      \"orientation\": \"horizontal\",\n      \"hAxis\": {\n        \"title\": \"\"\n      }\n    },\n    \"formatters\": {}\n  }\n\n  var chartObject4 = {\n    \"type\": \"BarChart\",\n    \"displayed\": false,\n    \"data\": {\n      \"cols\": [\n        {\n          \"id\": \"A\",\n          \"label\": \"Daily Incidents\",\n          \"type\": \"string\"\n        },\n        {\n          \"id\": \"B\",\n          \"label\": \"Daily Incidents Count\",\n          \"type\": \"number\"\n        }\n      ],\n      \"rows\": []\n    },\n    \"options\": {\n      \"title\": \"Daily Incidents Count\",\n      \"isStacked\": \"false\",\n      \"fill\": 20,\n      \"displayExactValues\": true,\n      \"width\": 600,\n      \"colors\": [\n        \"#92D050\"\n      ],\n      \"vAxis\": {\n        \"title\": \"\",\n        \"gridlines\": {\n          \"count\": 4\n        }\n      },\n      \"orientation\": \"horizontal\",\n      \"hAxis\": {\n        \"title\": \"\"\n      }\n    },\n    \"formatters\": {}\n  }\n\n  var chartObject2= {\n    \"type\": \"ComboChart\",\n    \"displayed\": false,\n    \"data\": {\n      \"cols\": [\n        {\n          \"id\": \"A\",\n          \"label\": \"NEW A\",\n          \"type\": \"string\"\n        },\n        {\n          \"id\": \"B\",\n          \"label\": \"Current Week\",\n          \"type\": \"number\"\n        },\n        {\n          \"id\": \"B\",\n          \"label\": \"\",\n          \"type\": \"number\"\n        }\n      ],\n      \"rows\": []\n    },\n    \"options\": {\n      \"title\": \"\",\n      \"isStacked\": \"false\",\n      \"fill\": 20,\n      \"displayExactValues\": true,\n      \"seriesType\": \"bars\",\n      \"width\": 600,\n      \"series\": {\n        \"1\": {\n          \"type\": \"line\"\n        }\n      },\n      \"colors\": [\n        \"#92D050\",\n        \"#D17E7C\"\n      ],\n      \"vAxis\": {\n        \"title\": \"\",\n        \"gridlines\": {\n          \"count\": 10\n        }\n      },\n      \"orientation\": \"horizontal\",\n      \"hAxis\": {\n        \"title\": \"\"\n      }\n    },\n    \"formatters\": {}\n  }\n\n\nfunction getfulldate(today) { //returns date in mm/dd/yyyy format\n\tvar currentDate=today.getDate(),\n\t\tcurrentMonth=today.getMonth()+1;\n\tvar x=(currentMonth<10)?('0'+currentMonth):currentMonth;\n\tvar y=(currentDate<10)?('0'+currentDate):currentDate;\n\treturn (x+'/'+y+'/'+today.getFullYear());\n}\nfunction getLastSunday(d) { //returns last sunday date takes input as mm/dd/yyyy\n  \tvar t = new Date(d);\n  \tt.setDate(t.getDate() - t.getDay());\n  \treturn t;\n}\nfunction getDateStamp(dateStamp) {\n\tvar monthName=[\"Jan\", \"Feb\", \"Mar\", \"Apr\", \"May\", \"June\",\"July\", \"Aug\", \"Sept\", \"Oct\", \"Nov\", \"Dec\"];\n\tvar newDate= new Date(dateStamp);\n\treturn newDate.getDate()+\"-\"+monthName[newDate.getMonth()]+\"-\"+newDate.getFullYear();\n}\n\nvar lastSundaydate=getLastSunday(getfulldate(new Date()));\ntableDatas[\"date\"]=getDateStamp(lastSundaydate);\nvar lastSunday=getfulldate(lastSundaydate);\nvar i=2;\nincidentBurn[0][i-1]=lastSunday;\ncategorisation[0][i-1]=lastSunday;\nvar lastSunday1=new Date(lastSunday);\ndailyIncidents[0][1]=getfulldate(lastSunday1);\n//console.log(new Date(lastSunday));\n//for (var i=1;i<7;i++) {\ndailyIncidents[0][2]=getfulldate(new Date(lastSunday1.getTime() - (24*60*60*1000*1)));\ndailyIncidents[0][3]=getfulldate(new Date(lastSunday1.getTime() - (24*60*60*1000*2)));\ndailyIncidents[0][4]=getfulldate(new Date(lastSunday1.getTime() - (24*60*60*1000*3)));\ndailyIncidents[0][5]=getfulldate(new Date(lastSunday1.getTime() - (24*60*60*1000*4)));\ndailyIncidents[0][6]=getfulldate(new Date(lastSunday1.getTime() - (24*60*60*1000*5)));\ndailyIncidents[0][7]=getfulldate(new Date(lastSunday1.getTime() - (24*60*60*1000*6)));\n\nfor (var z=1;z<dailyIncidents[0].length;z++) {\nvar dateDaily=new Date(dailyIncidents[0][z]);\nvar sev1sev2=0,sev3sev4=0;\n\tfor (var je=0;je<msg.incidentData.length;je++) {\n\t\tvar getDate1=msg.incidentData[je][\"Reported Date+\"];\n\t    var daterange1=getDate1.substring(0, getDate1.indexOf(' '));\n\t    var check1=new Date(daterange1);\n\t    //console.log(check1)\n\t    if(check1.getTime()==dateDaily.getTime() && (msg.incidentData[je][\"Priority*\"]===\"Critical\" || msg.incidentData[je][\"Priority*\"]===\"High\")) {\n\t    \tsev1sev2++;\n\t     }\n\t}\n\tfor (var je=0;je<msg.aecomData.length;je++) {\n\t\tvar getDate2=msg.aecomData[je][\"Reported Date+\"];\n\t    var daterange2=getDate2.substring(0, getDate2.indexOf(' '));\n\t    var check2=new Date(daterange2);\n\t    //console.log(check1)\n\t    if(check2.getTime()==dateDaily.getTime() && (msg.aecomData[je][\"Priority*\"]===\"Medium\" || msg.aecomData[je][\"Priority*\"]===\"Low\")) {\n\t    \tsev3sev4++;\n\t     }\n\t}\n\tdailyIncidents[1][z]=sev1sev2+sev3sev4;\n\t\t//dailyIncidents[1][z+1]=sev3sev4;\n}\nvar sev1Count=0,sev2Count=0,sev3Count=0,sev4Count=0;\n\n/*var mySunday=getLastSunday(getfulldate(new Date()));\nvar mySundaydate=getfulldate(mySunday);\ndailyIncidents[0][1]=mySundaydate;\nconsole.log(dailyIncidents);\nfor (var i=1;i<=6;i++) {\n\t//console.log(new Date(getfulldate(getfulldate(new Date()).getDate();\n\t//var ndate=new Date(new Date(mySundaydate).setDate(new Date(mySundaydate).getDate() - i)).setHours(0,0,0,0);\n\t//console.log(ndate);\n\t//console.log(new Date(new Date(new Date(getfulldate(getLastSunday(getfulldate(new Date())))).setDate(new Date(getfulldate(getLastSunday(getfulldate(new Date())))).getDate() - i)).setHours(0,0,0,0)));\n\n}*/\n/***daily data**/\n/*var dailyIncidents=[\n[\"Days\"],\n[\"Incident Count\"]\n];\nvar mySunday=getLastSunday(getfulldate(new Date()));\nvar mySundaydate=getfulldate(mySunday);\ndailyIncidents[0][1]=mySundaydate;\nfor (var i=1;i<=6;i++) {\n\tconsole.log(new Date(new Date(new Date(mySundaydate).setDate(new Date(mySundaydate).getDate() - i)).setHours(0,0,0,0)));\n\n}*/\n\n/****/\ndo{\n\tvar newlastSundaydate=new Date(lastSundaydate.setDate(lastSundaydate.getDate() - 7));\n\tvar newlastSunday=getfulldate(newlastSundaydate);\n\tincidentBurn[0][i]=newlastSunday;\n\tcategorisation[0][i]=newlastSunday;\n\tlastSundaydate=newlastSundaydate;\n\tlastSunday=newlastSunday;\n\ti++;\n} while(i<7);\n\n\nvar criticalCount=0,highCount=0,lowCount=0,incidentAgePopulate=true,checkforFirstItr=true,incidentAge1=0,incidentAge2=0,incidentAge3=0,incidentAge4=0,ProbRecordAge1=0,ProbRecordAge2=0,ProbRecordAge3=0,ProbRecordAge4=0,oneWeekCritical=0,oneWeekHigh=0,criticalIncidentObj=[],highIncidentObj=[];\n/***Find date range***/\nvar todayDate=new Date();\ntodayDate.setHours(0,0,0);\nvar day1=new Date(todayDate.setDate(todayDate.getDate() - 1)).setHours(0,0,0,0);\nvar day7=new Date(todayDate.setDate(todayDate.getDate() - 7)).setHours(0,0,0,0);\nvar day8=new Date(todayDate.setDate(todayDate.getDate() - 1)).setHours(0,0,0,0);\nvar day14=new Date(todayDate.setDate(todayDate.getDate() - 6)).setHours(0,0,0,0);\nvar day15=new Date(todayDate.setDate(todayDate.getDate() - 1)).setHours(0,0,0,0);\nvar day30=new Date(todayDate.setDate(todayDate.getDate() - 6)).setHours(0,0,0,0);\nvar today=new Date();\nvar day6=new Date(new Date().setDate(new Date().getDate()-25));\nfor (var i=1;i<incidentBurn[0].length;i++) {\n\tvar dateTo=incidentBurn[0][i];\n    var to=new Date(dateTo);\n    var newto=new Date(dateTo);\n    var dateFrom=new Date(newto.setDate(newto.getDate() - 6));\n    var category=[0,0,0,0,0,0,0,0,0,0];\n\n    var incidentCount=0,d13=0,e13=0,b13=0,c13=0,d14=0,e14=0,f3a=0,f3b=0,f4a=0,f4b=0,f5a=0,f5b=0;\n\tfor (var j=0;j<msg.incidentData.length;j++) {\n\t\tvar getDate=msg.incidentData[j][\"Reported Date+\"];\n\t    var daterange=getDate.substring(0, getDate.indexOf(' '));\n\t    var check=new Date(daterange);\n\t    var getClosedDate=msg.incidentData[j][\"Closed Date\"];\n\n\n\t    /****incident ageing****/\n\t    if (incidentAgePopulate && (msg.incidentData[j][\"Status*\"]===\"Assigned\" || msg.incidentData[j][\"Status*\"]===\"Pending\")) {\n\t\t\t\n\t\t\tif(check<=day1 && check>=day7) {\n\t\t\t\tincidentAge1++;\n\t\t\t} else if (check<=day8 && check>=day14) {\n\t\t\t\tincidentAge2++;\n\t\t\t} else if (check<=day15 && check>=day30) {\n\t\t\t\tincidentAge3++\n\t\t\t} else incidentAge4++;\n\t\t} else if (incidentAgePopulate) {\n\n\t\t\tif(check<=today && check>=day6) {\n\n\t\t\t\tif(msg.incidentData[j][\"Priority*\"]===\"Critical\") {\n\t\t\t\t\toneWeekCritical++;\n\t\t\t\t\tcriticalIncidentObj.push({\"Priority\":\"Sev1\",\"incidentId\":msg.incidentData[j][\"Incident ID*+\"],\"summary\":msg.incidentData[j][\"Summary*\"]});\n\n\t\t\t\t}\n\t\t\t\telse if (msg.incidentData[j][\"Priority*\"]===\"High\"){\n\t\t\t\t\toneWeekHigh++;\n\t\t\t\t\thighIncidentObj.push({\"Priority\":\"Sev2\",\"incidentId\":msg.incidentData[j][\"Incident ID*+\"],\"summary\":msg.incidentData[j][\"Summary*\"]});\n\t\t\t\t}\n\n\t\t\t} \n\n\t\t\tif(check >= dateFrom && check <= to ) {\n\t\t\t\tif(msg.incidentData[j][\"Priority*\"]===\"Critical\")\n\t\t\t\t{\n\t\t\t\t\tsev1Count++;\n\t\t\t\t} else if (msg.incidentData[j][\"Priority*\"]===\"High\") {\n\t\t\t\t\tsev2Count++;\n\t\t\t\t}\n\t      \t\n\t    \t}\n\n\n\t\t}\n\t\t/**/\n\n\t    if(msg.incidentData[j][\"Status*\"]===\"Assigned\" && (msg.incidentData[j][\"Priority*\"]===\"Medium\" || msg.incidentData[j][\"Priority*\"]===\"Critical\" || msg.incidentData[j][\"Priority*\"]===\"High\"))\n\t\t{\n\t\t\tf3a++;\n\t\t}\n\t\telse if(msg.incidentData[j][\"Status*\"]===\"In Progress\" && (msg.incidentData[j][\"Priority*\"]===\"Medium\" || msg.incidentData[j][\"Priority*\"]===\"Critical\" || msg.incidentData[j][\"Priority*\"]===\"High\"))\n\t\t{\n\t\t\tf4a++;\n\t\t} \n\t\telse if (msg.incidentData[j][\"Status*\"]===\"Pending\" && (msg.incidentData[j][\"Priority*\"]===\"Medium\" || msg.incidentData[j][\"Priority*\"]===\"Critical\" || msg.incidentData[j][\"Priority*\"]===\"High\"))\n\t\t{\n\t\t\tf5a++;\n\t\t} \n\n\t    if(getClosedDate!==undefined) {\n\t    \tvar ClosedDaterange=new Date(getClosedDate.substring(0, getClosedDate.indexOf(' ')));\n\t    \tif(ClosedDaterange >= dateFrom && ClosedDaterange <= to) {\n\t    \t\tif(msg.incidentData[j][\"Priority*\"]===\"Medium\")\n\t\t\t\t{\n\t\t\t\t\td14++;\n\t\t\t\t}\n    \t\t}\n\n\t    }\n\t\tif(check >= dateFrom && check <= to ) {\n\t\t\tif(msg.incidentData[j][\"Priority*\"]===\"Medium\")\n\t\t\t{\n\t\t\t\td13++;\n\t\t\t}\n\t\t\tif(msg.incidentData[j][\"Priority*\"]===\"Low\")\n\t\t\t{\n\t\t\t\te13++;\n\t\t\t}\n\t\t\tif(msg.incidentData[j][\"Priority*\"]===\"Critical\")\n\t\t\t{\n\t\t\t\tb13++;\n\t\t\t}\n\t\t\tif(msg.incidentData[j][\"Priority*\"]===\"High\")\n\t\t\t{\n\t\t\t\tc13++;\n\t\t\t}\n\n\t\t\tif(msg.incidentData[j][\"Resolution Categorization Tier 1\"]===\"Site Confidence Issues\") {\n\t\t\t\tcategory[0]++;\n\t\t\t} else if (msg.incidentData[j][\"Resolution Categorization Tier 1\"]===\"Application Error\") {\n\t\t\t\tcategory[1]++;\n\t\t\t} else if(msg.incidentData[j][\"Resolution Categorization Tier 1\"]===\"Service Request IT\") {\n\t\t\t\tcategory[2]++;\n\t\t\t} else if(msg.incidentData[j][\"Resolution Categorization Tier 1\"]===\"Service Request Business\") {\n\t\t\t\tcategory[3]++;\n\t\t\t} else if(msg.incidentData[j][\"Resolution Categorization Tier 1\"]===\"Misdirected/ Invalid call\") {\n\t\t\t\tcategory[4]++;\n\t\t\t} else if(msg.incidentData[j][\"Resolution Categorization Tier 1\"]===\"Training Issues\") {\n\t\t\t\tcategory[5]++;\n\t\t\t} else if(msg.incidentData[j][\"Resolution Categorization Tier 1\"]===\"Duplicate call\") {\n\t\t\t\tcategory[6]++;\n\t\t\t} else if(msg.incidentData[j][\"Resolution Categorization Tier 1\"]===\"Security Breach\") {\n\t\t\t\tcategory[7]++;\n\t\t\t} else if(msg.incidentData[j][\"Resolution Categorization Tier 1\"]===\"Known Error\") {\n\t\t\t\tcategory[8]++;\n\t\t\t} else if(msg.incidentData[j][\"Resolution Categorization Tier 1\"]===\"Connectivity Issue - 3rd Party\") {\n\t\t\t\tcategory[9]++;\n\t\t\t} \n        \t\n    \t}\n    \t\n\t}\n\n\tfor (var j=0;j<10;j++) {\n\t\tcategorisation[j+1][i]=category[j];\n\t}\n\tincidentAgePopulate=false;\n\tfor (var j=0;j<msg.aecomData.length;j++) {\n\t\tvar getDate=msg.aecomData[j][\"Reported Date+\"];\n\t    var daterange=getDate.substring(0, getDate.indexOf(' '));\n\t    var check=new Date(daterange);\n\t    var getClosedDate=msg.aecomData[j][\"Last Modified Date\"];\n\n\t    if(msg.aecomData[j][\"Status*\"]===\"Assigned\" && msg.aecomData[j][\"Priority*\"]===\"Low\") {\n\t    \tf3b++;\n\t    }\n\t    \n\t    else if(msg.aecomData[j][\"Status*\"]===\"In Progress\" && msg.aecomData[j][\"Priority*\"]===\"Low\") {\n\t    \tf4b++;\n\t    }\n\t    else if (msg.aecomData[j][\"Status*\"]===\"Pending\" && msg.aecomData[j][\"Priority*\"]===\"Low\") {\n\t    \tf5b++;\n\t    }\n\n\t    if(getClosedDate !==undefined) {\n\t    \tvar ClosedDaterange=new Date(getClosedDate.substring(0, getClosedDate.indexOf(' ')));\n\t    \tif(ClosedDaterange >= dateFrom && ClosedDaterange <= to) {\n\t    \t\tif(msg.aecomData[j][\"Priority*\"]===\"Low\" && (msg.aecomData[j][\"Status*\"]===\"Resolved\" || msg.incidentData[j][\"Status*\"]===\"Closed\"))\n\t\t\t\t{\n\t\t\t\t\te14++;\n\t\t\t\t}\n    \t\t}\n\t    }\n\t\tif(check >= dateFrom && check <= to ) {\n\t\t\t\n\t\t\tif(msg.aecomData[j][\"Priority*\"]===\"Low\")\n\t\t\t{\n\t\t\t\te13++;\n\t\t\t}\n       \t\n    \t}\n    \tif(checkforFirstItr) {\n\t    \tif(check >= dateFrom && check <= to ) {\n\t\t\t\tif(msg.aecomData[j][\"Priority*\"]===\"Medium\")\n\t\t\t\t{\n\t\t\t\t\tsev3Count++;\n\t\t\t\t} else if (msg.aecomData[j][\"Priority*\"]===\"Low\") {\n\t\t\t\t\tsev4Count++;\n\t\t\t\t}\n\t      \t\n\t    \t}\n\t    }\n    \t\n\t}\n\tincidentBurn[1][i]=d13+e13;\n\tincidentBurn[2][i]=d14+e14;\n\t//incidentBurn[3][i]=f3a+f3b+f4a+f4b;\n\tmsg.totalOpen=f3a+f3b+f4a+f4b+f5a+f5b;\n\tcheckforFirstItr=false;\n}\n//populating incidentAgeing \nincidentAgeing[0].push(incidentAge1,incidentAge2,incidentAge3,incidentAge4);\n\n/***populating incidentAgeingChart data***/\n  var alpha='A';\n\tfor (var i=0;i<incidentAgeing.length;i++) {\n\t\tvar charObj=\n\t\t{\n          \"id\": \"\",\n          \"label\": \"\",\n          \"type\": \"number\"\n        };\n\t    charObj.id=nextChar(alpha);\n\t    alpha=nextChar(alpha);\n\t    charObj.label=incidentAgeing[i][0];\n\t    chartObject1.data.cols.push(charObj);\n\t}\n\tvar daysCount=[\"0-7 Days\",\"8-14 Days\",\"15-30 Days\",\"30+ Days\"];\n\tfor (var j=1;j<incidentAgeing[0].length;j++){\n\t\tvar abc={\n\t\t\"c\": []\n\t\t};\n\t\tvar obj= {\n          \"v\": j-1,\n          \"f\": daysCount[j-1]\n        }\n        var obj1=\n        {\n          \"v\": incidentAgeing[0][j]\n        };\n\t\t\n\t\tabc.c.push(obj);\n\t\tabc.c.push(obj1);\n\t\tchartObject1.data.rows.push(abc);\n\t}\n/***populating incidentBurnChart data***/\n\nvar alpha='A';\n\nfor (var i=1;i<incidentBurn.length;i++) {\n\tvar charObj=\n\t{\n      \"id\": \"\",\n      \"label\": \"\",\n      \"type\": \"number\"\n    };\n    charObj.id=nextChar(alpha);\n    alpha=nextChar(alpha);\n    charObj.label=incidentBurn[i][0];\n    chartObject.data.cols.push(charObj);\n}\n\nfor (var i=1;i<incidentBurn[0].length;i++) {\n\tvar abc={\n\t\"c\": []\n\t};\n\tfor (var j=0;j<incidentBurn.length;j++){\n\t\tif(i===1 && j===0) {\n\t\t\tvar obj={\n              \"v\": 0,\n              \"f\": incidentBurn[j][i]\n            }\n\t\t} else {\n\t\t\tvar obj={\n\t\t\t\t\"v\":incidentBurn[j][i]\n\t\t\t}\n\t\t}\n\t\tabc.c.push(obj);\n\t}\n\tchartObject.data.rows.push(abc);\n}\n\n\nfor (var i=1;i<dailyIncidents[0].length;i++) {\n\tvar abc={\n\t\"c\": []\n\t};\n\t\t\tvar obj={\n              \"v\": i-1,\n              \"f\": dailyIncidents[0][i]\n            }\n\t\t\tvar obj1={\n\t\t\t\t\"v\":dailyIncidents[1][i]\n\t\t\t}\n\t\tabc.c.push(obj);\n\t\tabc.c.push(obj1);\n\n\tchartObject4.data.rows.push(abc);\n}\n/***probrecord Ageing***/\nfor (var i=0;i<msg.probRecords.length;i++) {\n    var getDate=msg.probRecords[i][\"Submit Date\"];\n    var daterange=getDate.substring(0, getDate.indexOf(' '));\n    var check=new Date(daterange);\n    /****probRecord ageing****/\n    if (msg.probRecords[i][\"Status*\"]===\"Draft\" || msg.probRecords[i][\"Status*\"]===\"Under Review\"){\n\t\tif(check<=day1 && check>=day7) {\n\t\t\tProbRecordAge1++;\n\t\t} else if (check<=day8 && check>=day14) {\n\t\t\tProbRecordAge2++;\n\t\t} else if (check<=day15 && check>=day30) {\n\t\t\tProbRecordAge3++\n\t\t} else ProbRecordAge4++;\n\t}\n\t\n}\nprobrecordAgeing[0].push(ProbRecordAge1,ProbRecordAge2,ProbRecordAge3,ProbRecordAge4);\n\nfor (var j=1;j<probrecordAgeing[0].length;j++){\n\t\tvar abc={\n\t\t\"c\": []\n\t\t};\n\t\tvar obj= {\n          \"v\": j-1,\n          \"f\": daysCount[j-1]\n        }\n        var obj1=\n        {\n          \"v\": probrecordAgeing[0][j]\n        };\n\t\t\n\t\tabc.c.push(obj);\n\t\tabc.c.push(obj1);\n\t\tchartObject3.data.rows.push(abc);\n\t}\n\n\tfor (var i=1;i<categorisation.length;i++) {\n\t\t//console.log(categorisation[i+1][0]);\n\t\tvar abc={\n\t\t\t\"c\":[]\n\t\t};\n\t\tvar obj={\n\t\t\t\"v\":i,\n\t\t\t\"f\":categorisation[i][0]\n\t\t}\n\t\tvar obj1= {\n\t\t\t\"v\":categorisation[i][1]\n\t\t};\n\t\tvar obj2={\n\t\t\t\"v\":categorisation[i][2]\n\t\t}\n\t\tabc.c.push(obj);\n\t\tabc.c.push(obj1);\n\t\tabc.c.push(obj2);\n\t\tchartObject2.data.rows.push(abc);\n\n\t}\n\tchartObject2.data.cols[1][\"label\"]=\"Current week \"+categorisation[0][1];\n\tchartObject2.data.cols[2][\"label\"]=\"week ending \"+categorisation[0][2];\n\n\tvar chartObject5={\n    \"type\": \"PieChart\",\n    \"displayed\": false,\n    \"data\": {\n      \"cols\": [\n        {\n          \"id\": \"A\",\n          \"label\": \"NEW A\",\n          \"type\": \"string\"\n        },\n        {\n          \"id\": \"B\",\n          \"label\": \"Sev1\",\n          \"type\": \"number\"\n        },\n        {\n          \"id\": \"C\",\n          \"label\": \"Sev2\",\n          \"type\": \"number\"\n        }\n      ],\n      \"rows\": [\n        {\n          \"c\": [\n            {\n              \"v\": 1,\n              \"f\": \"Sev1\"\n            },\n            {\n              \"v\": sev1Count\n            }\n          ]\n        },\n        {\n          \"c\": [\n            {\n              \"v\": 2,\n              \"f\": \"Sev2\"\n            },\n            {\n              \"v\": sev2Count\n            }\n\n          ]\n        },\n        {\n          \"c\": [\n            {\n              \"v\": 3,\n              \"f\": \"Sev3\"\n            },\n            {\n              \"v\": sev3Count\n            }\n          ]\n        },\n        {\n          \"c\": [\n            {\n              \"v\": 4,\n              \"f\": \"Sev4\"\n            },\n            {\n              \"v\": sev4Count\n            }\n          ]\n        }\n        \n        \n        \n      ]\n    },\n    \"options\": {\n      \"title\": \"Weekly Distribution\",\n      \"isStacked\": \"true\",\n      \"fill\": 20,\n      \"displayExactValues\": true,\n      //\"seriesType\": \"bars\",\n      \"width\": 600,\n      \"colors\": [\n        \"#92D050\",\n        \"#D20000\",\n        \"#E17E7C\",\n        \"#127E7C\"\n      ],\n      \"vAxis\": {\n        \"title\": \"\",\n        \"gridlines\": {\n          \"count\": 10\n        }\n      },\n      //\"orientation\": \"horizontal\",\n      \"hAxis\": {\n        \"title\": \"\"\n      }\n    },\n    \"formatters\": {}\n  }\n\t\nmsg.chartObject=JSON.stringify(chartObject);\nmsg.chartObject1=JSON.stringify(chartObject1);\nmsg.chartObject2=JSON.stringify(chartObject2);\nmsg.chartObject3=JSON.stringify(chartObject3);\nmsg.chartObject4=JSON.stringify(chartObject4);\nmsg.chartObject5=JSON.stringify(chartObject5);\ntableDatas[\"incidentBurn\"]=incidentBurn;\ntableDatas[\"incidentAgeing\"]=incidentAgeing;\ntableDatas[\"probrecordAgeing\"]=probrecordAgeing;\ntableDatas[\"categorisation\"]=categorisation;\nmsg.tableDatas= JSON.stringify(tableDatas);\nmsg.tableData=tableDatas;\nconsole.log(msg.tableData);\nmsg.summaryInfo={\n\t\"oneWeekCritical\":oneWeekCritical,\n\t\"oneWeekHigh\":oneWeekHigh,\n\t\"criticalIncident\":criticalIncidentObj,\n\t\"highIncident\":highIncidentObj\n}\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 689.9309692382812,
        "y": 434.7645845413208,
        "wires": [
            [
                "794f91b5.d3d14"
            ]
        ]
    },
    {
        "id": "4028f1b3.59341",
        "type": "http in",
        "z": "61f45e89.e9959",
        "name": "",
        "url": "/getsummary",
        "method": "get",
        "swaggerDoc": "",
        "x": 130.61553192138672,
        "y": 1162.7271728515625,
        "wires": [
            [
                "2985fe32.fb5a22"
            ]
        ]
    },
    {
        "id": "82f03b27.8c5c98",
        "type": "mongodb in",
        "z": "61f45e89.e9959",
        "mongodb": "c60cb185.3a934",
        "name": "",
        "collection": "keyDepend",
        "operation": "find",
        "x": 411.6155319213867,
        "y": 1180.7271728515625,
        "wires": [
            [
                "54a59f97.dc26a"
            ]
        ]
    },
    {
        "id": "54a59f97.dc26a",
        "type": "json",
        "z": "61f45e89.e9959",
        "name": "",
        "x": 566.6155319213867,
        "y": 1254.7271728515625,
        "wires": [
            [
                "a58c00ac.18468"
            ]
        ]
    },
    {
        "id": "a58c00ac.18468",
        "type": "function",
        "z": "61f45e89.e9959",
        "name": "",
        "func": "return msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 701.6155319213867,
        "y": 1200.7271728515625,
        "wires": [
            [
                "5df65a36.ce8eb4"
            ]
        ]
    },
    {
        "id": "2985fe32.fb5a22",
        "type": "function",
        "z": "61f45e89.e9959",
        "name": "",
        "func": "console.log(msg.payload);\nmsg.skip=0;\nmsg.limit=0;\nmsg.payload={};\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 176.61553192138672,
        "y": 1247.7271728515625,
        "wires": [
            [
                "82f03b27.8c5c98"
            ]
        ]
    },
    {
        "id": "5df65a36.ce8eb4",
        "type": "http response",
        "z": "61f45e89.e9959",
        "name": "",
        "x": 768.2354404118435,
        "y": 1301.4267328444485,
        "wires": []
    },
    {
        "id": "14195f90.4adf4",
        "type": "http request",
        "z": "73c2b0f6.41dab",
        "name": "",
        "method": "GET",
        "ret": "txt",
        "url": "http://127.0.0.1:80/getsummary",
        "tls": "",
        "x": 268.9993667602539,
        "y": 23.43434715270996,
        "wires": [
            [
                "70b37387.4cde7c"
            ]
        ]
    },
    {
        "id": "70b37387.4cde7c",
        "type": "function",
        "z": "73c2b0f6.41dab",
        "name": "",
        "func": "msg.identifier=\"summary-event\";\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 468.8478240966797,
        "y": 26.325761795043945,
        "wires": [
            [
                "ce75b255.31529"
            ]
        ]
    },
    {
        "id": "76c4f12c.d5167",
        "type": "mergepdf",
        "z": "ec253f80.0c828",
        "name": "",
        "x": 310.95738220214844,
        "y": 367.12213134765625,
        "wires": []
    },
    {
        "id": "f79b7fc5.12ddc",
        "type": "inject",
        "z": "ec253f80.0c828",
        "name": "",
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "repeat": "",
        "crontab": "",
        "once": false,
        "x": 102.96023559570312,
        "y": 385.9715881347656,
        "wires": [
            [
                "76c4f12c.d5167"
            ]
        ]
    },
    {
        "id": "a83e3838.508778",
        "type": "http in",
        "z": "73c2b0f6.41dab",
        "name": "",
        "url": "/u",
        "method": "get",
        "swaggerDoc": "",
        "x": 101.96307373046875,
        "y": 529.4119110107422,
        "wires": [
            [
                "5ca25b16.d01484"
            ]
        ]
    },
    {
        "id": "211450b6.12dea",
        "type": "http response",
        "z": "73c2b0f6.41dab",
        "name": "",
        "x": 613.9602203369141,
        "y": 522.8210048675537,
        "wires": []
    },
    {
        "id": "63384f4a.4ae5",
        "type": "function",
        "z": "73c2b0f6.41dab",
        "name": "",
        "func": "//var new2=msg.payload;\n//var globalContext = this.context().global;\n//var new1=new2.substring(new2.lastIndexOf(\"<body>\")+6,new2.lastIndexOf(\"</body>\")-7);\n//global.set(\"globaltemp1\",new1);  // this is now available to other nodes\n\n/*msg.filename=\"nu1.pdf\";\nmsg.options= {\n  \"base\": \"file:///D:/dashboard/dashboard-app/client/webcontent/\", // Base path that's used to load files (images, css, js) when they aren't referenced using a host \n}*/\n\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 840.0511169433594,
        "y": 149.41476440429688,
        "wires": [
            [
                "31f9e20a.f1497e"
            ]
        ]
    },
    {
        "id": "eb649a3b.aaf3e8",
        "type": "HTML-PDF",
        "z": "73c2b0f6.41dab",
        "name": "HTML-PDF",
        "output": "file",
        "x": 467.9545440673828,
        "y": 519.9147243499756,
        "wires": [
            [
                "211450b6.12dea"
            ]
        ]
    },
    {
        "id": "5ca25b16.d01484",
        "type": "function",
        "z": "73c2b0f6.41dab",
        "name": "",
        "func": "//console.log(globaltemp);\nvar myfoo = global.get(\"globaltemp\");\nmsg.filename=\"cc4.pdf\";\n//console.log(myfoo);\nmsg.payload=myfoo;\nmsg.options= {\n  \"base\": \"file:///D:/dashboard/dashboard-app/client/webcontent/\", // Base path that's used to load files (images, css, js) when they aren't referenced using a host \n}\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 181.95169067382812,
        "y": 483.05113792419434,
        "wires": [
            [
                "732d032e.a071dc"
            ]
        ]
    },
    {
        "id": "732d032e.a071dc",
        "type": "template",
        "z": "73c2b0f6.41dab",
        "name": "",
        "field": "payload",
        "fieldType": "msg",
        "format": "handlebars",
        "syntax": "mustache",
        "template": "<html lang=\"en\"><head><style type=\"text/css\">@charset \"UTF-8\";[ng\\:cloak],[ng-cloak],[data-ng-cloak],[x-ng-cloak],.ng-cloak,.x-ng-cloak,.ng-hide:not(.ng-hide-animate){display:none !important;}ng\\:form{display:block;}.ng-animate-shim{visibility:hidden;}.ng-anchor{position:absolute;}</style>\n    <meta charset=\"UTF-8\">\n    <title>MNS-Reporting</title>\n<link rel=\"stylesheet\" type=\"text/css\" href=\"assets/wsr-automation/css/style.css\">\n\n\n</head>\n{{{payload}}}\n</html>",
        "x": 318.9545440673828,
        "y": 509.0511074066162,
        "wires": [
            [
                "eb649a3b.aaf3e8"
            ]
        ]
    },
    {
        "id": "87278ded.cdc79",
        "type": "HTML-PDF",
        "z": "73c2b0f6.41dab",
        "name": "HTML-PDF",
        "output": "file",
        "x": 963.9544982910156,
        "y": 72.1875,
        "wires": [
            []
        ]
    },
    {
        "id": "e7d02c0.1ae84d8",
        "type": "http request",
        "z": "1cee00b4.e18b0f",
        "name": "",
        "method": "GET",
        "ret": "txt",
        "url": "http://127.0.0.1:80/getjson",
        "tls": "",
        "x": 191.0994415283203,
        "y": 139.09091186523438,
        "wires": [
            [
                "2e5ce37f.1da67c"
            ]
        ]
    },
    {
        "id": "2e5ce37f.1da67c",
        "type": "function",
        "z": "1cee00b4.e18b0f",
        "name": "",
        "func": "msg.identifier = 'all-incidents';\n//console.log(msg.identifier);\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 330.0994415283203,
        "y": 129.09091186523438,
        "wires": [
            [
                "8b8c1aec.0c5608"
            ]
        ]
    },
    {
        "id": "f1576920.15cac8",
        "type": "http request",
        "z": "1cee00b4.e18b0f",
        "name": "",
        "method": "GET",
        "ret": "txt",
        "url": "http://127.0.0.1:80/getpr",
        "tls": "",
        "x": 218.84945678710938,
        "y": 238.59091186523438,
        "wires": [
            [
                "ebf9f25.117351"
            ]
        ]
    },
    {
        "id": "ebf9f25.117351",
        "type": "function",
        "z": "1cee00b4.e18b0f",
        "name": "",
        "func": "msg.identifier=\"problem-record\";\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 287.0994110107422,
        "y": 182.09091186523438,
        "wires": [
            [
                "8b8c1aec.0c5608"
            ]
        ]
    },
    {
        "id": "8b8c1aec.0c5608",
        "type": "function",
        "z": "1cee00b4.e18b0f",
        "name": "",
        "func": "if (!context.data){\n   context.data = {\n       csvdata: {}\n   };\n} \nif(msg.identifier === \"all-incidents\"){\n    context.data.csvdata.allIncident = msg.payload;\n} else if(msg.identifier === \"aecom\") {\n    context.data.csvdata.aecomData = msg.payload;\n} else if (msg.identifier === \"calendar-event\") {\n    context.data.csvdata.calendarEvent=msg.payload;\n} else if (msg.identifier===\"summary-event\") {\n    context.data.csvdata.summaryData = msg.payload;\n \n}\nelse {\n    context.data.csvdata.probRecords = msg.payload;\n}\nif(context.data.csvdata.allIncident && context.data.csvdata.probRecords && context.data.csvdata.aecomData && context.data.csvdata.calendarEvent && context.data.csvdata.summaryData){\n    console.log(\"all-data\");\n     msg.payload = context.data;\n     context.data = null;\n     msg.incidentData=JSON.parse(msg.payload.csvdata.allIncident);\n     msg.probRecords=JSON.parse(msg.payload.csvdata.probRecords);\n    msg.aecomData=JSON.parse(msg.payload.csvdata.aecomData);\n    msg.calendarEvents=msg.payload.csvdata.calendarEvent;\nmsg.summaryData=JSON.parse(msg.payload.csvdata.summaryData);\n//console.log(msg.summaryData);\nreturn [msg,msg];\n/*if (msg.req.url===\"/wsr\"){\n    return [msg,null];\n} else {\n    return [null,msg];\n} */\n //   return msg;\n}",
        "outputs": "2",
        "noerr": 0,
        "x": 412.34938049316406,
        "y": 216.09091186523438,
        "wires": [
            [
                "fb5cb507.dffb08"
            ],
            [
                "c6558f76.03c1a"
            ]
        ]
    },
    {
        "id": "fb5cb507.dffb08",
        "type": "function",
        "z": "1cee00b4.e18b0f",
        "name": "",
        "func": "var tableDatas={};\nvar incidentDataJson=[\n    [\"Weekly Report (MM/DD/YYYY)\"],\n    //[\"Overall\",\"Green\",\"Green\",\"Green\",\"Green\",\"Green\",\"Green\"],\n    [\"Incidents\"],\n    [\"Problem Records\"]\n];\nvar slaViewData= [\n  [\"Sev1\",\"4hours\",,,0],\n  [\"Sev2\",\"8hours\",,,0],\n  [\"Sev3/4\",\"NA\",,\"NA\",\"NA\"]\n];\nvar incidentSummary = {};\nvar dateArray=[],currentWeekSummary=[],lastWeekSummary=[],finalWeekArray=[];\n\nfunction getfulldate(today) { //returns date in mm/dd/yyyy format\n  var currentDate=today.getDate(),\n    currentMonth=today.getMonth()+1;\n  var x=(currentMonth<10)?('0'+currentMonth):currentMonth;\n  var y=(currentDate<10)?('0'+currentDate):currentDate;\n  return (x+'/'+y+'/'+today.getFullYear());\n}\nfunction getLastSunday(d) { //returns last sunday date takes input as mm/dd/yyyy\n    var t = new Date(d);\n    t.setDate(t.getDate() - t.getDay());\n    return t;\n}\nfunction getDateStamp(dateStamp) {\n  var monthName=[\"Jan\", \"Feb\", \"Mar\", \"Apr\", \"May\", \"June\",\"July\", \"Aug\", \"Sept\", \"Oct\", \"Nov\", \"Dec\"];\n  var newDate= new Date(dateStamp);\n  return newDate.getDate()+\"-\"+monthName[newDate.getMonth()]+\"-\"+newDate.getFullYear();\n}\n\nvar lastSundaydate=getLastSunday(getfulldate(new Date()));\ntableDatas[\"date\"]=getDateStamp(lastSundaydate);\nvar lastSunday=getfulldate(lastSundaydate);\nvar i=2;\ndateArray[i-1]=lastSunday;\nincidentDataJson[0][i-1]=getDateStamp(new Date(lastSunday));\ndo{\n  var newlastSundaydate=new Date(lastSundaydate.setDate(lastSundaydate.getDate() - 7));\n  var newlastSunday=getfulldate(newlastSundaydate);\n  dateArray[i]=newlastSunday;\n  incidentDataJson[0][i]=getDateStamp(new Date(newlastSunday));\n  //incidentDataJson[0][i]=newlastSunday;\n  lastSundaydate=newlastSundaydate;\n  lastSunday=newlastSunday;\n  i++;\n} while(i<7);\n\n\n/***incident Count ***/\nvar firstEl=true,criticalCount=0,highCount=0,lowCount=0,totalIncidentCount=0,activeIncident=0;\n\nfor (var i=1;i<incidentDataJson[0].length;i++) {\nvar dateTo=dateArray[i];\n  //var dateTo=incidentDataJson[0][i];\n    var to=new Date(dateTo);\n    var newto=new Date(dateTo);\n    var dateFrom=new Date(newto.setDate(newto.getDate() - 6));\n    var incidentCount=0;\n  for (var j=0;j<msg.incidentData.length;j++) {\n    var getDate=msg.incidentData[j][\"Reported Date+\"];\n    //console.log(getDate);\n      var daterange=getDate.substring(0, getDate.indexOf(' '));\n      var check=new Date(daterange);\n      if(firstEl && (msg.incidentData[j][\"Priority*\"]===\"Medium\" || msg.incidentData[j][\"Priority*\"]===\"Critical\" || msg.incidentData[j][\"Priority*\"]===\"High\")) {\n        totalIncidentCount++;\n          if(msg.incidentData[j][\"Status*\"]===\"Assigned\" || msg.incidentData[j][\"Status*\"]===\"Pending\") {\n        activeIncident++;\n      }\n    }\n    if(check >= dateFrom && check <= to ) {\n          incidentCount++;\n          if(msg.incidentData[j][\"Priority*\"]===\"Critical\" && firstEl) {\n            criticalCount++;\n          }\n          if(msg.incidentData[j][\"Priority*\"]===\"High\" && firstEl) {\n            highCount++;\n          }\n          if((msg.incidentData[j][\"Priority*\"]===\"Medium\" || msg.incidentData[j][\"Priority*\"]===\"Low\") && firstEl) {\n            lowCount++;\n          }\n\n\n      }\n  }\n  firstEl=false;\n  incidentDataJson[1][i]=incidentCount;\n}\n\n\n/***problem Count ***/\nvar problemArrayDraft=[],problemArrayReview=[];\n  for (var i=1;i<incidentDataJson[0].length;i++) {\n    var dateTo=dateArray[i];\n  //var dateTo=incidentDataJson[0][i];\n        var to=new Date(dateTo);\n        var newto=new Date(dateTo);\n        var dateFrom=new Date(newto.setDate(newto.getDate() - 6));\n        var problemCount=0;\n    for (var j=0;j<msg.probRecords.length;j++) {\n      var getDate=msg.probRecords[j][\"Submit Date\"];\n        var daterange=getDate.substring(0, getDate.indexOf(' '));\n        var check=new Date(daterange);\n      if(check >= dateFrom && check <= to && msg.probRecords[j][\"Status*\"]===\"Draft\" ) {\n              problemCount++;\n          }\n          if(i===1) {\n             if(check >= dateFrom && check <= to && msg.probRecords[j][\"Status*\"]===\"Draft\" ) {\n                 var oneDay = 24*60*60*1000;\n                 var dayy1=new Date(new Date().setHours(0,0,0,0));\n                 var diffDays = Math.round(Math.abs((dayy1.getTime() - check.getTime())/(oneDay)));\n                    msg.probRecords[j][\"ageings\"]=diffDays;\n                    var gDate=msg.probRecords[j][\"Submit Date\"];\n                    msg.probRecords[j][\"Submit Date\"]=gDate.substring(0, gDate.indexOf(' '));\n                  problemArrayDraft.push(msg.probRecords[j]);\n              } \n              if(check >= dateFrom && check <= to && msg.probRecords[j][\"Status*\"]===\"Under Review\" ) {\n                  var oneDay = 24*60*60*1000;\n                 var dayy1=new Date(new Date().setHours(0,0,0,0));\n                 var diffDays = Math.round(Math.abs((dayy1.getTime() - check.getTime())/(oneDay)));\n                    msg.probRecords[j][\"ageings\"]=diffDays;\n                    var gDate=msg.probRecords[j][\"Submit Date\"];\n                    msg.probRecords[j][\"Submit Date\"]=gDate.substring(0, gDate.indexOf(' '));\n                  problemArrayReview.push(msg.probRecords[j]);\n              }\n          }\n    }\n    incidentDataJson[2][i]=problemCount;\n  }\n\n\n  /***total incident count****/\n    for (var j=0;j<msg.aecomData.length;j++) {\n      if(msg.aecomData[j][\"Priority*\"]===\"Low\") {\n        totalIncidentCount++;\n        if(msg.aecomData[j][\"Status*\"]===\"Assigned\" || msg.aecomData[j][\"Status*\"]===\"Pending\") {\n          activeIncident++;\n        }\n      }\n\n    }\n\n\nslaViewData[0][2]=criticalCount;\nslaViewData[0][3]=criticalCount;\nslaViewData[1][2]=highCount;\nslaViewData[1][3]=highCount;\nslaViewData[2][2]=lowCount;\nincidentSummary[\"Total Incidents\"]=totalIncidentCount;\nincidentSummary[\"Active Incidents\"]=activeIncident;\nincidentSummary[\"Non-Active Incidents\"]=totalIncidentCount-activeIncident;\ntableDatas[\"incidentData\"]=incidentDataJson;\ntableDatas[\"slaView\"]=slaViewData;\ntableDatas[\"incidentSummary\"]=incidentSummary;\n\nmsg.tableDatas= JSON.stringify(tableDatas);\nmsg.tableData=tableDatas;\nvar lastSun=getLastSunday(new Date());\nvar lastSun1=new Date(lastSun);\nvar lastSun2=new Date(lastSun1);\nvar lastSun3=new Date(lastSun1);\nvar nextWeek=new Date(lastSun2.setDate(lastSun2.getDate() + 7));\nvar lastWeek=new Date(lastSun3.setDate(lastSun3.getDate() - 10)); \n  var eventArray=[],lasteventArray=[];\n\nfor (var i=0;i<msg.calendarEvents.length;i++) {\n    //console.log(msg.calendarEvents[i].start.dateTime);\n   var imDate=Date.parse(msg.calendarEvents[i].start.dateTime);\n  var calendarDate=new Date(imDate);\n  if(calendarDate>lastSun1 && calendarDate<=nextWeek ) {\n      //console.log(msg.calendarEvents[i].summary)\n      eventArray.push({\"summary\":msg.calendarEvents[i].summary});\n  }\n  if(calendarDate<=lastSun1 && calendarDate>=lastWeek ) {\n     lasteventArray.push({\"summary\":msg.calendarEvents[i].summary});\n\n  }\n  \n \n}\nvar lastSun=getLastSunday(new Date());\nmsg.eventList=eventArray;\nmsg.lastEventList=lasteventArray;\nmsg.problemArrayDraft=problemArrayDraft;\nmsg.problemArrayReview=problemArrayReview;\n\n/***Summary**/\nfunction lw(nameval) {\n  for (var i=0;i<lastWeekSummary.length;i++) {\n    if(lastWeekSummary[i][\"name\"]===nameval && lastWeekSummary[i][\"value\"]!==\"\") {\n      return lastWeekSummary[i];\n    } else {\n        var defaultObj= {\n          \"name\":nameval,\n          \"value\": \"NA\"\n        };\n        return defaultObj;\n    }\n  }\n}\nfor (var i=0;i<msg.summaryData.length;i++)\n{\n    var summarydate=msg.summaryData[i][\"date\"];\n    if(new Date(summarydate).getTime()==new Date(dateArray[1]).getTime()){\n        currentWeekSummary.push(msg.summaryData[i]);\n    } else if (new Date(summarydate).getTime()==new Date(dateArray[2]).getTime()){\n        lastWeekSummary.push(msg.summaryData[i]);\n    }\n}\nconsole.log(\"currentWeek\",currentWeekSummary);\nconsole.log(\"lastWeek\",lastWeekSummary);\nfor (var i=0;i<currentWeekSummary.length;i++) {\n  if(currentWeekSummary[i][\"value\"]!==\"\") {\n    if (currentWeekSummary[i][\"name\"]===\"keyRisk\") {\n      msg.keyrisk=currentWeekSummary[i];\n    } else if (currentWeekSummary[i][\"name\"]===\"accomp\") {\n      msg.accomp=currentWeekSummary[i];\n    }\n    finalWeekArray.push(currentWeekSummary[i]);\n  } else {\n      var lastWeekObj=lw(currentWeekSummary[i][\"name\"]);\n      if (lastWeekObj[\"name\"]===\"keyRisk\") {\n        msg.keyrisk=lastWeekObj;\n      } else if (lastWeekObj[\"name\"]===\"accomp\") {\n        msg.accomp=lastWeekObj;\n      }\n      finalWeekArray.push(lastWeekObj);\n  }\n\n} \nconsole.log(\"finalWeekArray\",finalWeekArray);\nconsole.log(\"keyrisk\",msg.keyrisk);\nconsole.log(\"accomp\",msg.accomp);\n//msg.currentWeekSummary=currentWeekSummary;\n//msg.lastWeekSummary=lastWeekSummary;\nmsg.finalWeekArray=finalWeekArray;\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 488.4883270263672,
        "y": 120.75757598876953,
        "wires": [
            [
                "fae4e2e1.71e46"
            ]
        ]
    },
    {
        "id": "fae4e2e1.71e46",
        "type": "template",
        "z": "1cee00b4.e18b0f",
        "name": "",
        "field": "payload",
        "fieldType": "msg",
        "format": "handlebars",
        "syntax": "mustache",
        "template": "<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n    <meta charset=\"UTF-8\">\n    <title>MNS-Reporting</title>\n    <link rel=\"stylesheet\" type=\"text/css\" href=\"assets/wsr-automation/css/style.css\">\n    <!--<script src=\"https://ajax.googleapis.com/ajax/libs/jquery/1.12.0/jquery.min.js\"></script>-->\n    <!--<script src=\"http://ajax.googleapis.com/ajax/libs/angularjs/1.4.8/angular.min.js\"></script>-->\n    <script src=\"assets/wsr-automation/js/angular.min.js\"></script>\n    <script src=\"assets/wsr-automation/js/jquery-3.1.1.js\"></script>\n</head>\n<body>\n    <main class=\"container\" ng-app=\"weeklyReports\" ng-controller=\"reportsCtrl\">\n        <script type=\"text/ng-template\" id=\"incidentDataTable.html\">\n            <tr ng-repeat=\"data in dataFromTable\">\n                <td ng-repeat=\"values in data track by $index\" ng-class=\"values\" ng-bind=\"values\"></td>\n            </tr>\n        </script>\n        <script type=\"text/ng-template\" id=\"slaViewTable.html\">\n            <tr>\n                <td>Incident</td><td>SLA</td><td>Reported</td><td>Acheived</td><td>Breached</td>\n            </tr>\n            <tr ng-repeat=\"data in dataFromTable\">\n                <td ng-repeat=\"values in data track by $index\" ng-bind=\"values\"></td>\n            </tr>\n        </script>\n        <script type=\"text/ng-template\" id=\"incidentSumTable.html\">\n            <tr>\n                <td ng-repeat=\"(key,value) in dataFromTable\" ng-bind=\"key\"></td>\n            </tr>\n            <tr>\n                <td ng-repeat=\"data in dataFromTable\" ng-bind=\"data\"></td>\n            </tr>\n        </script>\n         \n        <div class=\"clearfix\">\n            <img src=\"assets/wsr-automation/images/mns-logo.jpg\" alt=\"Marks and Spencer logo\" id=\"mnsLogo\">\n            <img src=\"assets/wsr-automation/images/sapient-nitro.png\" alt=\"SapientNitro logo\" id=\"sapientLogo\">\n        </div>\n        <div class=\"clearfix\">\n            <img src=\"assets/wsr-automation/images/print-icon.png\" alt=\"Print Logo\" id=\"printLogo\" ng-click=\"printOption()\">\n        </div>\n\n        <section class=\"clearfix\">\n            <h1>\n                M&S eCom Support Weekly Status Report - Week Ending  {{tableData.date}}\n            </h1>\n            <table id=\"incidents\">\n                <caption>Incidents originating in Week ending {{tableData.date}}</caption>\n                <tbody id=\"incidentDataTable\" table-dir dataparam=tableDatas.incidentData></tbody>\n            </table>\n            <table id=\"slaView\">\n                <caption>SLA View for Week ending {{tableData.date}}</caption>\n                <tbody id=\"slaViewTable\" table-dir dataparam=\"tableDatas.slaView\"></tbody>\n            </table>\n            <table id=\"incidentSummary\" style=\"clear: both;\">\n                <caption>Incident Summary till {{tableData.date}}</caption>\n                <tbody id=\"incidentSumTable\" table-dir dataparam=\"tableDatas.incidentSummary\"></tbody>\n            </table>\n        </section>\n\n        <section>\n            <!--<h1>\n                M&S eCom Support Weekly Status Report - Week Ending  {{tableData.date}}\n            </h1>-->\n            <div id=\"keyUpdates\" class=\"sections\">\n                <div class=\"header-div\">\n                    <span class=\"edit-button\"></span>\n                    <h2 class=\"headlines\">Key updates</h2>\n                </div>\n\n                <div id=\"myArea1\" class=\"edit-div\">\n                    <div>\n                        <h3>Progress Last Week RAYG : GREEN</h3>\n                        <ul>\n                            <li>Total <span>69</span> incidents were raised in last week. Pending triage incidents are currently <span>29</span>.</li>\n                            <li>1 Sev 2's were raised last week.\n                                <ul>\n                                    <li>Sev 2 | INC000021527174 | EMAIL-PROBE (Site Confidence Alert:Script Step[28065111]) - Site Confidence Alert Script Step - Site Confidence Journey was failing</li>\n                                </ul>\n                            </li>\n                        </ul>\n                        <h3>Business Events</h3>\n                        <ul>\n                            <li>NA</li>\n                        </ul>\n                        \n                        <!--<ul>\n                            <li><span>2</span> Open (0 Draft ,2 Pending, 0 Under Review)</li>\n                        </ul>-->\n                        \n                        <!--<ul>\n                            <li>PROD | B&C | THROTTLE | Moving Mobile/App to -6 and Basket change <span>21st Mar</span></li>\n                            <li>PROD | Throttling to 100% New Basket for CS and Stores <span>23rd Mar</span></li>\n                            <li>PROD | CM-182 | SPARKS - FE change for Sparks FAQs link <span>24th Mar</span></li>\n                            <li>PROD | CM-183 | Whitelisting Omniture rest API Url for Prod Servers <span>24th Mar</span></li>\n                            <li>PROD | Timezone change to BST <span>27th Mar</span></li>\n                            <li>SIT3 | R26 Deployment <span>21st Mar</span></li>\n                            <li>SIT3/B | Apply RHEL Patch <span>23rd Mar</span></li>\n                        </ul>-->\n                    </div>\n                </div>\n                <div class=\"noneditable-container\" style=\"border-top:solid 1px black;padding-left:4px;\">\n\n                        <h3>Problem Record</h3>\n                        <table>\n\n                            {{#problemArrayDraft.length}}\n\n                                        <tr>\n                                            <td>Problem ID</td>\n                                            <td>Summary</th>\n                                            <td>Assignee</td>\n                                            <td>Status</td>\n                                            <td>Ageing</td>\n                                            <td>Open Date</td>\n\n                                        </tr>\n                            {{/problemArrayDraft.length}}\n                            {{#problemArrayDraft}}\n                                <tr> \n                                    <td>{{Problem ID*+}}</td>\n                                    <td>{{Summary*}}</td>\n                                    <td>{{Assignee+}}</td>\n                                    <td>{{Status*}}</td>\n                                    <td>{{ageings}}</td>\n                                    <td>{{Submit Date}}</td>\n\n                                </tr>\n                            {{/problemArrayDraft}}\n                        </table>\n\n                        \n                        <h3>Environments</h3>\n                        <ul>\n                            {{#lastEventList}}\n                            <li>\n                                {{summary}}\n                            </li>\n                            {{/lastEventList}}\n                        </ul>\n                </div>\n            </div>\n            <div id=\"nextWeekPlan\" class=\"sections\" >\n                <div class=\"header-div\">\n                    <span class=\"edit-button\"></span>\n                    <h2 class=\"headlines\"> Plan for next week</h2>\n                </div>\n\n                <div id=\"nextWeek\" class=\"edit-div\" >\n                    <h3>Business Events</h3>\n                    <ul>\n                        <li>NA</li>\n                    </ul>\n                        \n                    <!--<ul>\n                        <li>PROD | RHEL Patching DR <span>28th Mar</span></li>\n                        <li>PROD | Bing SIte Authorisation Update in AKAMAI <span>29th Mar</span></li>\n                        <li>PROD | RHEL Patching BURST <span>29th Mar</span></li>\n                        <li>PROD | R26 Deployment <span>30th Mar</span></li>\n                        <li>DR | QA3 | R26 Deployment <span>31st Mar</span></li>\n                    </ul>-->\n                </div>\n                <div class=\"noneditable-container\" style=\"border-top:solid 1px black;padding-left:4px;\">\n                    <h3>Environments</h3>\n                        <ul>\n                            {{#eventList}}\n                            <li>\n                                {{summary}}\n                            </li>\n                            {{/eventList}}\n                        </ul>\n                </div>\n            </div>\n            <div id=\"risksIssues\" class=\"sections\">\n                <div class=\"header-div\">\n                    <span class=\"edit-button\"></span>\n                    <h2 class=\"headlines\">Key risks/issues</h2>\n                </div>\n<pre><div class=\"edit_area\" id=\"keyRisk\" style=\"min-height:50px\">{{#keyrisk}}{{{value}}}{{/keyrisk}}</div></pre>\n                <!--<div id=\"risk\" class=\"edit-div\">\n                    <ul>\n                        <!--<li>Single Prod/ non-Prod account for Bing request. There is threshhold of 50 requested in 24 hrs</li>\n                        <li>Stageprop session killed twice</li>-->\n                       <!-- <li>NA</li>\n                    </ul>\n                </div>-->\n            </div>\n            <div id=\"accomplishments\" class=\"sections\">\n                <div class=\"header-div\">\n                    <span class=\"edit-button\"></span>\n                    <h2 class=\"headlines\">Accomplishments</h2>\n                </div>\n               <pre><div class=\"edit_area\" id=\"accomp\" style=\"min-height:50px\">{{#accomp}}{{{value}}}{{/accomp}}</div></pre>\n               <!-- <div id=\"accomp\" class=\"edit-div\">\n                    <ul>\n                        <!--<li>Timezone changed from GMT to BST has been successfully completed on 27th March.</li>-->\n\n                <!--    </ul>\n                </div>-->\n\n            </div>\n            <!--<div id=\"keyDependencies\" class=\"sections\">\n                <div class=\"header-div\">\n                    <span class=\"edit-button\"></span>\n                    <h2 class=\"headlines\">Key dependencies</h2>\n                </div>\n                    <div class=\"edit_area\" id=\"keydep\" style=\"min-height:50px\">\n                    \n                    </div>\n \n            </div>-->\n            <!--<div id=\"keyDependencies\" class=\"sections\">\n                <div class=\"header-div\">\n                    <span class=\"edit-button\"></span>\n                    <h2 class=\"headlines\">Key dependencies</h2>\n                </div>\n                <div id=\"keyDepend\" class=\"edit-div\">\n                    <ul>\n                                            <li>NA</li>\n\n                    </ul>\n                </div>\n            </div>-->\n            \n            <!--<div class=\"edit\" id=\"div_1\">Dolor</div>\n                <div class=\"edit_area\" id=\"div_2\">Lorem ipsum dolor sit amet, consectetuer\n                adipiscing elit, sed diam nonummy nibh euismod tincidunt ut laoreet dolore\n                magna aliquam erat volutpat.\n                </div>-->\n        </section>\n    </main>\n\n    <script src=\"assets/wsr-automation/js/app.js\"></script>\n    <script src=\"assets/wsr-automation/js/executiveSummary/newcontroller.js\"></script>\n    <script src=\"assets/wsr-automation/js/common/createTable.directive.js\"></script>\n    <!--<script src='http://js.nicedit.com/nicEdit-latest.js'></script>-->\n    <script src='assets/wsr-automation/js/common/jqueryeditable.js'></script>\n<style>\n    .edit_area textarea {\n        padding:1px;\n    }\n    .edit_area {\n        padding:1px;\n    }\n</style>\n<script type=\"text/javascript\">\nvar tableDatas={{{tableDatas}}};\nvar dateDisplay=tableDatas.date;\n//var accompl=accomp.value;\n\n$(document).ready(function() {\n    //$(\"#accomplishments .edit_area\").html(accompl);\n     $('.edit').editable('http://www.example.com/save.php', {\n         indicator : 'Saving...',\n         tooltip   : 'Click to edit...'\n     });\n     /*$('.edit_area').editable('http://www.example.com/save.php', {\n         type      : 'textarea',\n         cancel    : 'Cancel',\n         submit    : 'OK',\n         indicator : '<img src=\"assets/images/edit-button.png\">',\n         tooltip   : 'Click to edit...'\n     });*/\n\n     $('.edit_area').editable(function(value, settings) {\n       // console.log(tableDatas);\n       var idName=$(this).attr(\"id\");\n       //value=value.trim();\n         //console.log(value);\n        // console.log(settings);\n                   //  data     : {\"date\":new Date(dateDisplay),idName:value},\n            var postData= {\n                \"date\":new Date(dateDisplay),\n                \"name\":idName,\n                \"value\":value\n            }\n            //postData[idName]=value;\n            //postData[\"name\"]=idName;\n         $.ajax({\n            type     : \"POST\",\n            cache    : false,\n            url      : \"http://localhost/writeSummary\",\n            data     : postData,\n            success  : function(data) {\n               // $(\".printArea\").empty().append(data).css('visibility','visible');\n               console.log(\"success\");\n              // console.log(value);\n               \n            }\n        });//ajax\n         return(value);\n      }, {\n         type    : 'textarea',\n         submit  : 'OK',\n        cancel    : 'Cancel'\n\n     });\n });\n</script>\n</body>\n\n</html>\n\n\n\n",
        "x": 539.2383270263672,
        "y": 175.53536987304688,
        "wires": [
            [
                "53396eb8.267f"
            ]
        ]
    },
    {
        "id": "7f83fb05.4e5444",
        "type": "template",
        "z": "1cee00b4.e18b0f",
        "name": "",
        "field": "payload",
        "fieldType": "msg",
        "format": "handlebars",
        "syntax": "mustache",
        "template": "<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n    <meta charset=\"UTF-8\">\n    <title>MNS-Reporting</title>\n    <link rel=\"stylesheet\" type=\"text/css\" href=\"assets/wsr-automation/css/style.css\">\n    <script src=\"https://ajax.googleapis.com/ajax/libs/jquery/1.12.0/jquery.min.js\"></script>\n    <script src=\"http://ajax.googleapis.com/ajax/libs/angularjs/1.4.8/angular.min.js\"></script>\n    <script src=\"assets/wsr-automation/js/app.js\"></script>\n    <script src=\"assets/wsr-automation/js/ng-google-chart.min.js\"></script>\n    <script src=\"assets/wsr-automation/js/trends/newtrendscontroller.js\"></script>\n    <script src=\"assets/wsr-automation/js/common/createTable.directive.js\"></script>\n        <script src='http://js.nicedit.com/nicEdit-latest.js'></script>\n\n<script type=\"text/javascript\">\nvar chartObject={{{chartObject}}};\nvar chartObject1={{{chartObject1}}};\nvar chartObject2={{{chartObject2}}};\nvar chartObject3={{{chartObject3}}};\nvar chartObject4={{{chartObject4}}}\nvar chartObject5={{{chartObject5}}};\n\nvar tableDatas={{{tableDatas}}};\nvar dateDisplay=tableDatas.date;\n\n</script>\n</head>\n<body>\n    <main class=\"container\" ng-app=\"trendsReport\" ng-controller=\"trendsCtrl\">\n        <script type=\"text/ng-template\" id=\"incidentBurnTable.html\">\n            <tr ng-repeat=\"data in dataFromTable\">\n                <td ng-repeat=\"values in data track by $index\" ng-class=\"values\" ng-bind=\"values\"></td>\n            </tr>\n        </script>\n        <script type=\"text/ng-template\" id=\"incidentAgeTable.html\">\n            <tr>\n                <td>Ageing</td><td>0-7 Days</td><td>8-14 Days</td><td>15-30 Days</td><td>30+ Days</td>\n            </tr>\n            <tr ng-repeat=\"data in dataFromTable\">\n                <td ng-repeat=\"values in data track by $index\" ng-bind=\"values\"></td>\n            </tr>\n        </script>\n        <script type=\"text/ng-template\" id=\"incidentSumTable.html\">\n            <tr>\n                <td ng-repeat=\"(key,value) in dataFromTable\" ng-bind=\"key\"></td>\n            </tr>\n            <tr>\n                <td ng-repeat=\"data in dataFromTable\" ng-bind=\"data\"></td>\n            </tr>\n        </script>\n        <script type=\"text/ng-template\" id=\"categorizationTable.html\">\n            <!--<tr>\n                <td>Categorization</td><td>Current Week</td><td>Week ending 20th Mar</td><td>Week ending 6th Mar</td><td>Week ending 28th Feb</td>\n            </tr>-->\n            <tr ng-repeat=\"data in dataFromTable\">\n                <td ng-repeat=\"values in data track by $index\" ng-class=\"values\" ng-bind=\"values\"></td>\n            </tr>\n        </script>\n        <script type=\"text/ng-template\" id=\"weeklyAgeingTable.html\">\n            <tr>\n                <td>Ageing</td><td>0-7 Days</td><td>8-14 Days</td><td>15-30 Days</td><td>30+ Days</td>\n            </tr>\n            <tr ng-repeat=\"data in dataFromTable\">\n                <td ng-repeat=\"values in data track by $index\" ng-class=\"values\" ng-bind=\"values\"></td>\n            </tr>\n        </script>\n        <script type=\"text/ng-template\" id=\"releaseAlignmentTable.html\">\n            <tr>\n                <td>Row Labels</td><td>Not Aligned</td><td>Release 26</td><td>Grand Total</td>\n            </tr>\n            <tr ng-repeat=\"data in dataFromTable\">\n                <td ng-repeat=\"values in data track by $index\" ng-class=\"values\" ng-bind=\"values\"></td>\n            </tr>\n        </script>\n        <div class=\"clearfix\">\n            <img src=\"assets/wsr-automation/images/mns-logo.jpg\" alt=\"Marks and Spencer logo\" id=\"mnsLogo\">\n            <img src=\"assets/wsr-automation/images/sapient-nitro.png\" alt=\"SapientNitro logo\" id=\"sapientLogo\">\n        </div>\n        <div class=\"clearfix\">\n            <img src=\"assets/wsr-automation/images/print-icon.png\" alt=\"Print Logo\" id=\"printLogo\" ng-click=\"printOption()\">\n        </div>\n\n        <section class=\"clearfix\">\n            <table id=\"incidentBurnRate\" style=\"width:52%\">\n                <caption>Overall Incident Burn Rate - Weekly View  (Sev3&4)  </caption>\n                <tbody id=\"incidentBurnTable\" table-dir dataparam=\"tableDatas.incidentBurn\"></tbody>\n                <!--<tfoot>\n                    <tr>\n                      <td>Total Open</td>\n                      <td>{{totalOpen}}</td>\n                    </tr>\n                 </tfoot>-->\n            </table>\n            <table id=\"incidentAgeing\">\n                <caption>Overall Incident Ageing for Sev3 & 4</caption>\n                <tbody id=\"incidentAgeTable\" table-dir dataparam=\"tableDatas.incidentAgeing\"></tbody>\n            </table>\n        </section>\n                <section class=\"clearfix\" style=\"float:left;width:100%;margin-top:1%;\">\n            <section class=\"left-chart\">\n                <h4>Overall Incident Burn Rate</h4>\n                <div id=\"chartDiv\" class=\"chart-width\" google-chart chart=\"chartObject\" style=\"{{chart.cssStyle}}\"/>\n            </section>\n            <section class=\"right-chart\">\n                <h4>Overall Incident Ageing</h4>\n    \n                <div id=\"IncidentAgeChart\" class=\"chart-width\" google-chart chart=\"chartObject1\" style=\"{{chart.cssStyle}}\"/>\n    \n            </section>\n        </section>\n\n        <section class=\"clearfix\">\n            <div class=\"panel-message left-panel\" style=\"width: 52%;\">\n                {{#summaryInfo}}\n                    <p>{{oneWeekCritical}} Sev 1 was raised last week</p>\n                    <p>{{oneWeekHigh}} Sev 2 was raised last week</p>\n                    {{#criticalIncident}}\n                    <p>-{{Priority}} | {{incidentId}} | {{summary}}</p>\n                    {{/criticalIncident}}\n                    {{#highIncident}}\n                    <p>-{{Priority}} | {{incidentId}} | {{summary}}</p>\n                    {{/highIncident}}\n                {{/summaryInfo}}\n            </div>\n            <div class=\"panel-message right-panel \">\n            <div class=\"header-div\">\n                    <span class=\"edit-button\"></span>\n                    <h2 class=\"headlines\">Summary</h2>\n            </div>\n            <div id=\"editPanel1\" class=\"edit-div\">\n               <!-- <p>- Incident ageing  has been  under control</p>\n                <p>- Incident older than 15 days</p>\n                <p>- INC000019293754 -There is a spike in the 500 error for the command /ordercalculate. There are about 68 customer sessions until now out of which 66 customers have abandoned their basket</p>\n                <p>- INC000018829506 | Sev3 | Increase in count of 404  after R24</p>-->\n            </div>\n            </div>\n        </section>\n        <section class=\"clearfix\" style=\"clear:both\">\n            <table id=\"categorization\">\n                <caption>Categorization of Incidents - Weekly View  </caption>\n                <tbody id=\"categorizationTable\" table-dir dataparam=\"tableDatas.categorisation\"></tbody>\n            </table>\n            <section class=\"right-chart\"> \n                <!--<h4>Categorization of Incidents</h4>-->\n                <div id=\"CategorizationChart\" class=\"chart-width\" google-chart chart=\"chartObject2\" style=\"{{chart.cssStyle}}\"/>\n            </section>\n        </section>\n        <!--<section class=\"clearfix\">\n            <div class=\"panel-message left-panel\">\n                <p>71  Incidents closeds</p>\n                <p>- 12 Connectivity Issue 3rd Party - Site Confidence</p>\n                <p>- 12 Misdirected/ Invalid call</p>\n                <p>- 12 Known Error</p>\n                <p>- 11 Duplicate calls</p>\n            </div>\n        </section>-->\n        <section class=\"clearfix\" style=\"width: 100%;float:left;margin-top: 3%;\">\n            <table id=\"weeklyAge\" style=\"margin-top:5%;width:52%;\">\n                <caption>Overall Problem Record Ageing - Weekly View  </caption>\n                <tbody id=\"weeklyAgeingTable\" table-dir dataparam=\"tableDatas.probrecordAgeing\"></tbody>\n            </table>\n            <!--<table id=\"releaseAlignment\">\n                <caption>Incidents - Release Alignment : as per JIRA  </caption>\n                <tbody id=\"releaseAlignmentTable\" table-dir dataparam=\"\"></tbody>\n            </table>-->\n            <section class=\"left-chart\" style=\"width: 43%;float: right;\">\n            <h4>Overall Problem Record Ageing</h4>\n            <div id=\"weeklyAgeingChart\" class=\"chart-width\" google-chart chart=\"chartObject3\" style=\"{{chart.cssStyle}}\"/>\n        </section>\n        </section>\n        <section class=\"clearfix\" style=\"float: left;width: 100%;margin-top: 5%;\">\n\n        <section class=\"right-chart\">\n            <h4>Daily Incidents Count</h4>\n            <div id=\"releaseAlignChart\" class=\"chart-width\" google-chart chart=\"chartObject4\" style=\"{{chart.cssStyle}}\"/>\n        </section>\n        <section class=\"left-chart\" style=\"width:50%\">\n            <h4>Weekly Incidents Distribution</h4>\n\n            <div id=\"weeklyAgeingChart1\" class=\"chart-width\" google-chart chart=\"chartObject5\" style=\"{{chart.cssStyle}}\"/>\n        </section>\n        </section>\n        <!--<section class=\"right-chart\">\n            <div id=\"releaseAlignChart2\" class=\"chart-width\" google-chart chart=\"chartObject6\" style=\"{{chart.cssStyle}}\"/>\n        </section>-->\n        <section class=\"clearfix\">\n            <div class=\"panel-message left-panel \">\n                <div class=\"header-div\">\n                        <span class=\"edit-button\"></span>\n                        <h2 class=\"headlines\">Summary</h2>\n                </div>\n            <div id=\"editPanel2\" class=\"edit-div\">\n               <!-- <p>- 0  Under Review for Closure</p>\n                <p>- 0 Draft</p>\n                <p>- 0 Under Investigation</p>\n                <p>- 2 Pending with 3rd parties</p>\n                <p>- 0 Assigned</p>-->\n            </div>\n            </div>\n            <!--<div class=\"panel-message right-panel\">\n               <p>- 65 incidents are not aligned to any Release</p>\n                <p>- 0 Pending - Client Action</p>\n                <p>- 1 Pending 3rd Party</p>\n                <p>- 0 Future Enhancement</p>\n                <p>- 0 Client Hold</p>\n                <p>- 0 Under Monitoring</p>\n                <p>- 0 In progress</p>\n            </div>-->\n        </section>\n    </main>\n</body>\n</html>\n",
        "x": 572.5994110107422,
        "y": 217.34091186523438,
        "wires": [
            []
        ]
    },
    {
        "id": "c6558f76.03c1a",
        "type": "function",
        "z": "1cee00b4.e18b0f",
        "name": "",
        "func": "console.log(\"function\");\nvar tableDatas={};\nvar incidentBurn=[\n    [\"Weekly Report (MM/DD/YYYY)\"],\n    [\"New\"],\n    [\"Resolved\"]/*,\n    [\"Open\"],\n    [\"Total Open\"]*/\n];\nvar incidentAgeing= [\n  [\"Incident Count\"]\n];\nvar probrecordAgeing= [\n  [\"Problem Records\"]\n];\nvar categorisation =[\n  [\"Categorization\"],\n  [\"Site Confidence Issues\"],\n    [\"Application Error\"],\n    [\"Service Request IT\"],\n    [\"Service Request Business\"],\n    [\"Misdirected/ Invalid call\"],\n    [\"Training Issues\"],\n    [\"Duplicate call\"],\n    [\"Security Breach\"],\n    [\"Known Error\"],\n    [\"Connectivity Issue - 3rd Party\"]\n];\nvar dailyIncidents=[\n[\"Days\"],\n[\"Incident Count\"],\n[\"Date\"]\n];\n\n\n\n  function nextChar(c) {\n      return String.fromCharCode(c.charCodeAt(0) + 1);\n  }\n\n  var chartObject ={\n  \"type\": \"LineChart\",\n    \"displayed\": false,\n    \"data\": {\n      \"cols\": [{\n          \"id\": \"A\",\n          \"label\": \"NEW A\",\n          \"type\": \"string\"\n        }\n  ],\n      \"rows\":[]\n    },\n    \"options\": {\n      \"title\": \"\",\n              \"height\": 230,\n\n      \"isStacked\": \"true\",\n      \"fill\": 20,\n      \"legend\": {\n        \"position\": \"bottom\"\n      },\n      \"colors\": [\n        \"#4A7EBB\",\n        \"#ff0000\",\n        \"#98B954\",\n        \"#7D60A0\"\n      ],\n      \"displayExactValues\": true,\n      \"vAxis\": {\n        \"title\": \"\",\n        \"gridlines\": {\n          \"count\": 10,\n          \"color\":\"#ffffff\"\n        }\n      },\n      \"hAxis\": {\n        \"title\": \"\",\n        \"gridlines\": {\n          \"color\":\"#000000\"\n        }\n        \n      // slantedText: true,  /* Enable slantedText for horizontal axis */\n       //slantedTextAngle: 90 /* Define slant Angle */\n   \n      }\n    },\n    \"formatters\": {}\n  };\n  var chartObject1= {\n    \"type\": \"BarChart\",\n    \"displayed\": true,\n    \"data\": {\n      \"cols\": [\n        {\n          \"id\": \"A\",\n          \"label\": \"NEW A\",\n          \"type\": \"string\"\n        },\n        {\n          \"id\": \"B\",\n          \"label\": \"Incident Count\",\n          \"type\": \"number\"\n        },\n        {\n          \"id\":\"C\",\n          \"type\": \"string\", \n          \"role\": \"annotation\"\n        }\n      ],\n      \"rows\": []\n    },\n    \"options\": {\n      \"title\": \"\",\n      \"isStacked\": \"false\",\n      \"fill\": 20,\n      \"displayExactValues\": true,\n      \"colors\": [\n        \"#92D050\"\n      ],\n      \"legend\": {\n        \"position\": \"bottom\"\n      },\n      \"vAxis\": {\n        \"title\": \"\",\n        \"gridlines\": {\n          \"count\": 10,\n            \"color\":\"#ffffff\"\n\n        }\n      },\n      \"orientation\": \"horizontal\",\n      \"hAxis\": {\n        \"title\": \"\"\n      },\n      \"annotations\":{\n        \"alwaysOutside\":true,\n        \"textStyle\": {\n            \"bold\": true,\n            \"color\": '#000000',\n          },\n          \"stem\" : {\n            \"length\":0\n          }\n      }\n    },\n    \n    \"formatters\": {}\n\n  }\n\n  var chartObject3 = {\n    \"type\": \"BarChart\",\n    \"displayed\": true,\n    \"data\": {\n      \"cols\": [\n        {\n          \"id\": \"A\",\n          \"label\": \"weeklyAgeing\",\n          \"type\": \"string\"\n        },\n        {\n          \"id\": \"B\",\n          \"label\": \"Problem Records\",\n          \"type\": \"number\"\n        },\n        {\n          \"id\":\"C\",\n          \"type\": \"string\", \n          \"role\": \"annotation\"\n        }\n      ],\n      \"rows\": []\n    },\n    \"options\": {\n      \"title\": \"\",\n      \"isStacked\": \"false\",\n      \"fill\": 20,\n      \"displayExactValues\": true,\n      \"width\": 600,\n      \"colors\": [\n        \"#92D050\"\n      ],\n      \"legend\": {\n        \"position\": \"bottom\"\n      },\n      \"vAxis\": {\n        \"title\": \"\",\n        \"gridlines\": {\n          \"count\": 4,\n            \"color\":\"#ffffff\"\n\n        }\n      },\n      \"orientation\": \"horizontal\",\n      \"hAxis\": {\n        \"title\": \"\"\n      },\n      \"annotations\":{\n        \"alwaysOutside\":true,\n        \"textStyle\": {\n            \"bold\": true,\n            \"color\": '#000000',\n          },\n          \"stem\" : {\n            \"length\":0\n          }\n      }\n\n    },\n    \"formatters\": {}\n  }\n\n  var chartObject4 = {\n    \"type\": \"BarChart\",\n    \"displayed\": true,\n    \"data\": {\n      \"cols\": [\n        {\n          \"id\": \"A\",\n          \"label\": \"Daily Incidents\",\n          \"type\": \"string\"\n        },\n        {\n          \"id\": \"B\",\n          \"label\": \"Daily Incidents Count\",\n          \"type\": \"number\"\n        },\n        {\n          \"id\":\"C\",\n          \"type\": \"string\", \n          \"role\": \"annotation\"\n        }\n      ],\n      \"rows\": []\n    },\n    \"options\": {\n      \"title\": \"\",\n      \"isStacked\": \"false\",\n      \"fill\": 20,\n      \"displayExactValues\": true,\n      \"width\": 600,\n      \"height\":250,\n      \"colors\": [\n        \"#92D050\"\n      ],\n      \"legend\": {\n        \"position\": \"bottom\"\n      },\n      \"vAxis\": {\n        \"title\": \"\",\n        \"gridlines\": {\n          \"count\": 4,\n            \"color\":\"#ffffff\"\n\n        }\n      },\n      \"orientation\": \"horizontal\",\n      \"hAxis\": {\n        \"title\": \"\"\n      },\n      \"annotations\":{\n        \"alwaysOutside\":true,\n        \"textStyle\": {\n            \"bold\": true,\n            \"color\": '#000000',\n          },\n          \"stem\" : {\n            \"length\":0\n          }\n      }\n    },\n    \"formatters\": {}\n  }\n\n  var chartObject2= {\n    \"type\": \"ComboChart\",\n    \"displayed\": true,\n    \"data\": {\n      \"cols\": [\n        {\n          \"id\": \"A\",\n          \"label\": \"NEW A\",\n          \"type\": \"string\"\n        },\n        {\n          \"id\": \"B\",\n          \"label\": \"Current Week\",\n          \"type\": \"number\"\n        },\n                {\n          \"id\":\"C\",\n          \"type\": \"string\", \n          \"role\": \"annotation\"\n        },\n        {\n          \"id\": \"B\",\n          \"label\": \"\",\n          \"type\": \"number\"\n        }\n      ],\n      \"rows\": []\n    },\n    \"options\": {\n      \"title\": \"\",\n      \"isStacked\": \"false\",\n      \"fill\": 20,\n      \"displayExactValues\": true,\n      \"seriesType\": \"bars\",\n      \"width\": 600,\n      \"height\":400,\n      \"series\": {\n        \"1\": {\n          \"type\": \"line\"\n        }\n      },\n      \"colors\": [\n        \"#92D050\",\n        \"#D17E7C\"\n      ],\n      \"legend\": {\n        \"position\": \"bottom\"\n      },\n      \"vAxis\": {\n        \"title\": \"\",\n        \"gridlines\": {\n          \"count\": 5,\n            \"color\":\"#ffffff\"\n\n        }\n      },\n      \"orientation\": \"horizontal\",\n      \"hAxis\": {\n        \"title\": \"\"\n      },\n      \"annotations\":{\n        \"alwaysOutside\":true,\n        \"textStyle\": {\n            \"bold\": true,\n            \"color\": '#000000',\n          },\n          \"stem\" : {\n            \"length\":0\n          }\n      }\n    },\n    \"formatters\": {}\n  }\n\n\nfunction getfulldate(today) { //returns date in mm/dd/yyyy format\n  var currentDate=today.getDate(),\n    currentMonth=today.getMonth()+1;\n  var x=(currentMonth<10)?('0'+currentMonth):currentMonth;\n  var y=(currentDate<10)?('0'+currentDate):currentDate;\n  return (x+'/'+y+'/'+today.getFullYear());\n}\nfunction getLastSunday(d) { //returns last sunday date takes input as mm/dd/yyyy\n    var t = new Date(d);\n    t.setDate(t.getDate() - t.getDay());\n    return t;\n}\nfunction getDateStamp(dateStamp) {\n  var monthName=[\"Jan\", \"Feb\", \"Mar\", \"Apr\", \"May\", \"June\",\"July\", \"Aug\", \"Sept\", \"Oct\", \"Nov\", \"Dec\"];\n  var newDate= new Date(dateStamp);\n  return newDate.getDate()+\"-\"+monthName[newDate.getMonth()]+\"-\"+newDate.getFullYear();\n}\nvar dateArray=[];\nvar lastSundaydate=getLastSunday(getfulldate(new Date()));\ntableDatas[\"date\"]=getDateStamp(lastSundaydate);\nvar lastSunday=getfulldate(lastSundaydate);\nvar i=2;\ndateArray[i-1]=lastSunday;\nincidentBurn[0][i-1]=getDateStamp(new Date(lastSunday));\n//incidentBurn[0][i-1]=lastSunday;\ncategorisation[0][i-1]=getDateStamp(new Date(lastSunday));\nvar lastSunday1=new Date(lastSunday);\ndailyIncidents[0][1]=getfulldate(lastSunday1);\ndailyIncidents[2][1]=getDateStamp(new Date(lastSunday1));\n//console.log(new Date(lastSunday));\n//for (var i=1;i<7;i++) {\ndailyIncidents[0][2]=getfulldate(new Date(lastSunday1.getTime() - (24*60*60*1000*1)));\ndailyIncidents[2][2]=getDateStamp(new Date(new Date(lastSunday1.getTime() - (24*60*60*1000*1))));\n\ndailyIncidents[0][3]=getfulldate(new Date(lastSunday1.getTime() - (24*60*60*1000*2)));\ndailyIncidents[2][3]=getDateStamp(new Date(new Date(lastSunday1.getTime() - (24*60*60*1000*2))));\n\ndailyIncidents[0][4]=getfulldate(new Date(lastSunday1.getTime() - (24*60*60*1000*3)));\ndailyIncidents[2][4]=getDateStamp(new Date(new Date(lastSunday1.getTime() - (24*60*60*1000*3))));\n\ndailyIncidents[0][5]=getfulldate(new Date(lastSunday1.getTime() - (24*60*60*1000*4)));\ndailyIncidents[2][5]=getDateStamp(new Date(new Date(lastSunday1.getTime() - (24*60*60*1000*4))));\n\ndailyIncidents[0][6]=getfulldate(new Date(lastSunday1.getTime() - (24*60*60*1000*5)));\ndailyIncidents[2][6]=getDateStamp(new Date(new Date(lastSunday1.getTime() - (24*60*60*1000*5))));\n\ndailyIncidents[0][7]=getfulldate(new Date(lastSunday1.getTime() - (24*60*60*1000*6)));\ndailyIncidents[2][7]=getDateStamp(new Date(new Date(lastSunday1.getTime() - (24*60*60*1000*6))));\n\nfor (var z=1;z<dailyIncidents[0].length;z++) {\nvar dateDaily=new Date(dailyIncidents[0][z]);\nvar sev1sev2=0,sev3sev4=0;\n  for (var je=0;je<msg.incidentData.length;je++) {\n    var getDate1=msg.incidentData[je][\"Reported Date+\"];\n      var daterange1=getDate1.substring(0, getDate1.indexOf(' '));\n      var check1=new Date(daterange1);\n      //console.log(check1)\n      if(check1.getTime()==dateDaily.getTime() && (msg.incidentData[je][\"Priority*\"]===\"Critical\" || msg.incidentData[je][\"Priority*\"]===\"High\")) {\n        sev1sev2++;\n       }\n  }\n  for (var je=0;je<msg.aecomData.length;je++) {\n    var getDate2=msg.aecomData[je][\"Reported Date+\"];\n      var daterange2=getDate2.substring(0, getDate2.indexOf(' '));\n      var check2=new Date(daterange2);\n      //console.log(check1)\n      if(check2.getTime()==dateDaily.getTime() && (msg.aecomData[je][\"Priority*\"]===\"Medium\" || msg.aecomData[je][\"Priority*\"]===\"Low\")) {\n        sev3sev4++;\n       }\n  }\n  dailyIncidents[1][z]=sev1sev2+sev3sev4;\n    //dailyIncidents[1][z+1]=sev3sev4;\n}\nvar sev1Count=0,sev2Count=0,sev3Count=0,sev4Count=0;\n\n/*var mySunday=getLastSunday(getfulldate(new Date()));\nvar mySundaydate=getfulldate(mySunday);\ndailyIncidents[0][1]=mySundaydate;\nconsole.log(dailyIncidents);\nfor (var i=1;i<=6;i++) {\n  //console.log(new Date(getfulldate(getfulldate(new Date()).getDate();\n  //var ndate=new Date(new Date(mySundaydate).setDate(new Date(mySundaydate).getDate() - i)).setHours(0,0,0,0);\n  //console.log(ndate);\n  //console.log(new Date(new Date(new Date(getfulldate(getLastSunday(getfulldate(new Date())))).setDate(new Date(getfulldate(getLastSunday(getfulldate(new Date())))).getDate() - i)).setHours(0,0,0,0)));\n\n}*/\n/***daily data**/\n/*var dailyIncidents=[\n[\"Days\"],\n[\"Incident Count\"]\n];\nvar mySunday=getLastSunday(getfulldate(new Date()));\nvar mySundaydate=getfulldate(mySunday);\ndailyIncidents[0][1]=mySundaydate;\nfor (var i=1;i<=6;i++) {\n  console.log(new Date(new Date(new Date(mySundaydate).setDate(new Date(mySundaydate).getDate() - i)).setHours(0,0,0,0)));\n\n}*/\n\n/****/\ndo{\n  var newlastSundaydate=new Date(lastSundaydate.setDate(lastSundaydate.getDate() - 7));\n  var newlastSunday=getfulldate(newlastSundaydate);\n  dateArray[i]=newlastSunday;\n  incidentBurn[0][i]=getDateStamp(new Date(newlastSunday));\n  //incidentBurn[0][i]=newlastSunday;\n  categorisation[0][i]=getDateStamp(new Date(newlastSunday));\n  lastSundaydate=newlastSundaydate;\n  lastSunday=newlastSunday;\n  i++;\n} while(i<7);\n//console.log(\"dateArray\",dateArray);\n//console.log(\"incidentBurn\",incidentBurn);\n\nvar criticalCount=0,highCount=0,lowCount=0,incidentAgePopulate=true,checkforFirstItr=true,incidentAge1=0,incidentAge2=0,incidentAge3=0,incidentAge4=0,ProbRecordAge1=0,ProbRecordAge2=0,ProbRecordAge3=0,ProbRecordAge4=0,oneWeekCritical=0,oneWeekHigh=0,criticalIncidentObj=[],highIncidentObj=[];\n/***Find date range***/\nvar todayDate=new Date();\ntodayDate.setHours(0,0,0);\nvar day1=new Date(todayDate.setDate(todayDate.getDate() - 1)).setHours(0,0,0,0);\nvar day7=new Date(todayDate.setDate(todayDate.getDate() - 7)).setHours(0,0,0,0);\nvar day8=new Date(todayDate.setDate(todayDate.getDate() - 1)).setHours(0,0,0,0);\nvar day14=new Date(todayDate.setDate(todayDate.getDate() - 6)).setHours(0,0,0,0);\nvar day15=new Date(todayDate.setDate(todayDate.getDate() - 1)).setHours(0,0,0,0);\nvar day30=new Date(todayDate.setDate(todayDate.getDate() - 6)).setHours(0,0,0,0);\nvar today=new Date();\nvar day6=new Date(new Date().setDate(new Date().getDate()-25));\nfor (var i=1;i<incidentBurn[0].length;i++) {\n  //var dateTo=incidentBurn[0][i];\n  var dateTo=dateArray[i];\n    var to=new Date(dateTo);\n    var newto=new Date(dateTo);\n    var dateFrom=new Date(newto.setDate(newto.getDate() - 6));\n    var category=[0,0,0,0,0,0,0,0,0,0];\n\n    var incidentCount=0,d13=0,e13=0,b13=0,c13=0,d14=0,e14=0,f3a=0,f3b=0,f4a=0,f4b=0,f5a=0,f5b=0;\n  for (var j=0;j<msg.incidentData.length;j++) {\n    var getDate=msg.incidentData[j][\"Reported Date+\"];\n      var daterange=getDate.substring(0, getDate.indexOf(' '));\n      var check=new Date(daterange);\n      var getClosedDate=msg.incidentData[j][\"Closed Date\"];\n\n\n      /****incident ageing****/\n      if (incidentAgePopulate && (msg.incidentData[j][\"Status*\"]===\"Assigned\" || msg.incidentData[j][\"Status*\"]===\"Pending\")) {\n      \n      if(check<=day1 && check>=day7) {\n        incidentAge1++;\n      } else if (check<=day8 && check>=day14) {\n        incidentAge2++;\n      } else if (check<=day15 && check>=day30) {\n        incidentAge3++\n      } else incidentAge4++;\n    } else if (incidentAgePopulate) {\n\n      if(check<=today && check>=day6) {\n\n        if(msg.incidentData[j][\"Priority*\"]===\"Critical\") {\n          oneWeekCritical++;\n          criticalIncidentObj.push({\"Priority\":\"Sev1\",\"incidentId\":msg.incidentData[j][\"Incident ID*+\"],\"summary\":msg.incidentData[j][\"Summary*\"]});\n\n        }\n        else if (msg.incidentData[j][\"Priority*\"]===\"High\"){\n          oneWeekHigh++;\n          highIncidentObj.push({\"Priority\":\"Sev2\",\"incidentId\":msg.incidentData[j][\"Incident ID*+\"],\"summary\":msg.incidentData[j][\"Summary*\"]});\n        }\n\n      } \n\n      if(check >= dateFrom && check <= to ) {\n        if(msg.incidentData[j][\"Priority*\"]===\"Critical\")\n        {\n          sev1Count++;\n        } else if (msg.incidentData[j][\"Priority*\"]===\"High\") {\n          sev2Count++;\n        }\n          \n        }\n\n\n    }\n    /**/\n\n      if(msg.incidentData[j][\"Status*\"]===\"Assigned\" && (msg.incidentData[j][\"Priority*\"]===\"Medium\" || msg.incidentData[j][\"Priority*\"]===\"Critical\" || msg.incidentData[j][\"Priority*\"]===\"High\"))\n    {\n      f3a++;\n    }\n    else if(msg.incidentData[j][\"Status*\"]===\"In Progress\" && (msg.incidentData[j][\"Priority*\"]===\"Medium\" || msg.incidentData[j][\"Priority*\"]===\"Critical\" || msg.incidentData[j][\"Priority*\"]===\"High\"))\n    {\n      f4a++;\n    } \n    else if (msg.incidentData[j][\"Status*\"]===\"Pending\" && (msg.incidentData[j][\"Priority*\"]===\"Medium\" || msg.incidentData[j][\"Priority*\"]===\"Critical\" || msg.incidentData[j][\"Priority*\"]===\"High\"))\n    {\n      f5a++;\n    } \n\n      if(getClosedDate!==undefined) {\n        var ClosedDaterange=new Date(getClosedDate.substring(0, getClosedDate.indexOf(' ')));\n        if(ClosedDaterange >= dateFrom && ClosedDaterange <= to) {\n          if(msg.incidentData[j][\"Priority*\"]===\"Medium\")\n        {\n          d14++;\n        }\n        }\n\n      }\n    if(check >= dateFrom && check <= to ) {\n      if(msg.incidentData[j][\"Priority*\"]===\"Medium\")\n      {\n        d13++;\n      }\n      if(msg.incidentData[j][\"Priority*\"]===\"Low\")\n      {\n        e13++;\n      }\n      if(msg.incidentData[j][\"Priority*\"]===\"Critical\")\n      {\n        b13++;\n      }\n      if(msg.incidentData[j][\"Priority*\"]===\"High\")\n      {\n        c13++;\n      }\n\n      if(msg.incidentData[j][\"Resolution Categorization Tier 2\"]===\"Site Confidence Issues\") {\n        category[0]++;\n      } else if (msg.incidentData[j][\"Resolution Categorization Tier 2\"]===\"Application Error\") {\n        category[1]++;\n      } else if(msg.incidentData[j][\"Resolution Categorization Tier 2\"]===\"Service Request IT\") {\n        category[2]++;\n      } else if(msg.incidentData[j][\"Resolution Categorization Tier 2\"]===\"Service Request Business\") {\n        category[3]++;\n      } else if(msg.incidentData[j][\"Resolution Categorization Tier 2\"]===\"Misdirected/ Invalid call\") {\n        category[4]++;\n      } else if(msg.incidentData[j][\"Resolution Categorization Tier 2\"]===\"Training Issues\") {\n        category[5]++;\n      } else if(msg.incidentData[j][\"Resolution Categorization Tier 2\"]===\"Duplicate call\") {\n        category[6]++;\n      } else if(msg.incidentData[j][\"Resolution Categorization Tier 2\"]===\"Security Breach\") {\n        category[7]++;\n      } else if(msg.incidentData[j][\"Resolution Categorization Tier 2\"]===\"Known Error\") {\n        category[8]++;\n      } else if(msg.incidentData[j][\"Resolution Categorization Tier 2\"]===\"Connectivity Issue - 3rd Party\") {\n        category[9]++;\n      } \n          \n      }\n      \n  }\n\n  for (var j=0;j<10;j++) {\n    categorisation[j+1][i]=category[j];\n  }\n  incidentAgePopulate=false;\n  for (var j=0;j<msg.aecomData.length;j++) {\n    var getDate=msg.aecomData[j][\"Reported Date+\"];\n      var daterange=getDate.substring(0, getDate.indexOf(' '));\n      var check=new Date(daterange);\n      var getClosedDate=msg.aecomData[j][\"Last Modified Date\"];\n\n      if(msg.aecomData[j][\"Status*\"]===\"Assigned\" && msg.aecomData[j][\"Priority*\"]===\"Low\") {\n        f3b++;\n      }\n      \n      else if(msg.aecomData[j][\"Status*\"]===\"In Progress\" && msg.aecomData[j][\"Priority*\"]===\"Low\") {\n        f4b++;\n      }\n      else if (msg.aecomData[j][\"Status*\"]===\"Pending\" && msg.aecomData[j][\"Priority*\"]===\"Low\") {\n        f5b++;\n      }\n\n      if(getClosedDate !==undefined) {\n        var ClosedDaterange=new Date(getClosedDate.substring(0, getClosedDate.indexOf(' ')));\n        if(ClosedDaterange >= dateFrom && ClosedDaterange <= to) {\n          if(msg.aecomData[j][\"Priority*\"]===\"Low\" && (msg.aecomData[j][\"Status*\"]===\"Resolved\" || msg.incidentData[j][\"Status*\"]===\"Closed\"))\n        {\n          e14++;\n        }\n        }\n      }\n    if(check >= dateFrom && check <= to ) {\n      \n      if(msg.aecomData[j][\"Priority*\"]===\"Low\")\n      {\n        e13++;\n      }\n        \n      }\n      if(checkforFirstItr) {\n        if(check >= dateFrom && check <= to ) {\n        if(msg.aecomData[j][\"Priority*\"]===\"Medium\")\n        {\n          sev3Count++;\n        } else if (msg.aecomData[j][\"Priority*\"]===\"Low\") {\n          sev4Count++;\n        }\n          \n        }\n      }\n      \n  }\n  incidentBurn[1][i]=d13+e13;\n  incidentBurn[2][i]=d14+e14;\n  //incidentBurn[3][i]=f3a+f3b+f4a+f4b;\n  msg.totalOpen=f3a+f3b+f4a+f4b+f5a+f5b;\n  checkforFirstItr=false;\n}\n//populating incidentAgeing \nincidentAgeing[0].push(incidentAge1,incidentAge2,incidentAge3,incidentAge4);\n\n/***populating incidentAgeingChart data***/\n  var alpha='A';\n  for (var i=0;i<incidentAgeing.length;i++) {\n    /*var charObj=\n    {\n          \"id\": \"\",\n          \"label\": \"\",\n          \"type\": \"number\"\n        };\n      charObj.id=nextChar(alpha);\n      alpha=nextChar(alpha);\n      charObj.label=incidentAgeing[i][0];\n      chartObject1.data.cols.push(charObj);*/\n  }\n  var daysCount=[\"0-7 Days\",\"8-14 Days\",\"15-30 Days\",\"30+ Days\"];\n  for (var j=1;j<incidentAgeing[0].length;j++){\n    var abc={\n    \"c\": []\n    };\n    var obj= {\n          \"v\": j-1,\n          \"f\": daysCount[j-1]\n        }\n        var obj1=\n        {\n          \"v\": incidentAgeing[0][j]\n        };\n    \n    abc.c.push(obj);\n    abc.c.push(obj1);\n    abc.c.push(obj1);\n    chartObject1.data.rows.push(abc);\n  }\n/***populating incidentBurnChart data***/\n\nvar alpha='A';\n\nfor (var i=1;i<incidentBurn.length;i++) {\n  var charObj=\n  {\n      \"id\": \"\",\n      \"label\": \"\",\n      \"type\": \"number\"\n    };\n    charObj.id=nextChar(alpha);\n    alpha=nextChar(alpha);\n    charObj.label=incidentBurn[i][0];\n    chartObject.data.cols.push(charObj);\n}\n\nfor (var i=1;i<incidentBurn[0].length;i++) {\n  var abc={\n  \"c\": []\n  };\n  for (var j=0;j<incidentBurn.length;j++){\n    if(i===1 && j===0) {\n      var obj={\n              \"v\": 0,\n              \"f\": incidentBurn[j][i]\n            }\n    } else {\n      var obj={\n        \"v\":incidentBurn[j][i]\n      }\n    }\n    abc.c.push(obj);\n  }\n  chartObject.data.rows.push(abc);\n}\n\n\nfor (var i=1;i<dailyIncidents[0].length;i++) {\n  var abc={\n  \"c\": []\n  };\n      var obj={\n              \"v\": i-1,\n              \"f\": dailyIncidents[2][i]\n            }\n      var obj1={\n        \"v\":dailyIncidents[1][i]\n      }\n    abc.c.push(obj);\n    abc.c.push(obj1);\n    abc.c.push(obj1);\n\n  chartObject4.data.rows.push(abc);\n}\n/***probrecord Ageing***/\nfor (var i=0;i<msg.probRecords.length;i++) {\n    var getDate=msg.probRecords[i][\"Submit Date\"];\n    var daterange=getDate.substring(0, getDate.indexOf(' '));\n    var check=new Date(daterange);\n    /****probRecord ageing****/\n    if (msg.probRecords[i][\"Status*\"]===\"Draft\" || msg.probRecords[i][\"Status*\"]===\"Under Review\"){\n    if(check<=day1 && check>=day7) {\n      ProbRecordAge1++;\n    } else if (check<=day8 && check>=day14) {\n      ProbRecordAge2++;\n    } else if (check<=day15 && check>=day30) {\n      ProbRecordAge3++\n    } else ProbRecordAge4++;\n  }\n  \n}\nprobrecordAgeing[0].push(ProbRecordAge1,ProbRecordAge2,ProbRecordAge3,ProbRecordAge4);\n\nfor (var j=1;j<probrecordAgeing[0].length;j++){\n    var abc={\n    \"c\": []\n    };\n    var obj= {\n          \"v\": j-1,\n          \"f\": daysCount[j-1]\n        }\n        var obj1=\n        {\n          \"v\": probrecordAgeing[0][j]\n        };\n    \n    abc.c.push(obj);\n    abc.c.push(obj1);\n    abc.c.push(obj1);\n    chartObject3.data.rows.push(abc);\n  }\n\n  for (var i=1;i<categorisation.length;i++) {\n    //console.log(categorisation[i+1][0]);\n    var abc={\n      \"c\":[]\n    };\n    var obj={\n      \"v\":i,\n      \"f\":categorisation[i][0]\n    }\n    var obj1= {\n      \"v\":categorisation[i][1]\n    };\n    var obj2={\n      \"v\":categorisation[i][2]\n    }\n    abc.c.push(obj);\n    abc.c.push(obj1);\n    abc.c.push(obj1);\n\n    abc.c.push(obj2);\n    chartObject2.data.rows.push(abc);\n\n  }\n  chartObject2.data.cols[1][\"label\"]=\"Current week \"+categorisation[0][1];\n  chartObject2.data.cols[3][\"label\"]=\"week ending \"+categorisation[0][2];\n\n  var chartObject5={\n    \"type\": \"PieChart\",\n    \"displayed\": false,\n    \"data\": {\n      \"cols\": [\n        {\n          \"id\": \"A\",\n          \"label\": \"NEW A\",\n          \"type\": \"string\"\n        },\n        {\n          \"id\": \"B\",\n          \"label\": \"Sev1\",\n          \"type\": \"number\"\n        },\n        {\n          \"id\": \"C\",\n          \"label\": \"Sev2\",\n          \"type\": \"number\"\n        }\n      ],\n      \"rows\": [\n        {\n          \"c\": [\n            {\n              \"v\": 1,\n              \"f\": \"Sev1\"\n            },\n            {\n              \"v\": sev1Count\n            }\n          ]\n        },\n        {\n          \"c\": [\n            {\n              \"v\": 2,\n              \"f\": \"Sev2\"\n            },\n            {\n              \"v\": sev2Count\n            }\n\n          ]\n        },\n        {\n          \"c\": [\n            {\n              \"v\": 3,\n              \"f\": \"Sev3\"\n            },\n            {\n              \"v\": sev3Count\n            }\n          ]\n        },\n        {\n          \"c\": [\n            {\n              \"v\": 4,\n              \"f\": \"Sev4\"\n            },\n            {\n              \"v\": sev4Count\n            }\n          ]\n        }\n        \n        \n        \n      ]\n    },\n    \"options\": {\n      \"title\": \"\",\n      \"isStacked\": \"true\",\n      \"fill\": 20,\n      \"displayExactValues\": true,\n      //\"seriesType\": \"bars\",\n      \"width\": 600,\n      \"colors\": [\n        \"#92D050\",\n        \"#D20000\",\n        \"#E17E7C\",\n        \"#127E7C\"\n      ],\n      \"vAxis\": {\n        \"title\": \"\",\n        \"gridlines\": {\n          \"count\": 10,\n            \"color\":\"#ffffff\"\n\n        }\n      },\n      //\"orientation\": \"horizontal\",\n      \"hAxis\": {\n        \"title\": \"\"\n      }\n    },\n    \"formatters\": {}\n  }\n  \nmsg.chartObject=JSON.stringify(chartObject);\nmsg.chartObject1=JSON.stringify(chartObject1);\nmsg.chartObject2=JSON.stringify(chartObject2);\nmsg.chartObject3=JSON.stringify(chartObject3);\nmsg.chartObject4=JSON.stringify(chartObject4);\nmsg.chartObject5=JSON.stringify(chartObject5);\ntableDatas[\"incidentBurn\"]=incidentBurn;\ntableDatas[\"incidentAgeing\"]=incidentAgeing;\ntableDatas[\"probrecordAgeing\"]=probrecordAgeing;\ntableDatas[\"categorisation\"]=categorisation;\nmsg.tableDatas= JSON.stringify(tableDatas);\nmsg.tableData=tableDatas;\nmsg.summaryInfo={\n  \"oneWeekCritical\":oneWeekCritical,\n  \"oneWeekHigh\":oneWeekHigh,\n  \"criticalIncident\":criticalIncidentObj,\n  \"highIncident\":highIncidentObj\n}\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 525.0994415283203,
        "y": 272.34093856811523,
        "wires": [
            [
                "7f83fb05.4e5444"
            ]
        ]
    },
    {
        "id": "cc71cf0f.fda8f",
        "type": "http request",
        "z": "1cee00b4.e18b0f",
        "name": "",
        "method": "GET",
        "ret": "txt",
        "url": "http://127.0.0.1:80/getaecom",
        "tls": "",
        "x": 224.2890625,
        "y": 292.2670593261719,
        "wires": [
            [
                "7268ab69.caa364"
            ]
        ]
    },
    {
        "id": "7268ab69.caa364",
        "type": "function",
        "z": "1cee00b4.e18b0f",
        "name": "",
        "func": "msg.identifier=\"aecom\";\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 363.04261779785156,
        "y": 299.1747131347656,
        "wires": [
            [
                "8b8c1aec.0c5608"
            ]
        ]
    },
    {
        "id": "96a71c02.73d",
        "type": "gcalendar",
        "z": "1cee00b4.e18b0f",
        "name": "",
        "topic": "gcalendar",
        "calendarId": "primary",
        "x": 203.9883041381836,
        "y": 88.0909194946289,
        "wires": [
            [
                "1bf1c9a2.773016"
            ]
        ]
    },
    {
        "id": "1bf1c9a2.773016",
        "type": "function",
        "z": "1cee00b4.e18b0f",
        "name": "",
        "func": "msg.identifier=\"calendar-event\";\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 336.0994567871094,
        "y": 82.86868858337402,
        "wires": [
            [
                "8b8c1aec.0c5608"
            ]
        ]
    },
    {
        "id": "d2eb1061.780cf",
        "type": "http request",
        "z": "1cee00b4.e18b0f",
        "name": "",
        "method": "GET",
        "ret": "txt",
        "url": "http://127.0.0.1:80/getsummary",
        "tls": "",
        "x": 193.09882354736328,
        "y": 37.525259017944336,
        "wires": [
            [
                "58065f69.42537"
            ]
        ]
    },
    {
        "id": "58065f69.42537",
        "type": "function",
        "z": "1cee00b4.e18b0f",
        "name": "",
        "func": "msg.identifier=\"summary-event\";\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 380.94728088378906,
        "y": 38.41667366027832,
        "wires": [
            [
                "8b8c1aec.0c5608"
            ]
        ]
    },
    {
        "id": "53396eb8.267f",
        "type": "function",
        "z": "1cee00b4.e18b0f",
        "name": "",
        "func": "return msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 635.9516448974609,
        "y": 137.94601440429688,
        "wires": [
            []
        ]
    },
    {
        "id": "167570ac.a9067f",
        "type": "function",
        "z": "73c2b0f6.41dab",
        "name": "",
        "func": "//var new2=msg.payload;\n//var globalContext = this.context().global;\n//var new1=new2.substring(new2.lastIndexOf(\"<body>\")+6,new2.lastIndexOf(\"</body>\")-7);\n//global.set(\"globaltemp1\",new1);  // this is now available to other nodes\nconsole.log(msg.payload);\nmsg.filename=\"nu9.pdf\";\nmsg.options= {\n  \"base\": \"file:///D:/dashboard/dashboard-app/client/webcontent/\", // Base path that's used to load files (images, css, js) when they aren't referenced using a host \n}\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 811.3722229003906,
        "y": 244.09091186523438,
        "wires": [
            [
                "31f9e20a.f1497e"
            ]
        ]
    },
    {
        "id": "fa77d683.2b05e8",
        "type": "HTML-PDF",
        "z": "73c2b0f6.41dab",
        "name": "HTML-PDF",
        "output": "file",
        "x": 958.3721923828125,
        "y": 279.0909118652344,
        "wires": [
            []
        ]
    },
    {
        "id": "a68868b4.493dc8",
        "type": "debug",
        "z": "73c2b0f6.41dab",
        "name": "",
        "active": true,
        "console": "false",
        "complete": "false",
        "x": 1080.5000305175781,
        "y": 372.2613525390625,
        "wires": []
    },
    {
        "id": "6b12b308.f3011c",
        "type": "http in",
        "z": "73c2b0f6.41dab",
        "name": "",
        "url": "/knownErrors",
        "method": "get",
        "swaggerDoc": "",
        "x": 109,
        "y": 677,
        "wires": [
            [
                "3a927bc4.a51c04"
            ]
        ]
    },
    {
        "id": "a8828f07.61103",
        "type": "http response",
        "z": "73c2b0f6.41dab",
        "name": "",
        "x": 565,
        "y": 656,
        "wires": []
    },
    {
        "id": "8e0f36c.fef69c8",
        "type": "template",
        "z": "73c2b0f6.41dab",
        "name": "",
        "field": "payload",
        "fieldType": "msg",
        "format": "handlebars",
        "syntax": "mustache",
        "template": "<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n    <meta charset=\"UTF-8\">\n    <title>MNS-Reporting</title>\n    <link rel=\"stylesheet\" type=\"text/css\" href=\"assets/wsr-automation/css/style.css\">\n    <!--<script src=\"https://ajax.googleapis.com/ajax/libs/jquery/1.12.0/jquery.min.js\"></script>-->\n    <!--<script src=\"http://ajax.googleapis.com/ajax/libs/angularjs/1.4.8/angular.min.js\"></script>-->\n    <script src=\"assets/wsr-automation/js/angular.min.js\"></script>\n    <script src=\"assets/wsr-automation/js/jquery-3.1.1.js\"></script>\n</head>\n<body>\n    <main class=\"container\" ng-app=\"weeklyReports\" ng-controller=\"reportsCtrl\">\n        <script type=\"text/ng-template\" id=\"incidentDataTable.html\">\n            <tr ng-repeat=\"data in dataFromTable\">\n                <td ng-repeat=\"values in data track by $index\" ng-class=\"values\" ng-bind=\"values\"></td>\n            </tr>\n        </script>\n        <script type=\"text/ng-template\" id=\"slaViewTable.html\">\n            <tr>\n                <td>Incident</td><td>SLA</td><td>Reported</td><td>Acheived</td><td>Breached</td>\n            </tr>\n            <tr ng-repeat=\"data in dataFromTable\">\n                <td ng-repeat=\"values in data track by $index\" ng-bind=\"values\"></td>\n            </tr>\n        </script>\n        <script type=\"text/ng-template\" id=\"knownErrorTable.html\">\n            <tr ng-repeat=\"data in dataFromTable\">\n                <td ng-repeat=\"values in data track by $index\" ng-bind=\"values\"></td>\n            </tr>\n        </script>\n        <script type=\"text/ng-template\" id=\"incidentSumTable.html\">\n            <tr>\n                <td ng-repeat=\"(key,value) in dataFromTable\" ng-bind=\"key\"></td>\n            </tr>\n            <tr>\n                <td ng-repeat=\"data in dataFromTable\" ng-bind=\"data\"></td>\n            </tr>\n        </script>\n         \n        <div class=\"clearfix\">\n            <img src=\"assets/wsr-automation/images/mns-logo.jpg\" alt=\"Marks and Spencer logo\" id=\"mnsLogo\">\n            <img src=\"assets/wsr-automation/images/sapient-nitro.png\" alt=\"SapientNitro logo\" id=\"sapientLogo\">\n        </div>\n        <div class=\"clearfix\">\n            <img src=\"assets/wsr-automation/images/print-icon.png\" alt=\"Print Logo\" id=\"printLogo\" ng-click=\"printOption()\">\n        </div>\n\n        <section class=\"clearfix\">\n            \n            <table id=\"\">\n                <caption>Known Errors for week ending {{tableData.date}}</caption>\n                <tbody id=\"knownErrorTable\" table-dir dataparam=tableDatas.knownErrorData ></tbody>\n            </table>\n            <!--<table id=\"knownErrorTable\">\n                \n                <!<tbody>\n                    <tr><td>SHOPSN-957</td>\n                    <td>HTTP 500 |/MSInventoryAjaxRefresh</td>\n                    </tr>\n                    <tr><td>SHOPLS-1841</td>\n                    <td>Space in First name and Last name in address book in My Account</td>\n                    </tr>\n                </tbody>-->\n            <!--</table>-->\n            \n        \n    </main>\n\n    <script src=\"assets/wsr-automation/js/app.js\"></script>\n    <script src=\"assets/wsr-automation/js/executiveSummary/newcontroller.js\"></script>\n    <script src=\"assets/wsr-automation/js/common/createTable.directive.js\"></script>\n    <!--<script src='http://js.nicedit.com/nicEdit-latest.js'></script>-->\n    <script src='assets/wsr-automation/js/common/jqueryeditable.js'></script>\n<style>\n    .edit_area textarea {\n        padding:1px;\n    }\n    .edit_area {\n        padding:1px;\n    }\n</style>\n<script type=\"text/javascript\">\nvar tableDatas={{{tableDatas}}};\nvar dateDisplay=tableDatas.date;\n//var accompl=accomp.value;\n\n$(document).ready(function() {\n    //$(\"#accomplishments .edit_area\").html(accompl);\n     $('.edit').editable('http://www.example.com/save.php', {\n         indicator : 'Saving...',\n         tooltip   : 'Click to edit...'\n     });\n     /*$('.edit_area').editable('http://www.example.com/save.php', {\n         type      : 'textarea',\n         cancel    : 'Cancel',\n         submit    : 'OK',\n         indicator : '<img src=\"assets/images/edit-button.png\">',\n         tooltip   : 'Click to edit...'\n     });*/\n\n     $('.edit_area').editable(function(value, settings) {\n       // console.log(tableDatas);\n       var idName=$(this).attr(\"id\");\n       //value=value.trim();\n         //console.log(value);\n        // console.log(settings);\n                   //  data     : {\"date\":new Date(dateDisplay),idName:value},\n            var postData= {\n                \"date\":new Date(dateDisplay),\n                \"name\":idName,\n                \"value\":value\n            }\n            //postData[idName]=value;\n            //postData[\"name\"]=idName;\n         $.ajax({\n            type     : \"POST\",\n            cache    : false,\n            url      : \"http://localhost/writeSummary\",\n            data     : postData,\n            success  : function(data) {\n               // $(\".printArea\").empty().append(data).css('visibility','visible');\n               console.log(\"success\");\n              // console.log(value);\n               \n            }\n        });//ajax\n         return(value);\n      }, {\n         type    : 'textarea',\n         submit  : 'OK',\n        cancel    : 'Cancel'\n\n     });\n });\n</script>\n\n</body>\n\n</html>\n\n\n\n",
        "x": 374,
        "y": 596,
        "wires": [
            [
                "a8828f07.61103"
            ]
        ]
    },
    {
        "id": "3a927bc4.a51c04",
        "type": "function",
        "z": "73c2b0f6.41dab",
        "name": "",
        "func": "var tableDatas={};\nvar knownErrorDatas=[\n    [\"JIRA\",\"Description\",,,,,,,\"Fix Planned\",\"Identified\",\"Mitigation\"]\n    //[\"Weekly Report (MM/DD/YYYY)\"],\n    //[\"Overall\",\"Green\",\"Green\",\"Green\",\"Green\",\"Green\",\"Green\"],\n    //[\"Incidents\"],\n    //[\"Problem Records\"]\n];\nknownErrorDatas[1]=new Array(11);\nknownErrorDatas[1]=[]\nknownErrorDatas[2]=new Array(11);\n\nvar months=[\"January\",\"February\",\"March\",\"April\",\"May\",\"June\",\"July\",\"August\",\"September\",\"October\",\"November\",\"December\"];\n\nfunction getfulldate(today) { //returns date in mm/dd/yyyy format\n  var currentDate=today.getDate(),\n    currentMonth=today.getMonth()+1;\n  var x=(currentMonth<10)?('0'+currentMonth):currentMonth;\n  var y=(currentDate<10)?('0'+currentDate):currentDate;\n  return (x+'/'+y+'/'+today.getFullYear());\n}\nfunction getLastSunday(d) { //returns last sunday date takes input as mm/dd/yyyy\n    var t = new Date(d);\n    t.setDate(t.getDate() - t.getDay());\n    return t;\n}\nfunction getDateStamp(dateStamp) {\n  var monthName=[\"Jan\", \"Feb\", \"Mar\", \"Apr\", \"May\", \"June\",\"July\", \"Aug\", \"Sept\", \"Oct\", \"Nov\", \"Dec\"];\n  var newDate= new Date(dateStamp);\n  return newDate.getDate()+\"-\"+monthName[newDate.getMonth()]+\"-\"+newDate.getFullYear();\n}\n\nvar lastSundaydate=getLastSunday(getfulldate(new Date()));\ntableDatas[\"date\"]=getDateStamp(lastSundaydate);\nvar lastSunday=getfulldate(lastSundaydate);\nconsole.log(lastSundaydate);\nvar monthNames=lastSundaydate.getMonth();\nfor (var i=0;i<6;i++) {\n    var nameMonth=months[monthNames-i];\n    knownErrorDatas[0][i+2]=\"No of occurences in \"+nameMonth;\n    \n    \n}\ntableDatas[\"knownErrorData\"]=knownErrorDatas;\n//msg.tableDatas=tableDatas;\nmsg.tableDatas= JSON.stringify(tableDatas);\nmsg.tableData=tableDatas;\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 242,
        "y": 615,
        "wires": [
            [
                "8e0f36c.fef69c8"
            ]
        ]
    },
    {
        "id": "4b9517cc.b341e8",
        "type": "http in",
        "z": "73c2b0f6.41dab",
        "name": "",
        "url": "/dependency",
        "method": "get",
        "swaggerDoc": "",
        "x": 119,
        "y": 779,
        "wires": [
            [
                "8a6dc197.57054"
            ]
        ]
    },
    {
        "id": "f77399ed.ed6828",
        "type": "http response",
        "z": "73c2b0f6.41dab",
        "name": "",
        "x": 575,
        "y": 758,
        "wires": []
    },
    {
        "id": "95d8c217.ca0ff",
        "type": "template",
        "z": "73c2b0f6.41dab",
        "name": "",
        "field": "payload",
        "fieldType": "msg",
        "format": "handlebars",
        "syntax": "mustache",
        "template": "<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n    <meta charset=\"UTF-8\">\n    <title>MNS-Reporting</title>\n    <link rel=\"stylesheet\" type=\"text/css\" href=\"assets/wsr-automation/css/style.css\">\n    <!--<script src=\"https://ajax.googleapis.com/ajax/libs/jquery/1.12.0/jquery.min.js\"></script>-->\n    <!--<script src=\"http://ajax.googleapis.com/ajax/libs/angularjs/1.4.8/angular.min.js\"></script>-->\n    <script src=\"assets/wsr-automation/js/angular.min.js\"></script>\n    <script src=\"assets/wsr-automation/js/jquery-3.1.1.js\"></script>\n</head>\n<body>\n    <main class=\"container\" ng-app=\"weeklyReports\" ng-controller=\"reportsCtrl\">\n        <script type=\"text/ng-template\" id=\"incidentDataTable.html\">\n            <tr ng-repeat=\"data in dataFromTable\">\n                <td ng-repeat=\"values in data track by $index\" ng-class=\"values\" ng-bind=\"values\"></td>\n            </tr>\n        </script>\n        <script type=\"text/ng-template\" id=\"slaViewTable.html\">\n            <tr>\n                <td>Incident</td><td>SLA</td><td>Reported</td><td>Acheived</td><td>Breached</td>\n            </tr>\n            <tr ng-repeat=\"data in dataFromTable\">\n                <td ng-repeat=\"values in data track by $index\" ng-bind=\"values\"></td>\n            </tr>\n        </script>\n        <script type=\"text/ng-template\" id=\"dependencies.html\">\n            <tr ng-repeat=\"data in dataFromTable\">\n                <td ng-repeat=\"values in data track by $index\" ng-bind=\"values\"></td>\n            </tr>\n        </script>\n        <script type=\"text/ng-template\" id=\"incidentSumTable.html\">\n            <tr>\n                <td ng-repeat=\"(key,value) in dataFromTable\" ng-bind=\"key\"></td>\n            </tr>\n            <tr>\n                <td ng-repeat=\"data in dataFromTable\" ng-bind=\"data\"></td>\n            </tr>\n        </script>\n         \n        <div class=\"clearfix\">\n            <img src=\"assets/wsr-automation/images/mns-logo.jpg\" alt=\"Marks and Spencer logo\" id=\"mnsLogo\">\n            <img src=\"assets/wsr-automation/images/sapient-nitro.png\" alt=\"SapientNitro logo\" id=\"sapientLogo\">\n        </div>\n        <div class=\"clearfix\">\n            <img src=\"assets/wsr-automation/images/print-icon.png\" alt=\"Print Logo\" id=\"printLogo\" ng-click=\"printOption()\">\n        </div>\n\n        <section class=\"clearfix\">\n            <h2>Dependencies</h2>\n            <table id=\"dependTable\">\n                <caption>PMR Tracker</caption>\n                <tbody id=\"dependencies\" table-dir dataparam=tableDatas.dependenciesData ></tbody>\n            </table>\n            <!--<table id=\"knownErrorTable\">\n                \n                <!<tbody>\n                    <tr><td>SHOPSN-957</td>\n                    <td>HTTP 500 |/MSInventoryAjaxRefresh</td>\n                    </tr>\n                    <tr><td>SHOPLS-1841</td>\n                    <td>Space in First name and Last name in address book in My Account</td>\n                    </tr>\n                </tbody>-->\n            <!--</table>-->\n            \n        \n    </main>\n\n    <script src=\"assets/wsr-automation/js/app.js\"></script>\n    <script src=\"assets/wsr-automation/js/executiveSummary/newcontroller.js\"></script>\n    <script src=\"assets/wsr-automation/js/common/createTable.directive.js\"></script>\n    <!--<script src='http://js.nicedit.com/nicEdit-latest.js'></script>-->\n    <script src='assets/wsr-automation/js/common/jqueryeditable.js'></script>\n<style>\n    .edit_area textarea {\n        padding:1px;\n    }\n    .edit_area {\n        padding:1px;\n    }\n    #dependTable {\n        width:100%;\n    }\n</style>\n<script type=\"text/javascript\">\nvar tableDatas={{{tableDatas}}};\nvar dateDisplay=tableDatas.date;\n//var accompl=accomp.value;\n\n$(document).ready(function() {\n    //$(\"#accomplishments .edit_area\").html(accompl);\n     $('.edit').editable('http://www.example.com/save.php', {\n         indicator : 'Saving...',\n         tooltip   : 'Click to edit...'\n     });\n     /*$('.edit_area').editable('http://www.example.com/save.php', {\n         type      : 'textarea',\n         cancel    : 'Cancel',\n         submit    : 'OK',\n         indicator : '<img src=\"assets/images/edit-button.png\">',\n         tooltip   : 'Click to edit...'\n     });*/\n\n     $('.edit_area').editable(function(value, settings) {\n       // console.log(tableDatas);\n       var idName=$(this).attr(\"id\");\n       //value=value.trim();\n         //console.log(value);\n        // console.log(settings);\n                   //  data     : {\"date\":new Date(dateDisplay),idName:value},\n            var postData= {\n                \"date\":new Date(dateDisplay),\n                \"name\":idName,\n                \"value\":value\n            }\n            //postData[idName]=value;\n            //postData[\"name\"]=idName;\n         $.ajax({\n            type     : \"POST\",\n            cache    : false,\n            url      : \"http://localhost/writeSummary\",\n            data     : postData,\n            success  : function(data) {\n               // $(\".printArea\").empty().append(data).css('visibility','visible');\n               console.log(\"success\");\n              // console.log(value);\n               \n            }\n        });//ajax\n         return(value);\n      }, {\n         type    : 'textarea',\n         submit  : 'OK',\n        cancel    : 'Cancel'\n\n     });\n });\n</script>\n\n</body>\n\n</html>\n\n\n\n",
        "x": 384,
        "y": 698,
        "wires": [
            [
                "f77399ed.ed6828"
            ]
        ]
    },
    {
        "id": "8a6dc197.57054",
        "type": "function",
        "z": "73c2b0f6.41dab",
        "name": "",
        "func": "var tableDatas={};\nvar dependenciesData=[\n    [\"PMR Tracker\",\"Dependency Detail\",\"Status\",\"Owner\",\"Comments\",\"Next Step Owner\",\"Last Update Date\",\"Last Update By\"],\n    //[\"Weekly Report (MM/DD/YYYY)\"],\n    //[\"Overall\",\"Green\",\"Green\",\"Green\",\"Green\",\"Green\",\"Green\"],\n    //[\"Incidents\"],\n    //[\"Problem Records\"]\n];\ndependenciesData[1]=new Array(8);\n//knownErrorDatas[1]=[]\n//knownErrorDatas[2]=new Array(11);\n\nvar months=[\"January\",\"February\",\"March\",\"April\",\"May\",\"June\",\"July\",\"August\",\"September\",\"October\",\"November\",\"December\"];\n\nfunction getfulldate(today) { //returns date in mm/dd/yyyy format\n  var currentDate=today.getDate(),\n    currentMonth=today.getMonth()+1;\n  var x=(currentMonth<10)?('0'+currentMonth):currentMonth;\n  var y=(currentDate<10)?('0'+currentDate):currentDate;\n  return (x+'/'+y+'/'+today.getFullYear());\n}\nfunction getLastSunday(d) { //returns last sunday date takes input as mm/dd/yyyy\n    var t = new Date(d);\n    t.setDate(t.getDate() - t.getDay());\n    return t;\n}\nfunction getDateStamp(dateStamp) {\n  var monthName=[\"Jan\", \"Feb\", \"Mar\", \"Apr\", \"May\", \"June\",\"July\", \"Aug\", \"Sept\", \"Oct\", \"Nov\", \"Dec\"];\n  var newDate= new Date(dateStamp);\n  return newDate.getDate()+\"-\"+monthName[newDate.getMonth()]+\"-\"+newDate.getFullYear();\n}\n\nvar lastSundaydate=getLastSunday(getfulldate(new Date()));\ntableDatas[\"date\"]=getDateStamp(lastSundaydate);\nvar lastSunday=getfulldate(lastSundaydate);\nconsole.log(lastSundaydate);\nvar monthNames=lastSundaydate.getMonth();\n/*for (var i=0;i<6;i++) {\n    var nameMonth=months[monthNames-i];\n    knownErrorDatas[0][i+2]=\"No of occurences in \"+nameMonth;\n    \n    \n}*/\ntableDatas[\"dependenciesData\"]=dependenciesData;\n//msg.tableDatas=tableDatas;\nmsg.tableDatas= JSON.stringify(tableDatas);\nmsg.tableData=tableDatas;\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 252,
        "y": 717,
        "wires": [
            [
                "95d8c217.ca0ff"
            ]
        ]
    },
    {
        "id": "9d53c0d.3f08c4",
        "type": "http in",
        "z": "17f54f18.339b21",
        "name": "",
        "url": "/wsrReport",
        "method": "get",
        "swaggerDoc": "",
        "x": 136.66665649414062,
        "y": 226.03178215026855,
        "wires": [
            [
                "c9aea88d.473738",
                "c28b309d.0c668",
                "b65c131b.23628",
                "5d15f246.d5b7fc",
                "15bdb22b.9b52de"
            ]
        ]
    },
    {
        "id": "9a209c2d.e579f",
        "type": "http response",
        "z": "17f54f18.339b21",
        "name": "",
        "x": 1002.4363632202148,
        "y": 129.4523754119873,
        "wires": []
    },
    {
        "id": "c9aea88d.473738",
        "type": "http request",
        "z": "17f54f18.339b21",
        "name": "",
        "method": "GET",
        "ret": "txt",
        "url": "http://127.0.0.1:80/getjson",
        "tls": "",
        "x": 326.26983642578125,
        "y": 196.61904907226562,
        "wires": [
            [
                "1e544feb.ab3d9"
            ]
        ]
    },
    {
        "id": "1e544feb.ab3d9",
        "type": "function",
        "z": "17f54f18.339b21",
        "name": "",
        "func": "msg.identifier = 'all-incidents';\n//console.log(msg.identifier);\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 494.2698059082031,
        "y": 182.73016548156738,
        "wires": [
            [
                "f3fe9ba.c7b1768"
            ]
        ]
    },
    {
        "id": "c28b309d.0c668",
        "type": "http request",
        "z": "17f54f18.339b21",
        "name": "",
        "method": "GET",
        "ret": "txt",
        "url": "http://127.0.0.1:80/getpr",
        "tls": "",
        "x": 310.797607421875,
        "y": 277.56349182128906,
        "wires": [
            [
                "746ca55a.fffb7c"
            ]
        ]
    },
    {
        "id": "746ca55a.fffb7c",
        "type": "function",
        "z": "17f54f18.339b21",
        "name": "",
        "func": "msg.identifier=\"problem-record\";\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 481.04761505126953,
        "y": 268.174596786499,
        "wires": [
            [
                "f3fe9ba.c7b1768"
            ]
        ]
    },
    {
        "id": "f3fe9ba.c7b1768",
        "type": "function",
        "z": "17f54f18.339b21",
        "name": "",
        "func": "if (!context.data){\n   context.data = {\n       csvdata: {}\n   };\n} \nif(msg.identifier === \"all-incidents\"){\n    context.data.csvdata.allIncident = msg.payload;\n} else if(msg.identifier === \"aecom\") {\n    context.data.csvdata.aecomData = msg.payload;\n} else if (msg.identifier === \"calendar-event\") {\n    context.data.csvdata.calendarEvent=msg.payload;\n} else if (msg.identifier===\"summary-event\") {\n    context.data.csvdata.summaryData = msg.payload;\n \n}\nelse {\n    context.data.csvdata.probRecords = msg.payload;\n}\nif(context.data.csvdata.allIncident && context.data.csvdata.probRecords && context.data.csvdata.aecomData && context.data.csvdata.calendarEvent && context.data.csvdata.summaryData){\n    msg.payload = context.data;\n    context.data = null;\n    msg.incidentData=JSON.parse(msg.payload.csvdata.allIncident);\n    msg.probRecords=JSON.parse(msg.payload.csvdata.probRecords);\n    msg.aecomData=JSON.parse(msg.payload.csvdata.aecomData);\n    msg.calendarEvents=msg.payload.csvdata.calendarEvent;\n    msg.summaryData=JSON.parse(msg.payload.csvdata.summaryData);\n    return msg;\n}",
        "outputs": "1",
        "noerr": 0,
        "x": 708.7419281005859,
        "y": 154.1746063232422,
        "wires": [
            [
                "517151c0.7e0cc"
            ]
        ]
    },
    {
        "id": "9658e19f.b910d",
        "type": "template",
        "z": "17f54f18.339b21",
        "name": "",
        "field": "payload",
        "fieldType": "msg",
        "format": "handlebars",
        "syntax": "mustache",
        "template": "<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n    <meta charset=\"UTF-8\">\n    <title>MNS-Reporting</title>\n    <link rel=\"stylesheet\" type=\"text/css\" href=\"assets/wsr-automation/css/style.css\">\n    <script src=\"assets/wsr-automation/js/angular.min.js\"></script>\n    <script src=\"assets/wsr-automation/js/jquery-3.1.1.js\"></script>\n    <script src=\"assets/wsr-automation/js/ng-google-chart.min.js\"></script>\n    <script src=\"assets/wsr-automation/js/app.js\"></script>\n    <script src=\"assets/wsr-automation/js/trends/newtrendscontroller1.js\"></script>\n    <script src=\"assets/wsr-automation/js/common/createTable.directive.js\"></script>\n    <!--<script src='http://js.nicedit.com/nicEdit-latest.js'></script>-->\n    <script src='assets/wsr-automation/js/common/jqueryeditable.js'></script>\n<style>\n    .edit_area textarea {\n        padding:1px;\n    }\n    .edit_area {\n        padding:1px;\n    }\n    /*input {\n        display:none;\n    }*/\n</style>\n<style tyle=\"text/css\">\n   <!--\n   \n   @media print\n   {\n       #wsrPage {\n           display:block !important;\n       }\n       #trendsPage {\n           display:block !important;\n       }\n       #knownErrorPage {\n           display:block !important;\n       }\n       #dependencyPage {\n           display:block !important;\n       }\n       \n   }\n\n   -->\n</style>\n<style>\n@media print\n   {\n       #wsrPage {\n           display:block;\n       }\n       #trendsPage {\n           display:block;\n       }\n       #knownErrorPage {\n           display:block;\n       }\n       #dependencyPage {\n           display:block;\n       }\n       \n       \n       .container {\n           display:block;\n       }\n       \n   }\ninput {\n    display:none;\n}\npre {\n           padding: 0 10px;\n       }\n.top-menu {\n \n        line-height: 2em;\n    float: left;\n    width: 25%;\n    background-color: #ccc;\n    height: 2em;\n    font-size: 22px;\n    text-align: center;\n}\n.top-menu label {\n    display:block;\n}\n.top-menu:hover {\n    background-color: #aaa;\n}\n\n\n\n</style>\n\n<script type=\"text/javascript\">\n\n</script>\n<script type=\"text/javascript\">\n    var tableDatas={{{tableDatas}}};\n    var dateDisplay=tableDatas.date;\n    var chartObject={{{chartObject}}};\n    var chartObject1={{{chartObject1}}};\n    var chartObject2={{{chartObject2}}};\n    var chartObject3={{{chartObject3}}};\n    var chartObject4={{{chartObject4}}}\n    var chartObject5={{{chartObject5}}};\n\n$(document).ready(function() {\n    $(\".container\").css('display','none');\n    $(\"#wsrPage\").css('display','block');\n    $('input[name=accordion-group]:checked').parent('div').css('background-color','#999');\n\n    $.getJSON(\"https://spreadsheets.google.com/feeds/list/1dpz61PIETKNnIleJxPN4GPq0J0mXXpDfr0PnMGwUYLo/od6/public/values?alt=json\", function(data) {\n    for (var i=0;i<data.feed.entry.length;i++) {\n        //console.log(data.feed.entry[i[\"gsx$jira\"]]);\n    }\n});\n\n    //$(\"#accomplishments .edit_area\").html(accompl);\n    $('input[name=accordion-group]').on('change', function() {\n        var inputValue=$('input[name=accordion-group]:checked').val();\n        $('input[name=accordion-group]').parent('div').css('background-color','#ccc');\n\n        $('input[name=accordion-group]:checked').parent('div').css('background-color','#999');\n        switch (inputValue) {\n            case \"wsr\": \n            $(\".container\").css('display','none');\n            $(\"#wsrPage\").css('display','block');\n            break;\n            case \"trends\": \n            $(\".container\").css('display','none');\n            $(\"#trendsPage\").css('display','block');\n            break;\n            case \"known\":\n            $(\".container\").css('display','none');\n            $(\"#knownErrorPage\").css('display','block');\n            break;\n            case \"depend\":\n            $(\".container\").css('display','none');\n            $(\"#dependencyPage\").css('display','block');\n            break;\n        }\n               //console.log($('input[name=accordion-group]:checked').val())\n       //alert($('input[name=accordion-group]:checked').val()); \n    });\n     $('.edit').editable('http://www.example.com/save.php', {\n         indicator : 'Saving...',\n         tooltip   : 'Click to edit...'\n     });\n\n     $('.edit_area').editable(function(value, settings) {\n        var idName=$(this).attr(\"id\");\n            var postData= {\n                \"date\":new Date(dateDisplay),\n                \"name\":idName,\n                \"value\":value\n            }\n            //postData[idName]=value;\n            //postData[\"name\"]=idName;\n         $.ajax({\n            type     : \"POST\",\n            cache    : false,\n            url      : \"http://localhost/writeSummary\",\n            data     : postData,\n            success  : function(data) {\n               // $(\".printArea\").empty().append(data).css('visibility','visible');\n               console.log(\"success\");\n              // console.log(value);\n               \n            }\n        });//ajax\n         return(value);\n      }, {\n         type    : 'textarea',\n         submit  : 'OK',\n        cancel    : 'Cancel'\n\n     });\n });\n</script>\n</head>\n<body ng-app=\"trendsReport\" id=\"accordion\">\n        <script type=\"text/ng-template\" id=\"incidentDataTable.html\">\n            <tr ng-repeat=\"data in dataFromTable\">\n                <td ng-repeat=\"values in data track by $index\" ng-class=\"values\" ng-bind=\"values\"></td>\n            </tr>\n        </script>\n        <script type=\"text/ng-template\" id=\"slaViewTable.html\">\n            <tr>\n                <td>Incident</td><td>SLA</td><td>Reported</td><td>Acheived</td><td>Breached</td>\n            </tr>\n            <tr ng-repeat=\"data in dataFromTable\">\n                <td ng-repeat=\"values in data track by $index\" ng-bind=\"values\"></td>\n            </tr>\n        </script>\n        <script type=\"text/ng-template\" id=\"incidentSumTable.html\">\n            <tr>\n                <td ng-repeat=\"(key,value) in dataFromTable\" ng-bind=\"key\"></td>\n            </tr>\n            <tr>\n                <td ng-repeat=\"data in dataFromTable\" ng-bind=\"data\"></td>\n            </tr>\n        </script>\n        <script type=\"text/ng-template\" id=\"knownErrorTable.html\">\n            <tr ng-repeat=\"data in dataFromTable\">\n                <td ng-repeat=\"values in data track by $index\" ng-bind=\"values\"></td>\n            </tr>\n        </script>\n        <script type=\"text/ng-template\" id=\"dependencies.html\">\n            <tr ng-repeat=\"data in dataFromTable\">\n                <td ng-repeat=\"values in data track by $index\" ng-bind=\"values\"></td>\n            </tr>\n        </script>\n        <div class=\"clearfix\">\n            <img src=\"assets/wsr-automation/images/mns-logo.jpg\" alt=\"Marks and Spencer logo\" id=\"mnsLogo\">\n            <img src=\"assets/wsr-automation/images/sapient-nitro.png\" alt=\"SapientNitro logo\" id=\"sapientLogo\">\n        </div>\n        <div class=\"clearfix\" ng-controller=\"reportsCtrl\">\n            <img src=\"assets/wsr-automation/images/print-icon.png\" alt=\"Print Logo\" id=\"printLogo\" ng-click=\"printOption()\">\n        </div>\n        <div class=\"clearfix\" id=\"mainMenu\">\n            <div class=\"top-menu\">\n            <input type=\"radio\" name=\"accordion-group\" id=\"option-1\" value=\"wsr\" checked=\"checked\"/>\n            <label for=\"option-1\">Executive Summary</label>\n\n            </div>\n            <div class=\"top-menu\">\n            <input type=\"radio\" name=\"accordion-group\" id=\"option-2\" value=\"trends\" />\n                        <label for=\"option-2\">Trends</label>\n                        </div>\n                        <div class=\"top-menu\">\n\n            <input type=\"radio\" name=\"accordion-group\" id=\"option-3\" value=\"known\" />\n                        <label for=\"option-3\">Known Errors</label>\n                        </div>\n                        <div class=\"top-menu\">\n\n            <input type=\"radio\" name=\"accordion-group\" id=\"option-4\" value=\"depend\"/>\n                        <label for=\"option-4\">Dependencies</label>\n                        </div>\n\n            \n            <main id=\"wsrPage\" class=\"container\" ng-controller=\"reportsCtrl\">\n\n                <section class=\"clearfix\">\n                    <h1>\n                        M&S eCom Support Weekly Status Report - Week Ending  {{tableData.date}}\n                    </h1>\n                    <table id=\"incidents\">\n                        <caption>Incidents originating in Week ending {{tableData.date}}</caption>\n                        <tbody id=\"incidentDataTable\" table-dir dataparam=tableDatas.incidentData></tbody>\n                    </table>\n                    <table id=\"slaView\">\n                        <caption>SLA View for Week ending {{tableData.date}}</caption>\n                        <tbody id=\"slaViewTable\" table-dir dataparam=\"tableDatas.slaView\"></tbody>\n                    </table>\n                    <table id=\"incidentSummary\" style=\"clear: both;\">\n                        <caption>Incident Summary till {{tableData.date}}</caption>\n                        <tbody id=\"incidentSumTable\" table-dir dataparam=\"tableDatas.incidentSummary\"></tbody>\n                    </table>\n                </section>\n\n                <section>\n                    <!--<h1>\n                        M&S eCom Support Weekly Status Report - Week Ending  {{tableData.date}}\n                    </h1>-->\n                    <div id=\"keyUpdates\" class=\"sections\">\n                        <div class=\"header-div\">\n                            <span class=\"edit-button\"></span>\n                            <h2 class=\"headlines\">Key updates</h2>\n                        </div>\n\n                        <div id=\"myArea1\" class=\"edit-div\">\n                            <div>\n                                <h3>Progress Last Week RAYG : GREEN</h3>\n                                <ul>\n                                    <li>Total <span>69</span> incidents were raised in last week. Pending triage incidents are currently <span>29</span>.</li>\n                                    <li>1 Sev 2's were raised last week.\n                                        <ul>\n                                            <li>Sev 2 | INC000021527174 | EMAIL-PROBE (Site Confidence Alert:Script Step[28065111]) - Site Confidence Alert Script Step - Site Confidence Journey was failing</li>\n                                        </ul>\n                                    </li>\n                                </ul>\n                                <h3>Business Events</h3>\n                                <ul>\n                                    <li>NA</li>\n                                </ul>\n                                \n                                <!--<ul>\n                                    <li><span>2</span> Open (0 Draft ,2 Pending, 0 Under Review)</li>\n                                </ul>-->\n                                \n                                <!--<ul>\n                                    <li>PROD | B&C | THROTTLE | Moving Mobile/App to -6 and Basket change <span>21st Mar</span></li>\n                                    <li>PROD | Throttling to 100% New Basket for CS and Stores <span>23rd Mar</span></li>\n                                    <li>PROD | CM-182 | SPARKS - FE change for Sparks FAQs link <span>24th Mar</span></li>\n                                    <li>PROD | CM-183 | Whitelisting Omniture rest API Url for Prod Servers <span>24th Mar</span></li>\n                                    <li>PROD | Timezone change to BST <span>27th Mar</span></li>\n                                    <li>SIT3 | R26 Deployment <span>21st Mar</span></li>\n                                    <li>SIT3/B | Apply RHEL Patch <span>23rd Mar</span></li>\n                                </ul>-->\n                            </div>\n                        </div>\n                        <div class=\"noneditable-container\" style=\"border-top:solid 1px black;padding-left:4px;\">\n\n                                \n\n                                    {{#problemArrayDraft.length}}\n                                        <h3>Problem Record</h3>\n                                            <table>\n                                                <tr>\n                                                    <td>Problem ID</td>\n                                                    <td>Summary</th>\n                                                    <td>Assignee</td>\n                                                    <td>Status</td>\n                                                    <td>Ageing</td>\n                                                    <td>Open Date</td>\n\n                                                </tr>\n                                    {{/problemArrayDraft.length}}\n                                    {{#problemArrayDraft}}\n                                        <tr> \n                                            <td>{{Problem ID*+}}</td>\n                                            <td>{{Summary*}}</td>\n                                            <td>{{Assignee+}}</td>\n                                            <td>{{Status*}}</td>\n                                            <td>{{ageings}}</td>\n                                            <td>{{Submit Date}}</td>\n\n                                        </tr>\n                                    {{/problemArrayDraft}}\n                                 </table>\n\n                                \n                                <h3>Environments</h3>\n                                <ul>\n                                    {{#lastEventList}}\n                                    <li>\n                                        {{summary}}\n                                    </li>\n                                    {{/lastEventList}}\n                                    {{^lastEventList}}\n                                    <li>NA</li>\n                                    {{/lastEventList}}\n                                </ul>\n                        </div>\n                    </div>\n                    <div id=\"nextWeekPlan\" class=\"sections\" >\n                        <div class=\"header-div\">\n                            <span class=\"edit-button\"></span>\n                            <h2 class=\"headlines\"> Plan for next week</h2>\n                        </div>\n\n                        <div id=\"nextWeek\" class=\"edit-div\" >\n                            <h3>Business Events</h3>\n                            <ul>\n                                <li>NA</li>\n                            </ul>\n                                \n                            <!--<ul>\n                                <li>PROD | RHEL Patching DR <span>28th Mar</span></li>\n                                <li>PROD | Bing SIte Authorisation Update in AKAMAI <span>29th Mar</span></li>\n                                <li>PROD | RHEL Patching BURST <span>29th Mar</span></li>\n                                <li>PROD | R26 Deployment <span>30th Mar</span></li>\n                                <li>DR | QA3 | R26 Deployment <span>31st Mar</span></li>\n                            </ul>-->\n                        </div>\n                        <div class=\"noneditable-container\" style=\"border-top:solid 1px black;padding-left:4px;\">\n                            <h3>Environments</h3>\n                                <ul>\n                                    {{#eventList}}\n                                    <li>\n                                        {{summary}}\n                                    </li>\n                                    {{/eventList}}\n                                    {{^eventList}}\n                                    <li>NA</li>\n                                    {{/eventList}}\n                                </ul>\n                        </div>\n                    </div>\n                    <div id=\"risksIssues\" class=\"sections\">\n                        <div class=\"header-div\">\n                            <span class=\"edit-button\"></span>\n                            <h2 class=\"headlines\">Key risks/issues</h2>\n                        </div>\n                    <pre><div class=\"edit_area\" id=\"keyRisk\" style=\"min-height:50px\">{{#keyrisk}}{{{value}}}{{/keyrisk}}</div></pre>\n                        <!--<div id=\"risk\" class=\"edit-div\">\n                            <ul>\n                                <!--<li>Single Prod/ non-Prod account for Bing request. There is threshhold of 50 requested in 24 hrs</li>\n                                <li>Stageprop session killed twice</li>-->\n                               <!-- <li>NA</li>\n                            </ul>\n                        </div>-->\n                    </div>\n                    <div id=\"accomplishments\" class=\"sections\">\n                        <div class=\"header-div\">\n                            <span class=\"edit-button\"></span>\n                            <h2 class=\"headlines\">Accomplishments</h2>\n                        </div>\n                       <pre><div class=\"edit_area\" id=\"accomp\" style=\"min-height:50px\">{{#accomp}}{{{value}}}{{/accomp}}</div></pre>\n\n\n                    </div>\n                </section>\n            </main>\n        \n            <main id=\"trendsPage\" class=\"container\" ng-controller=\"trendsCtrl\">\n                <script type=\"text/ng-template\" id=\"incidentBurnTable.html\">\n                    <tr ng-repeat=\"data in dataFromTable\">\n                        <td ng-repeat=\"values in data track by $index\" ng-class=\"values\" ng-bind=\"values\"></td>\n                    </tr>\n                </script>\n                <script type=\"text/ng-template\" id=\"incidentAgeTable.html\">\n                    <tr>\n                        <td>Ageing</td><td>0-7 Days</td><td>8-14 Days</td><td>15-30 Days</td><td>30+ Days</td>\n                    </tr>\n                    <tr ng-repeat=\"data in dataFromTable\">\n                        <td ng-repeat=\"values in data track by $index\" ng-bind=\"values\"></td>\n                    </tr>\n                </script>\n                <script type=\"text/ng-template\" id=\"incidentSumTable.html\">\n                    <tr>\n                        <td ng-repeat=\"(key,value) in dataFromTable\" ng-bind=\"key\"></td>\n                    </tr>\n                    <tr>\n                        <td ng-repeat=\"data in dataFromTable\" ng-bind=\"data\"></td>\n                    </tr>\n                </script>\n                <script type=\"text/ng-template\" id=\"categorizationTable.html\">\n                    <!--<tr>\n                        <td>Categorization</td><td>Current Week</td><td>Week ending 20th Mar</td><td>Week ending 6th Mar</td><td>Week ending 28th Feb</td>\n                    </tr>-->\n                    <tr ng-repeat=\"data in dataFromTable\">\n                        <td ng-repeat=\"values in data track by $index\" ng-class=\"values\" ng-bind=\"values\"></td>\n                    </tr>\n                </script>\n                <script type=\"text/ng-template\" id=\"weeklyAgeingTable.html\">\n                    <tr>\n                        <td>Ageing</td><td>0-7 Days</td><td>8-14 Days</td><td>15-30 Days</td><td>30+ Days</td>\n                    </tr>\n                    <tr ng-repeat=\"data in dataFromTable\">\n                        <td ng-repeat=\"values in data track by $index\" ng-class=\"values\" ng-bind=\"values\"></td>\n                    </tr>\n                </script>\n                <script type=\"text/ng-template\" id=\"releaseAlignmentTable.html\">\n                    <tr>\n                        <td>Row Labels</td><td>Not Aligned</td><td>Release 26</td><td>Grand Total</td>\n                    </tr>\n                    <tr ng-repeat=\"data in dataFromTable\">\n                        <td ng-repeat=\"values in data track by $index\" ng-class=\"values\" ng-bind=\"values\"></td>\n                    </tr>\n                </script>\n\n                <section class=\"clearfix\">\n                    <table id=\"incidentBurnRate\" style=\"width:52%\">\n                        <caption>Overall Incident Burn Rate - Weekly View  (Sev3&4)  </caption>\n                        <tbody id=\"incidentBurnTable\" table-dir dataparam=\"tableDatas.incidentBurn\"></tbody>\n                        <!--<tfoot>\n                            <tr>\n                              <td>Total Open</td>\n                              <td>{{totalOpen}}</td>\n                            </tr>\n                         </tfoot>-->\n                    </table>\n                    <table id=\"incidentAgeing\">\n                        <caption>Overall Incident Ageing for Sev3 & 4</caption>\n                        <tbody id=\"incidentAgeTable\" table-dir dataparam=\"tableDatas.incidentAgeing\"></tbody>\n                    </table>\n                </section>\n                        <section class=\"clearfix\" style=\"float:left;width:100%;margin-top:1%;\">\n                    <section class=\"left-chart\">\n                        <h4>Overall Incident Burn Rate</h4>\n                        <div id=\"chartDiv\" class=\"chart-width\" google-chart chart=\"chartObject\" style=\"{{chart.cssStyle}}\"/>\n                    </section>\n                    <section class=\"right-chart\">\n                        <h4>Overall Incident Ageing</h4>\n            \n                        <div id=\"IncidentAgeChart\" class=\"chart-width\" google-chart chart=\"chartObject1\" style=\"{{chart.cssStyle}}\"/>\n            \n                    </section>\n                </section>\n\n                <section class=\"clearfix\"style=\"float: left;width: 100%;\">\n                    <div class=\"panel-message left-panel\" style=\"width: 52%;\">\n                        {{#summaryInfo}}\n                            <p>{{oneWeekCritical}} Sev 1 was raised last week</p>\n                            <p>{{oneWeekHigh}} Sev 2 was raised last week</p>\n                            {{#criticalIncident}}\n                            <p>-{{Priority}} | {{incidentId}} | {{summary}}</p>\n                            {{/criticalIncident}}\n                            {{#highIncident}}\n                            <p>-{{Priority}} | {{incidentId}} | {{summary}}</p>\n                            {{/highIncident}}\n                        {{/summaryInfo}}\n                    </div>\n                    <div class=\"panel-message right-panel \">\n                        <div class=\"header-div\">\n                                <span class=\"edit-button\"></span>\n                                <h2 class=\"headlines\">Summary</h2>\n                        </div>\n                        <pre><div class=\"edit_area\" id=\"summary1\" style=\"min-height:100px\">{{#summary1}}{{{value}}}{{/summary1}}</div></pre>\n\n                    <!--<div id=\"editPanel1\" class=\"edit-div\">\n                       <!-- <p>- Incident ageing  has been  under control</p>\n                        <p>- Incident older than 15 days</p>\n                        <p>- INC000019293754 -There is a spike in the 500 error for the command /ordercalculate. There are about 68 customer sessions until now out of which 66 customers have abandoned their basket</p>\n                        <p>- INC000018829506 | Sev3 | Increase in count of 404  after R24</p>-->\n                    <!--</div>-->\n                    </div>\n                </section>\n                <section class=\"clearfix\" style=\"clear:both\">\n                    <table id=\"categorization\">\n                        <caption>Categorization of Incidents - Weekly View  </caption>\n                        <tbody id=\"categorizationTable\" table-dir dataparam=\"tableDatas.categorisation\"></tbody>\n                    </table>\n                    <section class=\"right-chart\"> \n                        <!--<h4>Categorization of Incidents</h4>-->\n                        <div id=\"CategorizationChart\" class=\"chart-width\" google-chart chart=\"chartObject2\" style=\"{{chart.cssStyle}}\"/>\n                    </section>\n                </section>\n                <!--<section class=\"clearfix\">\n                    <div class=\"panel-message left-panel\">\n                        <p>71  Incidents closeds</p>\n                        <p>- 12 Connectivity Issue 3rd Party - Site Confidence</p>\n                        <p>- 12 Misdirected/ Invalid call</p>\n                        <p>- 12 Known Error</p>\n                        <p>- 11 Duplicate calls</p>\n                    </div>\n                </section>-->\n                <section class=\"clearfix\" style=\"width: 100%;float:left;margin-top: 3%;\">\n                    <table id=\"weeklyAge\" style=\"margin-top:5%;width:52%;\">\n                        <caption>Overall Problem Record Ageing - Weekly View  </caption>\n                        <tbody id=\"weeklyAgeingTable\" table-dir dataparam=\"tableDatas.probrecordAgeing\"></tbody>\n                    </table>\n                    <!--<table id=\"releaseAlignment\">\n                        <caption>Incidents - Release Alignment : as per JIRA  </caption>\n                        <tbody id=\"releaseAlignmentTable\" table-dir dataparam=\"\"></tbody>\n                    </table>-->\n                    <section class=\"left-chart\" style=\"width: 43%;float: right;\">\n                    <h4>Overall Problem Record Ageing</h4>\n                    <div id=\"weeklyAgeingChart\" class=\"chart-width\" google-chart chart=\"chartObject3\" style=\"{{chart.cssStyle}}\"/>\n                </section>\n                </section>\n                <section class=\"clearfix\" style=\"float: left;width: 100%;margin-top: 5%;\">\n\n                <section class=\"right-chart\">\n                    <h4>Daily Incidents Count</h4>\n                    <div id=\"releaseAlignChart\" class=\"chart-width\" google-chart chart=\"chartObject4\" style=\"{{chart.cssStyle}}\"/>\n                </section>\n                <section class=\"left-chart\" style=\"width:50%\">\n                    <h4>Weekly Incidents Distribution</h4>\n\n                    <div id=\"weeklyAgeingChart1\" class=\"chart-width\" google-chart chart=\"chartObject5\" style=\"{{chart.cssStyle}}\"/>\n                </section>\n                </section>\n                <!--<section class=\"right-chart\">\n                    <div id=\"releaseAlignChart2\" class=\"chart-width\" google-chart chart=\"chartObject6\" style=\"{{chart.cssStyle}}\"/>\n                </section>-->\n                <section class=\"clearfix\">\n                    <div class=\"panel-message left-panel \">\n                        <div class=\"header-div\">\n                                <span class=\"edit-button\"></span>\n                                <h2 class=\"headlines\">Summary</h2>\n                        </div>\n                        <pre><div class=\"edit_area\" id=\"summary2\" style=\"min-height:50px\">{{#summary2}}{{{value}}}{{/summary2}}</div></pre>\n                    <!--<div id=\"editPanel2\" class=\"edit-div\">\n                       <!-- <p>- 0  Under Review for Closure</p>\n                        <p>- 0 Draft</p>\n                        <p>- 0 Under Investigation</p>\n                        <p>- 2 Pending with 3rd parties</p>\n                        <p>- 0 Assigned</p>-->\n                    <!--</div>-->\n                    </div>\n                    <!--<div class=\"panel-message right-panel\">\n                       <p>- 65 incidents are not aligned to any Release</p>\n                        <p>- 0 Pending - Client Action</p>\n                        <p>- 1 Pending 3rd Party</p>\n                        <p>- 0 Future Enhancement</p>\n                        <p>- 0 Client Hold</p>\n                        <p>- 0 Under Monitoring</p>\n                        <p>- 0 In progress</p>\n                    </div>-->\n                </section>\n            </main>\n            \n            <section id=\"knownErrorPage\" class=\"clearfix container\" ng-controller=\"reportsCtrl\">\n                    <h2>Known Errors for week ending {{tableData.date}}</h2>\n                    <!--<table id=\"\">\n                        <tbody id=\"knownErrorTable\" table-dir dataparam=tableDatas.knownErrorData ></tbody>\n                    </table>-->\n                    \n                    \n<iframe src=\"https://docs.google.com/spreadsheets/d/1dpz61PIETKNnIleJxPN4GPq0J0mXXpDfr0PnMGwUYLo/edit?rm=minimal&usp=sharing&embedded=true\" style=\"width:100%;height:2000px\"></iframe>        \n            </section>\n            <section id=\"dependencyPage\" class=\"clearfix container\" ng-controller=\"reportsCtrl\">\n                    <h2>Dependencies</h2>\n                    <iframe src=\"https://docs.google.com/spreadsheets/d/1ij5l34GdwFIjXCdPpvjHCqYdyv_vjSZbWRmsJI4t4fw/edit?rm=minimal&usp=sharing&widget=true&embedded=true\" style=\"width:100%;height:2000px\"></iframe>\n                    <!--<table id=\"dependTable\" style=\"width:100%\">\n                        <caption>PMR Tracker</caption>\n                        <tbody id=\"dependencies\" table-dir dataparam=tableDatas.dependenciesData ></tbody>\n                    </table>-->\n            </section>\n</body>\n\n</html>\n\n\n\n",
        "x": 871.6943969726562,
        "y": 134.84131622314453,
        "wires": [
            [
                "9a209c2d.e579f"
            ]
        ]
    },
    {
        "id": "b65c131b.23628",
        "type": "http request",
        "z": "17f54f18.339b21",
        "name": "",
        "method": "GET",
        "ret": "txt",
        "url": "http://127.0.0.1:80/getaecom",
        "tls": "",
        "x": 326.57054901123047,
        "y": 339.6840944290161,
        "wires": [
            [
                "6b523ebc.75916"
            ]
        ]
    },
    {
        "id": "6b523ebc.75916",
        "type": "function",
        "z": "17f54f18.339b21",
        "name": "",
        "func": "msg.identifier=\"aecom\";\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 508.32410430908203,
        "y": 331.7028388977051,
        "wires": [
            [
                "f3fe9ba.c7b1768"
            ]
        ]
    },
    {
        "id": "5d15f246.d5b7fc",
        "type": "gcalendar",
        "z": "17f54f18.339b21",
        "name": "",
        "topic": "gcalendar",
        "calendarId": "primary",
        "x": 300.4920196533203,
        "y": 127.28572845458984,
        "wires": [
            [
                "7d9dd4d0.09ef1c"
            ]
        ]
    },
    {
        "id": "7d9dd4d0.09ef1c",
        "type": "function",
        "z": "17f54f18.339b21",
        "name": "",
        "func": "msg.identifier=\"calendar-event\";\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 503.6031723022461,
        "y": 108.73015975952148,
        "wires": [
            [
                "f3fe9ba.c7b1768"
            ]
        ]
    },
    {
        "id": "15bdb22b.9b52de",
        "type": "http request",
        "z": "17f54f18.339b21",
        "name": "GetSummary",
        "method": "GET",
        "ret": "txt",
        "url": "http://127.0.0.1:80/getsummary",
        "tls": "",
        "x": 305.0469970703125,
        "y": 49.94229507446289,
        "wires": [
            [
                "2d70f4a2.5f66bc"
            ]
        ]
    },
    {
        "id": "2d70f4a2.5f66bc",
        "type": "function",
        "z": "17f54f18.339b21",
        "name": "",
        "func": "\nmsg.identifier=\"summary-event\";\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 516.2287750244141,
        "y": 29.83370590209961,
        "wires": [
            [
                "f3fe9ba.c7b1768"
            ]
        ]
    },
    {
        "id": "517151c0.7e0cc",
        "type": "function",
        "z": "17f54f18.339b21",
        "name": "",
        "func": "var tableDatas={};\nvar incidentDataJson=[\n    [\"Weekly Report (MM/DD/YYYY)\"],\n    //[\"Overall\",\"Green\",\"Green\",\"Green\",\"Green\",\"Green\",\"Green\"],\n    [\"Incidents\"],\n    [\"Problem Records\"]\n];\nvar slaViewData= [\n  [\"Sev1\",\"4hours\",,,0],\n  [\"Sev2\",\"8hours\",,,0],\n  [\"Sev3/4\",\"NA\",,\"NA\",\"NA\"]\n];\nvar incidentSummary = {};\nvar dateArray=[],currentWeekSummary=[],lastWeekSummary=[],finalWeekArray=[];\n\nfunction getfulldate(today) { //returns date in mm/dd/yyyy format\n  var currentDate=today.getDate(),\n    currentMonth=today.getMonth()+1;\n  var x=(currentMonth<10)?('0'+currentMonth):currentMonth;\n  var y=(currentDate<10)?('0'+currentDate):currentDate;\n  return (x+'/'+y+'/'+today.getFullYear());\n}\nfunction getLastSunday(d) { //returns last sunday date takes input as mm/dd/yyyy\n    var t = new Date(d);\n    t.setDate(t.getDate() - t.getDay());\n    return t;\n}\nfunction getDateStamp(dateStamp) {\n  var monthName=[\"Jan\", \"Feb\", \"Mar\", \"Apr\", \"May\", \"June\",\"July\", \"Aug\", \"Sept\", \"Oct\", \"Nov\", \"Dec\"];\n  var newDate= new Date(dateStamp);\n  return newDate.getDate()+\"-\"+monthName[newDate.getMonth()]+\"-\"+newDate.getFullYear();\n}\n\nvar lastSundaydate=getLastSunday(getfulldate(new Date()));\ntableDatas[\"date\"]=getDateStamp(lastSundaydate);\nvar lastSunday=getfulldate(lastSundaydate);\nvar i=2;\ndateArray[i-1]=lastSunday;\nincidentDataJson[0][i-1]=getDateStamp(new Date(lastSunday));\ndo{\n  var newlastSundaydate=new Date(lastSundaydate.setDate(lastSundaydate.getDate() - 7));\n  var newlastSunday=getfulldate(newlastSundaydate);\n  dateArray[i]=newlastSunday;\n  incidentDataJson[0][i]=getDateStamp(new Date(newlastSunday));\n  //incidentDataJson[0][i]=newlastSunday;\n  lastSundaydate=newlastSundaydate;\n  lastSunday=newlastSunday;\n  i++;\n} while(i<7);\n\n\n/***incident Count ***/\nvar firstEl=true,criticalCount=0,highCount=0,lowCount=0,totalIncidentCount=0,activeIncident=0;\n\nfor (var i=1;i<incidentDataJson[0].length;i++) {\nvar dateTo=dateArray[i];\n  //var dateTo=incidentDataJson[0][i];\n    var to=new Date(dateTo);\n    var newto=new Date(dateTo);\n    var dateFrom=new Date(newto.setDate(newto.getDate() - 6));\n    var incidentCount=0;\n  for (var j=0;j<msg.incidentData.length;j++) {\n    var getDate=msg.incidentData[j][\"Reported Date+\"];\n      var daterange=getDate.substring(0, getDate.indexOf(' '));\n      var check=new Date(daterange);\n      if(firstEl && (msg.incidentData[j][\"Priority*\"]===\"Medium\" || msg.incidentData[j][\"Priority*\"]===\"Critical\" || msg.incidentData[j][\"Priority*\"]===\"High\")) {\n        totalIncidentCount++;\n          if(msg.incidentData[j][\"Status*\"]===\"Assigned\" || msg.incidentData[j][\"Status*\"]===\"Pending\") {\n        activeIncident++;\n      }\n    }\n    if(check >= dateFrom && check <= to ) {\n          incidentCount++;\n          if(msg.incidentData[j][\"Priority*\"]===\"Critical\" && firstEl) {\n            criticalCount++;\n          }\n          if(msg.incidentData[j][\"Priority*\"]===\"High\" && firstEl) {\n            highCount++;\n          }\n          if((msg.incidentData[j][\"Priority*\"]===\"Medium\" || msg.incidentData[j][\"Priority*\"]===\"Low\") && firstEl) {\n            lowCount++;\n          }\n\n\n      }\n  }\n  firstEl=false;\n  incidentDataJson[1][i]=incidentCount;\n}\n\n\n/***problem Count ***/\nvar problemArrayDraft=[],problemArrayReview=[];\n  for (var i=1;i<incidentDataJson[0].length;i++) {\n    var dateTo=dateArray[i];\n  //var dateTo=incidentDataJson[0][i];\n        var to=new Date(dateTo);\n        var newto=new Date(dateTo);\n        var dateFrom=new Date(newto.setDate(newto.getDate() - 6));\n        var problemCount=0;\n    for (var j=0;j<msg.probRecords.length;j++) {\n      var getDate=msg.probRecords[j][\"Submit Date\"];\n        var daterange=getDate.substring(0, getDate.indexOf(' '));\n        var check=new Date(daterange);\n      if(check >= dateFrom && check <= to && msg.probRecords[j][\"Status*\"]===\"Draft\" ) {\n              problemCount++;\n          }\n          if(i===1) {\n             if(check >= dateFrom && check <= to && msg.probRecords[j][\"Status*\"]===\"Draft\" ) {\n                 var oneDay = 24*60*60*1000;\n                 var dayy1=new Date(new Date().setHours(0,0,0,0));\n                 var diffDays = Math.round(Math.abs((dayy1.getTime() - check.getTime())/(oneDay)));\n                    msg.probRecords[j][\"ageings\"]=diffDays;\n                    var gDate=msg.probRecords[j][\"Submit Date\"];\n                    msg.probRecords[j][\"Submit Date\"]=gDate.substring(0, gDate.indexOf(' '));\n                  problemArrayDraft.push(msg.probRecords[j]);\n              } \n              if(check >= dateFrom && check <= to && msg.probRecords[j][\"Status*\"]===\"Under Review\" ) {\n                  var oneDay = 24*60*60*1000;\n                 var dayy1=new Date(new Date().setHours(0,0,0,0));\n                 var diffDays = Math.round(Math.abs((dayy1.getTime() - check.getTime())/(oneDay)));\n                    msg.probRecords[j][\"ageings\"]=diffDays;\n                    var gDate=msg.probRecords[j][\"Submit Date\"];\n                    msg.probRecords[j][\"Submit Date\"]=gDate.substring(0, gDate.indexOf(' '));\n                  problemArrayReview.push(msg.probRecords[j]);\n              }\n          }\n    }\n    incidentDataJson[2][i]=problemCount;\n  }\n\n\n  /***total incident count****/\n    for (var j=0;j<msg.aecomData.length;j++) {\n      if(msg.aecomData[j][\"Priority*\"]===\"Low\") {\n        totalIncidentCount++;\n        if(msg.aecomData[j][\"Status*\"]===\"Assigned\" || msg.aecomData[j][\"Status*\"]===\"Pending\") {\n          activeIncident++;\n        }\n      }\n\n    }\n\n\nslaViewData[0][2]=criticalCount;\nslaViewData[0][3]=criticalCount;\nslaViewData[1][2]=highCount;\nslaViewData[1][3]=highCount;\nslaViewData[2][2]=lowCount;\nincidentSummary[\"Total Incidents\"]=totalIncidentCount;\nincidentSummary[\"Active Incidents\"]=activeIncident;\nincidentSummary[\"Non-Active Incidents\"]=totalIncidentCount-activeIncident;\ntableDatas[\"incidentData\"]=incidentDataJson;\ntableDatas[\"slaView\"]=slaViewData;\ntableDatas[\"incidentSummary\"]=incidentSummary;\n\n//msg.tableDatas= JSON.stringify(tableDatas);\n//msg.tableData=tableDatas;\nvar lastSun=getLastSunday(new Date());\nvar lastSun1=new Date(lastSun);\nvar lastSun2=new Date(lastSun1);\nvar lastSun3=new Date(lastSun1);\nvar nextWeek=new Date(lastSun2.setDate(lastSun2.getDate() + 7));\nvar lastWeek=new Date(lastSun3.setDate(lastSun3.getDate() - 10)); \n  var eventArray=[],lasteventArray=[];\n\nfor (var i=0;i<msg.calendarEvents.length;i++) {\n   var imDate=Date.parse(msg.calendarEvents[i].start.dateTime);\n  var calendarDate=new Date(imDate);\n  if(calendarDate>lastSun1 && calendarDate<=nextWeek ) {\n      //console.log(msg.calendarEvents[i].summary)\n      eventArray.push({\"summary\":msg.calendarEvents[i].summary});\n  }\n  if(calendarDate<=lastSun1 && calendarDate>=lastWeek ) {\n     lasteventArray.push({\"summary\":msg.calendarEvents[i].summary});\n\n  }\n  \n \n}\nvar lastSun=getLastSunday(new Date());\nmsg.eventList=eventArray;\nmsg.lastEventList=lasteventArray;\nmsg.problemArrayDraft=problemArrayDraft;\nmsg.problemArrayReview=problemArrayReview;\n\n/***Summary**/\n/*function lw(nameval) {\n  for (var i=0;i<lastWeekSummary.length;i++) {\n    if(lastWeekSummary[i][\"name\"]===nameval && lastWeekSummary[i][\"value\"]!==\"\") {\n      return lastWeekSummary[i];\n    } else {\n        var defaultObj= {\n          \"name\":nameval,\n          \"value\": \"NA\"\n        };\n        return defaultObj;\n    }\n  }\n}*/\nfor (var i=0;i<msg.summaryData.length;i++)\n{\n    var summarydate=msg.summaryData[i][\"date\"];\n    if(new Date(summarydate).getTime()==new Date(dateArray[1]).getTime()){\n        currentWeekSummary.push(msg.summaryData[i]);\n    } else if (new Date(summarydate).getTime()==new Date(dateArray[2]).getTime()){\n        lastWeekSummary.push(msg.summaryData[i]);\n    }\n}\n//console.log(\"currentWeek\",currentWeekSummary);\n//console.log(\"lastWeek\",lastWeekSummary);\nvar arr=[\"keyRisk\",\"accomp\",\"summary1\",\"summary2\"];\n/*for (var i=0;i<currentWeekSummary.length;i++) {\n  if(currentWeekSummary[i][\"value\"]!==\"\") {\n    if (currentWeekSummary[i][\"name\"]===\"keyRisk\") {\n      msg.keyrisk=currentWeekSummary[i];\n    } else if (currentWeekSummary[i][\"name\"]===\"accomp\") {\n      msg.accomp=currentWeekSummary[i];\n    }\n    finalWeekArray.push(currentWeekSummary[i]);\n  } else {\n      var lastWeekObj=lw(currentWeekSummary[i][\"name\"]);\n      if (lastWeekObj[\"name\"]===\"keyRisk\") {\n        msg.keyrisk=lastWeekObj;\n      } else if (lastWeekObj[\"name\"]===\"accomp\") {\n        msg.accomp=lastWeekObj;\n      }\n      finalWeekArray.push(lastWeekObj);\n  }\n\n} \nif(currentWeekSummary.length===0) {\n    msg.finalWeekArray=currentWeekSummary;\n}*/\nfunction searchArray(arrayList,ele) {\n  for (var i=0;i<arrayList.length;i++) {\n    if(arrayList[i][\"name\"]===ele && arrayList[i][\"value\"]!==\"\") {\n      return arrayList[i];\n    }\n  }\n  return false;\n}\nfor (var i=0;i<arr.length;i++) {\n    var currentWeekEle=searchArray(currentWeekSummary,arr[i]);\n    if(currentWeekEle) {\n      finalWeekArray.push(currentWeekEle);\n    } else {\n      var lastWeekEle=searchArray(lastWeekSummary,arr[i]);\n      if(lastWeekEle) {\n        finalWeekArray.push(lastWeekEle);\n      } else {\n        var defaultObj= {\n          \"name\":arr[i],\n          \"value\": \"NA\"\n        };\n        finalWeekArray.push(defaultObj);\n      }\n    }\n}\n//console.log(\"finalWeekArray\",finalWeekArray);\nfor (var i=0;i<finalWeekArray.length;i++) {\n  if(finalWeekArray[i][\"name\"]===\"keyRisk\") {\n    msg.keyrisk=finalWeekArray[i];\n  } else if (finalWeekArray[i][\"name\"]===\"accomp\") {\n    msg.accomp=finalWeekArray[i];\n  } else if (finalWeekArray[i][\"name\"]===\"summary1\") {\n    msg.summary1=finalWeekArray[i];\n  } else if (finalWeekArray[i][\"name\"]===\"summary2\") {\n    msg.summary2=finalWeekArray[i];\n  }\n}\nmsg.finalWeekArray=finalWeekArray;\n\n\nvar incidentBurn=[\n    [\"Weekly Report (MM/DD/YYYY)\"],\n    [\"New\"],\n    [\"Resolved\"]\n    /*,\n    [\"Open\"],\n    [\"Total Open\"]*/\n];\nvar incidentAgeing= [\n  [\"Incident Count\"]\n];\nvar probrecordAgeing= [\n  [\"Problem Records\"]\n];\nvar categorisation =[\n  [\"Categorization\"],\n  [\"Site Confidence Issues\"],\n    [\"Application Error\"],\n    [\"Service Request IT\"],\n    [\"Service Request Business\"],\n    [\"Misdirected/ Invalid call\"],\n    [\"Training Issues\"],\n    [\"Duplicate call\"],\n    [\"Security Breach\"],\n    [\"Known Error\"],\n    [\"Connectivity Issue - 3rd Party\"]\n];\nvar dailyIncidents=[\n[\"Days\"],\n[\"Incident Count\"],\n[\"Date\"]\n];\n\n\n\n  function nextChar(c) {\n      return String.fromCharCode(c.charCodeAt(0) + 1);\n  }\n\n  var chartObject ={\n  \"type\": \"LineChart\",\n    \"displayed\": false,\n    \"data\": {\n      \"cols\": [{\n          \"id\": \"A\",\n          \"label\": \"NEW A\",\n          \"type\": \"string\"\n        }\n  ],\n      \"rows\":[]\n    },\n    \"options\": {\n      \"title\": \"\",\n              \"height\": 230,\n\n      \"isStacked\": \"true\",\n      \"fill\": 20,\n      \"legend\": {\n        \"position\": \"bottom\"\n      },\n      \"colors\": [\n        \"#4A7EBB\",\n        \"#ff0000\",\n        \"#98B954\",\n        \"#7D60A0\"\n      ],\n      \"displayExactValues\": true,\n      \"vAxis\": {\n        \"title\": \"\",\n        \"gridlines\": {\n          \"count\": 10,\n          \"color\":\"#ffffff\"\n        }\n      },\n      \"hAxis\": {\n        \"title\": \"\",\n        \"gridlines\": {\n          \"color\":\"#000000\"\n        }\n        \n      // slantedText: true,  /* Enable slantedText for horizontal axis */\n       //slantedTextAngle: 90 /* Define slant Angle */\n   \n      }\n    },\n    \"formatters\": {}\n  };\n  var chartObject1= {\n    \"type\": \"BarChart\",\n    \"displayed\": true,\n    \"data\": {\n      \"cols\": [\n        {\n          \"id\": \"A\",\n          \"label\": \"NEW A\",\n          \"type\": \"string\"\n        },\n        {\n          \"id\": \"B\",\n          \"label\": \"Incident Count\",\n          \"type\": \"number\"\n        },\n        {\n          \"id\":\"C\",\n          \"type\": \"string\", \n          \"role\": \"annotation\"\n        }\n      ],\n      \"rows\": []\n    },\n    \"options\": {\n      \"title\": \"\",\n      \"isStacked\": \"false\",\n      \"fill\": 20,\n      \"displayExactValues\": true,\n      \"colors\": [\n        \"#92D050\"\n      ],\n      \"legend\": {\n        \"position\": \"bottom\"\n      },\n      \"vAxis\": {\n        \"title\": \"\",\n        \"gridlines\": {\n          \"count\": 10,\n            \"color\":\"#ffffff\"\n\n        }\n      },\n      \"orientation\": \"horizontal\",\n      \"hAxis\": {\n        \"title\": \"\"\n      },\n      \"annotations\":{\n        \"alwaysOutside\":true,\n        \"textStyle\": {\n            \"bold\": true,\n            \"color\": '#000000',\n          },\n          \"stem\" : {\n            \"length\":0\n          }\n      }\n    },\n    \n    \"formatters\": {}\n\n  }\n\n  var chartObject3 = {\n    \"type\": \"BarChart\",\n    \"displayed\": true,\n    \"data\": {\n      \"cols\": [\n        {\n          \"id\": \"A\",\n          \"label\": \"weeklyAgeing\",\n          \"type\": \"string\"\n        },\n        {\n          \"id\": \"B\",\n          \"label\": \"Problem Records\",\n          \"type\": \"number\"\n        },\n        {\n          \"id\":\"C\",\n          \"type\": \"string\", \n          \"role\": \"annotation\"\n        }\n      ],\n      \"rows\": []\n    },\n    \"options\": {\n      \"title\": \"\",\n      \"isStacked\": \"false\",\n      \"fill\": 20,\n      \"displayExactValues\": true,\n      \"width\": 600,\n      \"colors\": [\n        \"#92D050\"\n      ],\n      \"legend\": {\n        \"position\": \"bottom\"\n      },\n      \"vAxis\": {\n        \"title\": \"\",\n        \"gridlines\": {\n          \"count\": 4,\n            \"color\":\"#ffffff\"\n\n        }\n      },\n      \"orientation\": \"horizontal\",\n      \"hAxis\": {\n        \"title\": \"\"\n      },\n      \"annotations\":{\n        \"alwaysOutside\":true,\n        \"textStyle\": {\n            \"bold\": true,\n            \"color\": '#000000',\n          },\n          \"stem\" : {\n            \"length\":0\n          }\n      }\n\n    },\n    \"formatters\": {}\n  }\n\n  var chartObject4 = {\n    \"type\": \"BarChart\",\n    \"displayed\": true,\n    \"data\": {\n      \"cols\": [\n        {\n          \"id\": \"A\",\n          \"label\": \"Daily Incidents\",\n          \"type\": \"string\"\n        },\n        {\n          \"id\": \"B\",\n          \"label\": \"Daily Incidents Count\",\n          \"type\": \"number\"\n        },\n        {\n          \"id\":\"C\",\n          \"type\": \"string\", \n          \"role\": \"annotation\"\n        }\n      ],\n      \"rows\": []\n    },\n    \"options\": {\n      \"title\": \"\",\n      \"isStacked\": \"false\",\n      \"fill\": 20,\n      \"displayExactValues\": true,\n      \"width\": 600,\n      \"height\":250,\n      \"colors\": [\n        \"#92D050\"\n      ],\n      \"legend\": {\n        \"position\": \"bottom\"\n      },\n      \"vAxis\": {\n        \"title\": \"\",\n        \"gridlines\": {\n          \"count\": 4,\n            \"color\":\"#ffffff\"\n\n        }\n      },\n      \"orientation\": \"horizontal\",\n      \"hAxis\": {\n        \"title\": \"\"\n      },\n      \"annotations\":{\n        \"alwaysOutside\":true,\n        \"textStyle\": {\n            \"bold\": true,\n            \"color\": '#000000',\n          },\n          \"stem\" : {\n            \"length\":0\n          }\n      }\n    },\n    \"formatters\": {}\n  }\n\n  var chartObject2= {\n    \"type\": \"ComboChart\",\n    \"displayed\": true,\n    \"data\": {\n      \"cols\": [\n        {\n          \"id\": \"A\",\n          \"label\": \"NEW A\",\n          \"type\": \"string\"\n        },\n        {\n          \"id\": \"B\",\n          \"label\": \"Current Week\",\n          \"type\": \"number\"\n        },\n                {\n          \"id\":\"C\",\n          \"type\": \"string\", \n          \"role\": \"annotation\"\n        },\n        {\n          \"id\": \"B\",\n          \"label\": \"\",\n          \"type\": \"number\"\n        }\n      ],\n      \"rows\": []\n    },\n    \"options\": {\n      \"title\": \"\",\n      \"isStacked\": \"false\",\n      \"fill\": 20,\n      \"displayExactValues\": true,\n      \"seriesType\": \"bars\",\n      \"width\": 600,\n      \"height\":400,\n      \"series\": {\n        \"1\": {\n          \"type\": \"line\"\n        }\n      },\n      \"colors\": [\n        \"#92D050\",\n        \"#D17E7C\"\n      ],\n      \"legend\": {\n        \"position\": \"bottom\"\n      },\n      \"vAxis\": {\n        \"title\": \"\",\n        \"gridlines\": {\n          \"count\": 5,\n            \"color\":\"#ffffff\"\n\n        }\n      },\n      \"orientation\": \"horizontal\",\n      \"hAxis\": {\n        \"title\": \"\"\n      },\n      \"annotations\":{\n        \"alwaysOutside\":true,\n        \"textStyle\": {\n            \"bold\": true,\n            \"color\": '#000000',\n          },\n          \"stem\" : {\n            \"length\":0\n          }\n      }\n    },\n    \"formatters\": {}\n  }\n\n\nfunction getfulldate(today) { //returns date in mm/dd/yyyy format\n  var currentDate=today.getDate(),\n    currentMonth=today.getMonth()+1;\n  var x=(currentMonth<10)?('0'+currentMonth):currentMonth;\n  var y=(currentDate<10)?('0'+currentDate):currentDate;\n  return (x+'/'+y+'/'+today.getFullYear());\n}\nfunction getLastSunday(d) { //returns last sunday date takes input as mm/dd/yyyy\n    var t = new Date(d);\n    t.setDate(t.getDate() - t.getDay());\n    return t;\n}\nfunction getDateStamp(dateStamp) {\n  var monthName=[\"Jan\", \"Feb\", \"Mar\", \"Apr\", \"May\", \"June\",\"July\", \"Aug\", \"Sept\", \"Oct\", \"Nov\", \"Dec\"];\n  var newDate= new Date(dateStamp);\n  return newDate.getDate()+\"-\"+monthName[newDate.getMonth()]+\"-\"+newDate.getFullYear();\n}\nvar dateArray=[];\nvar lastSundaydate=getLastSunday(getfulldate(new Date()));\ntableDatas[\"date\"]=getDateStamp(lastSundaydate);\nvar lastSunday=getfulldate(lastSundaydate);\nvar i=2;\ndateArray[i-1]=lastSunday;\nincidentBurn[0][i-1]=getDateStamp(new Date(lastSunday));\n//incidentBurn[0][i-1]=lastSunday;\ncategorisation[0][i-1]=getDateStamp(new Date(lastSunday));\nvar lastSunday1=new Date(lastSunday);\ndailyIncidents[0][1]=getfulldate(lastSunday1);\ndailyIncidents[2][1]=getDateStamp(new Date(lastSunday1));\n//console.log(new Date(lastSunday));\n//for (var i=1;i<7;i++) {\ndailyIncidents[0][2]=getfulldate(new Date(lastSunday1.getTime() - (24*60*60*1000*1)));\ndailyIncidents[2][2]=getDateStamp(new Date(new Date(lastSunday1.getTime() - (24*60*60*1000*1))));\n\ndailyIncidents[0][3]=getfulldate(new Date(lastSunday1.getTime() - (24*60*60*1000*2)));\ndailyIncidents[2][3]=getDateStamp(new Date(new Date(lastSunday1.getTime() - (24*60*60*1000*2))));\n\ndailyIncidents[0][4]=getfulldate(new Date(lastSunday1.getTime() - (24*60*60*1000*3)));\ndailyIncidents[2][4]=getDateStamp(new Date(new Date(lastSunday1.getTime() - (24*60*60*1000*3))));\n\ndailyIncidents[0][5]=getfulldate(new Date(lastSunday1.getTime() - (24*60*60*1000*4)));\ndailyIncidents[2][5]=getDateStamp(new Date(new Date(lastSunday1.getTime() - (24*60*60*1000*4))));\n\ndailyIncidents[0][6]=getfulldate(new Date(lastSunday1.getTime() - (24*60*60*1000*5)));\ndailyIncidents[2][6]=getDateStamp(new Date(new Date(lastSunday1.getTime() - (24*60*60*1000*5))));\n\ndailyIncidents[0][7]=getfulldate(new Date(lastSunday1.getTime() - (24*60*60*1000*6)));\ndailyIncidents[2][7]=getDateStamp(new Date(new Date(lastSunday1.getTime() - (24*60*60*1000*6))));\n\nfor (var z=1;z<dailyIncidents[0].length;z++) {\nvar dateDaily=new Date(dailyIncidents[0][z]);\nvar sev1sev2=0,sev3sev4=0;\n  for (var je=0;je<msg.incidentData.length;je++) {\n    var getDate1=msg.incidentData[je][\"Reported Date+\"];\n      var daterange1=getDate1.substring(0, getDate1.indexOf(' '));\n      var check1=new Date(daterange1);\n      //console.log(check1)\n      if(check1.getTime()==dateDaily.getTime() && (msg.incidentData[je][\"Priority*\"]===\"Critical\" || msg.incidentData[je][\"Priority*\"]===\"High\")) {\n        sev1sev2++;\n       }\n  }\n  for (var je=0;je<msg.aecomData.length;je++) {\n    var getDate2=msg.aecomData[je][\"Reported Date+\"];\n      var daterange2=getDate2.substring(0, getDate2.indexOf(' '));\n      var check2=new Date(daterange2);\n      //console.log(check1)\n      if(check2.getTime()==dateDaily.getTime() && (msg.aecomData[je][\"Priority*\"]===\"Medium\" || msg.aecomData[je][\"Priority*\"]===\"Low\")) {\n        sev3sev4++;\n       }\n  }\n  dailyIncidents[1][z]=sev1sev2+sev3sev4;\n    //dailyIncidents[1][z+1]=sev3sev4;\n}\nvar sev1Count=0,sev2Count=0,sev3Count=0,sev4Count=0;\n\n/*var mySunday=getLastSunday(getfulldate(new Date()));\nvar mySundaydate=getfulldate(mySunday);\ndailyIncidents[0][1]=mySundaydate;\nconsole.log(dailyIncidents);\nfor (var i=1;i<=6;i++) {\n  //console.log(new Date(getfulldate(getfulldate(new Date()).getDate();\n  //var ndate=new Date(new Date(mySundaydate).setDate(new Date(mySundaydate).getDate() - i)).setHours(0,0,0,0);\n  //console.log(ndate);\n  //console.log(new Date(new Date(new Date(getfulldate(getLastSunday(getfulldate(new Date())))).setDate(new Date(getfulldate(getLastSunday(getfulldate(new Date())))).getDate() - i)).setHours(0,0,0,0)));\n\n}*/\n/***daily data**/\n/*var dailyIncidents=[\n[\"Days\"],\n[\"Incident Count\"]\n];\nvar mySunday=getLastSunday(getfulldate(new Date()));\nvar mySundaydate=getfulldate(mySunday);\ndailyIncidents[0][1]=mySundaydate;\nfor (var i=1;i<=6;i++) {\n  console.log(new Date(new Date(new Date(mySundaydate).setDate(new Date(mySundaydate).getDate() - i)).setHours(0,0,0,0)));\n\n}*/\n\n/****/\ndo{\n  var newlastSundaydate=new Date(lastSundaydate.setDate(lastSundaydate.getDate() - 7));\n  var newlastSunday=getfulldate(newlastSundaydate);\n  dateArray[i]=newlastSunday;\n  incidentBurn[0][i]=getDateStamp(new Date(newlastSunday));\n  //incidentBurn[0][i]=newlastSunday;\n  categorisation[0][i]=getDateStamp(new Date(newlastSunday));\n  lastSundaydate=newlastSundaydate;\n  lastSunday=newlastSunday;\n  i++;\n} while(i<7);\n//console.log(\"dateArray\",dateArray);\n//console.log(\"incidentBurn\",incidentBurn);\n\nvar criticalCount=0,highCount=0,lowCount=0,incidentAgePopulate=true,checkforFirstItr=true,incidentAge1=0,incidentAge2=0,incidentAge3=0,incidentAge4=0,ProbRecordAge1=0,ProbRecordAge2=0,ProbRecordAge3=0,ProbRecordAge4=0,oneWeekCritical=0,oneWeekHigh=0,criticalIncidentObj=[],highIncidentObj=[];\n/***Find date range***/\nvar todayDate=new Date();\ntodayDate.setHours(0,0,0);\nvar day1=new Date(todayDate.setDate(todayDate.getDate() - 1)).setHours(0,0,0,0);\nvar day7=new Date(todayDate.setDate(todayDate.getDate() - 7)).setHours(0,0,0,0);\nvar day8=new Date(todayDate.setDate(todayDate.getDate() - 1)).setHours(0,0,0,0);\nvar day14=new Date(todayDate.setDate(todayDate.getDate() - 6)).setHours(0,0,0,0);\nvar day15=new Date(todayDate.setDate(todayDate.getDate() - 1)).setHours(0,0,0,0);\nvar day30=new Date(todayDate.setDate(todayDate.getDate() - 6)).setHours(0,0,0,0);\nvar today=new Date();\nvar day6=new Date(new Date().setDate(new Date().getDate()-25));\nfor (var i=1;i<incidentBurn[0].length;i++) {\n  //var dateTo=incidentBurn[0][i];\n  var dateTo=dateArray[i];\n    var to=new Date(dateTo);\n    var newto=new Date(dateTo);\n    var dateFrom=new Date(newto.setDate(newto.getDate() - 6));\n    var category=[0,0,0,0,0,0,0,0,0,0];\n\n    var incidentCount=0,d13=0,e13=0,b13=0,c13=0,d14=0,e14=0,f3a=0,f3b=0,f4a=0,f4b=0,f5a=0,f5b=0;\n  for (var j=0;j<msg.incidentData.length;j++) {\n    var getDate=msg.incidentData[j][\"Reported Date+\"];\n      var daterange=getDate.substring(0, getDate.indexOf(' '));\n      var check=new Date(daterange);\n      var getClosedDate=msg.incidentData[j][\"Closed Date\"];\n\n\n      /****incident ageing****/\n      if (incidentAgePopulate && (msg.incidentData[j][\"Status*\"]===\"Assigned\" || msg.incidentData[j][\"Status*\"]===\"Pending\")) {\n      \n      if(check<=day1 && check>=day7) {\n        incidentAge1++;\n      } else if (check<=day8 && check>=day14) {\n        incidentAge2++;\n      } else if (check<=day15 && check>=day30) {\n        incidentAge3++\n      } else incidentAge4++;\n    } else if (incidentAgePopulate) {\n\n      if(check<=today && check>=day6) {\n\n        if(msg.incidentData[j][\"Priority*\"]===\"Critical\") {\n          oneWeekCritical++;\n          criticalIncidentObj.push({\"Priority\":\"Sev1\",\"incidentId\":msg.incidentData[j][\"Incident ID*+\"],\"summary\":msg.incidentData[j][\"Summary*\"]});\n\n        }\n        else if (msg.incidentData[j][\"Priority*\"]===\"High\"){\n          oneWeekHigh++;\n          highIncidentObj.push({\"Priority\":\"Sev2\",\"incidentId\":msg.incidentData[j][\"Incident ID*+\"],\"summary\":msg.incidentData[j][\"Summary*\"]});\n        }\n\n      } \n\n      if(check >= dateFrom && check <= to ) {\n        if(msg.incidentData[j][\"Priority*\"]===\"Critical\")\n        {\n          sev1Count++;\n        } else if (msg.incidentData[j][\"Priority*\"]===\"High\") {\n          sev2Count++;\n        }\n          \n        }\n\n\n    }\n    /**/\n\n      if(msg.incidentData[j][\"Status*\"]===\"Assigned\" && (msg.incidentData[j][\"Priority*\"]===\"Medium\" || msg.incidentData[j][\"Priority*\"]===\"Critical\" || msg.incidentData[j][\"Priority*\"]===\"High\"))\n    {\n      f3a++;\n    }\n    else if(msg.incidentData[j][\"Status*\"]===\"In Progress\" && (msg.incidentData[j][\"Priority*\"]===\"Medium\" || msg.incidentData[j][\"Priority*\"]===\"Critical\" || msg.incidentData[j][\"Priority*\"]===\"High\"))\n    {\n      f4a++;\n    } \n    else if (msg.incidentData[j][\"Status*\"]===\"Pending\" && (msg.incidentData[j][\"Priority*\"]===\"Medium\" || msg.incidentData[j][\"Priority*\"]===\"Critical\" || msg.incidentData[j][\"Priority*\"]===\"High\"))\n    {\n      f5a++;\n    } \n\n      if(getClosedDate!==undefined) {\n        var ClosedDaterange=new Date(getClosedDate.substring(0, getClosedDate.indexOf(' ')));\n        if(ClosedDaterange >= dateFrom && ClosedDaterange <= to) {\n          if(msg.incidentData[j][\"Priority*\"]===\"Medium\")\n        {\n          d14++;\n        }\n        }\n\n      }\n    if(check >= dateFrom && check <= to ) {\n      if(msg.incidentData[j][\"Priority*\"]===\"Medium\")\n      {\n        d13++;\n      }\n      if(msg.incidentData[j][\"Priority*\"]===\"Low\")\n      {\n        e13++;\n      }\n      if(msg.incidentData[j][\"Priority*\"]===\"Critical\")\n      {\n        b13++;\n      }\n      if(msg.incidentData[j][\"Priority*\"]===\"High\")\n      {\n        c13++;\n      }\n\n      if(msg.incidentData[j][\"Resolution Categorization Tier 2\"]===\"Site Confidence Issues\") {\n        category[0]++;\n      } else if (msg.incidentData[j][\"Resolution Categorization Tier 2\"]===\"Application Error\") {\n        category[1]++;\n      } else if(msg.incidentData[j][\"Resolution Categorization Tier 2\"]===\"Service Request IT\") {\n        category[2]++;\n      } else if(msg.incidentData[j][\"Resolution Categorization Tier 2\"]===\"Service Request Business\") {\n        category[3]++;\n      } else if(msg.incidentData[j][\"Resolution Categorization Tier 2\"]===\"Misdirected/ Invalid call\") {\n        category[4]++;\n      } else if(msg.incidentData[j][\"Resolution Categorization Tier 2\"]===\"Training Issues\") {\n        category[5]++;\n      } else if(msg.incidentData[j][\"Resolution Categorization Tier 2\"]===\"Duplicate call\") {\n        category[6]++;\n      } else if(msg.incidentData[j][\"Resolution Categorization Tier 2\"]===\"Security Breach\") {\n        category[7]++;\n      } else if(msg.incidentData[j][\"Resolution Categorization Tier 2\"]===\"Known Error\") {\n        category[8]++;\n      } else if(msg.incidentData[j][\"Resolution Categorization Tier 2\"]===\"Connectivity Issue - 3rd Party\") {\n        category[9]++;\n      } \n          \n      }\n      \n  }\n\n  for (var j=0;j<10;j++) {\n    categorisation[j+1][i]=category[j];\n  }\n  incidentAgePopulate=false;\n  for (var j=0;j<msg.aecomData.length;j++) {\n    var getDate=msg.aecomData[j][\"Reported Date+\"];\n      var daterange=getDate.substring(0, getDate.indexOf(' '));\n      var check=new Date(daterange);\n      var getClosedDate=msg.aecomData[j][\"Last Modified Date\"];\n\n      if(msg.aecomData[j][\"Status*\"]===\"Assigned\" && msg.aecomData[j][\"Priority*\"]===\"Low\") {\n        f3b++;\n      }\n      \n      else if(msg.aecomData[j][\"Status*\"]===\"In Progress\" && msg.aecomData[j][\"Priority*\"]===\"Low\") {\n        f4b++;\n      }\n      else if (msg.aecomData[j][\"Status*\"]===\"Pending\" && msg.aecomData[j][\"Priority*\"]===\"Low\") {\n        f5b++;\n      }\n\n      if(getClosedDate !==undefined) {\n        var ClosedDaterange=new Date(getClosedDate.substring(0, getClosedDate.indexOf(' ')));\n        if(ClosedDaterange >= dateFrom && ClosedDaterange <= to) {\n          if(msg.aecomData[j][\"Priority*\"]===\"Low\" && (msg.aecomData[j][\"Status*\"]===\"Resolved\" || msg.incidentData[j][\"Status*\"]===\"Closed\"))\n        {\n          e14++;\n        }\n        }\n      }\n    if(check >= dateFrom && check <= to ) {\n      \n      if(msg.aecomData[j][\"Priority*\"]===\"Low\")\n      {\n        e13++;\n      }\n        \n      }\n      if(checkforFirstItr) {\n        if(check >= dateFrom && check <= to ) {\n        if(msg.aecomData[j][\"Priority*\"]===\"Medium\")\n        {\n          sev3Count++;\n        } else if (msg.aecomData[j][\"Priority*\"]===\"Low\") {\n          sev4Count++;\n        }\n          \n        }\n      }\n      \n  }\n  incidentBurn[1][i]=d13+e13;\n  incidentBurn[2][i]=d14+e14;\n  //incidentBurn[3][i]=f3a+f3b+f4a+f4b;\n  msg.totalOpen=f3a+f3b+f4a+f4b+f5a+f5b;\n  checkforFirstItr=false;\n}\n//populating incidentAgeing \nincidentAgeing[0].push(incidentAge1,incidentAge2,incidentAge3,incidentAge4);\nvar totalResolved=0,avgResolved;\nfor (var i=1;i<incidentBurn[2].length;i++) {\n  totalResolved=totalResolved+incidentBurn[2][i];\n}\navgResolved=totalResolved/(incidentBurn[2].length-1);\nconsole.log(\"avg\",avgResolved);\n\n/***populating incidentAgeingChart data***/\n  var alpha='A';\n  for (var i=0;i<incidentAgeing.length;i++) {\n    /*var charObj=\n    {\n          \"id\": \"\",\n          \"label\": \"\",\n          \"type\": \"number\"\n        };\n      charObj.id=nextChar(alpha);\n      alpha=nextChar(alpha);\n      charObj.label=incidentAgeing[i][0];\n      chartObject1.data.cols.push(charObj);*/\n  }\n  var daysCount=[\"0-7 Days\",\"8-14 Days\",\"15-30 Days\",\"30+ Days\"];\n  for (var j=1;j<incidentAgeing[0].length;j++){\n    var abc={\n    \"c\": []\n    };\n    var obj= {\n          \"v\": j-1,\n          \"f\": daysCount[j-1]\n        }\n        var obj1=\n        {\n          \"v\": incidentAgeing[0][j]\n        };\n    \n    abc.c.push(obj);\n    abc.c.push(obj1);\n    abc.c.push(obj1);\n    chartObject1.data.rows.push(abc);\n  }\n/***populating incidentBurnChart data***/\n\nvar alpha='A';\n\nfor (var i=1;i<incidentBurn.length;i++) {\n    var charObj=\n    {\n      \"id\": \"\",\n      \"label\": \"\",\n      \"type\": \"number\"\n    };\n    charObj.id=nextChar(alpha);\n    alpha=nextChar(alpha);\n    charObj.label=incidentBurn[i][0];\n    chartObject.data.cols.push(charObj);\n}\nvar newcharObj= {\n  \"id\":nextChar(alpha),\n  \"label\":\"Average\",\n  \"type\":\"number\"\n};\nchartObject.data.cols.push(newcharObj);\n\n\nfor (var i=1;i<incidentBurn[0].length;i++) {\n  var abc={\n  \"c\": []\n  };\n  for (var j=0;j<incidentBurn.length;j++){\n    if(i===1 && j===0) {\n      var obj={\n              \"v\": 0,\n              \"f\": incidentBurn[j][i]\n            }\n    } else {\n      var obj={\n        \"v\":incidentBurn[j][i]\n      }\n    }\n    abc.c.push(obj);\n  }\n  chartObject.data.rows.push(abc);\n}\nconsole.log(chartObject.data.rows.length);\nvar obk={\"v\":avgResolved};\nfor (var i=0;i<chartObject.data.rows.length;i++) {\n  chartObject.data.rows[i][\"c\"].push(obk);\n}\n//var obk={\"v\":avgResolved};\n\n//chartObject.data.rows.push(obk);\n\n\nfor (var i=1;i<dailyIncidents[0].length;i++) {\n  var abc={\n  \"c\": []\n  };\n      var obj={\n              \"v\": i-1,\n              \"f\": dailyIncidents[2][i]\n            }\n      var obj1={\n        \"v\":dailyIncidents[1][i]\n      }\n    abc.c.push(obj);\n    abc.c.push(obj1);\n    abc.c.push(obj1);\n\n  chartObject4.data.rows.push(abc);\n}\n/***probrecord Ageing***/\nfor (var i=0;i<msg.probRecords.length;i++) {\n    var getDate=msg.probRecords[i][\"Submit Date\"];\n    var daterange=getDate.substring(0, getDate.indexOf(' '));\n    var check=new Date(daterange);\n    /****probRecord ageing****/\n    if (msg.probRecords[i][\"Status*\"]===\"Draft\" || msg.probRecords[i][\"Status*\"]===\"Under Review\"){\n    if(check<=day1 && check>=day7) {\n      ProbRecordAge1++;\n    } else if (check<=day8 && check>=day14) {\n      ProbRecordAge2++;\n    } else if (check<=day15 && check>=day30) {\n      ProbRecordAge3++\n    } else ProbRecordAge4++;\n  }\n  \n}\nprobrecordAgeing[0].push(ProbRecordAge1,ProbRecordAge2,ProbRecordAge3,ProbRecordAge4);\n\nfor (var j=1;j<probrecordAgeing[0].length;j++){\n    var abc={\n    \"c\": []\n    };\n    var obj= {\n          \"v\": j-1,\n          \"f\": daysCount[j-1]\n        }\n        var obj1=\n        {\n          \"v\": probrecordAgeing[0][j]\n        };\n    \n    abc.c.push(obj);\n    abc.c.push(obj1);\n    abc.c.push(obj1);\n    chartObject3.data.rows.push(abc);\n  }\n\n  for (var i=1;i<categorisation.length;i++) {\n    //console.log(categorisation[i+1][0]);\n    var abc={\n      \"c\":[]\n    };\n    var obj={\n      \"v\":i,\n      \"f\":categorisation[i][0]\n    }\n    var obj1= {\n      \"v\":categorisation[i][1]\n    };\n    var obj2={\n      \"v\":categorisation[i][2]\n    }\n    abc.c.push(obj);\n    abc.c.push(obj1);\n    abc.c.push(obj1);\n\n    abc.c.push(obj2);\n    chartObject2.data.rows.push(abc);\n\n  }\n  chartObject2.data.cols[1][\"label\"]=\"Current week \"+categorisation[0][1];\n  chartObject2.data.cols[3][\"label\"]=\"week ending \"+categorisation[0][2];\n\n  var chartObject5={\n    \"type\": \"PieChart\",\n    \"displayed\": false,\n    \"data\": {\n      \"cols\": [\n        {\n          \"id\": \"A\",\n          \"label\": \"NEW A\",\n          \"type\": \"string\"\n        },\n        {\n          \"id\": \"B\",\n          \"label\": \"Sev1\",\n          \"type\": \"number\"\n        },\n        {\n          \"id\": \"C\",\n          \"label\": \"Sev2\",\n          \"type\": \"number\"\n        }\n      ],\n      \"rows\": [\n        {\n          \"c\": [\n            {\n              \"v\": 1,\n              \"f\": \"Sev1\"\n            },\n            {\n              \"v\": sev1Count\n            }\n          ]\n        },\n        {\n          \"c\": [\n            {\n              \"v\": 2,\n              \"f\": \"Sev2\"\n            },\n            {\n              \"v\": sev2Count\n            }\n\n          ]\n        },\n        {\n          \"c\": [\n            {\n              \"v\": 3,\n              \"f\": \"Sev3\"\n            },\n            {\n              \"v\": sev3Count\n            }\n          ]\n        },\n        {\n          \"c\": [\n            {\n              \"v\": 4,\n              \"f\": \"Sev4\"\n            },\n            {\n              \"v\": sev4Count\n            }\n          ]\n        }\n        \n        \n        \n      ]\n    },\n    \"options\": {\n      \"title\": \"\",\n      \"isStacked\": \"true\",\n      \"fill\": 20,\n      \"displayExactValues\": true,\n      //\"seriesType\": \"bars\",\n      \"width\": 600,\n      \"colors\": [\n        \"#92D050\",\n        \"#D20000\",\n        \"#E17E7C\",\n        \"#127E7C\"\n      ],\n      \"vAxis\": {\n        \"title\": \"\",\n        \"gridlines\": {\n          \"count\": 10,\n            \"color\":\"#ffffff\"\n\n        }\n      },\n      //\"orientation\": \"horizontal\",\n      \"hAxis\": {\n        \"title\": \"\"\n      }\n    },\n    \"formatters\": {}\n  }\n  \nmsg.chartObject=JSON.stringify(chartObject);\nmsg.chartObject1=JSON.stringify(chartObject1);\nmsg.chartObject2=JSON.stringify(chartObject2);\nmsg.chartObject3=JSON.stringify(chartObject3);\nmsg.chartObject4=JSON.stringify(chartObject4);\nmsg.chartObject5=JSON.stringify(chartObject5);\ntableDatas[\"incidentBurn\"]=incidentBurn;\ntableDatas[\"incidentAgeing\"]=incidentAgeing;\ntableDatas[\"probrecordAgeing\"]=probrecordAgeing;\ntableDatas[\"categorisation\"]=categorisation;\n\nmsg.summaryInfo={\n  \"oneWeekCritical\":oneWeekCritical,\n  \"oneWeekHigh\":oneWeekHigh,\n  \"criticalIncident\":criticalIncidentObj,\n  \"highIncident\":highIncidentObj\n}\n\n\n/***known errors****/\nvar knownErrorDatas=[\n    [\"JIRA\",\"Description\",,,,,,,\"Fix Planned\",\"Identified\",\"Mitigation\"]\n    //[\"Weekly Report (MM/DD/YYYY)\"],\n    //[\"Overall\",\"Green\",\"Green\",\"Green\",\"Green\",\"Green\",\"Green\"],\n    //[\"Incidents\"],\n    //[\"Problem Records\"]\n];\nknownErrorDatas[1]=new Array(11);\nknownErrorDatas[1]=[]\nknownErrorDatas[2]=new Array(11);\n\nvar months=[\"January\",\"February\",\"March\",\"April\",\"May\",\"June\",\"July\",\"August\",\"September\",\"October\",\"November\",\"December\"];\n\n\nvar lastSundaydaten=getLastSunday(getfulldate(new Date()));\nvar monthNames=lastSundaydaten.getMonth();\nfor (var i=0;i<6;i++) {\n    var nameMonth=months[monthNames-i];\n    knownErrorDatas[0][i+2]=\"No of occurences in \"+nameMonth;\n    \n    \n}\ntableDatas[\"knownErrorData\"]=knownErrorDatas;\n\n/***dependencies**/\nvar dependenciesData=[\n    [\"PMR Tracker\",\"Dependency Detail\",\"Status\",\"Owner\",\"Comments\",\"Next Step Owner\",\"Last Update Date\",\"Last Update By\"],\n    //[\"Weekly Report (MM/DD/YYYY)\"],\n    //[\"Overall\",\"Green\",\"Green\",\"Green\",\"Green\",\"Green\",\"Green\"],\n    //[\"Incidents\"],\n    //[\"Problem Records\"]\n];\ndependenciesData[1]=new Array(8);\n\ntableDatas[\"dependenciesData\"]=dependenciesData;\n\nmsg.tableDatas= JSON.stringify(tableDatas);\nmsg.tableData=tableDatas;\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 730.4762115478516,
        "y": 214.9205961227417,
        "wires": [
            [
                "9658e19f.b910d"
            ]
        ]
    }
]